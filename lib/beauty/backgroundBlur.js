!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MarsBlur=t():e.MarsBlur=t()}("undefined"==typeof window?global:window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=50)}([function(e,t,n){"use strict";function r(e){for(var t=arguments,n=function(n){var r=t[n];r&&Object.keys(r).forEach((function(t){e[t]=r[t]}))},r=1;r<arguments.length;r++)n(r);return e}function i(e,t){if("string"==typeof e){var n=e;e=new Image,t||/^data:/.test(n)||(e.crossOrigin="*"),e.src=n}return e.complete?Promise.resolve(e):new Promise((function(t,n){e.onload=function(){return e.onload=null,t(e)},e.onerror=function(t){return e.onerror=null,n(t)}}))}function a(e,t){var n=e.indexOf(t);if(n>-1)return e.splice(n,1),!0}function o(e,t){if(-1===e.indexOf(t))return e.push(t),!0}function s(e,t,n){if(c(e))if(void 0===n&&(n=e),e instanceof Array||"length"in e)Array.prototype.slice.call(e).forEach(t,n);else for(var r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r);return e}function u(e){return"function"==typeof e}function c(e){return"object"==typeof e&&e}function l(e){return"string"==typeof e}function f(){}function h(e,t){if(e.fill)e.fill(t);else for(var n=0;n<e.length;n++)e[n]=t;return e}function d(e,t){return e+Math.random()*(t-e)}function _(e,t){var n=Math.floor(Math.random()*e.length),r=e[n];return t||e.splice(n,1),r}function m(e,t){return t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest;i.responseType=t.responseType||"json",i.addEventListener("load",(function(){return n(i.response)})),i.addEventListener("error",r),i.open(t.method||"get",e),i.send(t.data)}))}function p(e){return e===parseInt(e,10)}function v(e){var t,n=0;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}n.d(t,"k",(function(){return r})),n.d(t,"i",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"j",(function(){return f})),n.d(t,"b",(function(){return h})),n.d(t,"l",(function(){return d})),n.d(t,"m",(function(){return _})),n.d(t,"n",(function(){return m})),n.d(t,"f",(function(){return p})),n.d(t,"o",(function(){return v})),Array.prototype.find||(Array.prototype.find=function(e,t){for(var n=t||this,r=0;r<this.length;r++){var i=this[r];if(e.call(n,i,r))return i}},Array.prototype.findIndex=function(e,t){for(var n=t||this,r=0;r<this.length;r++){var i=this[r];if(e.call(n,i,r))return r}})},function(e,t,n){"use strict";function r(e,t,n){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]+n[r];return e}function i(e,t,n){if(t&&n){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]+n[r];return e}return t||n}function a(e,t,n){if(t&&n){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]*n[r];return e}return t||n}function o(e,t,n){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]-n[r];return e}function s(e,t){for(var n=0,r=0,i=e.length;r<i;r++){var a=e[r]-t[r];n+=a*a}return n}n.d(t,"k",(function(){return r})),n.d(t,"l",(function(){return i})),n.d(t,"o",(function(){return a})),n.d(t,"n",(function(){return o})),n.d(t,"r",(function(){return s})),n.d(t,"q",(function(){return c})),n.d(t,"p",(function(){return l})),n.d(t,"m",(function(){return f})),n.d(t,"g",(function(){return h})),n.d(t,"i",(function(){return d})),n.d(t,"j",(function(){return _})),n.d(t,"h",(function(){return m})),n.d(t,"e",(function(){return p})),n.d(t,"d",(function(){return v})),n.d(t,"b",(function(){return g})),n.d(t,"c",(function(){return y})),n.d(t,"a",(function(){return T})),n.d(t,"f",(function(){return x}));var u=Number.EPSILON||Math.pow(2,-32);function c(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n]*e[n];return 0===(t=Math.sqrt(t))?e.slice():e.map((function(e){return e/t}))}function l(e,t,n){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]*n;return e}function f(e,t,n){if(isNaN(n)){for(var r=0,i=0,a=t.length;i<a;i++)r+=e[i]*t[i];return r}for(var o=0,s=t.length;o<s;o++)e[o]=t[o]*n;return e}function h(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e}function d(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e}function _(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15]||1;return e[0]=(n[0]*r+n[4]*i+n[8]*a)/o,e[1]=(n[1]*r+n[5]*i+n[9]*a)/o,e[2]=(n[2]*r+n[6]*i+n[10]*a)/o,e}function m(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e}function p(e){var t,n;return t=Math.sin(e),[n=Math.cos(e),t,0,-t,n,0,0,0,1]}function v(e){var t=Math.cos(e[0]),n=Math.cos(e[1]),r=Math.cos(e[2]),i=Math.sin(e[0]),a=Math.sin(e[1]),o=Math.sin(e[2]);return[n*r,n*o,-a,-t*o+i*a*r,t*r+i*a*o,i*n,o*i+t*a*r,-i*r+t*a*o,t*n]}function g(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],_=t[12],m=t[13],p=t[14],v=t[15],g=n*s-r*o,y=n*u-i*o,E=n*c-a*o,T=r*u-i*s,x=r*c-a*s,A=i*c-a*u,O=l*m-f*_,b=l*p-h*_,M=l*v-d*_,S=f*p-h*m,R=f*v-d*m,L=h*v-d*p,C=g*L-y*R+E*S+T*M-x*b+A*O;return C?(C=1/C,e[0]=(s*L-u*R+c*S)*C,e[1]=(i*R-r*L-a*S)*C,e[2]=(m*A-p*x+v*T)*C,e[3]=(h*x-f*A-d*T)*C,e[4]=(u*M-o*L-c*b)*C,e[5]=(n*L-i*M+a*b)*C,e[6]=(p*E-_*A-v*y)*C,e[7]=(l*A-h*E+d*y)*C,e[8]=(o*R-s*M+c*O)*C,e[9]=(r*M-n*R-a*O)*C,e[10]=(_*x-m*E+v*g)*C,e[11]=(f*E-l*x-d*g)*C,e[12]=(s*b-o*S-u*O)*C,e[13]=(n*S-r*b+i*O)*C,e[14]=(m*y-_*T-p*g)*C,e[15]=(l*T-f*y+h*g)*C,e):null}function y(e){for(var t=0,n=e.length;t<n;t++)if(Math.abs(e[t])>u)return!1;return!0}var E=Array.isArray;function T(e){return E(e)?[e[0],e[1],e[2]]:[0,0,0]}function x(e,t,n){var r=Math.cos(n),i=Math.sin(n),a=t[0],o=t[1];return e[0]=r*a+i*o,e[1]=-i*a+r*o,e}},function(e,t,n){"use strict";var r,i;function a(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w}n.r(t),n.d(t,"ABoxCollider",(function(){return nn})),n.d(t,"ACollider",(function(){return tn})),n.d(t,"ASphereCollider",(function(){return rn})),n.d(t,"AmbientLight",(function(){return qt})),n.d(t,"Animation",(function(){return Or})),n.d(t,"AnimationClip",(function(){return yr})),n.d(t,"AnimationEvent",(function(){return ur})),n.d(t,"AssetObject",(function(){return ht})),n.d(t,"AssetPromise",(function(){return N})),n.d(t,"AssetPromiseStatus",(function(){return y})),n.d(t,"AssetType",(function(){return Ht})),n.d(t,"BasicRenderPipeline",(function(){return Ct})),n.d(t,"BlendFunc",(function(){return xe})),n.d(t,"BlinnPhongMaterial",(function(){return Rr})),n.d(t,"BoundingType",(function(){return Re})),n.d(t,"BoxCollider",(function(){return ti})),n.d(t,"Buffer",(function(){return Kn})),n.d(t,"BufferBindFlag",(function(){return Gn})),n.d(t,"BufferGeometry",(function(){return Dr})),n.d(t,"BufferUsage",(function(){return Pn})),n.d(t,"BufferUtil",(function(){return Wn})),n.d(t,"Camera",(function(){return Ft})),n.d(t,"CircleGeometry",(function(){return kr})),n.d(t,"ClearMode",(function(){return ne})),n.d(t,"ColliderFeature",(function(){return en})),n.d(t,"CollisionDetection",(function(){return ii})),n.d(t,"CommonMaterial",(function(){return br})),n.d(t,"CompFunc",(function(){return _e})),n.d(t,"ComplexMaterial",(function(){return zn})),n.d(t,"Component",(function(){return Ze})),n.d(t,"ConstantMaterial",(function(){return Mr})),n.d(t,"CubeProbe",(function(){return yi})),n.d(t,"CuboidGeometry",(function(){return Br})),n.d(t,"CullFace",(function(){return le})),n.d(t,"CylinderGeometry",(function(){return Gr})),n.d(t,"DataType",(function(){return ge})),n.d(t,"DirectLight",(function(){return Yt})),n.d(t,"EXP2Fog",(function(){return oi})),n.d(t,"Engine",(function(){return ct})),n.d(t,"EngineFeature",(function(){return ft})),n.d(t,"EngineObject",(function(){return Q})),n.d(t,"Entity",(function(){return rt})),n.d(t,"EnvironmentMapLight",(function(){return Qt})),n.d(t,"Event",(function(){return G})),n.d(t,"EventDispatcher",(function(){return $})),n.d(t,"FogFeature",(function(){return li})),n.d(t,"FrontFace",(function(){return ue})),n.d(t,"GLCapabilityType",(function(){return Ce})),n.d(t,"GLCompressedTextureInternalFormat",(function(){return En})),n.d(t,"GPUParticleSystem",(function(){return Qr})),n.d(t,"GeometryRenderer",(function(){return Ur})),n.d(t,"IndexBufferBinding",(function(){return Qn})),n.d(t,"IndexFormat",(function(){return Un})),n.d(t,"InternalAssetType",(function(){return ee})),n.d(t,"InterpolationType",(function(){return lr})),n.d(t,"LODGroup",(function(){return Bn})),n.d(t,"LambertMaterial",(function(){return Sr})),n.d(t,"Layer",(function(){return ze})),n.d(t,"Light",(function(){return Wt})),n.d(t,"LightFeature",(function(){return $t})),n.d(t,"LinearFog",(function(){return fi})),n.d(t,"Loader",(function(){return kt})),n.d(t,"Logger",(function(){return Be})),n.d(t,"MaskList",(function(){return Oe})),n.d(t,"Material",(function(){return Hn})),n.d(t,"MaterialType",(function(){return ie})),n.d(t,"Mesh",(function(){return un})),n.d(t,"MeshRenderer",(function(){return Mn})),n.d(t,"Model",(function(){return Wr})),n.d(t,"OITMode",(function(){return we})),n.d(t,"ObjectValues",(function(){return U})),n.d(t,"PBRMaterial",(function(){return Kr})),n.d(t,"Particle",(function(){return Zr})),n.d(t,"PlaneCollider",(function(){return an})),n.d(t,"PlaneGeometry",(function(){return zr})),n.d(t,"PlaneProbe",(function(){return _i})),n.d(t,"PointLight",(function(){return Zt})),n.d(t,"Primitive",(function(){return Jn})),n.d(t,"PrimitiveTopology",(function(){return qn})),n.d(t,"Probe",(function(){return di})),n.d(t,"RefObject",(function(){return jt})),n.d(t,"RefreshRate",(function(){return Me})),n.d(t,"RenderBufferColorFormat",(function(){return xn})),n.d(t,"RenderBufferDepthFormat",(function(){return On})),n.d(t,"RenderColorTexture",(function(){return vr})),n.d(t,"RenderContext",(function(){return bt})),n.d(t,"RenderDepthTexture",(function(){return mr})),n.d(t,"RenderPass",(function(){return Ot})),n.d(t,"RenderQueue",(function(){return Rt})),n.d(t,"RenderState",(function(){return oe})),n.d(t,"RenderTarget",(function(){return pr})),n.d(t,"RenderTechnique",(function(){return ar})),n.d(t,"RenderableComponent",(function(){return xt})),n.d(t,"ResourceManager",(function(){return V})),n.d(t,"Scene",(function(){return ot})),n.d(t,"SceneFeature",(function(){return _t})),n.d(t,"SceneVisitor",(function(){return dt})),n.d(t,"ScreenQuadGeometry",(function(){return jr})),n.d(t,"Script",(function(){return gt})),n.d(t,"SetDataOptions",(function(){return jn})),n.d(t,"ShaderFactory",(function(){return ir})),n.d(t,"ShaderMaterial",(function(){return wr})),n.d(t,"ShapeGeometry",(function(){return Vr})),n.d(t,"Side",(function(){return he})),n.d(t,"Skin",(function(){return cn})),n.d(t,"SkinnedMeshRenderer",(function(){return wn})),n.d(t,"SkyBox",(function(){return Yr})),n.d(t,"SphereCollider",(function(){return ni})),n.d(t,"SphereGeometry",(function(){return Hr})),n.d(t,"SpotLight",(function(){return Jt})),n.d(t,"SpriteRenderer",(function(){return gr})),n.d(t,"SubPrimitive",(function(){return er})),n.d(t,"SystemInfo",(function(){return lt})),n.d(t,"Texture",(function(){return Sn})),n.d(t,"Texture2D",(function(){return Rn})),n.d(t,"TextureCubeFace",(function(){return nr})),n.d(t,"TextureCubeMap",(function(){return _r})),n.d(t,"TextureFilter",(function(){return pe})),n.d(t,"TextureFilterMode",(function(){return _n})),n.d(t,"TextureFormat",(function(){return pn})),n.d(t,"TextureMaterial",(function(){return Cr})),n.d(t,"TextureWrapMode",(function(){return gn})),n.d(t,"Time",(function(){return He})),n.d(t,"TorusGeometry",(function(){return Xr})),n.d(t,"TrailMaterial",(function(){return Jr})),n.d(t,"TrailRenderer",(function(){return ei})),n.d(t,"Transform",(function(){return nt})),n.d(t,"TransparentMaterial",(function(){return Ir})),n.d(t,"UniformSemantic",(function(){return Ee})),n.d(t,"UpdateFlag",(function(){return Je})),n.d(t,"Util",(function(){return F})),n.d(t,"VertexBufferBinding",(function(){return Zn})),n.d(t,"VertexElement",(function(){return $n})),n.d(t,"VertexElementFormat",(function(){return Fn})),n.d(t,"WrapMode",(function(){return or})),n.d(t,"bindFogToMaterial",(function(){return ci})),n.d(t,"dependencies",(function(){return qe})),n.d(t,"getFogMacro",(function(){return ui})),n.d(t,"hasFogFeature",(function(){return si})),n.d(t,"request",(function(){return Ut})),n.d(t,"resourceLoader",(function(){return B})),n.d(t,"GLTFModel",(function(){return Xa})),n.d(t,"Oasis",(function(){return Io})),n.d(t,"Parser",(function(){return Fo})),n.d(t,"RegistExtension",(function(){return ha})),n.d(t,"SchemaResource",(function(){return Ja})),n.d(t,"parseSingleKTX",(function(){return wa})),n.d(t,"parser",(function(){return Do})),n.d(t,"registerResource",(function(){return So})),n.d(t,"script",(function(){return io})),n.d(t,"BoundingBox",(function(){return c})),n.d(t,"BoundingSphere",(function(){return u})),n.d(t,"MathUtil",(function(){return o})),n.d(t,"Matrix",(function(){return h})),n.d(t,"Matrix3x3",(function(){return l})),n.d(t,"OBB",(function(){return d})),n.d(t,"Quaternion",(function(){return f})),n.d(t,"Ray",(function(){return _})),n.d(t,"RaycastHit",(function(){return m})),n.d(t,"Spherical",(function(){return v})),n.d(t,"Vector2",(function(){return g})),n.d(t,"Vector3",(function(){return s})),n.d(t,"Vector4",(function(){return T})),n.d(t,"GLShaderProgram",(function(){return Xo})),n.d(t,"GLTechnique",(function(){return qo})),n.d(t,"GLTexture",(function(){return Yo})),n.d(t,"WebCanvas",(function(){return Ko})),n.d(t,"WebGLEngine",(function(){return ss})),n.d(t,"WebGLMode",(function(){return rs})),n.d(t,"WebGLRenderer",(function(){return os})),(i=r||(r={}))[i.EXCLUDE=0]="EXCLUDE",i[i.INTERSECT=1]="INTERSECT",i[i.INCLUDE=2]="INCLUDE";var o=function(){function e(){}return e.clamp=function(e,t,n){return Math.max(t,Math.min(n,e))},e.equals=function(t,n){return Math.abs(t-n)<=e.zeroTolerance},e.isPowerOf2=function(e){return 0==(e&e-1)},e.radianToDegree=function(t){return t*e.radToDegreeFactor},e.degreeToRadian=function(t){return t*e.degreeToRadFactor},e}();o.zeroTolerance=1e-6,o.radToDegreeFactor=180/Math.PI,o.degreeToRadFactor=Math.PI/180;var s=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}e.add=function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z},e.subtract=function(e,t,n){n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z},e.multiply=function(e,t,n){n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z},e.divide=function(e,t,n){n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z},e.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},e.cross=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.x,s=t.y,u=t.z;n.x=i*u-a*s,n.y=a*o-r*u,n.z=r*s-i*o},e.distance=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return Math.sqrt(n*n+r*r+i*i)},e.distanceSquared=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return n*n+r*r+i*i},e.equals=function(e,t){return o.equals(e.x,t.x)&&o.equals(e.y,t.y)&&o.equals(e.z,t.z)},e.lerp=function(e,t,n,r){var i=e.x,a=e.y,o=e.z;r.x=i+(t.x-i)*n,r.y=a+(t.y-a)*n,r.z=o+(t.z-o)*n},e.max=function(e,t,n){n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z)},e.min=function(e,t,n){n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z)},e.negate=function(e,t){t.x=-e.x,t.y=-e.y,t.z=-e.z},e.normalize=function(e,t){var n=e.x,r=e.y,i=e.z,a=Math.sqrt(n*n+r*r+i*i);a>0&&(a=1/a,t.x=n*a,t.y=r*a,t.z=i*a)},e.scale=function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t},e.transformNormal=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.elements;n.x=r*o[0]+i*o[4]+a*o[8],n.y=r*o[1]+i*o[5]+a*o[9],n.z=r*o[2]+i*o[6]+a*o[10]},e.transformToVec3=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.elements;n.x=r*o[0]+i*o[4]+a*o[8]+o[12],n.y=r*o[1]+i*o[5]+a*o[9]+o[13],n.z=r*o[2]+i*o[6]+a*o[10]+o[14]},e.transformToVec4=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.elements;n.x=r*o[0]+i*o[4]+a*o[8]+o[12],n.y=r*o[1]+i*o[5]+a*o[9]+o[13],n.z=r*o[2]+i*o[6]+a*o[10]+o[14],n.w=r*o[3]+i*o[7]+a*o[11]+o[15]},e.transformCoordinate=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.elements,s=r*o[3]+i*o[7]+a*o[11]+o[15];s=1/s,n.x=(r*o[0]+i*o[4]+a*o[8]+o[12])*s,n.y=(r*o[1]+i*o[5]+a*o[9]+o[13])*s,n.z=(r*o[2]+i*o[6]+a*o[10]+o[14])*s},e.transformByQuat=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.x,s=t.y,u=t.z,c=t.w,l=c*r+s*a-u*i,f=c*i+u*r-o*a,h=c*a+o*i-s*r,d=-o*r-s*i-u*a;n.x=l*c-d*o-f*u+h*s,n.y=f*c-d*s-h*o+l*u,n.z=h*c-d*u-l*s+f*o};var t=e.prototype;return t.setValue=function(e,t,n){return this.x=e,this.y=t,this.z=n,this},t.setValueByArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},t.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},t.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},t.multiply=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},t.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},t.length=function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)},t.lengthSquared=function(){var e=this.x,t=this.y,n=this.z;return e*e+t*t+n*n},t.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.normalize=function(){return e.normalize(this,this),this},t.scale=function(e){return this.x*=e,this.y*=e,this.z*=e,this},t.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z},t.clone=function(){return new e(this.x,this.y,this.z)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e.z=this.z,e},t.transformNormal=function(t){return e.transformNormal(this,t,this),this},t.transformToVec3=function(t){return e.transformToVec3(this,t,this),this},t.transformCoordinate=function(t){return e.transformCoordinate(this,t,this),this},t.transformByQuat=function(t){return e.transformByQuat(this,t,this),this},e}();s._zero=new s(0,0,0),s._one=new s(1,1,1),s._tempVector3=new s;var u=function(){function e(e,t,n){this.center=new s,this.radius=0,this.centerWorld=new s,this.radiusWorld=0;var r=s.distance(e,t);this.radius=.5*r,s.add(e,t,this.center),this.center.scale(.5),this.updateByModelMatrix(n)}var t=e.prototype;return t.updateByModelMatrix=function(e){s.transformCoordinate(this.center,e,this.centerWorld),this.radiusWorld=this.radius*function(e){var t=e.elements,n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(n,r,i))}(e)},t.intersectsFrustum=function(e){for(var t=0;t<6;t++){var n=a(e[t],this.centerWorld);if(n<-this.radiusWorld)return r.EXCLUDE;if(n<this.radiusWorld)return r.INTERSECT}return r.INCLUDE},t.isInFrustum=function(e){for(var t=0;t<6;t++){if(a(e[t],this.centerWorld)<-this.radiusWorld)return!1}return!0},e}(),c=function(){function e(e,t){this.min=new s,this.max=new s,this.update(e,t)}var t=e.prototype;return t.update=function(e,t){e.cloneTo(this.min),t.cloneTo(this.max)},t.setFromCenterAndSize=function(e,t){var n=new s;s.scale(t,.5,n),s.subtract(e,n,this.min),s.add(e,n,this.max)},t.intersectsFrustum=function(e){for(var t=this.min,n=this.max,i=new s,o=new s,u=0;u<6;u++){var c=e[u];i.x=c.x>0?t.x:n.x,o.x=c.x>0?n.x:t.x,i.y=c.y>0?t.y:n.y,o.y=c.y>0?n.y:t.y,i.z=c.z>0?t.z:n.z,o.z=c.z>0?n.z:t.z;var l=a(c,i),f=a(c,o);if(l<0&&f<0)return r.EXCLUDE;if(l<0||f<0)return r.INTERSECT}return r.INCLUDE},t.isInFrustum=function(e){for(var t=this.min,n=this.max,r=new s,i=0;i<6;i++){var o=e[i];if(r.x=o.x>0?n.x:t.x,r.y=o.y>0?n.y:t.y,r.z=o.z>0?n.z:t.z,a(o,r)<0)return!1}return!0},t.clone=function(){return new e(this.min,this.max)},t.cloneTo=function(e){this.min.cloneTo(e.min),this.max.cloneTo(e.max)},e}(),l=function(){function e(e,t,n,r,i,a,o,s,u){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=1),this.elements=new Float32Array(9);var c=this.elements;c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=i,c[5]=a,c[6]=o,c[7]=s,c[8]=u}e.add=function(e,t,n){var r=e.elements,i=t.elements,a=n.elements;a[0]=r[0]+i[0],a[1]=r[1]+i[1],a[2]=r[2]+i[2],a[3]=r[3]+i[3],a[4]=r[4]+i[4],a[5]=r[5]+i[5],a[6]=r[6]+i[6],a[7]=r[7]+i[7],a[8]=r[8]+i[8]},e.subtract=function(e,t,n){var r=e.elements,i=t.elements,a=n.elements;a[0]=r[0]-i[0],a[1]=r[1]-i[1],a[2]=r[2]-i[2],a[3]=r[3]-i[3],a[4]=r[4]-i[4],a[5]=r[5]-i[5],a[6]=r[6]-i[6],a[7]=r[7]-i[7],a[8]=r[8]-i[8]},e.multiply=function(e,t,n){var r=e.elements,i=t.elements,a=n.elements,o=r[0],s=r[1],u=r[2],c=r[3],l=r[4],f=r[5],h=r[6],d=r[7],_=r[8],m=i[0],p=i[1],v=i[2],g=i[3],y=i[4],E=i[5],T=i[6],x=i[7],A=i[8];a[0]=o*m+c*p+h*v,a[1]=s*m+l*p+d*v,a[2]=u*m+f*p+_*v,a[3]=o*g+c*y+h*E,a[4]=s*g+l*y+d*E,a[5]=u*g+f*y+_*E,a[6]=o*T+c*x+h*A,a[7]=s*T+l*x+d*A,a[8]=u*T+f*x+_*A},e.equals=function(e,t){var n=e.elements,r=t.elements;return o.equals(n[0],r[0])&&o.equals(n[1],r[1])&&o.equals(n[2],r[2])&&o.equals(n[3],r[3])&&o.equals(n[4],r[4])&&o.equals(n[5],r[5])&&o.equals(n[6],r[6])&&o.equals(n[7],r[7])&&o.equals(n[8],r[8])},e.rotationQuaternion=function(e,t){var n=t.elements,r=e.x,i=e.y,a=e.z,o=e.w,s=r+r,u=i+i,c=a+a,l=r*s,f=i*s,h=i*u,d=a*s,_=a*u,m=a*c,p=o*s,v=o*u,g=o*c;n[0]=1-h-m,n[3]=f-g,n[6]=d+v,n[1]=f+g,n[4]=1-l-m,n[7]=_-p,n[2]=d-v,n[5]=_+p,n[8]=1-l-h},e.scaling=function(e,t){var n=t.elements;n[0]=e.x,n[1]=0,n[2]=0,n[3]=0,n[4]=e.y,n[5]=0,n[6]=0,n[7]=0,n[8]=1},e.translation=function(e,t){var n=t.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=e.x,n[7]=e.y,n[8]=1},e.invert=function(e,t){var n=e.elements,r=t.elements,i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],l=n[6],f=n[7],h=n[8],d=h*u-c*f,_=-h*s+c*l,m=f*s-u*l,p=i*d+a*_+o*m;p&&(p=1/p,r[0]=d*p,r[1]=(-h*a+o*f)*p,r[2]=(c*a-o*u)*p,r[3]=_*p,r[4]=(h*i-o*l)*p,r[5]=(-c*i+o*s)*p,r[6]=m*p,r[7]=(-f*i+a*l)*p,r[8]=(u*i-a*s)*p)},e.normalMatrix=function(e,t){var n=e.elements,r=t.elements,i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],l=n[6],f=n[7],h=n[8],d=n[9],_=n[10],m=n[11],p=n[12],v=n[13],g=n[14],y=n[15],E=i*c-a*u,T=i*l-o*u,x=i*f-s*u,A=a*l-o*c,O=a*f-s*c,b=o*f-s*l,M=h*v-d*p,S=h*g-_*p,R=h*y-m*p,L=d*g-_*v,C=d*y-m*v,I=_*y-m*g,w=E*I-T*C+x*L+A*R-O*S+b*M;if(!w)return null;w=1/w,r[0]=(c*I-l*C+f*L)*w,r[1]=(l*R-u*I-f*S)*w,r[2]=(u*C-c*R+f*M)*w,r[3]=(o*C-a*I-s*L)*w,r[4]=(i*I-o*R+s*S)*w,r[5]=(a*R-i*C-s*M)*w,r[6]=(v*b-g*O+y*A)*w,r[7]=(g*x-p*b-y*T)*w,r[8]=(p*O-v*x+y*E)*w},e.rotate=function(e,t,n){var r=e.elements,i=n.elements,a=Math.sin(t),o=Math.cos(t),s=r[0],u=r[1],c=r[2],l=r[3],f=r[4],h=r[5],d=r[6],_=r[7],m=r[8];i[0]=o*s+a*l,i[1]=o*u+a*f,i[2]=o*c+a*h,i[3]=o*l-a*s,i[4]=o*f-a*u,i[5]=o*h-a*c,i[6]=d,i[7]=_,i[8]=m},e.scale=function(e,t,n){var r=t.x,i=t.y,a=e.elements,o=n.elements;o[0]=r*a[0],o[1]=r*a[1],o[2]=r*a[2],o[3]=i*a[3],o[4]=i*a[4],o[5]=i*a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8]},e.translate=function(e,t,n){var r=t.x,i=t.y,a=e.elements,o=n.elements,s=a[0],u=a[1],c=a[2],l=a[3],f=a[4],h=a[5],d=a[6],_=a[7],m=a[8];o[0]=s,o[1]=u,o[2]=c,o[3]=l,o[4]=f,o[5]=h,o[6]=r*s+i*l+d,o[7]=r*u+i*f+_,o[8]=r*c+i*h+m},e.transpose=function(e,t){var n=e.elements,r=t.elements;if(t===e){var i=n[1],a=n[2],o=n[5];r[1]=n[3],r[2]=n[6],r[3]=i,r[5]=n[7],r[6]=a,r[7]=o}else r[0]=n[0],r[1]=n[3],r[2]=n[6],r[3]=n[1],r[4]=n[4],r[5]=n[7],r[6]=n[2],r[7]=n[5],r[8]=n[8]};var t=e.prototype;return t.setValue=function(e,t,n,r,i,a,o,s,u){var c=this.elements;return c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=i,c[5]=a,c[6]=o,c[7]=s,c[8]=u,this},t.setValueByArray=function(e,t){void 0===t&&(t=0);for(var n=this.elements,r=0;r<12;r++)n[r]=e[r+t];return this},t.setValueByMatrix=function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],this},t.toArray=function(e,t){void 0===t&&(t=0);var n=this.elements;e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8]},t.clone=function(){var t=this.elements;return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},t.cloneTo=function(e){var t=this.elements,n=e.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],e},t.add=function(t){return e.add(this,t,this),this},t.subtract=function(t){return e.subtract(this,t,this),this},t.multiply=function(t){return e.multiply(this,t,this),this},t.determinant=function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8];return t*(c*a-o*u)+n*(-c*i+o*s)+r*(u*i-a*s)},t.identity=function(){var e=this.elements;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},t.invert=function(){return e.invert(this,this),this},t.rotate=function(t){return e.rotate(this,t,this),this},t.scale=function(t){return e.scale(this,t,this),this},t.translate=function(t){return e.translate(this,t,this),this},t.transpose=function(){return e.transpose(this,this),this},e}(),f=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=e,this.y=t,this.z=n,this.w=r}e.add=function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w},e.multiply=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w,s=t.x,u=t.y,c=t.z,l=t.w;n.x=r*l+o*s+i*c-a*u,n.y=i*l+o*u+a*s-r*c,n.z=a*l+o*c+r*u-i*s,n.w=o*l-r*s-i*u-a*c},e.conjugate=function(e,t){t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w},e.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},e.equals=function(e,t){return o.equals(e.x,t.x)&&o.equals(e.y,t.y)&&o.equals(e.z,t.z)&&o.equals(e.w,t.w)},e.rotationAxisAngle=function(t,n,r){var i=e._tempVector3;s.normalize(t,i),n*=.5;var a=Math.sin(n);r.x=i.x*a,r.y=i.y*a,r.z=i.z*a,r.w=Math.cos(n)},e.rotationEuler=function(t,n,r,i){e.rotationYawPitchRoll(n,t,r,i)},e.rotationYawPitchRoll=function(e,t,n,r){var i=.5*n,a=.5*t,o=.5*e,s=Math.sin(i),u=Math.cos(i),c=Math.sin(a),l=Math.cos(a),f=Math.sin(o),h=Math.cos(o),d=h*l,_=f*c;r.x=h*c*u+f*l*s,r.y=f*l*u-h*c*s,r.z=d*s-_*u,r.w=d*u+_*s},e.rotationMatrix3x3=function(e,t){var n,r,i=e.elements,a=i[0],o=i[1],s=i[2],u=i[3],c=i[4],l=i[5],f=i[6],h=i[7],d=i[8],_=a+c+d;_>0?(n=Math.sqrt(_+1),t.w=.5*n,n=.5/n,t.x=(l-h)*n,t.y=(f-s)*n,t.z=(o-u)*n):a>=c&&a>=d?(r=.5/(n=Math.sqrt(1+a-c-d)),t.x=.5*n,t.y=(o+u)*r,t.z=(s+f)*r,t.w=(l-h)*r):c>d?(r=.5/(n=Math.sqrt(1+c-a-d)),t.x=(u+o)*r,t.y=.5*n,t.z=(h+l)*r,t.w=(f-s)*r):(r=.5/(n=Math.sqrt(1+d-a-c)),t.x=(s+f)*r,t.y=(l+h)*r,t.z=.5*n,t.w=(o-u)*r)},e.invert=function(e,t){var n=e.x,r=e.y,i=e.z,a=e.w,s=n*n+r*r+i*i+a*a;if(s>o.zeroTolerance){var u=1/s;t.x=-n*u,t.y=-r*u,t.z=-i*u,t.w=a*u}},e.lerp=function(t,n,r,i){var a=1-r;e.dot(t,n)>=0?(i.x=t.x*a+n.x*r,i.y=t.y*a+n.y*r,i.z=t.z*a+n.z*r,i.w=t.w*a+n.w*r):(i.x=t.x*a-n.x*r,i.y=t.y*a-n.y*r,i.z=t.z*a-n.z*r,i.w=t.w*a-n.w*r),i.normalize()},e.slerp=function(e,t,n,r){var i,a,s=e.x,u=e.y,c=e.z,l=e.w,f=t.x,h=t.y,d=t.z,_=t.w,m=s*f+u*h+c*d+l*_;if(m<0&&(m=-m,f=-f,h=-h,d=-d,_=-_),1-m>o.zeroTolerance){var p=Math.acos(m),v=Math.sin(p);i=Math.sin((1-n)*p)/v,a=Math.sin(n*p)/v}else i=1-n,a=n;r.x=i*s+a*f,r.y=i*u+a*h,r.z=i*c+a*d,r.w=i*l+a*_},e.normalize=function(e,t){var n=e.x,r=e.y,i=e.z,a=e.w,s=Math.sqrt(n*n+r*r+i*i+a*a);s>o.zeroTolerance&&(s=1/s,t.x=n*s,t.y=r*s,t.z=i*s,t.w=a*s)},e.rotationX=function(e,t){e*=.5;var n=Math.sin(e),r=Math.cos(e);t.x=n,t.y=0,t.z=0,t.w=r},e.rotationY=function(e,t){e*=.5;var n=Math.sin(e),r=Math.cos(e);t.x=0,t.y=n,t.z=0,t.w=r},e.rotationZ=function(e,t){e*=.5;var n=Math.sin(e),r=Math.cos(e);t.x=0,t.y=0,t.z=n,t.w=r},e.rotateX=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w;t*=.5;var s=Math.sin(t),u=Math.cos(t);n.x=r*u+o*s,n.y=i*u+a*s,n.z=a*u-i*s,n.w=o*u-r*s},e.rotateY=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w;t*=.5;var s=Math.sin(t),u=Math.cos(t);n.x=r*u-a*s,n.y=i*u+o*s,n.z=a*u+r*s,n.w=o*u-i*s},e.rotateZ=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w;t*=.5;var s=Math.sin(t),u=Math.cos(t);n.x=r*u+i*s,n.y=i*u-r*s,n.z=a*u+o*s,n.w=o*u-a*s},e.scale=function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t};var t=e.prototype;return t.setValue=function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},t.setValueByArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},t.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.getAxisAngle=function(e){var t=this.x,n=this.y,r=this.z,i=t*t+n*n+r*r;if(i<o.zeroTolerance)return e.x=1,e.y=0,e.z=0,0;var a=1/i;return e.x=this.x*a,e.y=this.y*a,e.z=this.z*a,2*Math.acos(this.w)},t.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},t.length=function(){var e=this.x,t=this.y,n=this.z,r=this.w;return Math.sqrt(e*e+t*t+n*n+r*r)},t.lengthSquared=function(){var e=this.x,t=this.y,n=this.z,r=this.w;return e*e+t*t+n*n+r*r},t.normalize=function(){return e.normalize(this,this),this},t.toEuler=function(e){this.toYawPitchRoll(e);var t=e.x;return e.x=e.y,e.y=t,e},t.toYawPitchRoll=function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=t*t,s=n*n,u=r*r,c=t*n,l=r*i,f=r*t,h=n*i,d=n*r,_=t*i;return e.y=Math.asin(2*(_-d)),Math.cos(e.y)>o.zeroTolerance?(e.z=Math.atan2(2*(c+l),1-2*(u+a)),e.x=Math.atan2(2*(f+h),1-2*(s+a))):(e.z=Math.atan2(-2*(c-l),1-2*(s+u)),e.x=0),e},t.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w},t.clone=function(){return new e(this.x,this.y,this.z,this.w)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},t.rotateX=function(t){return e.rotateX(this,t,this),this},t.rotateY=function(t){return e.rotateY(this,t,this),this},t.rotateZ=function(t){return e.rotateZ(this,t,this),this},t.rotationAxisAngle=function(t,n){return e.rotationAxisAngle(t,n,this),this},t.multiply=function(t){return e.multiply(this,t,this),this},t.invert=function(){return e.invert(this,this),this},t.dot=function(t){return e.dot(this,t)},t.lerp=function(t,n){return e.lerp(this,t,n,this),this},e}();f._tempVector3=new s;var h=function(){function e(e,t,n,r,i,a,o,s,u,c,l,f,h,d,_,m){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=0),void 0===c&&(c=0),void 0===l&&(l=1),void 0===f&&(f=0),void 0===h&&(h=0),void 0===d&&(d=0),void 0===_&&(_=0),void 0===m&&(m=1),this.elements=new Float32Array(16);var p=this.elements;p[0]=e,p[1]=t,p[2]=n,p[3]=r,p[4]=i,p[5]=a,p[6]=o,p[7]=s,p[8]=u,p[9]=c,p[10]=l,p[11]=f,p[12]=h,p[13]=d,p[14]=_,p[15]=m}e.multiply=function(e,t,n){var r=e.elements,i=t.elements,a=n.elements,o=r[0],s=r[1],u=r[2],c=r[3],l=r[4],f=r[5],h=r[6],d=r[7],_=r[8],m=r[9],p=r[10],v=r[11],g=r[12],y=r[13],E=r[14],T=r[15],x=i[0],A=i[1],O=i[2],b=i[3],M=i[4],S=i[5],R=i[6],L=i[7],C=i[8],I=i[9],w=i[10],P=i[11],N=i[12],F=i[13],D=i[14],U=i[15];a[0]=o*x+l*A+_*O+g*b,a[1]=s*x+f*A+m*O+y*b,a[2]=u*x+h*A+p*O+E*b,a[3]=c*x+d*A+v*O+T*b,a[4]=o*M+l*S+_*R+g*L,a[5]=s*M+f*S+m*R+y*L,a[6]=u*M+h*S+p*R+E*L,a[7]=c*M+d*S+v*R+T*L,a[8]=o*C+l*I+_*w+g*P,a[9]=s*C+f*I+m*w+y*P,a[10]=u*C+h*I+p*w+E*P,a[11]=c*C+d*I+v*w+T*P,a[12]=o*N+l*F+_*D+g*U,a[13]=s*N+f*F+m*D+y*U,a[14]=u*N+h*F+p*D+E*U,a[15]=c*N+d*F+v*D+T*U},e.equals=function(e,t){var n=e.elements,r=t.elements;return o.equals(n[0],r[0])&&o.equals(n[1],r[1])&&o.equals(n[2],r[2])&&o.equals(n[3],r[3])&&o.equals(n[4],r[4])&&o.equals(n[5],r[5])&&o.equals(n[6],r[6])&&o.equals(n[7],r[7])&&o.equals(n[8],r[8])&&o.equals(n[9],r[9])&&o.equals(n[10],r[10])&&o.equals(n[11],r[11])&&o.equals(n[12],r[12])&&o.equals(n[13],r[13])&&o.equals(n[14],r[14])&&o.equals(n[15],r[15])},e.rotationQuaternion=function(e,t){var n=t.elements,r=e.x,i=e.y,a=e.z,o=e.w,s=r+r,u=i+i,c=a+a,l=r*s,f=i*s,h=i*u,d=a*s,_=a*u,m=a*c,p=o*s,v=o*u,g=o*c;n[0]=1-h-m,n[1]=f+g,n[2]=d-v,n[3]=0,n[4]=f-g,n[5]=1-l-m,n[6]=_+p,n[7]=0,n[8]=d+v,n[9]=_-p,n[10]=1-l-h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},e.rotationAxisAngle=function(e,t,n){var r,i,a,s=n.elements,u=e.x,c=e.y,l=e.z,f=Math.sqrt(u*u+c*c+l*l);Math.abs(f)<o.zeroTolerance||(u*=f=1/f,c*=f,l*=f,r=Math.sin(t),a=1-(i=Math.cos(t)),s[0]=u*u*a+i,s[1]=c*u*a+l*r,s[2]=l*u*a-c*r,s[3]=0,s[4]=u*c*a-l*r,s[5]=c*c*a+i,s[6]=l*c*a+u*r,s[7]=0,s[8]=u*l*a+c*r,s[9]=c*l*a-u*r,s[10]=l*l*a+i,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1)},e.rotationTranslation=function(t,n,r){e.rotationQuaternion(t,r);var i=r.elements;i[12]=n.x,i[13]=n.y,i[14]=n.z},e.affineTransformation=function(e,t,n,r){var i=r.elements,a=t.x,o=t.y,s=t.z,u=t.w,c=a+a,l=o+o,f=s+s,h=a*c,d=a*l,_=a*f,m=o*l,p=o*f,v=s*f,g=u*c,y=u*l,E=u*f,T=e.x,x=e.y,A=e.z;i[0]=(1-(m+v))*T,i[1]=(d+E)*T,i[2]=(_-y)*T,i[3]=0,i[4]=(d-E)*x,i[5]=(1-(h+v))*x,i[6]=(p+g)*x,i[7]=0,i[8]=(_+y)*A,i[9]=(p-g)*A,i[10]=(1-(h+m))*A,i[11]=0,i[12]=n.x,i[13]=n.y,i[14]=n.z,i[15]=1},e.scaling=function(e,t){var n=t.elements;n[0]=e.x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e.y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e.z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},e.translation=function(e,t){var n=t.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1},e.invert=function(e,t){var n=e.elements,r=t.elements,i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],l=n[6],f=n[7],h=n[8],d=n[9],_=n[10],m=n[11],p=n[12],v=n[13],g=n[14],y=n[15],E=i*c-a*u,T=i*l-o*u,x=i*f-s*u,A=a*l-o*c,O=a*f-s*c,b=o*f-s*l,M=h*v-d*p,S=h*g-_*p,R=h*y-m*p,L=d*g-_*v,C=d*y-m*v,I=_*y-m*g,w=E*I-T*C+x*L+A*R-O*S+b*M;if(!w)return null;w=1/w,r[0]=(c*I-l*C+f*L)*w,r[1]=(o*C-a*I-s*L)*w,r[2]=(v*b-g*O+y*A)*w,r[3]=(_*O-d*b-m*A)*w,r[4]=(l*R-u*I-f*S)*w,r[5]=(i*I-o*R+s*S)*w,r[6]=(g*x-p*b-y*T)*w,r[7]=(h*b-_*x+m*T)*w,r[8]=(u*C-c*R+f*M)*w,r[9]=(a*R-i*C-s*M)*w,r[10]=(p*O-v*x+y*E)*w,r[11]=(d*x-h*O-m*E)*w,r[12]=(c*S-u*L-l*M)*w,r[13]=(i*L-a*S+o*M)*w,r[14]=(v*T-p*A-g*E)*w,r[15]=(h*A-d*T+_*E)*w},e.lookAt=function(t,n,r,i){var a=i.elements,o=e._tempVec30,u=e._tempVec31,c=e._tempVec32;s.subtract(t,n,c),c.normalize(),s.cross(r,c,o),o.normalize(),s.cross(c,o,u),a[0]=o.x,a[1]=u.x,a[2]=c.x,a[3]=0,a[4]=o.y,a[5]=u.y,a[6]=c.y,a[7]=0,a[8]=o.z,a[9]=u.z,a[10]=c.z,a[11]=0,a[12]=-s.dot(o,t),a[13]=-s.dot(u,t),a[14]=-s.dot(c,t),a[15]=1},e.ortho=function(e,t,n,r,i,a,o){var s=o.elements,u=1/(e-t),c=1/(n-r),l=1/(i-a);s[0]=-2*u,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*l,s[11]=0,s[12]=(e+t)*u,s[13]=(r+n)*c,s[14]=(a+i)*l,s[15]=1},e.perspective=function(e,t,n,r,i){var a=i.elements,o=1/Math.tan(e/2),s=1/(n-r);a[0]=o/t,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(r+n)*s,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*r*n*s,a[15]=0},e.rotateAxisAngle=function(e,t,n,r){var i=t.x,a=t.y,s=t.z,u=Math.sqrt(i*i+a*a+s*s);if(!(Math.abs(u)<o.zeroTolerance)){var c,l,f,h=e.elements,d=r.elements;i*=u=1/u,a*=u,s*=u,c=Math.sin(n),f=1-(l=Math.cos(n));var _=h[0],m=h[1],p=h[2],v=h[3],g=h[4],y=h[5],E=h[6],T=h[7],x=h[8],A=h[9],O=h[10],b=h[11],M=i*i*f+l,S=a*i*f+s*c,R=s*i*f-a*c,L=i*a*f-s*c,C=a*a*f+l,I=s*a*f+i*c,w=i*s*f+a*c,P=a*s*f-i*c,N=s*s*f+l;d[0]=_*M+g*S+x*R,d[1]=m*M+y*S+A*R,d[2]=p*M+E*S+O*R,d[3]=v*M+T*S+b*R,d[4]=_*L+g*C+x*I,d[5]=m*L+y*C+A*I,d[6]=p*L+E*C+O*I,d[7]=v*L+T*C+b*I,d[8]=_*w+g*P+x*N,d[9]=m*w+y*P+A*N,d[10]=p*w+E*P+O*N,d[11]=v*w+T*P+b*N,e!==r&&(d[12]=h[12],d[13]=h[13],d[14]=h[14],d[15]=h[15])}},e.scale=function(e,t,n){var r=e.elements,i=n.elements,a=t.x,o=t.y,s=t.z;i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[3]=r[3]*a,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[7]=r[7]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,i[11]=r[11]*s,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]},e.translate=function(e,t,n){var r=e.elements,i=n.elements,a=t.x,o=t.y,s=t.z;if(e===n)i[12]=r[0]*a+r[4]*o+r[8]*s+r[12],i[13]=r[1]*a+r[5]*o+r[9]*s+r[13],i[14]=r[2]*a+r[6]*o+r[10]*s+r[14],i[15]=r[3]*a+r[7]*o+r[11]*s+r[15];else{var u=r[0],c=r[1],l=r[2],f=r[3],h=r[4],d=r[5],_=r[6],m=r[7],p=r[8],v=r[9],g=r[10],y=r[11];i[0]=u,i[1]=c,i[2]=l,i[3]=f,i[4]=h,i[5]=d,i[6]=_,i[7]=m,i[8]=p,i[9]=v,i[10]=g,i[11]=y,i[12]=u*a+h*o+p*s+r[12],i[13]=c*a+d*o+v*s+r[13],i[14]=l*a+_*o+g*s+r[14],i[15]=f*a+m*o+y*s+r[15]}},e.transpose=function(e,t){var n=e.elements,r=t.elements;if(t===e){var i=n[1],a=n[2],o=n[3],s=n[6],u=n[7],c=n[11];r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=i,r[6]=n[9],r[7]=n[13],r[8]=a,r[9]=s,r[11]=n[14],r[12]=o,r[13]=u,r[14]=c}else r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15]};var t=e.prototype;return t.setValue=function(e,t,n,r,i,a,o,s,u,c,l,f,h,d,_,m){var p=this.elements;return p[0]=e,p[1]=t,p[2]=n,p[3]=r,p[4]=i,p[5]=a,p[6]=o,p[7]=s,p[8]=u,p[9]=c,p[10]=l,p[11]=f,p[12]=h,p[13]=d,p[14]=_,p[15]=m,this},t.setValueByArray=function(e,t){void 0===t&&(t=0);for(var n=this.elements,r=0;r<16;r++)n[r]=e[r+t];return this},t.toArray=function(e,t){void 0===t&&(t=0);var n=this.elements;e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15]},t.clone=function(){var t=this.elements;return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},t.cloneTo=function(e){var t=this.elements,n=e.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],e},t.multiply=function(t){return e.multiply(this,t,this),this},t.determinant=function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11],d=e[12],_=e[13],m=e[14],p=e[15];return(t*o-n*a)*(f*p-h*m)-(t*s-r*a)*(l*p-h*_)+(t*u-i*a)*(l*m-f*_)+(n*s-r*o)*(c*p-h*d)-(n*u-i*o)*(c*m-f*d)+(r*u-i*s)*(c*_-l*d)},t.decompose=function(t,n,r){var i=e._tempMat30,a=this.elements,s=i.elements,u=a[0],c=a[1],l=a[2],h=a[3],d=a[4],_=a[5],m=a[6],p=a[7],v=a[8],g=a[9],y=a[10],E=a[11];t.x=a[12],t.y=a[13],t.z=a[14];var T=Math.sign(u*c*l*h)<0?-1:1,x=Math.sign(d*_*m*p)<0?-1:1,A=Math.sign(v*g*y*E)<0?-1:1,O=T*Math.sqrt(u*u+c*c+l*l),b=x*Math.sqrt(d*d+_*_+m*m),M=A*Math.sqrt(v*v+g*g+y*y);if(r.x=O,r.y=b,r.z=M,Math.abs(O)<o.zeroTolerance||Math.abs(b)<o.zeroTolerance||Math.abs(M)<o.zeroTolerance)return n.identity(),!1;var S=1/O,R=1/b,L=1/M;return s[0]=u*S,s[1]=c*S,s[2]=l*S,s[3]=d*R,s[4]=_*R,s[5]=m*R,s[6]=v*L,s[7]=g*L,s[8]=y*L,f.rotationMatrix3x3(i,n),!0},t.getRotation=function(e){var t=this.elements,n=t[0]+t[5]+t[10];if(n>o.zeroTolerance){var r=2*Math.sqrt(n+1);e.w=.25*r,e.x=(t[6]-t[9])/r,e.y=(t[8]-t[2])/r,e.z=(t[1]-t[4])/r}else if(t[0]>t[5]&&t[0]>t[10]){var i=2*Math.sqrt(1+t[0]-t[5]-t[10]);e.w=(t[6]-t[9])/i,e.x=.25*i,e.y=(t[1]+t[4])/i,e.z=(t[8]+t[2])/i}else if(t[5]>t[10]){var a=2*Math.sqrt(1+t[5]-t[0]-t[10]);e.w=(t[8]-t[2])/a,e.x=(t[1]+t[4])/a,e.y=.25*a,e.z=(t[6]+t[9])/a}else{var s=2*Math.sqrt(1+t[10]-t[0]-t[5]);e.w=(t[1]-t[4])/s,e.x=(t[8]+t[2])/s,e.y=(t[6]+t[9])/s,e.z=.25*s}return e},t.getScaling=function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e.x=Math.sqrt(n*n+r*r+i*i),e.y=Math.sqrt(a*a+o*o+s*s),e.z=Math.sqrt(u*u+c*c+l*l),e},t.getTranslation=function(e){var t=this.elements;return e.x=t[12],e.y=t[13],e.z=t[14],e},t.identity=function(){var e=this.elements;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},t.invert=function(){return e.invert(this,this),this},t.rotateAxisAngle=function(t,n){return e.rotateAxisAngle(this,t,n,this),this},t.scale=function(t){return e.scale(this,t,this),this},t.translate=function(t){return e.translate(this,t,this),this},t.transpose=function(){return e.transpose(this,this),this},e}();h._tempVec30=new s,h._tempVec31=new s,h._tempVec32=new s,h._tempMat30=new l,h._tempMat40=new h,h._identity=new h(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);var d=function(){function e(e,t,n){this.min=new s,this.max=new s,this.corners=[],this.minWorld=new s,this.maxWorld=new s,this.cornersWorld=[],e.cloneTo(this.min),t.cloneTo(this.max),this.corners=this.getCornersFromMinMax(e,t),this.updateByModelMatrix(n)}var t=e.prototype;return t.getCornersFromMinMax=function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,u=t.z;return[new s(n,r,i),new s(a,o,u),new s(a,r,i),new s(n,o,i),new s(n,r,u),new s(a,o,i),new s(n,o,u),new s(a,r,u)]},t.updateByModelMatrix=function(t){var n=this.minWorld,r=this.maxWorld;n.setValue(1/0,1/0,1/0),r.setValue(-1/0,-1/0,-1/0);for(var i=0;i<8;++i){var a=this.corners[i],o=e._tempVec3;s.transformCoordinate(a,t,o),s.min(n,o,n),s.max(r,o,r),this.cornersWorld[i]=new s,o.cloneTo(this.cornersWorld[i])}},t.intersectsFrustum=function(e){for(var t=this.cornersWorld,n=0;n<6;n++){for(var i=e[n],o=!1,s=0;s<8;s++)if(a(i,t[s])>0)o=!0;else if(o)return r.INTERSECT;if(!o)return r.EXCLUDE}return r.INCLUDE},t.isInFrustum=function(e){for(var t=this.cornersWorld,n=0;n<6;n++){for(var r=e[n],i=!1,o=0;o<8;o++)if(a(r,t[o])>0){i=!0;break}if(!i)return!1}return!0},e}();d._tempVec3=new s;var _=function(){function e(e,t){this.origin=new s,this.direction=new s,e&&e.cloneTo(this.origin),t&&t.cloneTo(this.direction)}var t=e.prototype;return t.intersectPlane=function(e,t){var n=this.origin,r=s.dot(t,this.direction);if(Math.abs(r)>1e-6){var i=new s;s.subtract(e,n,i);var a=s.dot(i,t)/r;if(a>=0)return a}return!1},t.getPoint=function(e){var t=new s;return s.scale(this.direction,e,t),t.add(this.origin)},t.intersectSphere=function(e,t){var n=this.direction,r=new s;s.subtract(this.origin,e,r);var i=s.dot(n,n),a=2*s.dot(n,r),o=s.dot(r,r)-t*t,u=this._solveQuadratic(i,a,o);return!!u&&u[0]},t.intersectAABB=function(e,t){var n=this.direction,r=this.origin,i=new s(1/n.x,1/n.y,1/n.z),a=[t,e],o=[n.x<0?1:0,n.y<0?1:0,n.z<0?1:0],u=(a[o[0]].x-r.x)*i.x,c=(a[1-o[0]].x-r.x)*i.x,l=(a[o[1]].y-r.y)*i.y,f=(a[1-o[1]].y-r.y)*i.y;if(u>f||l>c)return!1;l>u&&(u=l),f<c&&(c=f);var h=(a[o[2]].z-r.z)*i.z,d=(a[1-o[2]].z-r.z)*i.z;if(u>d||h>c)return!1;h>u&&(u=h),d<c&&(c=d);var _=u;return!(_<0&&(_=c)<0)&&_},t._solveQuadratic=function(e,t,n){var r=t*t-4*e*n;if(r<0)return!1;if(0==r){var i=-.5*t/e;return[i,i]}var a=Math.sqrt(r),o=t>0?-.5*(t+a):-.5*(t-a),s=o/e,u=n/o;return s<=u?[s,u]:[u,s]},e}(),m=function(){this.distance=Number.MAX_VALUE,this.collider=null,this.point=null},p=o.zeroTolerance,v=function(){function e(e,t,n){this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0}var t=e.prototype;return t.set=function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},t.makeSafe=function(){return this.phi=o.clamp(this.phi,p,Math.PI-p),this},t.setFromVec3=function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(o.clamp(e.y/this.radius,-1,1))),this},t.setToVec3=function(e){var t=Math.sin(this.phi)*this.radius;return e.x=t*Math.sin(this.theta),e.y=Math.cos(this.phi)*this.radius,e.z=t*Math.cos(this.theta),this},e}(),g=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}e.add=function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y},e.subtract=function(e,t,n){n.x=e.x-t.x,n.y=e.y-t.y},e.multiply=function(e,t,n){n.x=e.x*t.x,n.y=e.y*t.y},e.divide=function(e,t,n){n.x=e.x/t.x,n.y=e.y/t.y},e.dot=function(e,t){return e.x*t.x+e.y*t.y},e.distance=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},e.distanceSquared=function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},e.equals=function(e,t){return o.equals(e.x,t.x)&&o.equals(e.y,t.y)},e.lerp=function(e,t,n,r){var i=e.x,a=e.y;r.x=i+(t.x-i)*n,r.y=a+(t.y-a)*n},e.max=function(e,t,n){n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y)},e.min=function(e,t,n){n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y)},e.negate=function(e,t){t.x=-e.x,t.y=-e.y},e.normalize=function(e,t){var n=e.x,r=e.y,i=Math.sqrt(n*n+r*r);i>o.zeroTolerance&&(i=1/i,t.x=n*i,t.y=r*i)},e.scale=function(e,t,n){n.x=e.x*t,n.y=e.y*t};var t=e.prototype;return t.setValue=function(e,t){return this.x=e,this.y=t,this},t.setValueByArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},t.add=function(e){return this.x+=e.x,this.y+=e.y,this},t.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},t.multiply=function(e){return this.x*=e.x,this.y*=e.y,this},t.divide=function(e){return this.x/=e.x,this.y/=e.y,this},t.length=function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)},t.lengthSquared=function(){var e=this.x,t=this.y;return e*e+t*t},t.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.normalize=function(){return e.normalize(this,this),this},t.scale=function(e){return this.x*=e,this.y*=e,this},t.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y},t.clone=function(){return new e(this.x,this.y)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e},e}();g._zero=new g(0,0),g._one=new g(1,1);var y,E,T=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=e,this.y=t,this.z=n,this.w=r}e.add=function(e,t,n){n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w},e.subtract=function(e,t,n){n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w},e.multiply=function(e,t,n){n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n.w=e.w*t.w},e.divide=function(e,t,n){n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n.w=e.w/t.w},e.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},e.distance=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z,a=t.w-e.w;return Math.sqrt(n*n+r*r+i*i+a*a)},e.distanceSquared=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z,a=t.w-e.w;return n*n+r*r+i*i+a*a},e.equals=function(e,t){return o.equals(e.x,t.x)&&o.equals(e.y,t.y)&&o.equals(e.z,t.z)&&o.equals(e.w,t.w)},e.lerp=function(e,t,n,r){var i=e.x,a=e.y,o=e.z,s=e.w;r.x=i+(t.x-i)*n,r.y=a+(t.y-a)*n,r.z=o+(t.z-o)*n,r.w=s+(t.w-s)*n},e.max=function(e,t,n){n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n.w=Math.max(e.w,t.w)},e.min=function(e,t,n){n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n.w=Math.min(e.w,t.w)},e.negate=function(e,t){t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w},e.normalize=function(e,t){var n=e.x,r=e.y,i=e.z,a=e.w,s=Math.sqrt(n*n+r*r+i*i+a*a);s>o.zeroTolerance&&(s=1/s,t.x=n*s,t.y=r*s,t.z=i*s,t.w=a*s)},e.scale=function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t},e.transform=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w,s=t.elements;n.x=r*s[0]+i*s[4]+a*s[8]+o*s[12],n.y=r*s[1]+i*s[5]+a*s[9]+o*s[13],n.z=r*s[2]+i*s[6]+a*s[10]+o*s[14],n.w=r*s[3]+i*s[7]+a*s[11]+o*s[15]},e.transformByQuat=function(e,t,n){var r=e.x,i=e.y,a=e.z,o=e.w,s=t.x,u=t.y,c=t.z,l=t.w,f=l*r+u*a-c*i,h=l*i+c*r-s*a,d=l*a+s*i-u*r,_=-s*r-u*i-c*a;n.x=f*l-_*s-h*c+d*u,n.y=h*l-_*u-d*s+f*c,n.z=d*l-_*c-f*u+h*s,n.w=o};var t=e.prototype;return t.setValue=function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},t.setValueByArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},t.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},t.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},t.multiply=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},t.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},t.length=function(){var e=this.x,t=this.y,n=this.z,r=this.w;return Math.sqrt(e*e+t*t+n*n+r*r)},t.lengthSquared=function(){var e=this.x,t=this.y,n=this.z,r=this.w;return e*e+t*t+n*n+r*r},t.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},t.normalize=function(){return e.normalize(this,this),this},t.scale=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},t.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w},t.clone=function(){return new e(this.x,this.y,this.z,this.w)},t.cloneTo=function(e){return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},e}();function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&M(e.prototype,t),n&&M(e,n),e}function R(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,w(e,t)}function L(e){var t="function"==typeof Map?new Map:void 0;return(L=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return C(e,arguments,P(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),w(r,e)})(e)}function C(e,t,n){return(C=I()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&w(i,n.prototype),i}).apply(null,arguments)}function I(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}T._zero=new T(0,0,0,0),T._one=new T(1,1,1,1),(E=y||(y={}))[E.Success=0]="Success",E[E.Pending=1]="Pending",E[E.Failed=2]="Failed";var N=function(e){R(n,e),n.all=function(e){return new n((function(t,n,r){if(!Array.isArray(e))return t([e]);var i=0,a=e.length,o=new Array(a);e.forEach((function(e,s){Promise.resolve(e).then((function(e){o[s]=e,r((i+=1)/a),i==a&&t(o)})).catch((function(e){return n(e)}))}))}))};var t=n.prototype;function n(t){var n,r,i=function(e){if(!(e<=n._progress)){n._progress=e;for(var t,r=O(n._listeners);!(t=r()).done;){(0,t.value)(e)}}};return(n=e.call(this,(function(e,a){t((function(t){Promise.resolve().then((function(){i(1),n._status=0,e(t)}))}),r=function(e){Promise.resolve().then((function(){n._status=2,a(e)}))},(function(e){Promise.resolve().then((function(){i(e)}))}))}))||this)._reject=r,n._listeners=new Set,n._progress=0,n._status=1,n}return t.onProgress=function(e){return this._listeners.add(e),this},t.cancel=function(){return 1!==this._status||this._reject("Promise Canceled"),this},S(n,[{key:"status",get:function(){return this._status}},{key:"progress",get:function(){return this._progress}}]),n}(L(Promise)),F={isArray:"isArray"in Array?Array.isArray:function(e){return"[object Array]"===toString.call(e)},isArrayLike:function(e){return!!e&&"number"==typeof e.length&&"function"!=typeof e},clone:function(e){if("object"!=typeof e||null===e)return e;var t;if(F.isArrayLike(e)){t=e.slice();for(var n=0,r=e.length;n<r;n++)t[n]=F.clone(e[n])}else for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=F.clone(e[i]));return t},downloadBlob:function(e,t){if(void 0===t&&(t=""),navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var n=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=n,r.download=t,r.addEventListener("click",(function(){r.parentElement&&r.parentElement.removeChild(r)})),r.click(),window.URL.revokeObjectURL(n)}}};function D(e,t){var n=e.indexOf(t);if(n<0)return!1;var r=e.length-1;if(n!==r){var i=e[r];e[n]=i}return e.length--,!0}function U(e){return Object.keys(e).map((function(t){return e[t]}))}var V=function(){function e(e){this.engine=e,this.retryCount=1,this.retryInterval=0,this.timeout=2e4,this._assetPool=Object.create(null),this._assetUrlPool=Object.create(null),this._refObjectPool=Object.create(null),this._loadingPromises={}}e._addLoader=function(e,t,n){this._loaders[e]=t;for(var r=0,i=n.length;r<i;r++)this._extTypeMapping[n[r]]=e},e._getTypeByUrl=function(e){var t=e.split("?")[0];return this._extTypeMapping[t.substring(t.lastIndexOf(".")+1)]};var t=e.prototype;return t.load=function(e){var t=this;if(!Array.isArray(e))return this._loadSingleItem(e);var n=e.map((function(e){return t._loadSingleItem(e)}));return N.all(n)},t.cancelNotLoaded=function(e){var t=this;if(e)if("string"==typeof e){var n;null==(n=this._loadingPromises[e])||n.cancel()}else e.forEach((function(e){var n;null==(n=t._loadingPromises[e])||n.cancel()}));else U(this._loadingPromises).forEach((function(e){e.cancel()}))},t.gc=function(){for(var e=U(this._refObjectPool),t=0,n=e.length;t<n;t++)e[t].isGCIgnored||e[t].destroy()},t.getAssetPath=function(e){return this._assetPool[e]},t._addAsset=function(e,t){this._assetPool[t.instanceId]=e,this._assetUrlPool[e]=t},t._deleteAsset=function(e){var t=e.instanceId,n=this._assetPool[t];n&&(delete this._assetPool[t],delete this._assetUrlPool[n])},t._addRefObject=function(e,t){this._refObjectPool[e]=t},t._deleteRefObject=function(e){delete this._refObjectPool[e]},t._assignDefaultOptions=function(t){var n,r,i,a,o;if(t.type=null!=(n=t.type)?n:e._getTypeByUrl(t.url),void 0===t.type)throw"asset type should be specified: "+t.url;return t.retryCount=null!=(r=t.retryCount)?r:this.retryCount,t.timeout=null!=(i=t.timeout)?i:this.timeout,t.retryInterval=null!=(a=t.retryInterval)?a:this.retryInterval,t.url=null!=(o=t.url)?o:t.urls.join(","),t},t._loadSingleItem=function(t){var n=this,r=this._assignDefaultOptions("string"==typeof t?{url:t}:t),i=r.url;if(this._assetUrlPool[i])return new N((function(e){e(n._assetUrlPool[i])}));if(this._loadingPromises[i])return this._loadingPromises[r.url];var a=e._loaders[r.type],o=a.load(r,this);return this._loadingPromises[i]=o,o.then((function(e){a.useCache&&n._addAsset(i,e),delete n._loadingPromises[i]})).catch((function(){})),o},e}();function B(e,t,n){return void 0===n&&(n=!0),function(r){var i=new r(n);V._addLoader(e,i,t)}}V._loaders={},V._extTypeMapping={};var H,z,G=function(){function e(e,t,n,r){void 0===t&&(t=null),void 0===n&&(n={}),void 0===r&&(r=!0),this._timeStamp=(new Date).getTime(),this._target=t,this.data=n,this._currentTarget=null,this._bubbles=r,this._propagationStopped=!1,this._type=e}return e.prototype.stopPropagation=function(){this._propagationStopped=!0},S(e,[{key:"propagationStopped",get:function(){return this._propagationStopped}},{key:"target",get:function(){return this._target},set:function(e){this._target=e}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"currentTarget",get:function(){return this._currentTarget},set:function(e){this._currentTarget=e}},{key:"bubbles",get:function(){return this._bubbles}},{key:"type",get:function(){return this._type}}]),e}();function k(e,t){W.registerCloneMode(e,t,H.Ignore)}function j(e,t){W.registerCloneMode(e,t,H.Shallow)}function X(e,t){W.registerCloneMode(e,t,H.Deep)}(z=H||(H={}))[z.Ignore=0]="Ignore",z[z.Assignment=1]="Assignment",z[z.Shallow=2]="Shallow",z[z.Deep=3]="Deep";var W=function(){function e(){}return e.registerCloneMode=function(t,n,r){var i=e._subCloneModeMap.get(t.constructor);i||(i=Object.create(null),e._subCloneModeMap.set(t.constructor,i)),i[n]=r},e.getCloneModeMode=function(t){var n=e._cloneModeMap.get(t);if(!n){n=Object.create(null),e._cloneModeMap.set(t,n);for(var r=e._obejctType,i=e._subCloneModeMap;t!==r;){var a=i.get(t);a&&Object.assign(n,a),t=Object.getPrototypeOf(t)}}return n},e}();W._subCloneModeMap=new Map,W._cloneModeMap=new Map,W._obejctType=Object.getPrototypeOf(Object);var q=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,K=function(e,t,n,r){for(var i,a=r>1?void 0:r?Y(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&q(t,n,a),a},Q=function e(t){this.instanceId=++e._instanceIdCounter,this._engine=t};Q._instanceIdCounter=0,K([k],Q.prototype,"instanceId",2),K([k],Q.prototype,"_engine",2);var Z=Object.defineProperty,J=Object.getOwnPropertyDescriptor,$=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._evts=Object.create(null),t._evtCount=0,t}R(t,e);var n=t.prototype;return n.hasEvent=function(e){return null!=this._evts[e]},n.eventNames=function(){return 0===this._evtCount?[]:Object.keys(this._evts)},n.listenerCount=function(e){var t=this._evts[e];return t?t.fn?1:t.length:0},n.dispatch=function(e,t){if(!this._evts[e])return!1;var n=this._evts[e];if(n.fn)n.once&&this.removeEventListener(e,n.fn),n.fn(t);else for(var r=n.length,i=0;i<r;i++)n[i].once&&this.removeEventListener(e,n[i].fn),n[i].fn(t);return!0},n.on=function(e,t){return this.addEventListener(e,t)},n.once=function(e,t){return this.addEventListener(e,t,!0)},n.addEventListener=function(e,t,n){var r={fn:t,once:n},i=this._evts;return i[e]?i[e].fn?i[e]=[i[e],r]:i[e].push(r):(i[e]=r,this._evtCount++),this},n.off=function(e,t){if(!this._evts[e])return this;if(!t)return this._clearEvent(e),this;var n=this._evts[e];if(n.fn&&n.fn===t)this._clearEvent(e);else{var r=n.indexOf(t);if(r>-1){var i=n[n.length-1];n[r]=i,n.length--,1===n.length&&(this._evts[e]=n[0])}}return this},n.removeEventListener=function(e,t){return this.off(e,t)},n.removeAllEventListeners=function(e){e?this._evts[e]&&this._clearEvent(e):(this._evts=Object.create(null),this._evtCount=0)},n.trigger=function(e){this.dispatch(e.type,e.data)},n._clearEvent=function(e){0==--this._evtCount?this._evts=Object.create(null):delete this._evts[e]},t}(Q);!function(e,t,n,r){for(var i,a=r>1?void 0:r?J(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);r&&a&&Z(t,n,a)}([k],$.prototype,"_evts",2);var ee,te,ne,re,ie,ae,oe,se,ue,ce,le,fe,he,de,_e,me,pe,ve,ge,ye,Ee,Te,xe,Ae,Oe,be,Me,Se,Re,Le,Ce,Ie,we,Pe,Ne=function(e){},Fe=console.log.bind(console),De=console.info.bind(console),Ue=console.warn.bind(console),Ve=console.error.bind(console),Be={debug:Ne,info:Ne,warn:Ne,error:Ne,isEnabled:!1,enable:function(){this.debug=Fe,this.info=De,this.warn=Ue,this.error=Ve,this.isEnabled=!0},disable:function(){this.debug=Ne,this.info=Ne,this.warn=Ne,this.error=Ne,this.isEnabled=!1}},He=function(){function e(){this._clock=performance||Date,this._timeScale=1,this._deltaTime=1e-4;var e=this._clock.now();this._startTime=e,this._lastTickTime=e}var t=e.prototype;return t.reset=function(){this._lastTickTime=this._clock.now()},t.tick=function(){var e=this.nowTime;this._deltaTime=(e-this._lastTickTime)*this._timeScale,this._lastTickTime=e},S(e,[{key:"nowTime",get:function(){return this._clock.now()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"timeScale",get:function(){return this._timeScale},set:function(e){this._timeScale=e}},{key:"unscaledDeltaTime",get:function(){return this._deltaTime/this._timeScale}},{key:"timeSinceStartup",get:function(){return this.nowTime-this._startTime}}]),e}();(te=ee||(ee={}))[te.Scene=1]="Scene",te[te.Cache=2]="Cache",(re=ne||(ne={}))[re.DONT_CLEAR=0]="DONT_CLEAR",re[re.SOLID_COLOR=1]="SOLID_COLOR",re[re.DEPTH_ONLY=2]="DEPTH_ONLY",re[re.COLOR_ONLY=3]="COLOR_ONLY",re[re.STENCIL_ONLY=4]="STENCIL_ONLY",re[re.ALL_CLEAR=5]="ALL_CLEAR",(ae=ie||(ie={}))[ae.OPAQUE=1e3]="OPAQUE",ae[ae.TRANSPARENT=2e3]="TRANSPARENT",(se=oe||(oe={}))[se.BLEND=3042]="BLEND",se[se.CULL_FACE=2884]="CULL_FACE",se[se.DEPTH_TEST=2929]="DEPTH_TEST",se[se.ALPHA_TEST=3008]="ALPHA_TEST",se[se.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",se[se.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",se[se.SCISSOR_TEST=3089]="SCISSOR_TEST",(ce=ue||(ue={}))[ce.CW=2304]="CW",ce[ce.CCW=2305]="CCW",(fe=le||(le={}))[fe.FRONT=1028]="FRONT",fe[fe.BACK=1029]="BACK",fe[fe.FRONT_AND_BACK=1032]="FRONT_AND_BACK",(de=he||(he={}))[de.FRONT=0]="FRONT",de[de.BACK=1]="BACK",de[de.NONE=2]="NONE",de[de.DOUBLE=3]="DOUBLE",(me=_e||(_e={}))[me.NEVER=512]="NEVER",me[me.LESS=513]="LESS",me[me.EQUAL=514]="EQUAL",me[me.LEQUAL=515]="LEQUAL",me[me.GREATER=516]="GREATER",me[me.NOTEQUAL=517]="NOTEQUAL",me[me.GEQUAL=518]="GEQUAL",me[me.ALWAYS=519]="ALWAYS",(ve=pe||(pe={}))[ve.NEAREST=9728]="NEAREST",ve[ve.LINEAR=9729]="LINEAR",ve[ve.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",ve[ve.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",ve[ve.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",ve[ve.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",(ye=ge||(ge={}))[ye.FLOAT=5126]="FLOAT",ye[ye.FLOAT_VEC2=35664]="FLOAT_VEC2",ye[ye.FLOAT_VEC3=35665]="FLOAT_VEC3",ye[ye.FLOAT_VEC4=35666]="FLOAT_VEC4",ye[ye.INT=5124]="INT",ye[ye.INT_VEC2=35667]="INT_VEC2",ye[ye.INT_VEC3=35668]="INT_VEC3",ye[ye.INT_VEC4=35669]="INT_VEC4",ye[ye.BOOL=35670]="BOOL",ye[ye.BOOL_VEC2=35671]="BOOL_VEC2",ye[ye.BOOL_VEC3=35672]="BOOL_VEC3",ye[ye.BOOL_VEC4=35673]="BOOL_VEC4",ye[ye.FLOAT_MAT2=35674]="FLOAT_MAT2",ye[ye.FLOAT_MAT3=35675]="FLOAT_MAT3",ye[ye.FLOAT_MAT4=35676]="FLOAT_MAT4",ye[ye.FLOAT_ARRAY=35677]="FLOAT_ARRAY",ye[ye.FLOAT_VEC2_ARRAY=1e5]="FLOAT_VEC2_ARRAY",ye[ye.FLOAT_VEC3_ARRAY=100001]="FLOAT_VEC3_ARRAY",ye[ye.FLOAT_VEC4_ARRAY=100002]="FLOAT_VEC4_ARRAY",ye[ye.INT_ARRAY=100003]="INT_ARRAY",ye[ye.INT_VEC2_ARRAY=100004]="INT_VEC2_ARRAY",ye[ye.INT_VEC3_ARRAY=100005]="INT_VEC3_ARRAY",ye[ye.INT_VEC4_ARRAY=100006]="INT_VEC4_ARRAY",ye[ye.FLOAT_MAT2_ARRAY=100007]="FLOAT_MAT2_ARRAY",ye[ye.FLOAT_MAT3_ARRAY=100008]="FLOAT_MAT3_ARRAY",ye[ye.FLOAT_MAT4_ARRAY=100009]="FLOAT_MAT4_ARRAY",ye[ye.SAMPLER_2D_ARRAY=100010]="SAMPLER_2D_ARRAY",ye[ye.SAMPLER_CUBE_ARRAY=100011]="SAMPLER_CUBE_ARRAY",ye[ye.SAMPLER_2D=35678]="SAMPLER_2D",ye[ye.SAMPLER_CUBE=35680]="SAMPLER_CUBE",ye[ye.BYTE=5120]="BYTE",ye[ye.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",ye[ye.SHORT=5122]="SHORT",ye[ye.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",ye[ye.UNSIGNED_INT=5125]="UNSIGNED_INT",(Te=Ee||(Ee={}))[Te.LOCAL=1]="LOCAL",Te[Te.MODEL=2]="MODEL",Te[Te.VIEW=3]="VIEW",Te[Te.PROJECTION=4]="PROJECTION",Te[Te.MODELVIEW=5]="MODELVIEW",Te[Te.VIEWPROJECTION=21]="VIEWPROJECTION",Te[Te.MODELVIEWPROJECTION=6]="MODELVIEWPROJECTION",Te[Te.MODELINVERSE=7]="MODELINVERSE",Te[Te.VIEWINVERSE=8]="VIEWINVERSE",Te[Te.PROJECTIONINVERSE=9]="PROJECTIONINVERSE",Te[Te.MODELVIEWINVERSE=10]="MODELVIEWINVERSE",Te[Te.MODELVIEWPROJECTIONINVERSE=11]="MODELVIEWPROJECTIONINVERSE",Te[Te.MODELINVERSETRANSPOSE=12]="MODELINVERSETRANSPOSE",Te[Te.MODELVIEWINVERSETRANSPOSE=13]="MODELVIEWINVERSETRANSPOSE",Te[Te.VIEWPORT=14]="VIEWPORT",Te[Te.JOINTMATRIX=15]="JOINTMATRIX",Te[Te.MORPHWEIGHTS=16]="MORPHWEIGHTS",Te[Te.EYEPOS=17]="EYEPOS",Te[Te.TIME=18]="TIME",Te[Te.JOINTTEXTURE=19]="JOINTTEXTURE",Te[Te.JOINTCOUNT=20]="JOINTCOUNT",(Ae=xe||(xe={}))[Ae.ZERO=0]="ZERO",Ae[Ae.ONE=1]="ONE",Ae[Ae.SRC_COLOR=768]="SRC_COLOR",Ae[Ae.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",Ae[Ae.SRC_ALPHA=770]="SRC_ALPHA",Ae[Ae.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",Ae[Ae.DST_ALPHA=772]="DST_ALPHA",Ae[Ae.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",Ae[Ae.DST_COLOR=774]="DST_COLOR",Ae[Ae.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",Ae[Ae.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",Ae[Ae.enumANT_COLOR=32769]="enumANT_COLOR",Ae[Ae.ONE_MINUS_enumANT_COLOR=32770]="ONE_MINUS_enumANT_COLOR",Ae[Ae.enumANT_ALPHA=32771]="enumANT_ALPHA",Ae[Ae.ONE_MINUS_enumANT_ALPHA=32772]="ONE_MINUS_enumANT_ALPHA",(be=Oe||(Oe={}))[be.MASK1=1]="MASK1",be[be.MASK2=2]="MASK2",be[be.MASK3=4]="MASK3",be[be.MASK4=8]="MASK4",be[be.MASK5=16]="MASK5",be[be.MASK6=32]="MASK6",be[be.MASK7=64]="MASK7",be[be.MASK8=128]="MASK8",be[be.MASK9=256]="MASK9",be[be.MASK10=512]="MASK10",be[be.MASK11=1024]="MASK11",be[be.MASK12=2048]="MASK12",be[be.MASK13=4096]="MASK13",be[be.MASK14=8192]="MASK14",be[be.MASK15=16384]="MASK15",be[be.MASK16=32768]="MASK16",be[be.MASK17=65536]="MASK17",be[be.MASK18=131072]="MASK18",be[be.MASK19=262144]="MASK19",be[be.MASK20=524288]="MASK20",be[be.EVERYTHING=268435455]="EVERYTHING",be[be.SHADOW=268435456]="SHADOW",be[be.SHADOW_MAP=536870912]="SHADOW_MAP",(Se=Me||(Me={}))[Se.ONCE=1]="ONCE",Se[Se.EVERYFRAME=2]="EVERYFRAME",(Le=Re||(Re={}))[Le.AABB=0]="AABB",Le[Le.OBB=1]="OBB",Le[Le.SPHERE=2]="SPHERE",(Ie=Ce||(Ce={})).standardDerivatives="OES_standard_derivatives",Ie.shaderTextureLod="EXT_shader_texture_lod",Ie.elementIndexUint="OES_element_index_uint",Ie.depthTexture="WEBGL_depth_texture",Ie.drawBuffers="WEBGL_draw_buffers",Ie.vertexArrayObject="OES_vertex_array_object",Ie.instancedArrays="ANGLE_instanced_arrays",Ie.multipleSample="multipleSampleOnlySupportedInWebGL2",Ie.textureFloat="OES_texture_float",Ie.textureFloatLinear="OES_texture_float_linear",Ie.textureHalfFloat="OES_texture_half_float",Ie.textureHalfFloatLinear="OES_texture_half_float_linear",Ie.WEBGL_colorBufferFloat="WEBGL_color_buffer_float",Ie.colorBufferFloat="EXT_color_buffer_float",Ie.colorBufferHalfFloat="EXT_color_buffer_half_float",Ie.textureFilterAnisotropic="EXT_texture_filter_anisotropic",Ie.astc="WEBGL_compressed_texture_astc",Ie.astc_webkit="WEBKIT_WEBGL_compressed_texture_astc",Ie.etc="WEBGL_compressed_texture_etc",Ie.etc_webkit="WEBKIT_WEBGL_compressed_texture_etc",Ie.etc1="WEBGL_compressed_texture_etc1",Ie.etc1_webkit="WEBKIT_WEBGL_compressed_texture_etc1",Ie.pvrtc="WEBGL_compressed_texture_pvrtc",Ie.pvrtc_webkit="WEBKIT_WEBGL_compressed_texture_pvrtc",Ie.s3tc="WEBGL_compressed_texture_s3tc",Ie.s3tc_webkit="WEBKIT_WEBGL_compressed_texture_s3tc",(Pe=we||(we={}))[Pe.WEIGHTED_AVERAGE=0]="WEIGHTED_AVERAGE",Pe[Pe.DEPTH_PEEL=1]="DEPTH_PEEL",Pe[Pe.DUAL_DEPTH_PEEL=2]="DUAL_DEPTH_PEEL";var ze,Ge,ke=function(){function e(e){void 0===e&&(e=0),this.length=0,this._elements=new Array(e)}var t=e.prototype;return t.add=function(e){this.length===this._elements.length?this._elements.push(e):this._elements[this.length]=e,this.length++},t.delete=function(e){var t=this._elements.indexOf(e);this.deleteByIndex(t)},t.deleteByIndex=function(e){var t=this._elements,n=null,r=this.length-1;return e!==r&&(n=t[r],t[e]=n),this.length--,n},t.garbageCollection=function(){this._elements.length=this.length},e}(),je=function(){function e(){this._onStartScripts=new ke,this._onUpdateScripts=new ke,this._onLateUpdateScripts=new ke,this._destoryComponents=[],this._onUpdateAnimations=new ke,this._renderers=new ke,this._onUpdateRenderers=new ke,this._componentsContainerPool=[]}var t=e.prototype;return t.addRenderer=function(e){e._rendererIndex=this._renderers.length,this._renderers.add(e)},t.removeRenderer=function(e){var t=this._renderers.deleteByIndex(e._rendererIndex);t&&(t._rendererIndex=e._rendererIndex),e._rendererIndex=-1},t.addOnStartScript=function(e){e._onStartIndex=this._onStartScripts.length,this._onStartScripts.add(e)},t.removeOnStartScript=function(e){var t=this._onStartScripts.deleteByIndex(e._onStartIndex);t&&(t._onStartIndex=e._onStartIndex),e._onStartIndex=-1},t.addOnUpdateScript=function(e){e._onUpdateIndex=this._onUpdateScripts.length,this._onUpdateScripts.add(e)},t.removeOnUpdateScript=function(e){var t=this._onUpdateScripts.deleteByIndex(e._onUpdateIndex);t&&(t._onUpdateIndex=e._onUpdateIndex),e._onUpdateIndex=-1},t.addOnLateUpdateScript=function(e){e._onLateUpdateIndex=this._onLateUpdateScripts.length,this._onLateUpdateScripts.add(e)},t.removeOnLateUpdateScript=function(e){var t=this._onLateUpdateScripts.deleteByIndex(e._onLateUpdateIndex);t&&(t._onLateUpdateIndex=e._onLateUpdateIndex),e._onLateUpdateIndex=-1},t.addOnUpdateAnimations=function(e){e._onUpdateIndex=this._onUpdateAnimations.length,this._onUpdateAnimations.add(e)},t.removeOnUpdateAnimations=function(e){var t=this._onUpdateAnimations.deleteByIndex(e._onUpdateIndex);t&&(t._onUpdateIndex=e._onUpdateIndex),e._onUpdateIndex=-1},t.addOnUpdateRenderers=function(e){e._onUpdateIndex=this._onUpdateRenderers.length,this._onUpdateRenderers.add(e)},t.removeOnUpdateRenderers=function(e){var t=this._onUpdateRenderers.deleteByIndex(e._onUpdateIndex);t&&(t._onUpdateIndex=e._onUpdateIndex),e._onUpdateIndex=-1},t.addDestoryComponent=function(e){this._destoryComponents.push(e)},t.callScriptOnStart=function(){var e=this._onStartScripts;if(e.length>0){for(var t=e._elements,n=0;n<e.length;n++){var r=t[n];r._started=!0,r._onStartIndex=-1,r.onStart()}e.length=0}},t.callScriptOnUpdate=function(e){for(var t=this._onUpdateScripts._elements,n=this._onUpdateScripts.length-1;n>=0;--n){var r=t[n];r._started&&r.onUpdate(e)}},t.callScriptOnLateUpdate=function(e){for(var t=this._onLateUpdateScripts._elements,n=this._onLateUpdateScripts.length-1;n>=0;--n){var r=t[n];r._started&&r.onLateUpdate(e)}},t.callAnimationUpdate=function(e){for(var t=this._onUpdateAnimations._elements,n=this._onUpdateAnimations.length-1;n>=0;--n)t[n].update(e)},t.callRendererOnUpdate=function(e){for(var t=this._onUpdateRenderers._elements,n=this._onUpdateRenderers.length-1;n>=0;--n)t[n].update(e)},t.callRender=function(e){for(var t=this._renderers._elements,n=this._renderers.length-1;n>=0;--n)t[n]._render(e)},t.callComponentDestory=function(){var e=this._destoryComponents,t=e.length;if(t>0){for(var n=t-1;n>=0;--n)e[n].onDestroy();e.length=0}},t.callCameraOnBeginRender=function(e){for(var t=e.entity._components,n=t.length-1;n>=0;--n){var r=t[n];r.onBeginRender&&r.onBeginRender(e)}},t.callCameraOnEndRender=function(e){for(var t=e.entity._components,n=t.length-1;n>=0;--n){var r=t[n];r.onBeginRender&&r.onEndRender(e)}},t.getActiveChangedTempList=function(){return this._componentsContainerPool.length?this._componentsContainerPool.pop():[]},t.putActiveChangedTempList=function(e){e.length=0,this._componentsContainerPool.push(e)},e}(),Xe=function(){function e(){}return e.cloneComponent=function(t,n){for(var r=W.getCloneModeMode(t.constructor),i=Object.keys(t),a=0,o=i.length;a<o;a++){var s=i[a];switch(r[s]){case void 0:case H.Assignment:n[s]=t[s];break;case H.Shallow:var u=t[s];if(u instanceof Object){var c=n[s];null==c&&(c=n[s]=u.constructor()),Object.assign(c,u)}else n[s]=u;break;case H.Deep:var l=t[s];if(l instanceof Object){var f=n[s];null==f&&(f=n[s]=l.constructor()),e._cloneComponentProp(l,f)}else n[s]=l}}},e._cloneComponentProp=function(t,n){var r=t.constructor;if(r===Object)for(var i=Object.keys(t),a=0,o=i.length;a<o;a++){var s=i[a],u=t[s];if(u instanceof Object){var c=n[s];null==c&&(n[s]=c=u.constructor()),e._cloneComponentProp(u,c)}else n[s]=u}else if(r===Array){var l=t,f=n,h=l.length;f.length=h;for(var d=0;d<h;d++){var _=l[d];if(_ instanceof Object){var m=f[d];null==m&&(f[d]=m=_.constructor()),e._cloneComponentProp(_,m)}else f[d]=_}}else t.cloneTo(n)},e}(),We=function(){function e(){}return e.register=function(e,t){this._addDependency(e,t,this._dependenciesMap),this._addDependency(t,e,this._invDependenciesMap)},e._addCheck=function(t,n){var r=e._dependenciesMap.get(n);if(r)for(var i=0,a=r.length;i<a;i++)if(!t.getComponent(r[i]))throw"you should add "+r[i]+" before adding "+n},e._removeCheck=function(t,n){var r=e._invDependenciesMap.get(n);if(r)for(var i=0,a=r.length;i<a;i++)if(t.getComponent(r[i]))throw"you should remove "+r[i]+" before adding "+n},e._addDependency=function(e,t,n){var r=n.get(e);r||(r=[],n.set(e,r)),-1===r.indexOf(t)&&r.push(t)},e}();function qe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){t.forEach((function(t){return We.register(e,t)}))}}We._dependenciesMap=new Map,We._invDependenciesMap=new Map,(Ge=ze||(ze={}))[Ge.Layer0=1]="Layer0",Ge[Ge.Layer1=2]="Layer1",Ge[Ge.Layer2=4]="Layer2",Ge[Ge.Layer3=8]="Layer3",Ge[Ge.Layer4=16]="Layer4",Ge[Ge.Layer5=32]="Layer5",Ge[Ge.Layer6=64]="Layer6",Ge[Ge.Layer7=128]="Layer7",Ge[Ge.Layer8=256]="Layer8",Ge[Ge.Layer9=512]="Layer9",Ge[Ge.Layer10=1024]="Layer10",Ge[Ge.Layer11=2048]="Layer11",Ge[Ge.Layer12=4096]="Layer12",Ge[Ge.Layer13=8192]="Layer13",Ge[Ge.Layer14=16384]="Layer14",Ge[Ge.Layer15=32768]="Layer15",Ge[Ge.Layer16=65536]="Layer16",Ge[Ge.Layer17=131072]="Layer17",Ge[Ge.Layer18=262144]="Layer18",Ge[Ge.Layer19=524288]="Layer19",Ge[Ge.Layer20=1048576]="Layer20",Ge[Ge.Layer21=2097152]="Layer21",Ge[Ge.Layer22=4194304]="Layer22",Ge[Ge.Layer23=8388608]="Layer23",Ge[Ge.Layer24=16777216]="Layer24",Ge[Ge.Layer25=33554432]="Layer25",Ge[Ge.Layer26=67108864]="Layer26",Ge[Ge.Layer27=134217728]="Layer27",Ge[Ge.Layer28=268435456]="Layer28",Ge[Ge.Layer29=536870912]="Layer29",Ge[Ge.Layer30=1073741824]="Layer30",Ge[Ge.Layer31=2147483648]="Layer31",Ge[Ge.Everything=4294967295]="Everything",Ge[Ge.Nothing=0]="Nothing";var Ye=Object.defineProperty,Ke=Object.getOwnPropertyDescriptor,Qe=function(e,t,n,r){for(var i,a=r>1?void 0:r?Ke(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Ye(t,n,a),a},Ze=function(e){function t(t){var n;return(n=e.call(this,t.engine)||this)._destroyed=!1,n._enabled=!0,n._awaked=!1,n._renderPriority=0,n._cullDistanceSq=0,n._entity=t,n._renderPassFlag=Oe.EVERYTHING,n._passMasks=[Oe.EVERYTHING],n}R(t,e);var n=t.prototype;return n.destroy=function(){this._destroyed||(this._entity._removeComponent(this),this._entity.isActiveInHierarchy&&(this._enabled&&this._onDisable(),this._onInActive()),this._destroyed=!0,this._onDestroy())},n._onAwake=function(){},n._onEnable=function(){},n._onDisable=function(){},n._onDestroy=function(){},n._onActive=function(){},n._onInActive=function(){},n._setActive=function(e){e?(this._awaked||(this._awaked=!0,this._onAwake()),this._entity._isActiveInHierarchy&&(this._onActive(),this._enabled&&this._onEnable())):(this._enabled&&this._onDisable(),this._onInActive())},n.setPassMasks=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._passMasks=t,this._renderPassFlag=t.reduce((function(e,t){return e|t}),0)},n.addPassMasks=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r],o=this._passMasks.indexOf(a);o<0&&this._passMasks.push(a)}this.setPassMasks.apply(this,this._passMasks)},n.removePassMasks=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r],o=this._passMasks.indexOf(a);o>-1&&this._passMasks.splice(o,1)}this.setPassMasks.apply(this,this._passMasks)},S(t,[{key:"enabled",get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,e?this._entity.isActiveInHierarchy&&this._onEnable():this._entity.isActiveInHierarchy&&this._onDisable())}},{key:"destroyed",get:function(){return this._destroyed}},{key:"entity",get:function(){return this._entity}},{key:"scene",get:function(){return this._entity.scene}},{key:"engine",get:function(){return this._entity.engine}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(e){this._renderPriority=e}},{key:"cullDistanceSq",get:function(){return this._cullDistanceSq}},{key:"cullDistance",get:function(){return Math.sqrt(this._cullDistanceSq)},set:function(e){this._cullDistanceSq=e*e}},{key:"renderPassFlag",get:function(){return this._renderPassFlag},set:function(e){this._renderPassFlag=e}}]),t}($);Qe([k],Ze.prototype,"_entity",2),Qe([k],Ze.prototype,"_destroyed",2),Qe([k],Ze.prototype,"_enabled",2),Qe([k],Ze.prototype,"_awaked",2);var Je=function(){function e(e){void 0===e&&(e=[]),this._flags=e,this.flag=!0}return e.prototype.destroy=function(){D(this._flags,this),this._flags=null},e}(),$e=Object.defineProperty,et=Object.getOwnPropertyDescriptor,tt=function(e,t,n,r){for(var i,a=r>1?void 0:r?et(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&$e(t,n,a),a},nt=function(e){function t(){var n;return(n=e.apply(this,arguments)||this)._position=new s,n._rotation=new s,n._rotationQuaternion=new f,n._scale=new s(1,1,1),n._worldPosition=new s,n._worldRotation=new s,n._worldRotationQuaternion=new f,n._lossyWorldScale=new s(1,1,1),n._localMatrix=new h,n._worldMatrix=new h,n._changeFlags=[],n._isParentDirty=!0,n._parentTransformCache=null,n._dirtyFlag=t._WM_WP_WE_WQ_WS_FLAGS,n}R(t,e);var n=t.prototype;return n.setPosition=function(e,t,n){this._position.setValue(e,t,n),this.position=this._position},n.setRotation=function(e,t,n){this._rotation.setValue(e,t,n),this.rotation=this._rotation},n.setRotationQuaternion=function(e,t,n,r){this._rotationQuaternion.setValue(e,t,n,r),this.rotationQuaternion=this._rotationQuaternion},n.setScale=function(e,t,n){this._scale.setValue(e,t,n),this.scale=this._scale},n.setWorldPosition=function(e,t,n){this._worldPosition.setValue(e,t,n),this.worldPosition=this._worldPosition},n.setWorldRotation=function(e,t,n){this._worldRotation.setValue(e,t,n),this.worldRotation=this._worldRotation},n.setWorldRotationQuaternion=function(e,t,n,r){this._worldRotationQuaternion.setValue(e,t,n,r),this.worldRotationQuaternion=this._worldRotationQuaternion},n.getWorldForward=function(e){var t=this.worldMatrix.elements;return e.setValue(-t[8],-t[9],-t[10]),e.normalize()},n.getWorldRight=function(e){var t=this.worldMatrix.elements;return e.setValue(t[0],t[1],t[2]),e.normalize()},n.getWorldUp=function(e){var t=this.worldMatrix.elements;return e.setValue(t[4],t[5],t[6]),e.normalize()},n.translate=function(e,n){if(void 0===n&&(n=!0),n){var r=t._tempMat40;h.rotationQuaternion(this.rotationQuaternion,r),s.transformCoordinate(e,r,t._tempVec3),this.position=this._position.add(t._tempVec3)}else this.worldPosition=this._worldPosition.add(e)},n.translateXYZ=function(e,n,r,i){void 0===i&&(i=!0);var a=t._tempVec3;a.setValue(e,n,r),this.translate(a,i)},n.rotate=function(e,t){void 0===t&&(t=!0),this.rotateXYZ(e.x,e.y,e.z,t)},n.rotateXYZ=function(e,n,r,i){void 0===i&&(i=!0);var a=o.degreeToRadFactor,s=t._tempQuat0;f.rotationEuler(e*a,n*a,r*a,s),this._rotateByQuat(s,i)},n.rotateByAxis=function(e,n,r){void 0===r&&(r=!0);var i=n*o.degreeToRadFactor;f.rotationAxisAngle(e,i,t._tempQuat0),this._rotateByQuat(t._tempQuat0,r)},n.lookAt=function(e,n){var r,i=this.worldPosition,a=o.zeroTolerance;if(!(Math.abs(i.x-e.x)<a&&Math.abs(i.y-e.y)<a&&Math.abs(i.z-e.z)<a)){var s=t._tempMat43,u=this._worldRotationQuaternion;n=null!=(r=n)?r:t._tempVec3.setValue(0,1,0),h.lookAt(i,e,n,s),s.getRotation(u).invert(),this.worldRotationQuaternion=u}},n.registerWorldChangeFlag=function(){var e=new Je(this._changeFlags);return this._changeFlags.push(e),e},n._parentChange=function(){this._isParentDirty=!0,this._updateAllWorldFlag()},n._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(t._WM_WP_FLAGS)){this._worldAssociatedChange(t._WM_WP_FLAGS);for(var e=this._entity._children,n=0,r=e.length;n<r;n++){var i;null==(i=e[n].transform)||i._updateWorldPositionFlag()}}},n._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(t._WM_WE_WQ_FLAGS)){this._worldAssociatedChange(t._WM_WE_WQ_FLAGS);for(var e=this._entity._children,n=0,r=e.length;n<r;n++){var i;null==(i=e[n].transform)||i._updateWorldPositionAndRotationFlag()}}},n._updateWorldPositionAndRotationFlag=function(){if(!this._isContainDirtyFlags(t._WM_WP_WE_WQ_FLAGS)){this._worldAssociatedChange(t._WM_WP_WE_WQ_FLAGS);for(var e=this._entity._children,n=0,r=e.length;n<r;n++){var i;null==(i=e[n].transform)||i._updateWorldPositionAndRotationFlag()}}},n._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(t._WM_WS_FLAGS)){this._worldAssociatedChange(t._WM_WS_FLAGS);for(var e=this._entity._children,n=0,r=e.length;n<r;n++){var i;null==(i=e[n].transform)||i._updateWorldPositionAndScaleFlag()}}},n._updateWorldPositionAndScaleFlag=function(){if(!this._isContainDirtyFlags(t._WM_WP_WS_FLAGS)){this._worldAssociatedChange(t._WM_WP_WS_FLAGS);for(var e=this._entity._children,n=0,r=e.length;n<r;n++){var i;null==(i=e[n].transform)||i._updateWorldPositionAndScaleFlag()}}},n._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(t._WM_WP_WE_WQ_WS_FLAGS)){this._worldAssociatedChange(t._WM_WP_WE_WQ_WS_FLAGS);for(var e=this._entity._children,n=0,r=e.length;n<r;n++){var i;null==(i=e[n].transform)||i._updateAllWorldFlag()}}},n._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;for(var e=null,t=this._entity.parent;t;){var n=t.transform;if(n){e=n;break}t=t.parent}return this._parentTransformCache=e,this._isParentDirty=!1,e},n._getScaleMatrix=function(){var e=t._tempQuat0,n=t._tempMat30,r=t._tempMat31,i=t._tempMat32;return r.setValueByMatrix(this.worldMatrix),f.invert(this.worldRotationQuaternion,e),l.rotationQuaternion(e,n),l.multiply(n,r,i),i},n._isContainDirtyFlags=function(e){return(this._dirtyFlag&e)===e},n._isContainDirtyFlag=function(e){return 0!=(this._dirtyFlag&e)},n._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},n._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},n._worldAssociatedChange=function(e){this._dirtyFlag|=e;for(var t=this._changeFlags.length-1;t>=0;t--)this._changeFlags[t].flag=!0},n._rotateByQuat=function(e,t){t?(f.multiply(this.rotationQuaternion,e,this._rotationQuaternion),this.rotationQuaternion=this._rotationQuaternion):(f.multiply(this.worldRotationQuaternion,e,this._worldRotationQuaternion),this.worldRotationQuaternion=this._worldRotationQuaternion)},S(t,[{key:"position",get:function(){return this._position},set:function(e){this._position!==e&&e.cloneTo(this._position),this._setDirtyFlagTrue(t._LOCAL_MATRIX_FLAG),this._updateWorldPositionFlag()}},{key:"worldPosition",get:function(){return this._isContainDirtyFlag(t._WORLD_POSITION_FLAG)&&(this._getParentTransform()?this.worldMatrix.getTranslation(this._worldPosition):this._position.cloneTo(this._worldPosition),this._setDirtyFlagFalse(t._WORLD_POSITION_FLAG)),this._worldPosition},set:function(e){this._worldPosition!==e&&e.cloneTo(this._worldPosition);var n=this._getParentTransform();n?(h.invert(n.worldMatrix,t._tempMat41),s.transformCoordinate(e,t._tempMat41,this._position)):e.cloneTo(this._position),this.position=this._position,this._setDirtyFlagFalse(t._WORLD_POSITION_FLAG)}},{key:"rotation",get:function(){return this._isContainDirtyFlag(t._LOCAL_EULER_FLAG)&&(this._rotationQuaternion.toEuler(this._rotation),this._rotation.scale(o.radToDegreeFactor),this._setDirtyFlagFalse(t._LOCAL_EULER_FLAG)),this._rotation},set:function(e){this._rotation!==e&&e.cloneTo(this._rotation),this._setDirtyFlagTrue(t._LOCAL_MATRIX_FLAG|t._LOCAL_QUAT_FLAG),this._setDirtyFlagFalse(t._LOCAL_EULER_FLAG),this._updateWorldRotationFlag()}},{key:"worldRotation",get:function(){return this._isContainDirtyFlag(t._WORLD_EULER_FLAG)&&(this.worldRotationQuaternion.toEuler(this._worldRotation),this._worldRotation.scale(o.radToDegreeFactor),this._setDirtyFlagFalse(t._WORLD_EULER_FLAG)),this._worldRotation},set:function(e){this._worldRotation!==e&&e.cloneTo(this._worldRotation),f.rotationEuler(o.degreeToRadian(e.x),o.degreeToRadian(e.y),o.degreeToRadian(e.z),this._worldRotationQuaternion),this.worldRotationQuaternion=this._worldRotationQuaternion,this._setDirtyFlagFalse(t._WORLD_EULER_FLAG)}},{key:"rotationQuaternion",get:function(){return this._isContainDirtyFlag(t._LOCAL_QUAT_FLAG)&&(f.rotationEuler(o.degreeToRadian(this._rotation.x),o.degreeToRadian(this._rotation.y),o.degreeToRadian(this._rotation.z),this._rotationQuaternion),this._setDirtyFlagFalse(t._LOCAL_QUAT_FLAG)),this._rotationQuaternion},set:function(e){this._rotationQuaternion!==e&&e.cloneTo(this._rotationQuaternion),this._setDirtyFlagTrue(t._LOCAL_MATRIX_FLAG|t._LOCAL_EULER_FLAG),this._setDirtyFlagFalse(t._LOCAL_QUAT_FLAG),this._updateWorldRotationFlag()}},{key:"worldRotationQuaternion",get:function(){if(this._isContainDirtyFlag(t._WORLD_QUAT_FLAG)){var e=this._getParentTransform();null!=e?f.multiply(e.worldRotationQuaternion,this.rotationQuaternion,this._worldRotationQuaternion):this.rotationQuaternion.cloneTo(this._worldRotationQuaternion),this._setDirtyFlagFalse(t._WORLD_QUAT_FLAG)}return this._worldRotationQuaternion},set:function(e){this._worldRotationQuaternion!==e&&e.cloneTo(this._worldRotationQuaternion);var n=this._getParentTransform();n?(f.invert(n.worldRotationQuaternion,t._tempQuat0),f.multiply(e,t._tempQuat0,this._rotationQuaternion)):e.cloneTo(this._rotationQuaternion),this.rotationQuaternion=this._rotationQuaternion,this._setDirtyFlagFalse(t._WORLD_QUAT_FLAG)}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&e.cloneTo(this._scale),this._setDirtyFlagTrue(t._LOCAL_MATRIX_FLAG),this._updateWorldScaleFlag()}},{key:"lossyWorldScale",get:function(){if(this._isContainDirtyFlag(t._WORLD_SCALE_FLAG)){if(this._getParentTransform()){var e=this._getScaleMatrix().elements;this._lossyWorldScale.setValue(e[0],e[4],e[8])}else this._scale.cloneTo(this._lossyWorldScale);this._setDirtyFlagFalse(t._WORLD_SCALE_FLAG)}return this._lossyWorldScale}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(t._LOCAL_MATRIX_FLAG)&&(h.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(t._LOCAL_MATRIX_FLAG)),this._localMatrix},set:function(e){this._localMatrix!==e&&e.cloneTo(this._localMatrix),this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._setDirtyFlagTrue(t._LOCAL_EULER_FLAG),this._setDirtyFlagFalse(t._LOCAL_MATRIX_FLAG),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(t._WORLD_MATRIX_FLAG)){var e=this._getParentTransform();e?h.multiply(e.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._setDirtyFlagFalse(t._WORLD_MATRIX_FLAG)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&e.cloneTo(this._worldMatrix);var n=this._getParentTransform();n?(h.invert(n.worldMatrix,t._tempMat42),h.multiply(e,t._tempMat42,this._localMatrix)):e.cloneTo(this._localMatrix),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(t._WORLD_MATRIX_FLAG)}}]),t}(Ze);nt._tempQuat0=new f,nt._tempVec3=new s,nt._tempMat30=new l,nt._tempMat31=new l,nt._tempMat32=new l,nt._tempMat40=new h,nt._tempMat41=new h,nt._tempMat42=new h,nt._tempMat43=new h,nt._LOCAL_EULER_FLAG=1,nt._LOCAL_QUAT_FLAG=2,nt._WORLD_POSITION_FLAG=4,nt._WORLD_EULER_FLAG=8,nt._WORLD_QUAT_FLAG=16,nt._WORLD_SCALE_FLAG=32,nt._LOCAL_MATRIX_FLAG=64,nt._WORLD_MATRIX_FLAG=128,nt._WM_WP_FLAGS=132,nt._WM_WE_WQ_FLAGS=152,nt._WM_WP_WE_WQ_FLAGS=156,nt._WM_WS_FLAGS=160,nt._WM_WP_WS_FLAGS=164,nt._WM_WP_WE_WQ_WS_FLAGS=188,tt([X],nt.prototype,"_position",2),tt([X],nt.prototype,"_rotation",2),tt([X],nt.prototype,"_rotationQuaternion",2),tt([X],nt.prototype,"_scale",2),tt([X],nt.prototype,"_worldPosition",2),tt([X],nt.prototype,"_worldRotation",2),tt([X],nt.prototype,"_worldRotationQuaternion",2),tt([X],nt.prototype,"_lossyWorldScale",2),tt([X],nt.prototype,"_localMatrix",2),tt([X],nt.prototype,"_worldMatrix",2),tt([k],nt.prototype,"_changeFlags",2),tt([k],nt.prototype,"_isParentDirty",2),tt([k],nt.prototype,"_parentTransformCache",2);var rt=function(e){function t(n,r){var i;return(i=e.call(this,n)||this).layer=ze.Layer0,i._isActiveInHierarchy=!1,i._components=[],i._children=[],i._isRoot=!1,i._isActive=!0,i._parent=null,i._invModelMatrix=new h,t._entitys.add(A(i)),i.name=r,i.transform=i.addComponent(nt),i._inverseWorldMatFlag=i.transform.registerWorldChangeFlag(),i}R(t,e),t.findByName=function(e){for(var n=t._entitys,r=n._elements,i=n.length-1;i>=0;i--){var a=r[i];if(a.name===e)return a}return null},t.findByPath=function(e,t){return e.findEntityByPath(t)},t._findChildByName=function(e,t){for(var n=e._children,r=n.length-1;r>=0;r--){var i=n[r];if(i.name===t)return i}return null},t._traverseSetOwnerScene=function(e,t){e._scene=t;for(var n=e._children,r=e.childCount-1;r>=0;r--)this._traverseSetOwnerScene(n[r],t)};var n=t.prototype;return n.addComponent=function(e){We._addCheck(this,e);var t=new e(this);return this._components.push(t),this._isActiveInHierarchy&&t._setActive(!0),t},n.getComponent=function(e){for(var t=this._components.length-1;t>=0;t--){var n=this._components[t];if(n instanceof e)return n}},n.getComponents=function(e,t){t.length=0;for(var n=this._components.length-1;n>=0;n--){var r=this._components[n];r instanceof e&&t.push(r)}return t},n.getComponentsIncludeChildren=function(e,t){return t.length=0,this._getComponentsIncludeChildren(e,t),t},n.addChild=function(e){e.parent=this},n.removeChild=function(e){e.parent=null},n.getChild=function(e){return this._children[e]},n.findByName=function(e){var n=this._children,r=t._findChildByName(this,e);if(r)return r;for(var i=n.length-1;i>=0;i--){var a=n[i].findByName(e);if(a)return a}return null},n.findByPath=function(e){for(var n=e.split("/"),r=this,i=0,a=n.length;i<a;++i){var o=n[i];if(o&&!(r=t._findChildByName(r,o)))return null}return r},n.createChild=function(e){var n=new t(this.engine,e);return n.layer=this.layer,n.parent=this,n},n.clearChildren=function(){for(var e=this._children,n=e.length-1;n>=0;n--){var r=e[n];r._parent=null,r._isActiveInHierarchy&&r._processInActive(),t._traverseSetOwnerScene(r,null)}e.length=0},n.clone=function(){var e=new t(this._engine,this.name);e._isActive=this._isActive,e.transform.localMatrix=this.transform.localMatrix;for(var n=this._children,r=0,i=this._children.length;r<i;r++){var a=n[r];e.addChild(a.clone())}for(var o=this._components,s=0,u=o.length;s<u;s++){var c=o[s];if(!(c instanceof nt)){var l=e.addComponent(c.constructor);Xe.cloneComponent(c,l)}}return e},n.destroy=function(){for(var e=this._components,n=e.length-1;n>=0;n--)e[n].destroy();this._components.length=0;for(var r=this._children,i=r.length-1;i>=0;i--)r[i].destroy();if(this._children.length=0,null!=this._parent){var a=this._parent._children;a.splice(a.indexOf(this),1)}this._parent=null,t._entitys.delete(this)},n._removeComponent=function(e){We._removeCheck(this,e.constructor);var t=this._components;t.splice(t.indexOf(e),1)},n._removeFromParent=function(){var e=this._parent;if(null!=e){var t=e._children;t.splice(t.indexOf(this),1),this._parent=null}return e},n._processActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!0)},n._processInActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setInActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!1)},n._getComponentsIncludeChildren=function(e,t){for(var n=this._components.length-1;n>=0;n--){var r=this._components[n];r instanceof e&&t.push(r)}for(var i=this._children.length-1;i>=0;i--)this._children[i]._getComponentsIncludeChildren(e,t)},n._setActiveComponents=function(e){for(var t=this._activeChangedComponents,n=0,r=t.length;n<r;++n)t[n]._setActive(e);this._engine._componentsManager.putActiveChangedTempList(t),this._activeChangedComponents=null},n._setActiveInHierarchy=function(e){this._isActiveInHierarchy=!0;for(var t=this._components,n=t.length-1;n>=0;n--)e.push(t[n]);for(var r=this._children,i=r.length-1;i>=0;i--){var a=r[i];a.isActive&&a._setActiveInHierarchy(e)}},n._setInActiveInHierarchy=function(e){this._isActiveInHierarchy=!1;for(var t=this._components,n=t.length-1;n>=0;n--)e.push(t[n]);for(var r=this._children,i=r.length-1;i>=0;i--){var a=r[i];a.isActive&&a._setInActiveInHierarchy(e)}},n._setTransformDirty=function(){if(this.transform)this.transform._parentChange();else for(var e=0,t=this._children.length;e<t;e++)this._children[e]._setTransformDirty()},n.getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&(h.invert(this.transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},S(t,[{key:"isActive",get:function(){return this._isActive},set:function(e){if(e!==this._isActive)if(this._isActive=e,e){var t=this._parent;(null!=t&&t._isActiveInHierarchy||this._isRoot&&this._scene._isActiveInEngine)&&this._processActive()}else this._isActiveInHierarchy&&this._processInActive()}},{key:"isActiveInHierarchy",get:function(){return this._isActiveInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){if(e!==this._parent){var n=this._removeFromParent(),r=this._parent=e;if(r){r._children.push(this);var i=r._scene;this._scene!==i&&t._traverseSetOwnerScene(this,i),r._isActiveInHierarchy?!this._isActiveInHierarchy&&this._isActive&&this._processActive():this._isActiveInHierarchy&&this._processInActive()}else this._isActiveInHierarchy&&this._processInActive(),n&&t._traverseSetOwnerScene(this,null);this._setTransformDirty()}}},{key:"children",get:function(){return this._children}},{key:"childCount",get:function(){return this._children.length}},{key:"scene",get:function(){return this._scene}},{key:"engine",get:function(){return this._engine}},{key:"position",get:function(){return this.transform.position},set:function(e){this.transform.position=e}},{key:"worldPosition",get:function(){return this.transform.worldPosition},set:function(e){this.transform.worldPosition=e}},{key:"rotation",get:function(){return this.transform.rotationQuaternion},set:function(e){this.transform.rotationQuaternion=e}},{key:"scale",get:function(){return this.transform.scale},set:function(e){this.transform.scale=e}}]),t}($);rt._entitys=new ke;var it=function(){function e(){this._features=[],this._objects=[]}var t=e.prototype;return t.registerFeature=function(e){for(var t=this._features,n=0,r=t.length;n<r;n++)if(t[n]===e)return;t.push(e);for(var i=this._objects,a=0,o=i.length;a<o;a++)i[a].features.push(new e)},t.addObject=function(e){e.features=[];for(var t=0,n=this._features.length;t<n;t++){var r;e.features.push(new this._features[t](null!=(r=e.engine)?r:e))}this._objects.push(e)},t.callFeatureMethod=function(e,t,n){for(var r=e.features,i=r.length,a=0;a<i;a++){var o=r[a];o[t]&&o[t].apply(o,n)}},t.findFeature=function(e,t){for(var n=e.features,r=n.length,i=0;i<r;i++){var a=n[i];if(a.constructor===t)return a}},e}(),at=function(){function e(){}return e.getFromPool=function(){var t=e._elementPoolIndex,n=e._elementPool;if(e._elementPoolIndex++,n.length===t){var r=new e;return n.push(r),r}return n[t]},e._restPool=function(){e._elementPoolIndex=0},e.prototype.setValue=function(e,t,n,r){this.component=e,this.primitive=t,this.subPrimitive=n,this.material=r},e}();at._elementPoolIndex=0,at._elementPool=[];var ot=function(e){function t(n,r){var i;return(i=e.call(this,n)||this).clipPlanes=[],i._activeCameras=[],i._isActiveInEngine=!1,i._destroyed=!1,i._rootEntities=[],i.features=[],i.name=r||"",t.sceneFeatureManager.addObject(A(i)),i}R(t,e);var n=t.prototype;return n.createRootEntity=function(e){var t=new rt(this._engine,e);return this.addRootEntity(t),t},n.addRootEntity=function(e){var t=e._isRoot;t||(e._isRoot=!0,e._removeFromParent());var n=e._scene;n!==this?(n&&t&&n._removeEntity(e),this._rootEntities.push(e),rt._traverseSetOwnerScene(e,this)):t||this._rootEntities.push(e),this._isActiveInEngine?!e._isActiveInHierarchy&&e._isActive&&e._processActive():e._isActiveInHierarchy&&e._processInActive()},n.removeRootEntity=function(e){e._isRoot&&e._scene==this&&(this._removeEntity(e),this._isActiveInEngine&&e._processInActive(),rt._traverseSetOwnerScene(e,null))},n.getRootEntity=function(e){return void 0===e&&(e=0),this._rootEntities[e]},n.findEntityByName=function(e){for(var t=this._rootEntities,n=t.length-1;n>=0;n--){var r=t[n];if(r.name===e)return r}for(var i=t.length-1;i>=0;i--){var a=t[i].findByName(e);if(a)return a}return null},n.findEntityByPath=function(e){for(var t=e.split("/").filter(Boolean),n=0,r=this.rootEntitiesCount;n<r;n++){var i=this.getRootEntity(n);if(i.name==t[0]){for(var a=1,o=t.length;a<o&&(i=rt._findChildByName(i,t[a]));++a);return i}}return null},n.destroy=function(){this._isActiveInEngine&&(this._engine.sceneManager.activeScene=null),t.sceneFeatureManager.callFeatureMethod(this,"destroy",[this]);for(var e=0,n=this.rootEntitiesCount;e<n;e++)this._rootEntities[e].destroy();this._rootEntities.length=0,this._activeCameras.length=0,t.sceneFeatureManager._objects=[],this._destroyed=!0},n.attachRenderCamera=function(e){-1===this._activeCameras.indexOf(e)?this._activeCameras.push(e):Be.warn("Camera already attached.")},n.detachRenderCamera=function(e){var t=this._activeCameras.indexOf(e);-1!==t&&this._activeCameras.splice(t,1)},n._processActive=function(e){this._isActiveInEngine=e;for(var t=this._rootEntities,n=t.length-1;n>=0;n--){var r=t[n];r._isActive&&(e?r._processActive():r._processInActive())}},n._removeEntity=function(e){var t=this._rootEntities;t.splice(t.indexOf(e),1)},t.registerFeature=function(e){t.sceneFeatureManager.registerFeature(e)},n.findFeature=function(e){return t.sceneFeatureManager.findFeature(this,e)},n.raycast=function(e,t,n){},S(t,[{key:"engine",get:function(){return this._engine}},{key:"rootEntitiesCount",get:function(){return this._rootEntities.length}},{key:"rootEntities",get:function(){return this._rootEntities}},{key:"destroyed",get:function(){return this._destroyed}}]),t}($);ot.sceneFeatureManager=new it;var st=function(){function e(e){this.engine=e}var t=e.prototype;return t.loadScene=function(e,t){var n=this;void 0===t&&(t=!0);var r=this.engine.resourceManager.load(e);return r.then((function(e){var r=n._activeScene;n.activeScene=e,r&&t&&r.destroy()})),r},t.mergeScenes=function(e,t){for(var n=e.rootEntities,r=0,i=n.length;r<i;r++)t.addRootEntity(n[r])},S(e,[{key:"activeScene",get:function(){return this._activeScene},set:function(e){var t=this._activeScene;t!==e&&(t&&t._processActive(!1),e&&e._processActive(!0),this._activeScene=e)}}]),e}(),ut=new it,ct=function(e){function t(t,n){var r;return(r=e.call(this,null)||this)._componentsManager=new je,r._resourceManager=new V(A(r)),r._sceneManager=new st(A(r)),r._vSyncCount=1,r._targetFrameRate=60,r._time=new He,r._isPaused=!0,r._loopCounter=0,r._targetFrameInterval=1e3/60,r._animate=function(){r._vSyncCount?(r._requestId=requestAnimationFrame(r._animate),r._loopCounter++%r._vSyncCount==0&&(r.update(),r._loopCounter=0)):(r._timeoutId=window.setTimeout(r._animate,r._targetFrameInterval),r.update())},r.features=[],r._hardwareRenderer=n,r._hardwareRenderer.init(t),r._canvas=t,ut.addObject(A(r)),r._sceneManager.activeScene=new ot(A(r),"DefaultScene"),r}R(t,e);var n=t.prototype;return n.createEntity=function(e){return new rt(this,e)},n.pause=function(){this._isPaused=!0,cancelAnimationFrame(this._requestId),clearTimeout(this._timeoutId)},n.resume=function(){this._isPaused&&(this._isPaused=!1,this.time.reset(),requestAnimationFrame(this._animate))},n.update=function(){var e=this._time,t=e.deltaTime;e.tick(),at._restPool(),ut.callFeatureMethod(this,"preTick",[this,this._sceneManager._activeScene]),this._hardwareRenderer.beginFrame();var n=this._sceneManager._activeScene,r=this._componentsManager;n&&(r.callScriptOnStart(),r.callScriptOnUpdate(t),r.callAnimationUpdate(t),r.callScriptOnLateUpdate(t),this._render(n)),this._componentsManager.callComponentDestory(),this._hardwareRenderer.endFrame(),ut.callFeatureMethod(this,"postTick",[this,this._sceneManager._activeScene])},n.run=function(){ut.callFeatureMethod(this,"preLoad",[this]),this.resume(),this.trigger(new G("run",this))},n.destroy=function(){this._sceneManager&&(this.trigger(new G("shutdown",this)),ut.callFeatureMethod(this,"shutdown",[this]),this.pause(),this._animate=null,this._sceneManager._activeScene.destroy(),this._sceneManager=null,this._resourceManager.gc(),this._resourceManager=null,this._canvas=null,this.features=[],this._time=null,ut._objects=[])},n._render=function(e){var t=e._activeCameras,n=this._componentsManager,r=this.time.deltaTime;if(n.callRendererOnUpdate(r),t.length>0){t.sort((function(e,t){return e.priority-t.priority}));for(var i=0,a=t.length;i<a;i++){var o=t[i],s=o.entity;o.enabled&&s.isActiveInHierarchy&&(n.callCameraOnBeginRender(o),ot.sceneFeatureManager.callFeatureMethod(e,"preRender",[this,o]),o.render(),ot.sceneFeatureManager.callFeatureMethod(e,"postRender",[this,o]),n.callCameraOnEndRender(o))}}else Be.debug("NO active camera.")},n.findFeature=function(e){return ut.findFeature(this,e)},t.registerFeature=function(e){ut.registerFeature(e)},S(t,[{key:"canvas",get:function(){return this._canvas}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"time",get:function(){return this._time}},{key:"isPaused",get:function(){return this._isPaused}},{key:"vSyncCount",get:function(){return this._vSyncCount},set:function(e){this._vSyncCount=Math.max(0,Math.floor(e))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){e=Math.max(1e-6,e),this._targetFrameRate=e,this._targetFrameInterval=1e3/e}},{key:"renderhardware",get:function(){return this._hardwareRenderer}}]),t}($),lt=function(){function e(){}return S(e,null,[{key:"devicePixelRatio",get:function(){return window.devicePixelRatio}}]),e}(),ft=function(){function e(){}var t=e.prototype;return t.preLoad=function(e){},t.preTick=function(e,t){},t.postTick=function(e,t){},t.shutdown=function(e){},e}(),ht=function(e){function t(){return e.apply(this,arguments)||this}return R(t,e),t}(Q),dt=function(){},_t=function(){function e(){}var t=e.prototype;return t.preUpdate=function(e){},t.postUpdate=function(e){},t.preRender=function(e,t){},t.postRender=function(e,t){},t.destroy=function(e){},e}(),mt=Object.defineProperty,pt=Object.getOwnPropertyDescriptor,vt=function(e,t,n,r){for(var i,a=r>1?void 0:r?pt(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&mt(t,n,a),a},gt=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._started=!1,t._onStartIndex=-1,t._onUpdateIndex=-1,t._onLateUpdateIndex=-1,t._onPreRenderIndex=-1,t._onPostRenderIndex=-1,t}R(t,e);var n=t.prototype;return n.onAwake=function(){},n.onEnable=function(){},n.onStart=function(){},n.onUpdate=function(e){},n.onLateUpdate=function(e){},n.onBeginRender=function(e){},n.onEndRender=function(e){},n.onDisable=function(){},n.onDestroy=function(){},n._onAwake=function(){this.onAwake()},n._onEnable=function(){var e=this.engine._componentsManager,n=t.prototype;this._started||e.addOnStartScript(this),this.onUpdate!==n.onUpdate&&e.addOnUpdateScript(this),this.onLateUpdate!==n.onLateUpdate&&e.addOnLateUpdateScript(this),this.onEnable()},n._onDisable=function(){var e=this.engine._componentsManager;-1!==this._onStartIndex&&e.removeOnStartScript(this),-1!==this._onUpdateIndex&&e.removeOnUpdateScript(this),-1!==this._onLateUpdateIndex&&e.removeOnLateUpdateScript(this),this.onDisable()},n._onDestroy=function(){this.engine._componentsManager.addDestoryComponent(this)},t}(Ze);vt([k],gt.prototype,"_started",2),vt([k],gt.prototype,"_onStartIndex",2),vt([k],gt.prototype,"_onUpdateIndex",2),vt([k],gt.prototype,"_onLateUpdateIndex",2),vt([k],gt.prototype,"_onPreRenderIndex",2),vt([k],gt.prototype,"_onPostRenderIndex",2);var yt=Object.defineProperty,Et=Object.getOwnPropertyDescriptor,Tt=function(e,t,n,r){for(var i,a=r>1?void 0:r?Et(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&yt(t,n,a),a},xt=function(e){function t(n){var r;(r=e.call(this,n)||this)._onUpdateIndex=-1,r._rendererIndex=-1,r._overrideUpdate=!1,r._bounds=new c(new s,new s);var i=t.prototype;return r._overrideUpdate=r.update!==i.update,r._transformChangeFlag=r.entity.transform.registerWorldChangeFlag(),r}R(t,e);var n=t.prototype;return n.destroy=function(){e.prototype.destroy.call(this);var t=this._transformChangeFlag;t&&(t.destroy(),this._transformChangeFlag=null)},n.update=function(e){},n._updateBounds=function(e){},n._onEnable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.addOnUpdateRenderers(this),e.addRenderer(this)},n._onDisable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.removeOnUpdateRenderers(this),e.removeRenderer(this)},n._render=function(e){var t=!1;if(this.cullDistanceSq>0){var n=s.distanceSquared(e._entity.transform.worldPosition,this.entity.transform.worldPosition);t=this.cullDistanceSq<n}t||this.render(e)},S(t,[{key:"bounds",get:function(){var e=this._transformChangeFlag;return e.flag&&(this._updateBounds(this._bounds),e.flag=!1),this._bounds}}]),t}(Ze);Tt([k],xt.prototype,"_onUpdateIndex",2),Tt([k],xt.prototype,"_rendererIndex",2),Tt([k],xt.prototype,"_overrideUpdate",2),Tt([k],xt.prototype,"_transformChangeFlag",2),Tt([X],xt.prototype,"_bounds",2);var At=0,Ot=function(){function e(e,t,n,r,i,a){void 0===e&&(e="RENDER_PASS"+At++),void 0===t&&(t=0),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=new T(0,0,0,0)),this.name=e,this.enabled=!0,this.priority=t,this.renderTarget=n,this.replaceMaterial=r,this.mask=i||Oe.EVERYTHING,this.renderOverride=!1,this.clearMode=ne.SOLID_COLOR,this._clearParam=a}var t=e.prototype;return t.render=function(e,t,n){},t.preRender=function(e,t,n){},t.postRender=function(e,t,n){},S(e,[{key:"clearParam",get:function(){return this._clearParam},set:function(e){this._clearParam=e}}]),e}(),bt=function(){function e(){this.viewProjectMatrix=new h}return e._getRenderContext=function(t){var n=e._renderContext;return n.camera=t,n.viewport=t.viewport,n.cameraPosition=t.entity.transform.worldPosition,n.inverseViewMatrix=t.inverseViewMatrix,n.inverseProjectionMatrix=t.inverseProjectionMatrix,n.viewMatrix=t.viewMatrix,n.projectionMatrix=t.projectionMatrix,h.multiply(n.projectionMatrix,n.viewMatrix,n.viewProjectMatrix),this._renderContext},e}();bt._renderContext=new bt;var Mt,St,Rt=function(){function e(){this._items=[]}var t=e.prototype;return t.clear=function(){this._items=[]},t.pushPrimitive=function(e){this._items.push(e)},t.sortByDistance=function(e){var t=this._items;t.length>1&&(this._items=t.sort((function(t,n){if(t.component.renderPriority===n.component.renderPriority){var r=t.component.entity.transform.worldPosition,i=n.component.entity.transform.worldPosition;return s.distanceSquared(i,e)-s.distanceSquared(r,e)}return t.component.renderPriority-n.component.renderPriority})))},t.sortByTechnique=function(){var e=this._items;e.length>1&&(this._items=e.sort((function(e,t){if(e.component.renderPriority===t.component.renderPriority){var n=e.material.technique,r=t.material.technique;return n&&r?n.name.localeCompare(r.name):0}return e.component.renderPriority-t.component.renderPriority})))},t.pushSprite=function(e,t,n,r,i,a,o){var s={component:e,positionQuad:t,uvRect:n,tintColor:r,texture:i,renderMode:a,camera:o};this._items.push(s)},t.render=function(e,t,n){var r=e.scene.engine._hardwareRenderer,i=this._items;if(0!==i.length){this.updateMaxJointsNum(this._items,t);for(var a=bt._getRenderContext(e),o=e.cullingMask,s=0,u=i.length;s<u;s++){var c=i[s],l=c.component;if(o&l._entity.layer)if(l.renderPassFlag&n)if(this._isPrimitive(c)){var f=c;r.flushSprite();var h=t||f.material;null==h.preRender||h.preRender(f.component,f.primitive),h.prepareDrawing(a,f.component,f.primitive,f.material),r.drawPrimitive(f.primitive,f.subPrimitive,h),null==h.postRender||h.postRender(f.component,f.primitive)}else{var d=c;r.drawSprite(d.positionQuad,d.uvRect,d.tintColor,d.texture,d.renderMode,d.camera)}}r.flushSprite()}},t.updateMaxJointsNum=function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n],a=i.component,o=i.material,s=t||o;a.jointNodes&&(s.maxJointsNum=Math.max(s.maxJointsNum,a.jointNodes.length))}},t._isPrimitive=function(e){return!!e.primitive},S(e,[{key:"items",get:function(){return this._items}}]),e}(),Lt=function(e){function t(t,n){var r;return void 0===t&&(t="SeparateSprite"),void 0===n&&(n=10),(r=e.call(this,t,n)||this).clearMode=ne.DONT_CLEAR,r.renderOverride=!0,r._spriteItems=[],r}R(t,e);var n=t.prototype;return n.preRender=function(){this.enabled=this.isUsed},n.render=function(e){var t=e.renderHardware;this._sortByDistance(e.eyePos);for(var n=this._spriteItems,r=0;r<n.length;r++){var i=n[r];t.drawSprite(i.positionQuad,i.uvRect,i.tintColor,i.texture,i.renderMode,i.camera)}n.length=0},n.postRender=function(e){this.enabled&&e.renderHardware.flushSprite()},n._sortByDistance=function(e){this._spriteItems.length>1&&(this._spriteItems=this._spriteItems.sort((function(t,n){if(t.component.renderPriority===n.component.renderPriority){var r=t.component.node.worldPosition,i=n.component.node.worldPosition;return s.distanceSquared(i,e)-s.distanceSquared(r,e)}return t.component.renderPriority-n.component.renderPriority})))},n.pushSprite=function(e,t,n,r,i,a,o){this._spriteItems.push({component:e,positionQuad:t,uvRect:n,tintColor:r,texture:i,renderMode:a,camera:o})},S(t,[{key:"isUsed",get:function(){return this._spriteItems.length>0}}]),t}(Ot),Ct=function(e){function t(t){var n;return(n=e.call(this)||this)._camera=t,n._opaqueQueue=new Rt,n._transparentQueue=new Rt,n._renderPassArray=[],n._defaultPass=new Ot("default",0,null,null,0),n.addRenderPass(n._defaultPass),n}R(t,e);var n=t.prototype;return n.addRenderPass=function(e,t,n,r,i,a){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=new T(0,0,0,0)),"string"==typeof e){var o=new Ot(e,t,n,r,i,a);this._renderPassArray.push(o)}else e instanceof Ot&&this._renderPassArray.push(e);this._renderPassArray.sort((function(e,t){return e.priority-t.priority}))},n.removeRenderPass=function(e){var t;if("string"==typeof e?t=this.getRenderPass(e):e instanceof Ot&&(t=e),t){var n=this._renderPassArray.indexOf(t);this._renderPassArray.splice(n,1)}},n.getRenderPass=function(e){for(var t=0,n=this._renderPassArray.length;t<n;t++){var r=this._renderPassArray[t];if(r.name===e)return r}return null},n.destroy=function(){},n.render=function(){var e=this._camera,t=this._opaqueQueue,n=this._transparentQueue;t.clear(),n.clear(),e.engine._componentsManager.callRender(e),t.sortByTechnique(),n.sortByDistance(e.entity.transform.worldPosition),this._canvasDepthPass&&(this._canvasDepthPass.enabled=!1),this._separateSpritePass&&this._separateSpritePass.isUsed&&this._defaultPass.renderTarget&&(this._canvasDepthPass||(this._canvasDepthPass=new Ot("CanvasDepthRenderPass",0,null,null,0),this._canvasDepthPass.clearMode=ne.DONT_CLEAR,this.addRenderPass(this._canvasDepthPass)),this._canvasDepthPass.enabled=!0);for(var r=0,i=this._renderPassArray.length;r<i;r++)this._drawRenderPass(this._renderPassArray[r],e)},n._drawRenderPass=function(e,t){e.preRender(t,this.opaqueQueue,this.transparentQueue);var n=t.scene.engine._hardwareRenderer,r=t.renderTarget||e.renderTarget;n.activeRenderTarget(r,t),e.enabled&&(n.clearRenderTarget(e.clearMode,e.clearParam),e.renderOverride?e.render(t,this.opaqueQueue,this.transparentQueue):(this.opaqueQueue.render(t,e.replaceMaterial,e.mask),this.transparentQueue.render(t,e.replaceMaterial,e.mask))),n.blitRenderTarget(r),e.postRender(t,this.opaqueQueue,this.transparentQueue)},n.pushPrimitive=function(e){e.material.renderType===ie.TRANSPARENT?this._transparentQueue.pushPrimitive(e):this._opaqueQueue.pushPrimitive(e)},n.pushSprite=function(e,t,n,r,i,a,o){if(e.separateDraw)return this._separateSpritePass||(this._separateSpritePass=new Lt,this.addRenderPass(this._separateSpritePass)),void this._separateSpritePass.pushSprite(e,t,n,r,i,a,o);this._transparentQueue.pushSprite(e,t,n,r,i,a,o)},S(t,[{key:"defaultRenderPass",get:function(){return this._defaultPass}},{key:"opaqueQueue",get:function(){return this._opaqueQueue}},{key:"transparentQueue",get:function(){return this._transparentQueue}}]),t}(dt),It=Object.defineProperty,wt=Object.getOwnPropertyDescriptor,Pt=function(e,t,n,r){for(var i,a=r>1?void 0:r?wt(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&It(t,n,a),a},Nt=function(){};Nt.tempMat4=new h,Nt.tempVec4=new T,Nt.tempVec3=new s,(St=Mt||(Mt={}))[St.DepthSky=0]="DepthSky",St[St.DepthColor=1]="DepthColor",St[St.Depth=2]="Depth",St[St.None=3]="None";var Ft=function(e){function t(t){var n;return(n=e.call(this,t)||this).priority=0,n.cullingMask=ze.Everything,n._isOrthographic=!1,n._isProjMatSetting=!1,n._clearMode=ne.SOLID_COLOR,n._nearClipPlane=.1,n._farClipPlane=100,n._fieldOfView=45,n._orthographicSize=10,n._isProjectionDirty=!0,n._isInvProjMatDirty=!0,n._customAspectRatio=void 0,n._renderTarget=null,n._projectionMatrix=new h,n._viewMatrix=new h,n._backgroundColor=new T,n._viewport=new T(0,0,1,1),n._inverseProjectionMatrix=new h,n._inverseViewMatrix=new h,n._lastAspectSize=new g(0,0),n._invViewProjMat=new h,n._transform=n.entity.transform,n._isViewMatrixDirty=n._transform.registerWorldChangeFlag(),n._isInvViewProjDirty=n._transform.registerWorldChangeFlag(),n._renderPipeline=new Ct(A(n)),n.setClearMode(),n}R(t,e);var n=t.prototype;return n.resetProjectionMatrix=function(){this._isProjMatSetting=!1,this._projMatChange()},n.resetAspectRatio=function(){this._customAspectRatio=void 0,this._projMatChange()},n.worldToViewportPoint=function(e,t){h.multiply(this.projectionMatrix,this.viewMatrix,Nt.tempMat4),Nt.tempVec4.setValue(e.x,e.y,e.z,1),T.transform(Nt.tempVec4,Nt.tempMat4,Nt.tempVec4);var n=Nt.tempVec4.w,r=Nt.tempVec4.x/n,i=Nt.tempVec4.y/n,a=Nt.tempVec4.z/n;return t.x=.5*(r+1),t.y=.5*(1-i),t.z=a,t.w=n,t},n.viewportToWorldPoint=function(e,t){var n=this.invViewProjMat;return this._innerViewportToWorldPoint(e,n,t)},n.viewportPointToRay=function(e,t){var n=Nt.tempVec3;n.setValue(e.x,e.y,0);var r=this.viewportToWorldPoint(n,t.origin);n.z=1;var i=this._innerViewportToWorldPoint(n,this._invViewProjMat,n);return s.subtract(i,r,t.direction),t.direction.normalize(),t},n.screenToViewportPoint=function(e,t){var n=this.engine.canvas,r=this.viewport;return t.x=(e.x/n.width-r.x)/r.z,t.y=(e.y/n.height-r.y)/r.w,t},n.viewportToScreenPoint=function(e,t){var n=this.engine.canvas,r=this.viewport;return t.x=(r.x+e.x*r.z)*n.width,t.y=(r.y+e.y*r.w)*n.height,t},n.worldToScreenPoint=function(e,t){return this.worldToViewportPoint(e,t),this.viewportToScreenPoint(t,t)},n.screenToWorldPoint=function(e,t){return this.screenToViewportPoint(e,t),this.viewportToWorldPoint(t,t)},n.render=function(e){this._renderPipeline.render()},n._onActive=function(){this.entity.scene.attachRenderCamera(this)},n._onInActive=function(){this.entity.scene.detachRenderCamera(this)},n._onDestroy=function(){var e;null==(e=this._renderPipeline)||e.destroy(),this._isInvViewProjDirty.destroy(),this._isViewMatrixDirty.destroy()},n._projMatChange=function(){this._isProjectionDirty=!0,this._isInvProjMatDirty=!0,this._isInvViewProjDirty.flag=!0},n._innerViewportToWorldPoint=function(e,t,n){var r=2*e.z-1,i=Nt.tempVec4;i.setValue(2*e.x-1,1-2*e.y,r,1),T.transform(i,t,i);var a=1/i.w;return n.x=i.x*a,n.y=i.y*a,n.z=i.z*a,n},n.setClearMode=function(e,t){void 0===e&&(e=ne.SOLID_COLOR),void 0===t&&(t=new T(.25,.25,.25,1)),this._clearMode=e,this._backgroundColor=t,this._renderPipeline.defaultRenderPass.clearParam=t,this._renderPipeline.defaultRenderPass.clearMode=e},S(t,[{key:"nearClipPlane",get:function(){return this._nearClipPlane},set:function(e){this._nearClipPlane=e,this._projMatChange()}},{key:"farClipPlane",get:function(){return this._farClipPlane},set:function(e){this._farClipPlane=e,this._projMatChange()}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._projMatChange()}},{key:"aspectRatio",get:function(){var e,t=this._entity.engine.canvas;return null!=(e=this._customAspectRatio)?e:t.width*this._viewport.z/(t.height*this._viewport.w)},set:function(e){this._customAspectRatio=e,this._projMatChange()}},{key:"viewport",get:function(){return this._viewport},set:function(e){e!==this._viewport&&e.cloneTo(this._viewport),this._projMatChange()}},{key:"isOrthographic",get:function(){return this._isOrthographic},set:function(e){this._isOrthographic=e,this._projMatChange()}},{key:"orthographicSize",get:function(){return this._orthographicSize},set:function(e){this._orthographicSize=e,this._projMatChange()}},{key:"clearFlags",get:function(){throw"not implemented"},set:function(e){throw"not implemented"}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(e){this.setClearMode(this._clearMode,e)}},{key:"backgroundSky",get:function(){throw new Error("")}},{key:"viewMatrix",get:function(){return this._isViewMatrixDirty.flag&&(this._isViewMatrixDirty.flag=!1,h.invert(this._transform.worldMatrix,this._viewMatrix)),this._viewMatrix}},{key:"projectionMatrix",get:function(){var e=this._entity.engine.canvas;if((!this._isProjectionDirty||this._isProjMatSetting)&&this._lastAspectSize.x===e.width&&this._lastAspectSize.y===e.height)return this._projectionMatrix;this._isProjectionDirty=!1,this._lastAspectSize.x=e.width,this._lastAspectSize.y=e.height;var t=this.aspectRatio;if(this._isOrthographic){var n=this._orthographicSize*t,r=this._orthographicSize;h.ortho(-n,n,-r,r,this._nearClipPlane,this._farClipPlane,this._projectionMatrix)}else h.perspective(o.degreeToRadian(this._fieldOfView),t,this._nearClipPlane,this._farClipPlane,this._projectionMatrix);return this._projectionMatrix},set:function(e){this._projectionMatrix=e,this._isProjMatSetting=!0,this._projMatChange()}},{key:"enableHDR",get:function(){return console.log("not implemention"),!1},set:function(e){console.log("not implemention")}},{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){this._renderTarget=e}},{key:"invViewProjMat",get:function(){return this._isInvViewProjDirty.flag&&(this._isInvViewProjDirty.flag=!1,h.multiply(this.inverseViewMatrix,this.inverseProjectionMatrix,this._invViewProjMat)),this._invViewProjMat}},{key:"inverseProjectionMatrix",get:function(){return this._isInvProjMatDirty&&(this._isInvProjMatDirty=!1,h.invert(this.projectionMatrix,this._inverseProjectionMatrix)),this._inverseProjectionMatrix}},{key:"inverseViewMatrix",get:function(){return this._transform.worldMatrix.cloneTo(this._inverseViewMatrix),this._inverseViewMatrix}}]),t}(Ze);Pt([k],Ft.prototype,"_renderPipeline",2),Pt([k],Ft.prototype,"_transform",2),Pt([k],Ft.prototype,"_isViewMatrixDirty",2),Pt([k],Ft.prototype,"_isInvViewProjDirty",2),Pt([X],Ft.prototype,"_projectionMatrix",2),Pt([X],Ft.prototype,"_viewMatrix",2),Pt([X],Ft.prototype,"_backgroundColor",2),Pt([X],Ft.prototype,"_viewport",2),Pt([X],Ft.prototype,"_inverseProjectionMatrix",2),Pt([X],Ft.prototype,"_inverseViewMatrix",2),Pt([X],Ft.prototype,"_lastAspectSize",2),Pt([X],Ft.prototype,"_invViewProjMat",2),Ft=Pt([qe(nt)],Ft);var Dt={json:"json",gltf:"json",mtl:"json",prefab:"json",txt:"text",bin:"arraybuffer",png:"image",webp:"image",jpg:"image"};function Ut(e,t){return void 0===t&&(t={}),new N((function(n,r,i){var a,o,s,u,c=null!=(a=t.retryCount)?a:4,l=null!=(o=t.retryInterval)?o:500;t.timeout=null!=(s=t.timeout)?s:15e3,t.type=null!=(u=t.type)?u:function(e){var t=e.substring(e.lastIndexOf(".")+1);return Dt[t]}(e);var f,h="image"===t.type?Vt:Bt,d=new Gt((function(){return h(e,t).onProgress(i).then((function(e){n(e),d.stop()})).catch((function(e){return f=e}))}),c,l);d.start((function(){r(f)}))}))}function Vt(e,t){return new N((function(n,r){var i=t.timeout,a=new Image,o=function(){r(new Error("request "+e+" fail"))};a.onerror=o,a.onabort=o;var s,u=setTimeout((function(){r(new Error("request "+e+" timeout"))}),i);a.onload=(s=u,function(){n(a),clearTimeout(s)}),a.crossOrigin="anonymous",a.src=e}))}function Bt(e,t){return new N((function(n,r,i){var a,o=new XMLHttpRequest;o.timeout=t.timeout,t.method=null!=(a=t.method)?a:"get",o.onload=function(){var t;if(o.status<200||o.status>=300)r(new Error("request failed from: "+e));else{var i=null!=(t=o.response)?t:o.responseText;n(i)}},o.onerror=function(){r(new Error("request failed from: "+e))},o.ontimeout=function(){r(new Error("request timeout from: "+e))},o.onprogress=function(e){i(e.loaded/e.total)},o.open(t.method,e,!0),o.withCredentials="include"===t.credentials,o.responseType=t.type;var s=t.headers;s&&Object.keys(s).forEach((function(e){o.setRequestHeader(e,s[e])})),o.send(t.body)}))}var Ht,zt,Gt=function(){function e(e,t,n){this.execFunc=e,this.totalCount=t,this.interval=n,this._timeoutId=-100,this._currentCount=0,this.exec=this.exec.bind(this)}var t=e.prototype;return t.start=function(e){this.done=e,this.exec()},t.stop=function(){clearTimeout(this._timeoutId)},t.exec=function(){var e=this;this._currentCount>=this.totalCount?this.done&&this.done():(this._currentCount++,this.execFunc(this._currentCount).then((function(){e._timeoutId=setTimeout(e.exec,e.interval)})))},e}(),kt=function(e){this.useCache=e,this.request=Ut};(zt=Ht||(Ht={}))[zt.Text=0]="Text",zt[zt.JSON=1]="JSON",zt[zt.Buffer=2]="Buffer",zt[zt.Texture2D=3]="Texture2D",zt[zt.TextureCube=4]="TextureCube",zt[zt.Material=5]="Material",zt[zt.Mesh=6]="Mesh",zt[zt.AnimationClip=7]="AnimationClip",zt[zt.Perfab=8]="Perfab",zt[zt.KTX=9]="KTX",zt[zt.KTXCube=10]="KTXCube";var jt=function(e){function t(t){var n;return(n=e.call(this,t)||this).isGCIgnored=!1,n._refCount=0,n._refChildren=[],n._refParent=null,n._destroyed=!1,t.resourceManager._addRefObject(n.instanceId,A(n)),n}R(t,e);var n=t.prototype;return n.destroy=function(e){if(void 0===e&&(e=!1),this._destroyed)return!0;if(!e&&0!==this._refCount)return!1;var t=this._engine.resourceManager;return t&&(t._deleteAsset(this),t._deleteRefObject(this.instanceId)),this._refParent&&D(this._refParent._refChildren,this),this._engine=null,this._onDestroy(),this._destroyed=!0,!0},n._addToResourceManager=function(e){this._engine.resourceManager._addAsset(e,this)},n._addRefCount=function(e){this._refCount+=e;for(var t,n=O(this._refChildren);!(t=n()).done;){t.value._addRefCount(e)}},n._addRefChild=function(e){this._refChildren.push(e),e._refParent=this,e._addRefCount(this._refCount)},n._removeRefChild=function(e){D(this._refChildren,e)&&(e._refParent=null,e._addRefCount(-this._refCount))},S(t,[{key:"refCount",get:function(){return this._refCount}},{key:"destroyed",get:function(){return this._destroyed}}]),t}(Q),Xt=new s(0,1,0),Wt=function(e){function t(t){var n;return n=e.call(this,t)||this,t.addEventListener("removedFromScene",n._onDisable.bind(A(n))),n}R(t,e),t.getUniformDefine=function(e){return{}};var n=t.prototype;return n._onEnable=function(){this.scene.findFeature($t).attachRenderLight(this)},n._onDisable=function(){this.scene.findFeature($t).detachRenderLight(this)},S(t,[{key:"viewMatrix",get:function(){return this._viewMat||(this._viewMat=new h),h.invert(this.inverseViewMatrix,this._viewMat),this._viewMat}},{key:"inverseViewMatrix",get:function(){return this._modelMat||(this._modelMat=new h),h.rotateAxisAngle(this.entity.transform.worldMatrix,Xt,Math.PI,this._modelMat),this._modelMat}}]),t}(Ze),qt=function(e){function t(t){var n;return(n=e.call(this,t)||this).color=new s(1,1,1),n.intensity=1,n._lightColor=new s,n}return R(t,e),t.getUniformDefine=function(e){var t;return(t={})[e+".color"]={name:e+".color",type:ge.FLOAT_VEC3},t[e+".lightColor"]={name:e+".lightColor",type:ge.FLOAT_VEC3},t[e+".intensity"]={name:e+".intensity",type:ge.FLOAT},t},t.prototype.bindMaterialValues=function(e,t){e.setValue(t+".color",this.color),e.setValue(t+".lightColor",this.lightColor),e.setValue(t+".intensity",this.intensity)},S(t,[{key:"lightColor",get:function(){return s.scale(this.color,this.intensity,this._lightColor),this._lightColor}}]),t}(Wt),Yt=function(e){function t(t){var n;return(n=e.call(this,t)||this)._forward=new s,n.color=new s(1,1,1),n.intensity=1,n._lightColor=new s,n._reverseDirection=new s,n}return R(t,e),t.getUniformDefine=function(e){var t={};return t[e+".color"]={name:e+".color",type:ge.FLOAT_VEC3},t[e+".lightColor"]={name:e+".lightColor",type:ge.FLOAT_VEC3},t[e+".intensity"]={name:e+".intensity",type:ge.FLOAT},t[e+".direction"]={name:e+".direction",type:ge.FLOAT_VEC3},t},t.prototype.bindMaterialValues=function(e,t){e.setValue(t+".color",this.color),e.setValue(t+".lightColor",this.lightColor),e.setValue(t+".intensity",this.intensity),e.setValue(t+".direction",this.direction)},S(t,[{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"lightColor",get:function(){return s.scale(this.color,this.intensity,this._lightColor),this._lightColor}},{key:"reverseDirection",get:function(){return s.scale(this.direction,-1,this._reverseDirection),this._reverseDirection}}]),t}(Wt),Kt=new l,Qt=function(e){function t(t){var n;return(n=e.call(this,t)||this).diffuse=new s(.3,.3,.3),n.specular=new s(.5,.5,.5),n.diffuseIntensity=1,n.specularIntensity=1,n}return R(t,e),t.getUniformDefine=function(e){var t={};return t.u_env_diffuseSampler={name:"u_env_diffuseSampler",type:ge.SAMPLER_CUBE},t.u_env_specularSampler={name:"u_env_specularSampler",type:ge.SAMPLER_CUBE},t[e+".diffuse"]={name:e+".diffuse",type:ge.FLOAT_VEC3},t[e+".specular"]={name:e+".specular",type:ge.FLOAT_VEC3},t[e+".mipMapLevel"]={name:e+".mipMapLevel",type:ge.FLOAT},t[e+".transformMatrix"]={name:e+".transformMatrix",type:ge.FLOAT_MAT3},t[e+".diffuseIntensity"]={name:e+".diffuseIntensity",type:ge.FLOAT},t[e+".specularIntensity"]={name:e+".specularIntensity",type:ge.FLOAT},t},t.prototype.bindMaterialValues=function(e,t){e.setValue(t+".diffuseIntensity",this.diffuseIntensity),e.setValue(t+".specularIntensity",this.specularIntensity),this.useDiffuseMap?e.setValue("u_env_diffuseSampler",this.diffuseMap):e.setValue(t+".diffuse",this.diffuse),this.useSpecularMap?(e.setValue("u_env_specularSampler",this.specularMap),e.setValue(t+".mipMapLevel",this.specularMap.mipmapCount)):e.setValue(t+".specular",this.specular);var n=this.entity.transform.worldMatrix;Kt.setValueByMatrix(n),e.setValue(t+".transformMatrix",Kt)},S(t,[{key:"useDiffuseMap",get:function(){return!!this.diffuseMap}},{key:"useSpecularMap",get:function(){return!!this.specularMap}}]),t}(Wt),Zt=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).color=new s(1,1,1),t.intensity=1,t.distance=0,t.decay=0,t._lightColor=new s,t}return R(t,e),t.getUniformDefine=function(e){var t={};return t[e+".position"]={name:e+".position",type:ge.FLOAT_VEC3},t[e+".color"]={name:e+".color",type:ge.FLOAT_VEC3},t[e+".lightColor"]={name:e+".lightColor",type:ge.FLOAT_VEC3},t[e+".intensity"]={name:e+".intensity",type:ge.FLOAT},t[e+".distance"]={name:e+".distance",type:ge.FLOAT},t[e+".decay"]={name:e+".decay",type:ge.FLOAT},t},t.prototype.bindMaterialValues=function(e,t){e.setValue(t+".position",this.position),e.setValue(t+".color",this.color),e.setValue(t+".lightColor",this.lightColor),e.setValue(t+".intensity",this.intensity),e.setValue(t+".distance",this.distance),e.setValue(t+".decay",this.decay)},S(t,[{key:"position",get:function(){return this.entity.worldPosition}},{key:"lightColor",get:function(){return s.scale(this.color,this.intensity,this._lightColor),this._lightColor}}]),t}(Wt),Jt=function(e){function t(t){var n;return(n=e.call(this,t)||this)._forward=new s,n.color=new s(1,1,1),n.penumbra=0,n.distance=0,n.intensity=1,n.decay=0,n.angle=Math.PI/6,n._lightColor=new s,n._inverseDirection=new s,n}return R(t,e),t.getUniformDefine=function(e){var t={};return t[e+".position"]={name:e+".position",type:ge.FLOAT_VEC3},t[e+".direction"]={name:e+".direction",type:ge.FLOAT_VEC3},t[e+".color"]={name:e+".color",type:ge.FLOAT_VEC3},t[e+".lightColor"]={name:e+".lightColor",type:ge.FLOAT_VEC3},t[e+".intensity"]={name:e+".intensity",type:ge.FLOAT},t[e+".distance"]={name:e+".distance",type:ge.FLOAT},t[e+".decay"]={name:e+".decay",type:ge.FLOAT},t[e+".angle"]={name:e+".angle",type:ge.FLOAT},t[e+".penumbra"]={name:e+".penumbra",type:ge.FLOAT},t[e+".coneCos"]={name:e+".coneCos",type:ge.FLOAT},t[e+".penumbraCos"]={name:e+".penumbraCos",type:ge.FLOAT},t},t.prototype.bindMaterialValues=function(e,t){e.setValue(t+".position",this.position),e.setValue(t+".direction",this.direction),e.setValue(t+".color",this.color),e.setValue(t+".lightColor",this.lightColor),e.setValue(t+".intensity",this.intensity),e.setValue(t+".distance",this.distance),e.setValue(t+".decay",this.decay),e.setValue(t+".angle",this.angle),e.setValue(t+".penumbra",this.penumbra),e.setValue(t+".coneCos",Math.cos(this.angle)),e.setValue(t+".penumbraCos",Math.cos(this.angle*(1-this.penumbra)))},S(t,[{key:"position",get:function(){return this.entity.worldPosition}},{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"reverseDirection",get:function(){return s.scale(this.direction,-1,this._inverseDirection),this._inverseDirection}},{key:"lightColor",get:function(){return s.scale(this.color,this.intensity,this._lightColor),this._lightColor}}]),t}(Wt);var $t=function(e){function t(){var t;return(t=e.call(this)||this).visibleLights=[],t}R(t,e);var n=t.prototype;return n.attachRenderLight=function(e){-1==this.visibleLights.indexOf(e)?this.visibleLights.push(e):Be.warn("Light already attached.")},n.detachRenderLight=function(e){var t=this.visibleLights.indexOf(e);-1!=t&&this.visibleLights.splice(t,1)},n.bindMaterialValues=function(e){for(var t=0,n=0,r=0,i=this.visibleLights,a=0,o=i.length;a<o;a++){var s=i[a];s instanceof qt?s.bindMaterialValues(e,"u_ambientLight"):s instanceof Yt?s.bindMaterialValues(e,"u_directLights["+t+++"]"):s instanceof Zt?s.bindMaterialValues(e,"u_pointLights["+n+++"]"):s instanceof Jt?s.bindMaterialValues(e,"u_spotLights["+r+++"]"):s instanceof Qt&&s.bindMaterialValues(e,"u_envMapLight")}},n.getUniformDefine=function(){for(var e={},t=0,n=0,r=0,i=0,a=0,o=this.visibleLights,s=0,u=o.length;s<u;s++){var c=o[s];c instanceof qt&&!t++?e=x({},e,qt.getUniformDefine("u_ambientLight")):c instanceof Yt?e=x({},e,Yt.getUniformDefine("u_directLights["+n+++"]")):c instanceof Zt?e=x({},e,Zt.getUniformDefine("u_pointLights["+r+++"]")):c instanceof Jt?e=x({},e,Jt.getUniformDefine("u_spotLights["+i+++"]")):c instanceof Qt&&!a++&&(e=x({},e,Qt.getUniformDefine("u_envMapLight")))}return e},S(t,[{key:"lightSortAmount",get:function(){for(var e=0,t=0,n=0,r=0,i=0,a=!1,o=!1,s=this.visibleLights,u=0,c=s.length;u<c;u++){var l=s[u];l instanceof qt?e++:l instanceof Yt?t++:l instanceof Zt?n++:l instanceof Jt?r++:l instanceof Qt&&(i++,a=l.useDiffuseMap,o=l.useSpecularMap)}return{ambientLightCount:e,directLightCount:t,pointLightCount:n,spotLightCount:r,envMapLightCount:i,useDiffuseEnv:a,useSpecularEnv:o}}}]),t}(_t),en=function(e){function t(){var t;return(t=e.call(this)||this).colliders=[],t}R(t,e);var n=t.prototype;return n.attachCollider=function(e){this.colliders.push(e)},n.detachCollider=function(e){var t=this.colliders.indexOf(e);-1!=t&&this.colliders.splice(t,1)},t}(_t),tn=function(e){function t(t){var n;return(n=e.call(this,t)||this).tag=Oe.EVERYTHING,n}R(t,e);var n=t.prototype;return n._onEnable=function(){this.scene.findFeature(en).attachCollider(this)},n._onDisable=function(){this.scene.findFeature(en).detachCollider(this)},t}(Ze),nn=function(e){function t(t){var n;return(n=e.call(this,t)||this)._corners=[],n._cornerFlag=!1,n.boxMin=new s(-.5,-.5,-.5),n.boxMax=new s(.5,.5,.5),n}R(t,e);var n=t.prototype;return n.setBoxMinMax=function(e,t){this.boxMin=e,this.boxMax=t,this._cornerFlag=!0},n.setBoxCenterSize=function(e,n){var r=t._tempVec3;s.scale(n,.5,r),s.add(e,r,this.boxMax),s.subtract(e,r,this.boxMin),this._cornerFlag=!0},n.getCorners=function(){if(this._cornerFlag){var e=this.boxMin.x,t=this.boxMin.y,n=this.boxMin.z,r=this.boxMax.x-e,i=this.boxMax.y-t,a=this.boxMax.z-n;if(0===this._corners.length)for(var o=0;o<8;++o)this._corners.push(new s);this._corners[0].setValue(e+r,t+i,n+a),this._corners[1].setValue(e,t+i,n+a),this._corners[2].setValue(e,t,n+a),this._corners[3].setValue(e+r,t,n+a),this._corners[4].setValue(e+r,t+i,n),this._corners[5].setValue(e,t+i,n),this._corners[6].setValue(e,t,n),this._corners[7].setValue(e+r,t,n),this._cornerFlag=!1}return this._corners},t}(tn);nn._tempVec3=new s;var rn=function(e){function t(t){var n;return(n=e.call(this,t)||this).center=new s,n.radius=1,n}R(t,e);var n=t.prototype;return n.raycast=function(e,t){},n.setSphere=function(e,t){this.center=e,this.radius=t},t}(tn),an=function(e){function t(t){var n;return(n=e.call(this,t)||this).planePoint=new s,n.normal=new s(0,1,0),n}return R(t,e),t.prototype.setPlane=function(e,t){this.planePoint=e,this.normal=t},t}(tn);function on(e,t,n,r,i){var a=t.getPoint(n);s.transformCoordinate(a,e.entity.transform.worldMatrix,a),r.distance=s.distance(i,a),r.collider=e,r.point=a}function sn(e,t){var n=e.entity.getInvModelMatrix(),r=new s;s.transformCoordinate(t.origin,n,r);var i,a,o,u,c,l,f,h=new s;return i=h,a=t.direction,o=n,u=a.x,c=a.y,l=a.z,f=o.elements,i.x=u*f[0]+c*f[4]+l*f[8],i.y=u*f[1]+c*f[5]+l*f[9],i.z=u*f[2]+c*f[6]+l*f[10],new _(r,h)}ot.prototype.raycast=function(e,t,n){void 0===n&&(n=Oe.EVERYTHING);for(var r=new _(e.origin,e.direction),i=this.findFeature(en).colliders,a=new m,o=0,s=i.length;o<s;o++){var u=i[o];if(u.entity.isActiveInHierarchy&&u.tag&n){var c=new m;u.raycast(r,c)&&c.distance<a.distance&&(a=c)}}return t&&a.collider&&a.point.cloneTo(t),a.collider},nn.prototype.raycast=function(e,t){var n=sn(this,e),r=n.intersectAABB(this.boxMax,this.boxMin);return!!r&&(on(this,n,r,t,e.origin),!0)},rn.prototype.raycast=function(e,t){var n=sn(this,e),r=n.intersectSphere(this.center,this.radius);return!!r&&(on(this,n,r,t,e.origin),!0)},an.prototype.raycast=function(e,t){var n=sn(this,e),r=n.intersectPlane(this.planePoint,this.normal);return!!r&&(on(this,n,r,t,e.origin),!0)};var un=function(e){function t(t,n){var r;return(r=e.call(this,t)||this).primitives=[],r.groups=[],r.bounds=new c(new s,new s),r.name=n,r}R(t,e);var n=t.prototype;return n.updatePrimitiveWeightsIndices=function(e){},n.destroy=function(){this.primitives=null},t}(Q),cn=function(e){function t(t){var n;return(n=e.call(this,null)||this).inverseBindMatrices=[],n.joints=[],n.skeleton="none",n}return R(t,e),t}(ht),ln=Object.defineProperty,fn=Object.getOwnPropertyDescriptor,hn=function(e,t,n,r){for(var i,a=r>1?void 0:r?fn(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&ln(t,n,a),a};function dn(e,t){for(var n=e.primitives,r=0,i=n.length;r<i;r++)n[r]._addRefCount(t)}var _n,mn,pn,vn,gn,yn,En,Tn,xn,An,On,bn,Mn=function(e){function t(t){var n;return(n=e.call(this,t)||this)._instanceMaterials=[],n._sharedMaterials=[],n._mesh=null,n}R(t,e);var n=t.prototype;return n.setSharedMaterial=function(e,t){this._sharedMaterials[e]&&this._sharedMaterials[e]._addRefCount(-1),t._addRefCount(1),this._sharedMaterials[e]=t},n.setMaterial=function(e,t){this._instanceMaterials[e]&&this._instanceMaterials[e]._addRefCount(-1),t._addRefCount(1),this._instanceMaterials[e]=t},n.getInstanceMaterial=function(e){return this._instanceMaterials[e]},n.getSharedMaterial=function(e){return this._sharedMaterials[e]},n.render=function(e){var t=this._mesh;if(t)for(var n=e._renderPipeline,r=t.primitives,i=t.groups,a=0,o=r.length;a<o;a++){var s=r[a],u=this._instanceMaterials[a]||this._sharedMaterials[a];if(u){var c=at.getFromPool();c.setValue(this,s,i[a],u),n.pushPrimitive(c)}else Be.error("Primitive has no material: "+s.name)}},n.destroy=function(){e.prototype.destroy.call(this),this._mesh=null,this._instanceMaterials=[],this._sharedMaterials=[];for(var t=0;t<this._instanceMaterials.length;t++)this._instanceMaterials[t]._addRefCount(-1);for(var n=0;n<this._sharedMaterials.length;n++)this._sharedMaterials[n]._addRefCount(-1);this._mesh&&dn(this._mesh,-1)},n._updateBounds=function(e){var t=this.mesh.bounds,n=this._entity.transform.worldMatrix;s.transformCoordinate(t.min,n,e.min),s.transformCoordinate(t.max,n,e.max)},S(t,[{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh&&dn(this._mesh,-1),dn(e,1),this._mesh=e,this._sharedMaterials=[],this._instanceMaterials=[]}}]),t}(xt);hn([k],Mn.prototype,"_instanceMaterials",2),hn([j],Mn.prototype,"_sharedMaterials",2),(mn=_n||(_n={}))[mn.Point=0]="Point",mn[mn.Bilinear=1]="Bilinear",mn[mn.Trilinear=2]="Trilinear",(vn=pn||(pn={}))[vn.R8G8B8=0]="R8G8B8",vn[vn.R8G8B8A8=1]="R8G8B8A8",vn[vn.R4G4B4A4=2]="R4G4B4A4",vn[vn.R5G5B5A1=3]="R5G5B5A1",vn[vn.R5G6B5=4]="R5G6B5",vn[vn.Alpha8=5]="Alpha8",vn[vn.R32G32B32A32=6]="R32G32B32A32",vn[vn.DXT1=7]="DXT1",vn[vn.DXT5=8]="DXT5",vn[vn.ETC1_RGB=9]="ETC1_RGB",vn[vn.ETC2_RGB=10]="ETC2_RGB",vn[vn.ETC2_RGBA5=11]="ETC2_RGBA5",vn[vn.ETC2_RGBA8=12]="ETC2_RGBA8",vn[vn.PVRTC_RGB2=13]="PVRTC_RGB2",vn[vn.PVRTC_RGBA2=14]="PVRTC_RGBA2",vn[vn.PVRTC_RGB4=15]="PVRTC_RGB4",vn[vn.PVRTC_RGBA4=16]="PVRTC_RGBA4",vn[vn.ASTC_4x4=17]="ASTC_4x4",vn[vn.ASTC_5x5=18]="ASTC_5x5",vn[vn.ASTC_6x6=19]="ASTC_6x6",vn[vn.ASTC_8x8=20]="ASTC_8x8",vn[vn.ASTC_10x10=21]="ASTC_10x10",vn[vn.ASTC_12x12=22]="ASTC_12x12",(yn=gn||(gn={}))[yn.Clamp=0]="Clamp",yn[yn.Repeat=1]="Repeat",yn[yn.Mirror=2]="Mirror",(Tn=En||(En={}))[Tn.RGBA_ASTC_4X4_KHR=37808]="RGBA_ASTC_4X4_KHR",Tn[Tn.RGBA_ASTC_5X4_KHR=37809]="RGBA_ASTC_5X4_KHR",Tn[Tn.RGBA_ASTC_5X5_KHR=37810]="RGBA_ASTC_5X5_KHR",Tn[Tn.RGBA_ASTC_6X5_KHR=37811]="RGBA_ASTC_6X5_KHR",Tn[Tn.RGBA_ASTC_6X6_KHR=37812]="RGBA_ASTC_6X6_KHR",Tn[Tn.RGBA_ASTC_8X5_KHR=37813]="RGBA_ASTC_8X5_KHR",Tn[Tn.RGBA_ASTC_8X6_KHR=37814]="RGBA_ASTC_8X6_KHR",Tn[Tn.RGBA_ASTC_8X8_KHR=37815]="RGBA_ASTC_8X8_KHR",Tn[Tn.RGBA_ASTC_10X5_KHR=37816]="RGBA_ASTC_10X5_KHR",Tn[Tn.RGBA_ASTC_10X6_KHR=37817]="RGBA_ASTC_10X6_KHR",Tn[Tn.RGBA_ASTC_10X8_KHR=37818]="RGBA_ASTC_10X8_KHR",Tn[Tn.RGBA_ASTC_10X10_KHR=37819]="RGBA_ASTC_10X10_KHR",Tn[Tn.RGBA_ASTC_12X10_KHR=37820]="RGBA_ASTC_12X10_KHR",Tn[Tn.RGBA_ASTC_12X12_KHR=37821]="RGBA_ASTC_12X12_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_4X4_KHR=37840]="SRGB8_ALPHA8_ASTC_4X4_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_5X4_KHR=37841]="SRGB8_ALPHA8_ASTC_5X4_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_5X5_KHR=37842]="SRGB8_ALPHA8_ASTC_5X5_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_6X5_KHR=37843]="SRGB8_ALPHA8_ASTC_6X5_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_6X6_KHR=37844]="SRGB8_ALPHA8_ASTC_6X6_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_8X5_KHR=37845]="SRGB8_ALPHA8_ASTC_8X5_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_8X6_KHR=37846]="SRGB8_ALPHA8_ASTC_8X6_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_8X8_KHR=37847]="SRGB8_ALPHA8_ASTC_8X8_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_10X5_KHR=37848]="SRGB8_ALPHA8_ASTC_10X5_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_10X6_KHR=37849]="SRGB8_ALPHA8_ASTC_10X6_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_10X8_KHR=37850]="SRGB8_ALPHA8_ASTC_10X8_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_10X10_KHR=37851]="SRGB8_ALPHA8_ASTC_10X10_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_12X10_KHR=37852]="SRGB8_ALPHA8_ASTC_12X10_KHR",Tn[Tn.SRGB8_ALPHA8_ASTC_12X12_KHR=37853]="SRGB8_ALPHA8_ASTC_12X12_KHR",Tn[Tn.RGB_ETC1_WEBGL=36196]="RGB_ETC1_WEBGL",Tn[Tn.R11_EAC=37488]="R11_EAC",Tn[Tn.SIGNED_R11_EAC=37489]="SIGNED_R11_EAC",Tn[Tn.RG11_EAC=37490]="RG11_EAC",Tn[Tn.SIGNED_RG11_EAC=37491]="SIGNED_RG11_EAC",Tn[Tn.RGB8_ETC2=37492]="RGB8_ETC2",Tn[Tn.SRGB8_ETC2=37493]="SRGB8_ETC2",Tn[Tn.RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="RGB8_PUNCHTHROUGH_ALPHA1_ETC2",Tn[Tn.SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",Tn[Tn.RGBA8_ETC2_EAC=37496]="RGBA8_ETC2_EAC",Tn[Tn.SRGB8_ALPHA8_ETC2_EAC=37497]="SRGB8_ALPHA8_ETC2_EAC",Tn[Tn.RGB_PVRTC_4BPPV1_IMG=35840]="RGB_PVRTC_4BPPV1_IMG",Tn[Tn.RGB_PVRTC_2BPPV1_IMG=35841]="RGB_PVRTC_2BPPV1_IMG",Tn[Tn.RGBA_PVRTC_4BPPV1_IMG=35842]="RGBA_PVRTC_4BPPV1_IMG",Tn[Tn.RGBA_PVRTC_2BPPV1_IMG=35843]="RGBA_PVRTC_2BPPV1_IMG",Tn[Tn.RGB_S3TC_DXT1_EXT=33776]="RGB_S3TC_DXT1_EXT",Tn[Tn.RGBA_S3TC_DXT1_EXT=33777]="RGBA_S3TC_DXT1_EXT",Tn[Tn.RGBA_S3TC_DXT3_EXT=33778]="RGBA_S3TC_DXT3_EXT",Tn[Tn.RGBA_S3TC_DXT5_EXT=33779]="RGBA_S3TC_DXT5_EXT",(An=xn||(xn={}))[An.R8G8B8=0]="R8G8B8",An[An.R8G8B8A8=1]="R8G8B8A8",An[An.R4G4B4A4=2]="R4G4B4A4",An[An.R5G5B5A1=3]="R5G5B5A1",An[An.R5G6B5=4]="R5G6B5",An[An.Alpha8=5]="Alpha8",An[An.R16G16B16A16=6]="R16G16B16A16",An[An.R32G32B32A32=7]="R32G32B32A32",(bn=On||(On={}))[bn.Depth=0]="Depth",bn[bn.DepthStencil=1]="DepthStencil",bn[bn.Stencil=2]="Stencil",bn[bn.Depth16=3]="Depth16",bn[bn.Depth24=4]="Depth24",bn[bn.Depth32=5]="Depth32",bn[bn.Depth24Stencil8=6]="Depth24Stencil8",bn[bn.Depth32Stencil8=7]="Depth32Stencil8";var Sn=function(e){function t(t){var n;return(n=e.call(this,t)||this)._anisoLevel=1,n}R(t,e),t._isPowerOf2=function(e){return 0==(e&e-1)},t._getFormatDetail=function(e,t,n){switch(e){case pn.R8G8B8:return{internalFormat:n?t.RGB8:t.RGB,baseFormat:t.RGB,dataType:t.UNSIGNED_BYTE,isCompressed:!1};case pn.R8G8B8A8:return{internalFormat:n?t.RGBA8:t.RGBA,baseFormat:t.RGBA,dataType:t.UNSIGNED_BYTE,isCompressed:!1};case pn.R4G4B4A4:return{internalFormat:n?t.RGBA4:t.RGBA,baseFormat:t.RGBA,dataType:t.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case pn.R5G5B5A1:return{internalFormat:n?t.RGB5_A1:t.RGBA,baseFormat:t.RGBA,dataType:t.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case pn.R5G6B5:return{internalFormat:n?t.RGB565:t.RGB,baseFormat:t.RGB,dataType:t.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case pn.Alpha8:return{internalFormat:t.ALPHA,baseFormat:t.ALPHA,dataType:t.UNSIGNED_BYTE,isCompressed:!1};case pn.R32G32B32A32:return{internalFormat:t.RGBA32F,baseFormat:t.RGBA,dataType:t.FLOAT,isCompressed:!1};case pn.DXT1:return{internalFormat:En.RGB_S3TC_DXT1_EXT,isCompressed:!0};case pn.DXT5:return{internalFormat:En.RGBA_S3TC_DXT5_EXT,isCompressed:!0};case pn.ETC1_RGB:return{internalFormat:En.RGB_ETC1_WEBGL,isCompressed:!0};case pn.ETC2_RGB:return{internalFormat:En.RGB8_ETC2,isCompressed:!0};case pn.ETC2_RGBA5:return{internalFormat:En.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,isCompressed:!0};case pn.ETC2_RGBA8:return{internalFormat:En.RGBA8_ETC2_EAC,isCompressed:!0};case pn.PVRTC_RGB2:return{internalFormat:En.RGB_PVRTC_2BPPV1_IMG,isCompressed:!0};case pn.PVRTC_RGBA2:return{internalFormat:En.RGBA_PVRTC_2BPPV1_IMG,isCompressed:!0};case pn.PVRTC_RGB4:return{internalFormat:En.RGB_PVRTC_4BPPV1_IMG,isCompressed:!0};case pn.PVRTC_RGBA4:return{internalFormat:En.RGBA_PVRTC_4BPPV1_IMG,isCompressed:!0};case pn.ASTC_4x4:return{internalFormat:En.RGBA_ASTC_4X4_KHR,isCompressed:!0};case pn.ASTC_5x5:return{internalFormat:En.RGBA_ASTC_5X5_KHR,isCompressed:!0};case pn.ASTC_6x6:return{internalFormat:En.RGBA_ASTC_6X6_KHR,isCompressed:!0};case pn.ASTC_8x8:return{internalFormat:En.RGBA_ASTC_8X8_KHR,isCompressed:!0};case pn.ASTC_10x10:return{internalFormat:En.RGBA_ASTC_10X10_KHR,isCompressed:!0};case pn.ASTC_12x12:return{internalFormat:En.RGBA_ASTC_12X12_KHR,isCompressed:!0};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+e)}},t._getRenderBufferColorFormatDetail=function(e,t,n){switch(e){case xn.R8G8B8:return{internalFormat:n?t.RGB8:t.RGB,baseFormat:t.RGB,dataType:t.UNSIGNED_BYTE,isCompressed:!1};case xn.R8G8B8A8:return{internalFormat:n?t.RGBA8:t.RGBA,baseFormat:t.RGBA,dataType:t.UNSIGNED_BYTE,isCompressed:!1};case xn.R4G4B4A4:return{internalFormat:n?t.RGBA4:t.RGBA,baseFormat:t.RGBA,dataType:t.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case xn.R5G5B5A1:return{internalFormat:n?t.RGB5_A1:t.RGBA,baseFormat:t.RGBA,dataType:t.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case xn.R5G6B5:return{internalFormat:n?t.RGB565:t.RGB,baseFormat:t.RGB,dataType:t.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case xn.Alpha8:return{internalFormat:t.ALPHA,baseFormat:t.ALPHA,dataType:t.UNSIGNED_BYTE,isCompressed:!1};case xn.R16G16B16A16:return{internalFormat:t.RGBA16F,baseFormat:t.RGBA,dataType:t.HALF_FLOAT,isCompressed:!1};case xn.R32G32B32A32:return{internalFormat:t.RGBA32F,baseFormat:t.RGBA,dataType:t.FLOAT,isCompressed:!1};default:throw new Error("this RenderBufferColorFormat is not supported in Oasis Engine: "+e)}},t._getRenderBufferDepthFormatDetail=function(e,t,n){switch(e){case On.Depth:return{internalFormat:n?t.DEPTH_COMPONENT32F:t.DEPTH_COMPONENT16,baseFormat:t.DEPTH_COMPONENT,dataType:n?t.FLOAT:t.UNSIGNED_INT,isCompressed:!1,attachment:t.DEPTH_ATTACHMENT};case On.DepthStencil:return{internalFormat:n?t.DEPTH24_STENCIL8:t.DEPTH_STENCIL,baseFormat:t.DEPTH_STENCIL,dataType:t.UNSIGNED_INT_24_8,isCompressed:!1,attachment:t.DEPTH_STENCIL_ATTACHMENT};case On.Stencil:return{internalFormat:t.STENCIL_INDEX8,baseFormat:t.STENCIL_ATTACHMENT,dataType:t.UNSIGNED_BYTE,isCompressed:!1,attachment:t.STENCIL_ATTACHMENT};case On.Depth16:return{internalFormat:t.DEPTH_COMPONENT16,baseFormat:t.DEPTH_COMPONENT,dataType:t.UNSIGNED_INT,isCompressed:!1,attachment:t.DEPTH_ATTACHMENT};case On.Depth24:return{internalFormat:t.DEPTH_COMPONENT24,baseFormat:t.DEPTH_COMPONENT,dataType:t.UNSIGNED_INT,isCompressed:!1,attachment:t.DEPTH_ATTACHMENT};case On.Depth32:return{internalFormat:t.DEPTH_COMPONENT32F,baseFormat:t.DEPTH_COMPONENT,dataType:t.FLOAT,isCompressed:!1,attachment:t.DEPTH_ATTACHMENT};case On.Depth24Stencil8:return{internalFormat:n?t.DEPTH24_STENCIL8:t.DEPTH_STENCIL,baseFormat:t.DEPTH_STENCIL,dataType:t.UNSIGNED_INT_24_8,isCompressed:!1,attachment:t.DEPTH_STENCIL_ATTACHMENT};case On.Depth32Stencil8:return{internalFormat:t.DEPTH32F_STENCIL8,baseFormat:t.DEPTH_STENCIL,dataType:t.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:t.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this RenderBufferDepthFormat is not supported in Oasis Engine: "+e)}},t._supportTextureFormat=function(e,t){var n=!0;switch(e){case pn.R32G32B32A32:t.canIUse(Ce.textureFloat)||(n=!1)}return n},t._supportRenderBufferColorFormat=function(e,t){var n=!0;switch(e){case xn.R32G32B32A32:t.canIUse(Ce.colorBufferFloat)&&t.canIUse(Ce.textureFloat)||(n=!1);break;case xn.R16G16B16A16:t.canIUse(Ce.colorBufferHalfFloat)&&t.canIUse(Ce.textureHalfFloat)||(n=!1)}return n},t._supportRenderBufferDepthFormat=function(e,t,n){var r=t.isWebGL2,i=!0;if(n&&!t.canIUse(Ce.depthTexture))return!1;switch(e){case On.Stencil:i=!1;break;case On.Depth24:case On.Depth32:case On.Depth32Stencil8:r||(i=!1)}return i};var n=t.prototype;return n.generateMipmaps=function(){if(this._mipmap){var e=this._rhi.gl;this._bind(),e.generateMipmap(this._target),this._unbind()}},n._onDestroy=function(){this._rhi.gl.deleteTexture(this._glTexture),this._glTexture=null,this._formatDetail=null,this._rhi=null},n._bind=function(){this._rhi.gl.bindTexture(this._target,this._glTexture)},n._unbind=function(){this._rhi.gl.bindTexture(this._target,null)},n._getPixelBuffer=function(e,n,r,i,a,o){var s=this._rhi.gl,u=this._formatDetail,c=u.baseFormat,l=u.dataType;t._readFrameBuffer||(t._readFrameBuffer=s.createFramebuffer()),s.bindFramebuffer(s.FRAMEBUFFER,t._readFrameBuffer),null!=e?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+e,this._glTexture,0):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this._glTexture,0),s.readPixels(n,r,i,a,c,l,o),s.bindFramebuffer(s.FRAMEBUFFER,null)},n._initMipmap=function(e){var t=this._rhi.gl,n=this._rhi.isWebGL2,r=this._formatDetail,i=r.internalFormat,a=r.baseFormat,o=r.dataType;if(this._bind(),n)t.texStorage2D(this._target,this._mipmapCount,i,this._width,this._height);else if(a!==i&&(i=a),e)for(var s=0;s<this._mipmapCount;s++)for(var u=Math.max(1,this._width>>s),c=0;c<6;c++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+c,s,i,u,u,0,a,o,null);else for(var l=0;l<this._mipmapCount;l++){var f=Math.max(1,this._width>>l),h=Math.max(1,this._height>>l);t.texImage2D(this._target,l,i,f,h,0,a,o,null)}this._unbind()},n._getMaxMiplevel=function(e){return Math.floor(Math.log2(e))},n._getMipmapCount=function(){return this._mipmap?Math.floor(Math.log2(Math.max(this._width,this._height)))+1:1},n._setWrapMode=function(e,n){var r=this._rhi.gl;switch(this._rhi.isWebGL2||e===gn.Clamp||t._isPowerOf2(this._width)&&t._isPowerOf2(this._height)||(Be.warn("non-power-2 texture is not supported for REPEAT or MIRRORED_REPEAT in WebGL1,and has automatically downgraded to CLAMP_TO_EDGE"),e=gn.Clamp),e){case gn.Clamp:r.texParameteri(this._target,n,r.CLAMP_TO_EDGE);break;case gn.Repeat:r.texParameteri(this._target,n,r.REPEAT);break;case gn.Mirror:r.texParameteri(this._target,n,r.MIRRORED_REPEAT)}},S(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){if(e!==this._wrapModeU){var t=this._rhi.gl;this._wrapModeU=e,this._bind(),this._setWrapMode(e,t.TEXTURE_WRAP_S),this._unbind()}}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){if(e!==this._wrapModeV){var t=this._rhi.gl;this._wrapModeV=e,this._bind(),this._setWrapMode(e,t.TEXTURE_WRAP_T),this._unbind()}}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){if(e!==this._filterMode){var t=this._rhi.gl;switch(this._filterMode=e,this._bind(),e){case _n.Point:t.texParameteri(this._target,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(this._target,t.TEXTURE_MIN_FILTER,this._mipmap?t.NEAREST_MIPMAP_NEAREST:t.NEAREST);break;case _n.Bilinear:t.texParameteri(this._target,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(this._target,t.TEXTURE_MIN_FILTER,this._mipmap?t.LINEAR_MIPMAP_NEAREST:t.LINEAR);break;case _n.Trilinear:t.texParameteri(this._target,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(this._target,t.TEXTURE_MIN_FILTER,this._mipmap?t.LINEAR_MIPMAP_LINEAR:t.LINEAR)}this._unbind()}}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){var t=this._rhi.capability.maxAnisoLevel;if(e>t&&(Be.warn("anisoLevel:"+e+", exceeds the limit and is automatically downgraded to:"+t),e=t),e<1&&(Be.warn("anisoLevel:"+e+", must be greater than 0, and is automatically downgraded to 1"),e=1),e!==this._anisoLevel){var n=this._rhi.gl;this._anisoLevel=e,this._bind(),n.texParameterf(this._target,n.TEXTURE_MAX_ANISOTROPY_EXT,e),this._unbind()}}}]),t}(jt);Sn._readFrameBuffer=null;var Rn=function(e){function t(t,n,r,i,a){var o;void 0===i&&(i=pn.R8G8B8A8),void 0===a&&(a=!0),(o=e.call(this,t)||this)._compressedMipFilled=0;var s=t._hardwareRenderer,u=s.gl,c=s.isWebGL2;if(!Sn._supportTextureFormat(i,s))throw new Error("Texture format is not supported:"+pn[i]);!a||c||Sn._isPowerOf2(n)&&Sn._isPowerOf2(r)||(Be.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),a=!1);var l=Sn._getFormatDetail(i,u,c);return o._glTexture=u.createTexture(),o._formatDetail=l,o._rhi=s,o._target=u.TEXTURE_2D,o._mipmap=a,o._width=n,o._height=r,o._format=i,o._mipmapCount=o._getMipmapCount(),l.isCompressed&&!c||o._initMipmap(!1),o.filterMode=_n.Bilinear,o.wrapModeU=o.wrapModeV=gn.Repeat,o}R(t,e);var n=t.prototype;return n.setPixelBuffer=function(e,t,n,r,i,a){void 0===t&&(t=0);var o=this._rhi.gl,s=this._rhi.isWebGL2,u=this._formatDetail,c=u.internalFormat,l=u.baseFormat,f=u.dataType,h=u.isCompressed,d=Math.max(1,this._width>>t),_=Math.max(1,this._height>>t);if(n=n||0,r=r||0,i=i||d-n,a=a||_-r,this._bind(),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,0),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),h){var m=1<<t;s||this._compressedMipFilled&m?o.compressedTexSubImage2D(this._target,t,n,r,i,a,c,e):(o.compressedTexImage2D(this._target,t,c,i,a,0,e),this._compressedMipFilled|=m)}else o.texSubImage2D(this._target,t,n,r,i,a,l,f,e);this._unbind()},n.setImageSource=function(e,t,n,r,i,a){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=this._rhi.gl,s=this._formatDetail,u=s.baseFormat,c=s.dataType;this._bind(),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,+n),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+r),o.texSubImage2D(this._target,t,i||0,a||0,u,c,e),this._unbind()},n.getPixelBuffer=function(t,n,r,i,a){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");e.prototype._getPixelBuffer.call(this,null,t,n,r,i,a)},S(t,[{key:"format",get:function(){return this._format}}]),t}(Sn),Ln=Object.defineProperty,Cn=Object.getOwnPropertyDescriptor,In=function(e,t,n,r){for(var i,a=r>1?void 0:r?Cn(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Ln(t,n,a),a},wn=function(e){function t(t){var n;return(n=e.call(this,t)||this)._hasInitJoints=!1,n.weightsIndices=[],n._useJointTexture=!1,n._mat=new h,n._weights=null,n._skin=null,n}R(t,e);var n=t.prototype;return n.setWeights=function(e){if(this._weights=e,e){for(var t=e.length,n=0;n<t;n++)this.weightsIndices[n]=n;for(var r=this.weightsIndices,i=0;i<t-1;i++)for(var a=i+1;a<t;a++)if(e[a]>e[i]){var o=e[i];e[i]=e[a],e[a]=o,o=r[i],r[i]=r[a],r[a]=o}this.mesh.updatePrimitiveWeightsIndices(r)}},n._initJoints=function(){if(this._skin){for(var e=this._skin.joints,t=[],n=e.length-1;n>=0;n--)t[n]=this.findByNodeName(this.entity,e[n]);this.matrixPalette=new Float32Array(16*t.length),this.jointNodes=t;var r=this.entity.engine._hardwareRenderer;if(r){var i=r.renderStates.getParameter(r.gl.MAX_VERTEX_UNIFORM_VECTORS),a=Math.floor((i-20)/4);e.length>a&&r.canIUseMoreJoints&&(this._useJointTexture=!0)}}},n.findByNodeName=function(e,t){if(!e)return null;var n=e.findByName(t);return n||this.findByNodeName(e.parent,t)},n._findParent=function(e,t){if(e){var n=e.parent;if(!n)return null;if(n.name===t)return n;var r=n.findByName(t);return r||this._findParent(n,t)}return null},n.update=function(){if(this._hasInitJoints||(this._initJoints(),this._hasInitJoints=!0),this._skin){for(var e=this.jointNodes,t=this._skin.inverseBindMatrices,n=this.matrixPalette,r=this.entity.getInvModelMatrix(),i=this._mat,a=e.length-1;a>=0;a--)i.identity(),e[a]?h.multiply(e[a].transform.worldMatrix,t[a],i):t[a].cloneTo(i),h.multiply(r,i,i),n.set(i.elements,16*a);this._useJointTexture&&this.createJointTexture()}},n.createJointTexture=function(){if(!this.jointTexture){var e=this.engine;if(!e._hardwareRenderer)return;this.jointTexture=new Rn(e,4,this.jointNodes.length,pn.R32G32B32A32,!1),this.jointTexture.filterMode=_n.Point}this.jointTexture.setPixelBuffer(this.matrixPalette)},S(t,[{key:"skin",get:function(){return this._skin},set:function(e){this._skin=e}},{key:"weights",get:function(){return this._weights}}]),t}(Mn);In([k],wn.prototype,"matrixPalette",2),In([k],wn.prototype,"jointNodes",2),In([k],wn.prototype,"jointTexture",2),In([k],wn.prototype,"_hasInitJoints",2),In([k],wn.prototype,"_mat",2),In([k],wn.prototype,"_weights",2),In([k],wn.prototype,"weightsIndices",2),In([k],wn.prototype,"_useJointTexture",2);var Pn,Nn,Fn,Dn,Un,Vn,Bn=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._lods=[],t}R(t,e);var n=t.prototype;return n.addLod=function(e,t){t.enabled=!1,this._lods.push({distance:e,rendererAbility:t}),this._lods.sort((function(e,t){return t.distance-e.distance}))},n.render=function(e){if(!(this._lods.length<=0)){for(var t=s.distance(e.eyePos,this.entity.worldPosition),n=this._lods,r=0,i=n.length-1;i>=0;i--){if(t<n[i].distance){r=i;break}}n[r].rendererAbility.render(e)}},t}(xt),Hn=function(e){function t(t,n){var r;return(r=e.call(this,t)||this).name=n,r.renderType=ie.OPAQUE,r.useFog=!0,r.maxJointsNum=0,r._technique=null,r._values={},r}R(t,e);var n=t.prototype;return n.clone=function(e,t){void 0===e&&(e=this.name),void 0===t&&(t=!1);var n=new this.constructor(e);for(var r in n.renderType=this.renderType,n.useFog=this.useFog,this._values)if(this._values.hasOwnProperty(r)){var i=this._values[r];i instanceof Sn?n.setValue(r,i):n.setValue(r,F.clone(i))}return n},n.setValue=function(e,t){var n=this.getValue(e),r=n instanceof Sn,i=t instanceof Sn;r&&this._removeRefChild(n),i&&this._addRefChild(t),this._generateTechnique&&r!==i&&(this._technique=null),null!=t?this._values[e]=t:this.delValue(e)},n.delValue=function(e){delete this._values[e]},n.getValue=function(e){return this._values[e]},n.prepareDrawing=function(e,t,n,r){var i=e.camera,a=this._technique.uniforms;for(var o in a){var s=a[o];this._updateValueBySemantic(s,e,t)}var u=i.scene;u.hasFogFeature&&u.bindFogToMaterial(this),this._technique.compile(i,t,n,this)},n.preCompile=function(e){},n.postCompile=function(e){},n.preRender=function(e,t){},n.postRender=function(e,t){},n._updateValueBySemantic=function(e,t,n){var r,i=this._values;switch(e.semantic){case Ee.LOCAL:i[e.name]=n._entity.transform.localMatrix;break;case Ee.MODEL:i[e.name]=n._entity.transform.worldMatrix;break;case Ee.VIEW:i[e.name]=t.viewMatrix;break;case Ee.PROJECTION:i[e.name]=t.projectionMatrix;break;case Ee.MODELVIEW:var a=t.viewMatrix,o=n._entity.transform.worldMatrix,s=i[e.name];s||(s=new h),h.multiply(a,o,s),i[e.name]=s;break;case Ee.VIEWPROJECTION:var u=t.viewProjectMatrix;i[e.name]=u;break;case Ee.MODELVIEWPROJECTION:var c=t.viewProjectMatrix,f=n._entity.transform.worldMatrix,d=i[e.name];d||(d=new h),h.multiply(c,f,d),i[e.name]=d;break;case Ee.MODELINVERSE:i[e.name]=n.invModelMatrixs;break;case Ee.VIEWINVERSE:i[e.name]=t.inverseViewMatrix;break;case Ee.PROJECTIONINVERSE:i[e.name]=t.inverseProjectionMatrix;break;case Ee.MODELVIEWINVERSE:var _=t.viewMatrix,m=n._entity.transform.worldMatrix,p=i[e.name];p||(p=new h),h.multiply(_,m,p),h.invert(p,p),i[e.name]=p;break;case Ee.MODELVIEWPROJECTIONINVERSE:var v=t.viewProjectMatrix,g=n._entity.transform.worldMatrix,y=i[e.name];y||(y=new h),h.multiply(v,g,y),h.invert(y,y),i[e.name]=y;break;case Ee.MODELINVERSETRANSPOSE:var E=i[e.name];E||(E=new l),l.normalMatrix(n._entity.transform.worldMatrix,E),i[e.name]=E;break;case Ee.MODELVIEWINVERSETRANSPOSE:var T=i[e.name];T||(T=new h),h.multiply(t.viewMatrix,n._entity.transform.worldMatrix,T),h.invert(T,T),h.transpose(T,T),i[e.name]=T;break;case Ee.VIEWPORT:i[e.name]=t.viewport;break;case Ee.JOINTMATRIX:i[e.name]=n.matrixPalette;break;case Ee.JOINTTEXTURE:i[e.name]=n.jointTexture;break;case Ee.JOINTCOUNT:i[e.name]=null==(r=n.jointNodes)?void 0:r.length;break;case Ee.MORPHWEIGHTS:i[e.name]=n.weights;break;case Ee.EYEPOS:i[e.name]=t.cameraPosition;break;case Ee.TIME:i[e.name]=.001*n.engine.time.timeSinceStartup}},n._onDestroy=function(){if(this._technique){for(var e=U(this._values),t=0,n=e.length;t<n;t++){var r=e[t];r instanceof Sn&&r._addRefCount(-1)}this._technique._finalize(),this._technique=null}},S(t,[{key:"transparent",get:function(){return this.renderType===ie.TRANSPARENT},set:function(e){this.renderType=e?ie.TRANSPARENT:ie.OPAQUE}},{key:"technique",get:function(){return this._technique},set:function(e){this._technique=e,this._values={}}}]),t}(jt),zn=function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this)._techniquePool={},r}R(t,e);var n=t.prototype;return n.prepareDrawing=function(t,n,r){var i=t.camera,a=this._requireTechnique(i,n,r);a&&(this._technique=a,e.prototype.prepareDrawing.call(this,t,n,r))},n.clearTechniques=function(){this._techniquePool={}},n._requireTechnique=function(e,t,n){var r=this._getTechniqueKey(e,t,n),i=this._techniquePool[r];return i||(i=this._generateTechnique(e,t,n),this._techniquePool[r]=i),i},n._generateTechnique=function(e,t,n){},n._getTechniqueKey=function(e,t,n){var r=null!=t.skin,i=r?t.skin.joints.length:0,a=r?"skin_":"static_";return r&&(a+="jont"+i),a},t}(Hn);(Nn=Pn||(Pn={}))[Nn.Static=0]="Static",Nn[Nn.Dynamic=1]="Dynamic",Nn[Nn.Stream=2]="Stream",(Dn=Fn||(Fn={}))[Dn.Float=0]="Float",Dn[Dn.Vector2=1]="Vector2",Dn[Dn.Vector3=2]="Vector3",Dn[Dn.Vector4=3]="Vector4",Dn[Dn.Byte4=4]="Byte4",Dn[Dn.UByte4=5]="UByte4",Dn[Dn.NormalizedByte4=6]="NormalizedByte4",Dn[Dn.NormalizedUByte4=7]="NormalizedUByte4",Dn[Dn.Short2=8]="Short2",Dn[Dn.UShort2=9]="UShort2",Dn[Dn.NormalizedShort2=10]="NormalizedShort2",Dn[Dn.NormalizedUShort2=11]="NormalizedUShort2",Dn[Dn.Short4=12]="Short4",Dn[Dn.UShort4=13]="UShort4",Dn[Dn.NormalizedShort4=14]="NormalizedShort4",Dn[Dn.NormalizedUShort4=15]="NormalizedUShort4",(Vn=Un||(Un={}))[Vn.UInt8=0]="UInt8",Vn[Vn.UInt16=1]="UInt16",Vn[Vn.UInt32=2]="UInt32";var Gn,kn,jn,Xn,Wn=function(){function e(){}return e._getGLBufferUsage=function(e,t){switch(t){case Pn.Static:return e.STATIC_DRAW;case Pn.Dynamic:return e.DYNAMIC_DRAW;case Pn.Stream:return e.STREAM_DRAW}},e._getGLIndexType=function(e){switch(e){case Un.UInt8:return ge.UNSIGNED_BYTE;case Un.UInt16:return ge.UNSIGNED_SHORT;case Un.UInt32:return ge.UNSIGNED_INT}},e._getElementInfo=function(e){var t,n;switch(e){case Fn.Float:t=1,n=ge.FLOAT;break;case Fn.Vector2:t=2,n=ge.FLOAT;break;case Fn.Vector3:t=3,n=ge.FLOAT;break;case Fn.Vector4:t=4,n=ge.FLOAT;break;case Fn.Byte4:t=4,n=ge.UNSIGNED_BYTE;break;case Fn.Short2:t=2,n=ge.SHORT;break;case Fn.Short4:t=4,n=ge.SHORT;break;case Fn.UShort2:t=2,n=ge.UNSIGNED_SHORT;break;case Fn.UShort4:t=4,n=ge.UNSIGNED_SHORT}return{size:t,type:n}},e}();(kn=Gn||(Gn={}))[kn.VertexBuffer=0]="VertexBuffer",kn[kn.IndexBuffer=1]="IndexBuffer",(Xn=jn||(jn={}))[Xn.None=0]="None",Xn[Xn.Discard=1]="Discard";var qn,Yn,Kn=function(e){function t(t,n,r,i){var a;void 0===i&&(i=Pn.Static),(a=e.call(this,t)||this)._engine=t,a._type=n,a._bufferUsage=i;var o=t._hardwareRenderer,s=o.gl,u=Wn._getGLBufferUsage(s,i),c=n===Gn.VertexBuffer?s.ARRAY_BUFFER:s.ELEMENT_ARRAY_BUFFER;return a._nativeBuffer=s.createBuffer(),a._hardwareRenderer=o,a._glBufferUsage=u,a._glBindTarget=c,a.bind(),"number"==typeof r?(a._byteLength=r,s.bufferData(c,r,u)):(a._byteLength=r.byteLength,s.bufferData(c,r,u)),s.bindBuffer(c,null),a}R(t,e);var n=t.prototype;return n.bind=function(){this._hardwareRenderer.gl.bindBuffer(this._glBindTarget,this._nativeBuffer)},n.setData=function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=jn.None);var a=this._hardwareRenderer.gl,o=this._hardwareRenderer.isWebGL2,s=this._glBindTarget;this.bind(),i===jn.Discard&&a.bufferData(s,this._byteLength,this._glBufferUsage);var u=e.BYTES_PER_ELEMENT||1,c=r?u*r:e.byteLength;if(0!==n||c<e.byteLength){var l=void 0!==e.byteOffset;if(o&&l)a.bufferSubData(s,t,e,n,c/u);else{var f=new Uint8Array(l?e.buffer:e,n*u,c);a.bufferSubData(s,t,f)}}else a.bufferSubData(s,t,e);a.bindBuffer(s,null)},n.getData=function(e,t,n,r){if(void 0===t&&(t=0),void 0===n&&(n=0),!this._hardwareRenderer.isWebGL2)throw"Buffer is write-only on WebGL1.0 platforms.";var i=this._hardwareRenderer.gl;this.bind(),i.getBufferSubData(this._glBindTarget,t,e,n,r)},n._onDestroy=function(){this._hardwareRenderer.gl.deleteBuffer(this._nativeBuffer),this._nativeBuffer=null,this._hardwareRenderer=null},n.resize=function(e){this.bind(),this._hardwareRenderer.gl.bufferData(this._glBindTarget,e,this._glBufferUsage),this._byteLength=e},S(t,[{key:"engine",get:function(){return this._engine}},{key:"type",get:function(){return this._type}},{key:"byteLength",get:function(){return this._byteLength}},{key:"bufferUsage",get:function(){return this._bufferUsage}}]),t}(jt);(Yn=qn||(qn={}))[Yn.Points=0]="Points",Yn[Yn.Lines=1]="Lines",Yn[Yn.LineLoop=2]="LineLoop",Yn[Yn.LineStrip=3]="LineStrip",Yn[Yn.Triangles=4]="Triangles",Yn[Yn.TriangleStrip=5]="TriangleStrip",Yn[Yn.TriangleFan=6]="TriangleFan";var Qn=function(){function e(e,t){this._buffer=e,this._format=t}return S(e,[{key:"buffer",get:function(){return this._buffer}},{key:"format",get:function(){return this._format}}]),e}(),Zn=function(){function e(e,t){this._buffer=e,this._stride=t}return S(e,[{key:"buffer",get:function(){return this._buffer}},{key:"stride",get:function(){return this._stride}}]),e}(),Jn=function(e){function t(t,n){var r;return(r=e.call(this,t)||this).instanceCount=0,r._vertexElementMap={},r._vertexBufferBindings=[],r._indexBufferBinding=null,r._vertexElements=[],r.targets=[],r.boundingBox=null,r.boundingSphere=null,r.isInFrustum=!0,r.name=n,r._platformPrimitive=r._engine._hardwareRenderer.createPlatformPrimitive(A(r)),r}R(t,e);var n=t.prototype;return n.setVertexBufferBinding=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0);var r=e,i=void 0!==r.buffer;i||(r=new Zn(e,t));var a=this._vertexBufferBindings;a.length<=n&&(a.length=n+1),this._setVertexBufferBinding(i?t:n,r)},n.setVertexBufferBindings=function(e,t){void 0===t&&(t=0);var n=this._vertexBufferBindings,r=e,i=r.length,a=t+i;n.length<a&&(n.length=a);for(var o=0;o<i;o++)this._setVertexBufferBinding(t+o,r[o])},n.setIndexBufferBinding=function(e,t){var n=e;void 0!==n.buffer||(n=new Qn(e,t)),this._indexBufferBinding=n,this._glIndexType=Wn._getGLIndexType(n.format)},n.setVertexElements=function(e){this._clearVertexElements();for(var t=0,n=e.length;t<n;t++)this._addVertexElement(e[t])},n.draw=function(e,t){this._platformPrimitive.draw(e,t)},n._onDestroy=function(){this._vertexBufferBindings=null,this._indexBufferBinding=null,this._vertexElements=null,this._vertexElementMap=null,this._platformPrimitive.destroy()},n._clearVertexElements=function(){this._vertexElements.length=0;var e=this._vertexElementMap;for(var t in e)delete e[t]},n._addVertexElement=function(e){this._vertexElementMap[e.semantic]=e,this._vertexElements.push(e)},n._setVertexBufferBinding=function(e,t){var n=this._vertexBufferBindings[e];n&&this._removeRefChild(n._buffer),this._addRefChild(t._buffer),this._vertexBufferBindings[e]=t},S(t,[{key:"vertexBufferBindings",get:function(){return this._vertexBufferBindings}},{key:"vertexElements",get:function(){return this._vertexElements}},{key:"indexBufferBinding",get:function(){return this._indexBufferBinding}}]),t}(jt),$n=function(){function e(e,t,n,r,i){void 0===i&&(i=0),this.normalized=!1,this._semantic=e,this._offset=t,this._format=n,this._bindingIndex=r,this._glElementInfo=Wn._getElementInfo(this.format),this._instanceStepRate=Math.floor(i)}return S(e,[{key:"semantic",get:function(){return this._semantic}},{key:"offset",get:function(){return this._offset}},{key:"format",get:function(){return this._format}},{key:"bindingIndex",get:function(){return this._bindingIndex}},{key:"instanceStepRate",get:function(){return this._instanceStepRate}},{key:"elementInfo",get:function(){return this._glElementInfo}}]),e}(),er=function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=qn.Triangles),this.start=e,this.count=t,this.topology=n},tr=x({common:"#define PI 3.14159265359\n#define LOG2 1.442695\n\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\n// nosie common\n#include <noise_common>\n",common_vert:"attribute vec3 a_position;\n\n#ifdef O3_HAS_UV\n\nattribute vec2 a_uv;\n\n#endif\n\n#ifdef O3_HAS_NORMAL\n\nattribute vec3 a_normal;\n\n#endif\n\n#ifdef O3_HAS_TANGENT\n\nattribute vec4 a_tangent;\n\n#endif\n\n#ifdef O3_HAS_VERTEXCOLOR\n\nattribute vec4 a_color;\n\n#endif\n\n#if defined( O3_HAS_SKIN ) && ( defined( O3_JOINTS_NUM ) || defined( O3_USE_JOINT_TEXTURE ) )\n    attribute vec4 a_joint;\n    attribute vec4 a_weight;\n\n    #ifdef O3_USE_JOINT_TEXTURE\n        uniform sampler2D u_jointSampler;\n        uniform float u_jointCount;\n\n        mat4 getJointMatrix(sampler2D smp, float index)\n        {\n            float base = index / u_jointCount;\n            float hf = 0.5 / u_jointCount;\n            float v = base + hf;\n\n            vec4 m0 = texture2D(smp, vec2(0.125, v ));\n            vec4 m1 = texture2D(smp, vec2(0.375, v ));\n            vec4 m2 = texture2D(smp, vec2(0.625, v ));\n            vec4 m3 = texture2D(smp, vec2(0.875, v ));\n\n            return mat4(m0, m1, m2, m3);\n\n        }\n\n    #elif defined( O3_JOINTS_NUM )\n        uniform mat4 u_jointMatrix[ O3_JOINTS_NUM ];\n    #endif\n#endif\n\nuniform mat4 u_localMat;\nuniform mat4 u_modelMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nuniform mat4 u_MVMat;\nuniform mat4 u_MVPMat;\nuniform mat3 u_normalMat;\nuniform vec3 u_cameraPos;\nuniform float u_time;\n",common_frag:"uniform O3_VERTEX_PRECISION mat4 u_localMat;\nuniform O3_VERTEX_PRECISION mat4 u_modelMat;\nuniform O3_VERTEX_PRECISION mat4 u_viewMat;\nuniform O3_VERTEX_PRECISION mat4 u_projMat;\nuniform O3_VERTEX_PRECISION mat4 u_MVMat;\nuniform O3_VERTEX_PRECISION mat4 u_MVPMat;\nuniform O3_VERTEX_PRECISION mat3 u_normalMat;\nuniform O3_VERTEX_PRECISION vec3 u_cameraPos;\nuniform O3_VERTEX_PRECISION float u_time;\n",color_share:"#ifdef O3_HAS_VERTEXCOLOR\n\nvarying vec4 v_color;\n\n#endif\n",normal_share:"#ifdef O3_HAS_NORMAL\n\n    #if defined( O3_HAS_TANGENT ) && defined( O3_HAS_NORMALMAP )\n\n    varying mat3 v_TBN;\n\n    #else\n\n    varying vec3 v_normal;\n\n    #endif\n\n#endif\n",uv_share:"varying vec2 v_uv;\n",worldpos_share:"#if defined( O3_NEED_WORLDPOS ) || defined( O3_HAS_ENVMAP ) || defined( O3_HAS_LIGHTMAP ) || defined(O3_CLIPPLANE_NUM)\n\nvarying vec3 v_pos;\n\n#endif\n",shadow_share:"#ifdef O3_GENERATE_SHADOW_MAP\n\nuniform mat4 u_viewMatFromLight;\nuniform mat4 u_projMatFromLight;\n\n#endif\n\n#ifdef O3_SHADOW_MAP_COUNT\n\nuniform mat4 u_viewMatFromLight[O3_SHADOW_MAP_COUNT];\nuniform mat4 u_projMatFromLight[O3_SHADOW_MAP_COUNT];\nvarying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];\n\n#endif\n",fog_share:"#ifdef O3_HAS_FOG\n\nvarying vec3 v_fogDepth;\n\nuniform O3_VERTEX_PRECISION vec3 u_fogColor;\n\n    #ifdef O3_FOG_EXP2\n\n        uniform O3_VERTEX_PRECISION float u_fogDensity;\n\n    #else\n\n        uniform O3_VERTEX_PRECISION float u_fogNear;\n        uniform O3_VERTEX_PRECISION float u_fogFar;\n\n    #endif\n\n#endif\n",begin_normal_vert:"    #ifdef O3_HAS_NORMAL\n\n    vec3 normal = vec3( a_normal );\n\n        #if defined( O3_HAS_TANGENT ) && defined( O3_HAS_NORMALMAP )\n\n        vec4 tangent = vec4( a_tangent );\n\n        #endif\n\n    #endif\n",begin_position_vert:"    vec4 position = vec4( a_position , 1.0 );\n",morph_target_vert:"#ifdef O3_HAS_MORPH\n\n    uniform float u_morphWeights[ O3_MORPH_NUM ];\n\n    #ifdef O3_MORPH_POSITION\n\n    attribute vec3 a_position0;\n\n    #endif\n\n    #ifdef O3_MORPH_NORMAL\n\n    attribute vec3 a_normal0;\n\n    #endif\n\n    #ifdef O3_MORPH_TANGENT\n\n    attribute vec3 a_tangent0;\n\n    #endif\n\n    #if O3_MORPH_NUM > 1\n\n        #ifdef O3_MORPH_POSITION\n\n        attribute vec3 a_position1;\n\n        #endif\n\n        #ifdef O3_MORPH_NORMAL\n\n        attribute vec3 a_normal1;\n\n        #endif\n\n        #ifdef O3_MORPH_TANGENT\n\n        attribute vec3 a_tangent1;\n\n        #endif\n\n    #endif\n\n    #if O3_MORPH_NUM > 2\n\n        #ifdef O3_MORPH_POSITION\n\n        attribute vec3 a_position2;\n\n        #endif\n\n        #ifdef O3_MORPH_NORMAL\n\n        attribute vec3 a_normal2;\n\n        #endif\n\n        #ifdef O3_MORPH_TANGENT\n\n        attribute vec3 a_tangent2;\n\n        #endif\n\n    #endif\n\n    #if O3_MORPH_NUM > 3\n\n        #ifdef O3_MORPH_POSITION\n\n        attribute vec3 a_position3;\n\n        #endif\n\n        #ifdef O3_MORPH_NORMAL\n\n        attribute vec3 a_normal3;\n\n        #endif\n\n        #ifdef O3_MORPH_TANGENT\n\n        attribute vec3 a_tangent3;\n\n        #endif\n\n    #endif\n\n    #if O3_MORPH_NUM > 4\n\n        #ifdef O3_MORPH_POSITION\n\n        attribute vec3 a_position4;\n\n        #endif\n\n        #ifdef O3_MORPH_NORMAL\n\n        attribute vec3 a_normal4;\n\n        #endif\n\n        #ifdef O3_MORPH_TANGENT\n\n        attribute vec3 a_tangent4;\n\n        #endif\n\n    #endif\n\n    #if O3_MORPH_NUM > 5\n\n        #ifdef O3_MORPH_POSITION\n\n        attribute vec3 a_position5;\n\n        #endif\n\n        #ifdef O3_MORPH_NORMAL\n\n        attribute vec3 a_normal5;\n\n        #endif\n\n        #ifdef O3_MORPH_TANGENT\n\n        attribute vec3 a_tangent5;\n\n        #endif\n\n    #endif\n\n    #if O3_MORPH_NUM > 6\n\n        #ifdef O3_MORPH_POSITION\n\n        attribute vec3 a_position6;\n\n        #endif\n\n        #ifdef O3_MORPH_NORMAL\n\n        attribute vec3 a_normal6;\n\n        #endif\n\n        #ifdef O3_MORPH_TANGENT\n\n        attribute vec3 a_tangent6;\n\n        #endif\n\n    #endif\n\n    #if O3_MORPH_NUM > 7\n\n        #ifdef O3_MORPH_POSITION\n\n        attribute vec3 a_position7;\n\n        #endif\n\n        #ifdef O3_MORPH_NORMAL\n\n        attribute vec3 a_normal7;\n\n        #endif\n\n        #ifdef O3_MORPH_TANGENT\n\n        attribute vec3 a_tangent7;\n\n        #endif\n\n    #endif\n\n#endif\n",position_vert:"    #ifndef O3_GENERATE_SHADOW_MAP\n\n    gl_Position = u_MVPMat * position;\n\n    #endif\n",color_vert:"    #ifdef O3_HAS_VERTEXCOLOR\n\n    v_color = a_color;\n\n    #endif\n",normal_vert:"    #ifdef O3_HAS_NORMAL\n\n        #if defined( O3_HAS_TANGENT ) && defined( O3_HAS_NORMALMAP )\n\n        vec3 normalW = normalize( u_normalMat * normal.xyz );\n        vec3 tangentW = normalize( u_normalMat * tangent.xyz );\n        vec3 bitangentW = cross( normalW, tangentW ) * tangent.w;\n        v_TBN = mat3( tangentW, bitangentW, normalW );\n\n        #else\n\n        v_normal = normalize( u_normalMat * normal );\n\n        #endif\n\n    #endif\n",skinning_vert:"#if defined( O3_HAS_SKIN ) && ( defined( O3_JOINTS_NUM ) || defined( O3_USE_JOINT_TEXTURE ) )\n\n        #ifdef O3_USE_JOINT_TEXTURE\n            mat4 skinMatrix =\n                a_weight.x * getJointMatrix(u_jointSampler, a_joint.x ) +\n                a_weight.y * getJointMatrix(u_jointSampler, a_joint.y ) +\n                a_weight.z * getJointMatrix(u_jointSampler, a_joint.z ) +\n                a_weight.w * getJointMatrix(u_jointSampler, a_joint.w );\n\n        #elif defined( O3_JOINTS_NUM )\n            mat4 skinMatrix =\n                a_weight.x * u_jointMatrix[ int( a_joint.x ) ] +\n                a_weight.y * u_jointMatrix[ int( a_joint.y ) ] +\n                a_weight.z * u_jointMatrix[ int( a_joint.z ) ] +\n                a_weight.w * u_jointMatrix[ int( a_joint.w ) ];\n        #endif\n\n        position = skinMatrix * position;\n\n        #ifdef O3_HAS_NORMAL\n            normal = vec4( skinMatrix * vec4( normal, 0.0 ) ).xyz;\n            #if defined( O3_HAS_TANGENT ) && defined( O3_HAS_NORMALMAP )\n                tangent.xyz = vec4( skinMatrix * vec4( tangent.xyz, 0.0 ) ).xyz;\n            #endif\n\n        #endif\n\n#endif\n",uv_vert:"    #ifdef O3_HAS_UV\n\n    v_uv = a_uv;\n\n    #else\n\n    // may need this calculate normal\n    v_uv = vec2( 0., 0. );\n\n    #endif\n",worldpos_vert:"    #if defined( O3_NEED_WORLDPOS ) || defined( O3_HAS_ENVMAP ) || defined( O3_HAS_LIGHTMAP ) || defined(O3_CLIPPLANE_NUM)\n\n    vec4 temp_pos = u_modelMat * position;\n    v_pos = temp_pos.xyz / temp_pos.w;\n\n    #endif\n",shadow_vert:"    #ifdef O3_GENERATE_SHADOW_MAP\n\n    gl_Position = u_projMatFromLight * u_viewMatFromLight * u_modelMat * position;\n\n    #endif\n\n    #ifdef O3_SHADOW_MAP_COUNT\n\n    for (int i = 0; i < O3_SHADOW_MAP_COUNT; i++) {\n\n        v_PositionFromLight[i] = u_projMatFromLight[i] * u_viewMatFromLight[i] * u_modelMat * vec4( a_position, 1.0 );\n\n    }\n\n    #endif\n",morph_vert:"    #ifdef O3_HAS_MORPH\n\n        #if defined( O3_MORPH_POSITION )\n\n        position.xyz += u_morphWeights[ 0 ] * a_position0;\n\n            #if O3_MORPH_NUM > 1\n\n            position.xyz += u_morphWeights[ 1 ] * a_position1;\n\n            #endif\n\n            #if O3_MORPH_NUM > 2\n\n            position.xyz += u_morphWeights[ 2 ] * a_position2;\n\n            #endif\n\n            #if O3_MORPH_NUM > 3\n\n            position.xyz += u_morphWeights[ 3 ] * a_position3;\n\n            #endif\n\n            #if O3_MORPH_NUM > 4\n\n            position.xyz += u_morphWeights[ 4 ] * a_position4;\n\n            #endif\n\n            #if O3_MORPH_NUM > 5\n\n            position.xyz += u_morphWeights[ 5 ] * a_position5;\n\n            #endif\n\n            #if O3_MORPH_NUM > 6\n\n            position.xyz += u_morphWeights[ 6 ] * a_position6;\n\n            #endif\n\n            #if O3_MORPH_NUM > 7\n\n            position.xyz += u_morphWeights[ 7 ] * a_position7;\n\n            #endif\n\n        #endif\n\n        #if defined( O3_HAS_NORMAL ) && defined( O3_MORPH_NORMAL )\n\n        normal.xyz += u_morphWeights[ 0 ] * a_normal0;\n\n            #if O3_MORPH_NUM > 1\n\n            normal.xyz += u_morphWeights[ 1 ] * a_normal1;\n\n            #endif\n\n            #if O3_MORPH_NUM > 2\n\n            normal.xyz += u_morphWeights[ 2 ] * a_normal2;\n\n            #endif\n\n            #if O3_MORPH_NUM > 3\n\n            normal.xyz += u_morphWeights[ 3 ] * a_normal3;\n\n            #endif\n\n            #if O3_MORPH_NUM > 4\n\n            normal.xyz += u_morphWeights[ 4 ] * a_normal4;\n\n            #endif\n\n            #if O3_MORPH_NUM > 5\n\n            normal.xyz += u_morphWeights[ 5 ] * a_normal5;\n\n            #endif\n\n            #if O3_MORPH_NUM > 6\n\n            normal.xyz += u_morphWeights[ 6 ] * a_normal6;\n\n            #endif\n\n            #if O3_MORPH_NUM > 7\n\n            normal.xyz += u_morphWeights[ 7 ] * a_normal7;\n\n            #endif\n\n        #endif\n\n        #if defined( O3_HAS_TANGENT ) && defined( O3_MORPH_TANGENT ) && defined( O3_HAS_NORMALMAP )\n\n        tangent.xyz += u_morphWeights[ 0 ] * a_tangent0;\n\n            #if O3_MORPH_NUM > 1\n\n            tangent.xyz += u_morphWeights[ 1 ] * a_tangent1;\n\n            #endif\n\n            #if O3_MORPH_NUM > 2\n\n            tangent.xyz += u_morphWeights[ 2 ] * a_tangent2;\n\n            #endif\n\n            #if O3_MORPH_NUM > 3\n\n            tangent.xyz += u_morphWeights[ 3 ] * a_tangent3;\n\n            #endif\n\n            #if O3_MORPH_NUM > 4\n\n            tangent.xyz += u_morphWeights[ 4 ] * a_tangent4;\n\n            #endif\n\n            #if O3_MORPH_NUM > 5\n\n            tangent.xyz += u_morphWeights[ 5 ] * a_tangent5;\n\n            #endif\n\n            #if O3_MORPH_NUM > 6\n\n            tangent.xyz += u_morphWeights[ 6 ] * a_tangent6;\n\n            #endif\n\n            #if O3_MORPH_NUM > 7\n\n            tangent.xyz += u_morphWeights[ 7 ] * a_tangent7;\n\n            #endif\n\n        #endif\n\n    #endif\n",fog_vert:"    #ifdef O3_HAS_FOG\n\n    v_fogDepth = ( u_MVMat * position ).xyz;\n\n    #endif\n",ambient_light_frag:"#ifdef O3_HAS_AMBIENT_LIGHT\n\nstruct AmbientLight {\n    vec3 color;\n    vec3 lightColor;\n    float intensity;\n};\nuniform AmbientLight u_ambientLight;\n\n#endif\n",direct_light_frag:"#ifdef O3_DIRECT_LIGHT_COUNT\n\nstruct DirectLight {\n    vec3 color;\n    vec3 lightColor;\n    float intensity;\n    vec3 direction;\n};\nuniform DirectLight u_directLights[ O3_DIRECT_LIGHT_COUNT ];\n\n#endif\n",point_light_frag:"#ifdef O3_POINT_LIGHT_COUNT\n\nstruct PointLight {\n    vec3 color;\n    vec3 lightColor;\n    vec3 position;\n    float intensity;\n    float distance;\n    float decay;\n};\nuniform PointLight u_pointLights[ O3_POINT_LIGHT_COUNT ];\n\n#endif\n",spot_light_frag:"#ifdef O3_SPOT_LIGHT_COUNT\n\nstruct SpotLight {\n    vec3 color;\n    vec3 lightColor;\n    vec3 position;\n    vec3 direction;\n    float intensity;\n    float distance;\n    float decay;\n    float angle;\n    float penumbra;\n    float coneCos;\n    float penumbraCos;\n};\nuniform SpotLight u_spotLights[ O3_SPOT_LIGHT_COUNT ];\n\n#endif\n",mobile_material_frag:"uniform float u_shininess;\n\n#ifdef O3_EMISSION_TEXTURE\n\nuniform sampler2D u_emission;\n\n#else\n\nuniform vec4 u_emission;\n\n#endif\n\n#ifdef O3_AMBIENT_TEXTURE\n\nuniform sampler2D u_ambient;\n\n#else\n\nuniform vec4 u_ambient;\n\n#endif\n\n#ifdef O3_DIFFUSE_TEXTURE\n\nuniform sampler2D u_diffuse;\n\n#else\n\nuniform vec4 u_diffuse;\n\n#endif\n\n#ifdef O3_SPECULAR_TEXTURE\n\nuniform sampler2D u_specular;\n\n#else\n\nuniform vec4 u_specular;\n\n#endif\n",fog_frag:"    #ifdef O3_HAS_FOG\n\n    float fogDepth = length( v_fogDepth );\n\n        #ifdef O3_FOG_EXP2\n\n            float fogFactor = whiteCompliment( exp2( - u_fogDensity * u_fogDensity * fogDepth * fogDepth * LOG2 ) );\n\n        #else\n\n            float fogFactor = smoothstep( u_fogNear, u_fogFar, fogDepth );\n\n        #endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, u_fogColor, fogFactor );\n\n    #endif\n",begin_mobile_frag:"    #ifdef O3_EMISSION_TEXTURE\n\n    vec4 emission = texture2D(u_emission, v_uv);\n\n    #else\n\n    vec4 emission = u_emission;\n\n    #endif\n\n    vec4 ambient = vec4(0);\n    #ifdef O3_HAS_AMBIENT_LIGHT\n        #ifdef O3_AMBIENT_TEXTURE\n            ambient = texture2D(u_ambient, v_uv) * vec4(u_ambientLight.lightColor, 1.0);\n         #else\n            ambient = u_ambient * vec4(u_ambientLight.lightColor, 1.0);\n         #endif\n    #endif\n\n    #ifdef O3_DIFFUSE_TEXTURE\n\n    vec4 diffuse = texture2D(u_diffuse, v_uv);\n\n    #else\n\n    vec4 diffuse = u_diffuse;\n\n    #endif\n\n    #ifdef O3_SPECULAR_TEXTURE\n\n    vec4 specular = texture2D(u_specular, v_uv);\n\n    #else\n\n    vec4 specular = u_specular;\n\n    #endif\n",begin_normal_frag:"    #ifdef O3_HAS_NORMAL\n\n        #if defined( O3_HAS_TANGENT ) && defined( O3_HAS_NORMALMAP )\n\n        vec3 N = normalize( v_TBN[ 2 ] );\n\n        #else\n\n        vec3 N = normalize( v_normal );\n\n        #endif\n\n    #endif\n",begin_viewdir_frag:"    #if defined( O3_NEED_WORLDPOS ) || defined( O3_HAS_ENVMAP ) || defined( O3_HAS_LIGHTMAP )\n\n    vec3 V =  normalize( u_cameraPos - v_pos );\n\n    #endif\n",mobile_blinnphong_frag:"    #ifdef O3_HAS_NORMAL\n         N *= float( gl_FrontFacing ) * 2.0 - 1.0;\n    #else\n         vec3 N = vec3(0, 0, 1);\n    #endif\n\n\n    vec3 lightDiffuse = vec3( 0.0, 0.0, 0.0 );\n    vec3 lightSpecular = vec3( 0.0, 0.0, 0.0 );\n\n    #ifdef O3_DIRECT_LIGHT_COUNT\n\n    for( int i = 0; i < O3_DIRECT_LIGHT_COUNT; i++ ) {\n        DirectLight lgt = u_directLights[ i ];\n\n        float d = max(dot(N, -lgt.direction), 0.0)*lgt.intensity;\n        lightDiffuse += lgt.color*d;\n\n        vec3 halfDir = normalize( V - lgt.direction );\n        float s = pow( clamp( dot( N, halfDir ), 0.0, 1.0 ), u_shininess ) * lgt.intensity;\n        lightSpecular += lgt.color * s;\n    }\n\n    #endif\n\n    #ifdef O3_POINT_LIGHT_COUNT\n\n    for( int i = 0; i < O3_POINT_LIGHT_COUNT; i++ ) {\n        PointLight lgt = u_pointLights[ i ];\n        vec3 direction = v_pos - lgt.position;\n        float dist = length( direction );\n        direction /= dist;\n        float decay = pow( max( 0.0, 1.0-dist/lgt.distance ), 2.0 );\n\n        float d =  max( dot( N, -direction ), 0.0 )*lgt.intensity*decay;\n        lightDiffuse += lgt.color*d;\n\n        vec3 halfDir = normalize( V - direction );\n        float s = pow( clamp( dot( N, halfDir ), 0.0, 1.0 ), u_shininess ) * lgt.intensity * decay;\n        lightSpecular += lgt.color * s;\n\n    }\n\n    #endif\n\n    #ifdef O3_SPOT_LIGHT_COUNT\n\n    for( int i = 0; i < O3_SPOT_LIGHT_COUNT; i++) {\n        SpotLight lgt = u_spotLights[ i ];\n        vec3 direction = v_pos - lgt.position;\n        float angle = acos( dot( normalize( direction ), normalize( lgt.direction ) ) );\n        float dist = length( direction );\n        direction /= dist;\n        float decay = pow( max( 0.0, 1.0 - dist / lgt.distance ), 2.0 );\n\n        float hasLight = step( angle, lgt.angle );\n        float hasPenumbra = step( lgt.angle, angle ) * step( angle, lgt.angle * ( 1.0 + lgt.penumbra ) );\n        float penumbra = hasPenumbra * ( 1.0 - ( angle - lgt.angle ) / ( lgt.angle * lgt.penumbra ) );\n        float d = max( dot( N, -direction ), 0.0 ) * lgt.intensity * decay * ( penumbra + hasLight );\n        lightDiffuse += lgt.color * d;\n\n        vec3 halfDir = normalize( V - direction );\n        float s = pow( clamp( dot( N, halfDir ), 0.0, 1.0 ), u_shininess ) * lgt.intensity * decay * ( penumbra + hasLight );\n        lightSpecular += lgt.color * s;\n\n    }\n\n    #endif\n\n    diffuse *= vec4( lightDiffuse, 1.0 );\n    specular *= vec4( lightSpecular, 1.0 );\n",mobile_lambert_frag:"    vec3 totalLight = vec3(0.0, 0.0, 0.0);\n    #ifdef O3_DIRECT_LIGHT_COUNT\n    for( int i = 0; i < O3_DIRECT_LIGHT_COUNT; i++ ){\n        vec3 lightColor = u_directLights[ i ].color * u_directLights[ i ].intensity;\n        lightColor *= max( dot( N, -u_directLights[ i ].direction ), 0.0 );\n\n        totalLight += lightColor;\n    }\n    #endif\n    diffuse *= vec4( totalLight, 1.0 );\n",noise_common:"// Modulo 289 without a division (only multiplications)\nvec4 mod289( vec4 x ) {\n\n    return x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nvec3 mod289( vec3 x ) {\n\n    return x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nvec2 mod289( vec2 x ) {\n\n    return x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\nfloat mod289( float x ) {\n\n    return x - floor( x * ( 1.0 / 289.0 ) ) * 289.0;\n\n}\n\n// Modulo 7 without a division\nvec4 mod7( vec4 x ) {\n\n    return x - floor( x * ( 1.0 / 7.0 ) ) * 7.0;\n\n}\n\nvec3 mod7( vec3 x ) {\n\n    return x - floor( x * ( 1.0 / 7.0 ) ) * 7.0;\n\n}\n\n// Permutation polynomial: (34x^2 + x) mod 289\nvec4 permute( vec4 x ) {\n\n    return mod289( ( 34.0 * x + 1.0 ) * x);\n\n}\n\nvec3 permute( vec3 x ) {\n\n    return mod289( ( 34.0 * x + 1.0 ) * x );\n\n}\n\nfloat permute( float x ) {\n\n  return mod289( ( ( x * 34.0 ) + 1.0 ) * x );\n\n}\n\nvec4 taylorInvSqrt( vec4 r ) {\n\n    return 1.79284291400159 - 0.85373472095314 * r;\n\n}\n\nfloat taylorInvSqrt( float r ) {\n\n    return 1.79284291400159 - 0.85373472095314 * r;\n\n}\n\nvec4 fade( vec4 t ) {\n\n    return t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n\nvec3 fade( vec3 t ) {\n\n    return t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n\nvec2 fade( vec2 t ) {\n\n    return t * t * t * ( t * ( t * 6.0 - 15.0 ) + 10.0 );\n\n}\n\n#define K 0.142857142857 // 1/7\n#define Ko 0.428571428571 // 1/2-K/2\n#define K2 0.020408163265306 // 1/(7*7)\n#define Kd2 0.0714285714285 // K/2\n#define Kz 0.166666666667 // 1/6\n#define Kzo 0.416666666667 // 1/2-1/6*2\n#define jitter 1.0 // smaller jitter gives more regular pattern\n#define jitter1 0.8 // smaller jitter gives less errors in F1 F2\n",noise_cellular_2D:'\n// Cellular noise ("Worley noise") in 2D in GLSL.\n// Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.\n// This code is released under the conditions of the MIT license.\n// See LICENSE file for details.\n// https://github.com/stegu/webgl-noise\n\n// Cellular noise, returning F1 and F2 in a vec2.\n// Standard 3x3 search window for good F1 and F2 values\nvec2 cellular( vec2 P ) {\n\n\tvec2 Pi = mod289( floor( P ) );\n \tvec2 Pf = fract( P );\n\tvec3 oi = vec3( -1.0, 0.0, 1.0);\n\tvec3 of = vec3( -0.5, 0.5, 1.5);\n\tvec3 px = permute( Pi.x + oi );\n\tvec3 p = permute( px.x + Pi.y + oi ); // p11, p12, p13\n\tvec3 ox = fract( p * K ) - Ko;\n\tvec3 oy = mod7( floor( p * K ) ) * K - Ko;\n\tvec3 dx = Pf.x + 0.5 + jitter * ox;\n\tvec3 dy = Pf.y - of + jitter * oy;\n\tvec3 d1 = dx * dx + dy * dy; // d11, d12 and d13, squared\n\tp = permute( px.y + Pi.y + oi ); // p21, p22, p23\n\tox = fract( p * K ) - Ko;\n\toy = mod7( floor( p * K ) ) * K - Ko;\n\tdx = Pf.x - 0.5 + jitter * ox;\n\tdy = Pf.y - of + jitter * oy;\n\tvec3 d2 = dx * dx + dy * dy; // d21, d22 and d23, squared\n\tp = permute( px.z + Pi.y + oi ); // p31, p32, p33\n\tox = fract( p * K ) - Ko;\n\toy = mod7( floor( p * K ) ) * K - Ko;\n\tdx = Pf.x - 1.5 + jitter * ox;\n\tdy = Pf.y - of + jitter * oy;\n\tvec3 d3 = dx * dx + dy * dy; // d31, d32 and d33, squared\n\t// Sort out the two smallest distances (F1, F2)\n\tvec3 d1a = min( d1, d2 );\n\td2 = max( d1, d2 ); // Swap to keep candidates for F2\n\td2 = min( d2, d3 ); // neither F1 nor F2 are now in d3\n\td1 = min( d1a, d2 ); // F1 is now in d1\n\td2 = max( d1a, d2 ); // Swap to keep candidates for F2\n\td1.xy = ( d1.x < d1.y ) ? d1.xy : d1.yx; // Swap if smaller\n\td1.xz = ( d1.x < d1.z ) ? d1.xz : d1.zx; // F1 is in d1.x\n\td1.yz = min( d1.yz, d2.yz ); // F2 is now not in d2.yz\n\td1.y = min( d1.y, d1.z ); // nor in  d1.z\n\td1.y = min( d1.y, d2.x ); // F2 is in d1.y, we\'re done.\n\treturn sqrt( d1.xy );\n\n}\n',noise_cellular_2x2:'\n// Cellular noise ("Worley noise") in 2D in GLSL.\n// Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.\n// This code is released under the conditions of the MIT license.\n// See LICENSE file for details.\n// https://github.com/stegu/webgl-noise\n\n// Cellular noise, returning F1 and F2 in a vec2.\n// Speeded up by using 2x2 search window instead of 3x3,\n// at the expense of some strong pattern artifacts.\n// F2 is often wrong and has sharp discontinuities.\n// If you need a smooth F2, use the slower 3x3 version.\n// F1 is sometimes wrong, too, but OK for most purposes.\nvec2 cellular2x2( vec2 P ) {\n\n\tvec2 Pi = mod289( floor( P ) );\n \tvec2 Pf = fract( P );\n\tvec4 Pfx = Pf.x + vec4( -0.5, -1.5, -0.5, -1.5 );\n\tvec4 Pfy = Pf.y + vec4( -0.5, -0.5, -1.5, -1.5 );\n\tvec4 p = permute( Pi.x + vec4( 0.0, 1.0, 0.0, 1.0 ) );\n\tp = permute( p + Pi.y + vec4( 0.0, 0.0, 1.0, 1.0 ) );\n\tvec4 ox = mod7( p ) * K + Kd2;\n\tvec4 oy = mod7( floor( p * K ) ) * K + Kd2;\n\tvec4 dx = Pfx + jitter1 * ox;\n\tvec4 dy = Pfy + jitter1 * oy;\n\tvec4 d = dx * dx + dy * dy; // d11, d12, d21 and d22, squared\n\n\t// Do it right and find both F1 and F2\n\td.xy = ( d.x < d.y ) ? d.xy : d.yx; // Swap if smaller\n\td.xz = ( d.x < d.z ) ? d.xz : d.zx;\n\td.xw = ( d.x < d.w ) ? d.xw : d.wx;\n\td.y = min( d.y, d.z );\n\td.y = min( d.y, d.w );\n\treturn sqrt( d.xy );\n\n}\n',noise_cellular_2x2x2:'\n// Cellular noise ("Worley noise") in 3D in GLSL.\n// Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.\n// This code is released under the conditions of the MIT license.\n// See LICENSE file for details.\n// https://github.com/stegu/webgl-noise\n\n// Cellular noise, returning F1 and F2 in a vec2.\n// Speeded up by using 2x2x2 search window instead of 3x3x3,\n// at the expense of some pattern artifacts.\n// F2 is often wrong and has sharp discontinuities.\n// If you need a good F2, use the slower 3x3x3 version.\nvec2 cellular2x2x2(vec3 P) {\n\n\tvec3 Pi = mod289( floor( P ) );\n \tvec3 Pf = fract( P );\n\tvec4 Pfx = Pf.x + vec4( 0.0, -1.0, 0.0, -1.0 );\n\tvec4 Pfy = Pf.y + vec4( 0.0, 0.0, -1.0, -1.0 );\n\tvec4 p = permute( Pi.x + vec4( 0.0, 1.0, 0.0, 1.0 ) );\n\tp = permute( p + Pi.y + vec4( 0.0, 0.0, 1.0, 1.0 ) );\n\tvec4 p1 = permute( p + Pi.z ); // z+0\n\tvec4 p2 = permute( p + Pi.z + vec4( 1.0 ) ); // z+1\n\tvec4 ox1 = fract( p1 * K ) - Ko;\n\tvec4 oy1 = mod7( floor( p1 * K ) ) * K - Ko;\n\tvec4 oz1 = floor( p1 * K2 ) * Kz - Kzo; // p1 < 289 guaranteed\n\tvec4 ox2 = fract( p2 * K ) - Ko;\n\tvec4 oy2 = mod7( floor( p2 * K ) ) * K - Ko;\n\tvec4 oz2 = floor( p2 * K2 ) * Kz - Kzo;\n\tvec4 dx1 = Pfx + jitter1 * ox1;\n\tvec4 dy1 = Pfy + jitter1 * oy1;\n\tvec4 dz1 = Pf.z + jitter1 * oz1;\n\tvec4 dx2 = Pfx + jitter1 * ox2;\n\tvec4 dy2 = Pfy + jitter1 * oy2;\n\tvec4 dz2 = Pf.z - 1.0 + jitter1 * oz2;\n\tvec4 d1 = dx1 * dx1 + dy1 * dy1 + dz1 * dz1; // z+0\n\tvec4 d2 = dx2 * dx2 + dy2 * dy2 + dz2 * dz2; // z+1\n\n\t// Do it right and sort out both F1 and F2\n\tvec4 d = min( d1, d2 ); // F1 is now in d\n\td2 = max( d1, d2 ); // Make sure we keep all candidates for F2\n\td.xy = ( d.x < d.y ) ? d.xy : d.yx; // Swap smallest to d.x\n\td.xz = ( d.x < d.z ) ? d.xz : d.zx;\n\td.xw = ( d.x < d.w ) ? d.xw : d.wx; // F1 is now in d.x\n\td.yzw = min( d.yzw, d2.yzw ); // F2 now not in d2.yzw\n\td.y = min( d.y, d.z ); // nor in d.z\n\td.y = min( d.y, d.w ); // nor in d.w\n\td.y = min( d.y, d2.x ); // F2 is now in d.y\n\treturn sqrt( d.xy ); // F1 and F2\n\n}\n',noise_cellular_3D:'\n// Cellular noise ("Worley noise") in 3D in GLSL.\n// Copyright (c) Stefan Gustavson 2011-04-19. All rights reserved.\n// This code is released under the conditions of the MIT license.\n// See LICENSE file for details.\n// https://github.com/stegu/webgl-noise\n\n// Cellular noise, returning F1 and F2 in a vec2.\n// 3x3x3 search region for good F2 everywhere, but a lot\n// slower than the 2x2x2 version.\n// The code below is a bit scary even to its author,\n// but it has at least half decent performance on a\n// modern GPU. In any case, it beats any software\n// implementation of Worley noise hands down.\n\nvec2 cellular( vec3 P ) {\n\n\tvec3 Pi = mod289( floor( P ) );\n \tvec3 Pf = fract( P ) - 0.5;\n\n\tvec3 Pfx = Pf.x + vec3( 1.0, 0.0, -1.0 );\n\tvec3 Pfy = Pf.y + vec3( 1.0, 0.0, -1.0 );\n\tvec3 Pfz = Pf.z + vec3( 1.0, 0.0, -1.0 );\n\n\tvec3 p = permute( Pi.x + vec3( -1.0, 0.0, 1.0 ) );\n\tvec3 p1 = permute( p + Pi.y - 1.0 );\n\tvec3 p2 = permute( p + Pi.y );\n\tvec3 p3 = permute( p + Pi.y + 1.0 );\n\n\tvec3 p11 = permute( p1 + Pi.z - 1.0 );\n\tvec3 p12 = permute( p1 + Pi.z );\n\tvec3 p13 = permute( p1 + Pi.z + 1.0 );\n\n\tvec3 p21 = permute( p2 + Pi.z - 1.0 );\n\tvec3 p22 = permute( p2 + Pi.z );\n\tvec3 p23 = permute( p2 + Pi.z + 1.0 );\n\n\tvec3 p31 = permute( p3 + Pi.z - 1.0 );\n\tvec3 p32 = permute( p3 + Pi.z );\n\tvec3 p33 = permute( p3 + Pi.z + 1.0 );\n\n\tvec3 ox11 = fract( p11 * K ) - Ko;\n\tvec3 oy11 = mod7( floor( p11 * K ) ) * K - Ko;\n\tvec3 oz11 = floor( p11 * K2 ) * Kz - Kzo; // p11 < 289 guaranteed\n\n\tvec3 ox12 = fract( p12 * K ) - Ko;\n\tvec3 oy12 = mod7( floor( p12 * K ) ) * K - Ko;\n\tvec3 oz12 = floor( p12 * K2 ) * Kz - Kzo;\n\n\tvec3 ox13 = fract( p13 * K ) - Ko;\n\tvec3 oy13 = mod7( floor( p13 * K ) ) * K - Ko;\n\tvec3 oz13 = floor( p13 * K2 ) * Kz - Kzo;\n\n\tvec3 ox21 = fract( p21 * K ) - Ko;\n\tvec3 oy21 = mod7( floor( p21 * K ) ) * K - Ko;\n\tvec3 oz21 = floor( p21 * K2 ) * Kz - Kzo;\n\n\tvec3 ox22 = fract( p22 * K ) - Ko;\n\tvec3 oy22 = mod7( floor( p22 * K ) ) * K - Ko;\n\tvec3 oz22 = floor( p22 * K2 ) * Kz - Kzo;\n\n\tvec3 ox23 = fract( p23 * K ) - Ko;\n\tvec3 oy23 = mod7( floor( p23 * K ) ) * K - Ko;\n\tvec3 oz23 = floor( p23 * K2 ) * Kz - Kzo;\n\n\tvec3 ox31 = fract( p31 * K ) - Ko;\n\tvec3 oy31 = mod7( floor( p31 * K ) ) * K - Ko;\n\tvec3 oz31 = floor( p31 * K2 ) * Kz - Kzo;\n\n\tvec3 ox32 = fract( p32 * K ) - Ko;\n\tvec3 oy32 = mod7( floor( p32 * K ) ) * K - Ko;\n\tvec3 oz32 = floor( p32 * K2 ) * Kz - Kzo;\n\n\tvec3 ox33 = fract( p33 * K ) - Ko;\n\tvec3 oy33 = mod7( floor( p33 * K ) ) * K - Ko;\n\tvec3 oz33 = floor( p33 * K2 ) * Kz - Kzo;\n\n\tvec3 dx11 = Pfx + jitter * ox11;\n\tvec3 dy11 = Pfy.x + jitter * oy11;\n\tvec3 dz11 = Pfz.x + jitter * oz11;\n\n\tvec3 dx12 = Pfx + jitter * ox12;\n\tvec3 dy12 = Pfy.x + jitter * oy12;\n\tvec3 dz12 = Pfz.y + jitter * oz12;\n\n\tvec3 dx13 = Pfx + jitter * ox13;\n\tvec3 dy13 = Pfy.x + jitter * oy13;\n\tvec3 dz13 = Pfz.z + jitter * oz13;\n\n\tvec3 dx21 = Pfx + jitter * ox21;\n\tvec3 dy21 = Pfy.y + jitter * oy21;\n\tvec3 dz21 = Pfz.x + jitter * oz21;\n\n\tvec3 dx22 = Pfx + jitter * ox22;\n\tvec3 dy22 = Pfy.y + jitter * oy22;\n\tvec3 dz22 = Pfz.y + jitter * oz22;\n\n\tvec3 dx23 = Pfx + jitter * ox23;\n\tvec3 dy23 = Pfy.y + jitter * oy23;\n\tvec3 dz23 = Pfz.z + jitter * oz23;\n\n\tvec3 dx31 = Pfx + jitter * ox31;\n\tvec3 dy31 = Pfy.z + jitter * oy31;\n\tvec3 dz31 = Pfz.x + jitter * oz31;\n\n\tvec3 dx32 = Pfx + jitter * ox32;\n\tvec3 dy32 = Pfy.z + jitter * oy32;\n\tvec3 dz32 = Pfz.y + jitter * oz32;\n\n\tvec3 dx33 = Pfx + jitter * ox33;\n\tvec3 dy33 = Pfy.z + jitter * oy33;\n\tvec3 dz33 = Pfz.z + jitter * oz33;\n\n\tvec3 d11 = dx11 * dx11 + dy11 * dy11 + dz11 * dz11;\n\tvec3 d12 = dx12 * dx12 + dy12 * dy12 + dz12 * dz12;\n\tvec3 d13 = dx13 * dx13 + dy13 * dy13 + dz13 * dz13;\n\tvec3 d21 = dx21 * dx21 + dy21 * dy21 + dz21 * dz21;\n\tvec3 d22 = dx22 * dx22 + dy22 * dy22 + dz22 * dz22;\n\tvec3 d23 = dx23 * dx23 + dy23 * dy23 + dz23 * dz23;\n\tvec3 d31 = dx31 * dx31 + dy31 * dy31 + dz31 * dz31;\n\tvec3 d32 = dx32 * dx32 + dy32 * dy32 + dz32 * dz32;\n\tvec3 d33 = dx33 * dx33 + dy33 * dy33 + dz33 * dz33;\n\n\t// Do it right and sort out both F1 and F2\n\tvec3 d1a = min( d11, d12 );\n\td12 = max( d11, d12 );\n\td11 = min( d1a, d13 ); // Smallest now not in d12 or d13\n\td13 = max( d1a, d13 );\n\td12 = min( d12, d13 ); // 2nd smallest now not in d13\n\tvec3 d2a = min( d21, d22 );\n\td22 = max( d21, d22 );\n\td21 = min( d2a, d23 ); // Smallest now not in d22 or d23\n\td23 = max( d2a, d23 );\n\td22 = min( d22, d23 ); // 2nd smallest now not in d23\n\tvec3 d3a = min( d31, d32 );\n\td32 = max( d31, d32 );\n\td31 = min( d3a, d33 ); // Smallest now not in d32 or d33\n\td33 = max( d3a, d33 );\n\td32 = min( d32, d33 ); // 2nd smallest now not in d33\n\tvec3 da = min( d11, d21 );\n\td21 = max( d11, d21 );\n\td11 = min( da, d31 ); // Smallest now in d11\n\td31 = max( da, d31 ); // 2nd smallest now not in d31\n\td11.xy = ( d11.x < d11.y ) ? d11.xy : d11.yx;\n\td11.xz = ( d11.x < d11.z ) ? d11.xz : d11.zx; // d11.x now smallest\n\td12 = min( d12, d21 ); // 2nd smallest now not in d21\n\td12 = min( d12, d22 ); // nor in d22\n\td12 = min( d12, d31 ); // nor in d31\n\td12 = min( d12, d32 ); // nor in d32\n\td11.yz = min( d11.yz, d12.xy ); // nor in d12.yz\n\td11.y = min( d11.y, d12.z ); // Only two more to go\n\td11.y = min( d11.y, d11.z ); // Done! (Phew! )\n\treturn sqrt( d11.xy ); // F1, F2\n\n}\n',noise_cellular:"#include <noise_cellular_2D>\n#include <noise_cellular_3D>\n#include <noise_cellular_2x2>\n#include <noise_cellular_2x2x2>\n",noise_perlin_2D:'//\n// GLSL textureless classic 2D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n// Classic Perlin noise\nfloat perlin( vec2 P ) {\n\n    vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n    vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n    Pi = mod289(Pi); // To avoid truncation effects in permutation\n    vec4 ix = Pi.xzxz;\n    vec4 iy = Pi.yyww;\n    vec4 fx = Pf.xzxz;\n    vec4 fy = Pf.yyww;\n\n    vec4 i = permute(permute(ix) + iy);\n\n    vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n    vec4 gy = abs(gx) - 0.5 ;\n    vec4 tx = floor(gx + 0.5);\n    gx = gx - tx;\n\n    vec2 g00 = vec2(gx.x,gy.x);\n    vec2 g10 = vec2(gx.y,gy.y);\n    vec2 g01 = vec2(gx.z,gy.z);\n    vec2 g11 = vec2(gx.w,gy.w);\n\n    vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n    g00 *= norm.x;\n    g01 *= norm.y;\n    g10 *= norm.z;\n    g11 *= norm.w;\n\n    float n00 = dot(g00, vec2(fx.x, fy.x));\n    float n10 = dot(g10, vec2(fx.y, fy.y));\n    float n01 = dot(g01, vec2(fx.z, fy.z));\n    float n11 = dot(g11, vec2(fx.w, fy.w));\n\n    vec2 fade_xy = fade(Pf.xy);\n    vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n    float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n    return 2.3 * n_xy;\n\n}\n\n// Classic Perlin noise, periodic variant\nfloat perlin( vec2 P, vec2 rep ) {\n\n    vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n    vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n    Pi = mod(Pi, rep.xyxy); // To create noise with explicit period\n    Pi = mod289(Pi);        // To avoid truncation effects in permutation\n    vec4 ix = Pi.xzxz;\n    vec4 iy = Pi.yyww;\n    vec4 fx = Pf.xzxz;\n    vec4 fy = Pf.yyww;\n\n    vec4 i = permute(permute(ix) + iy);\n\n    vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n    vec4 gy = abs(gx) - 0.5 ;\n    vec4 tx = floor(gx + 0.5);\n    gx = gx - tx;\n\n    vec2 g00 = vec2(gx.x,gy.x);\n    vec2 g10 = vec2(gx.y,gy.y);\n    vec2 g01 = vec2(gx.z,gy.z);\n    vec2 g11 = vec2(gx.w,gy.w);\n\n    vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n    g00 *= norm.x;\n    g01 *= norm.y;\n    g10 *= norm.z;\n    g11 *= norm.w;\n\n    float n00 = dot(g00, vec2(fx.x, fy.x));\n    float n10 = dot(g10, vec2(fx.y, fy.y));\n    float n01 = dot(g01, vec2(fx.z, fy.z));\n    float n11 = dot(g11, vec2(fx.w, fy.w));\n\n    vec2 fade_xy = fade(Pf.xy);\n    vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n    float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n    return 2.3 * n_xy;\n\n}\n',noise_perlin_3D:'//\n// GLSL textureless classic 3D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-10-11\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n// Classic Perlin noise\nfloat perlin( vec3 P ) {\n\n    vec3 Pi0 = floor(P); // Integer part for indexing\n    vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = Pi0.zzzz;\n    vec4 iz1 = Pi1.zzzz;\n\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n\n    vec4 gx0 = ixy0 * (1.0 / 7.0);\n    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n    vec4 sz0 = step(gz0, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n    vec4 gx1 = ixy1 * (1.0 / 7.0);\n    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n    vec4 sz1 = step(gz1, vec4(0.0));\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n    vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n    vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n    vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n    vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n    vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n    vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n    vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n    vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n\n    float n000 = dot(g000, Pf0);\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n    float n111 = dot(g111, Pf1);\n\n    vec3 fade_xyz = fade(Pf0);\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n\n}\n\n// Classic Perlin noise, periodic variant\nfloat perlin( vec3 P, vec3 rep ) {\n\n    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = Pi0.zzzz;\n    vec4 iz1 = Pi1.zzzz;\n\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n\n    vec4 gx0 = ixy0 * (1.0 / 7.0);\n    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n    vec4 sz0 = step(gz0, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n    vec4 gx1 = ixy1 * (1.0 / 7.0);\n    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n    vec4 sz1 = step(gz1, vec4(0.0));\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n    vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n    vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n    vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n    vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n    vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n    vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n    vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n    vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n\n    float n000 = dot(g000, Pf0);\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n    float n111 = dot(g111, Pf1);\n\n    vec3 fade_xyz = fade(Pf0);\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n\n}\n',noise_perlin_4D:'//\n// GLSL textureless classic 4D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n// Classic Perlin noise\nfloat perlin( vec4 P ) {\n\n    vec4 Pi0 = floor(P); // Integer part for indexing\n    vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec4 Pf0 = fract(P); // Fractional part for interpolation\n    vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = vec4(Pi0.zzzz);\n    vec4 iz1 = vec4(Pi1.zzzz);\n    vec4 iw0 = vec4(Pi0.wwww);\n    vec4 iw1 = vec4(Pi1.wwww);\n\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n    vec4 ixy00 = permute(ixy0 + iw0);\n    vec4 ixy01 = permute(ixy0 + iw1);\n    vec4 ixy10 = permute(ixy1 + iw0);\n    vec4 ixy11 = permute(ixy1 + iw1);\n\n    vec4 gx00 = ixy00 * (1.0 / 7.0);\n    vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n    vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n    gx00 = fract(gx00) - 0.5;\n    gy00 = fract(gy00) - 0.5;\n    gz00 = fract(gz00) - 0.5;\n    vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n    vec4 sw00 = step(gw00, vec4(0.0));\n    gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n    gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n    vec4 gx01 = ixy01 * (1.0 / 7.0);\n    vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n    vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n    gx01 = fract(gx01) - 0.5;\n    gy01 = fract(gy01) - 0.5;\n    gz01 = fract(gz01) - 0.5;\n    vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n    vec4 sw01 = step(gw01, vec4(0.0));\n    gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n    gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n    vec4 gx10 = ixy10 * (1.0 / 7.0);\n    vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n    vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n    gx10 = fract(gx10) - 0.5;\n    gy10 = fract(gy10) - 0.5;\n    gz10 = fract(gz10) - 0.5;\n    vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n    vec4 sw10 = step(gw10, vec4(0.0));\n    gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n    gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n    vec4 gx11 = ixy11 * (1.0 / 7.0);\n    vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n    vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n    gx11 = fract(gx11) - 0.5;\n    gy11 = fract(gy11) - 0.5;\n    gz11 = fract(gz11) - 0.5;\n    vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n    vec4 sw11 = step(gw11, vec4(0.0));\n    gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n    gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n    vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n    vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n    vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n    vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n    vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n    vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n    vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n    vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n    vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n    vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n    vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n    vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n    vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n    vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n    vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n    vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n    vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n    g0000 *= norm00.x;\n    g0100 *= norm00.y;\n    g1000 *= norm00.z;\n    g1100 *= norm00.w;\n\n    vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n    g0001 *= norm01.x;\n    g0101 *= norm01.y;\n    g1001 *= norm01.z;\n    g1101 *= norm01.w;\n\n    vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n    g0010 *= norm10.x;\n    g0110 *= norm10.y;\n    g1010 *= norm10.z;\n    g1110 *= norm10.w;\n\n    vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n    g0011 *= norm11.x;\n    g0111 *= norm11.y;\n    g1011 *= norm11.z;\n    g1111 *= norm11.w;\n\n    float n0000 = dot(g0000, Pf0);\n    float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n    float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n    float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n    float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n    float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n    float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n    float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n    float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n    float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n    float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n    float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n    float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n    float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n    float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n    float n1111 = dot(g1111, Pf1);\n\n    vec4 fade_xyzw = fade(Pf0);\n    vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n    vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n    vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n    vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n    float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n    return 2.2 * n_xyzw;\n\n}\n\n// Classic Perlin noise, periodic version\nfloat perlin( vec4 P, vec4 rep ) {\n\n    vec4 Pi0 = mod(floor(P), rep); // Integer part modulo rep\n    vec4 Pi1 = mod(Pi0 + 1.0, rep); // Integer part + 1 mod rep\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec4 Pf0 = fract(P); // Fractional part for interpolation\n    vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = vec4(Pi0.zzzz);\n    vec4 iz1 = vec4(Pi1.zzzz);\n    vec4 iw0 = vec4(Pi0.wwww);\n    vec4 iw1 = vec4(Pi1.wwww);\n\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n    vec4 ixy00 = permute(ixy0 + iw0);\n    vec4 ixy01 = permute(ixy0 + iw1);\n    vec4 ixy10 = permute(ixy1 + iw0);\n    vec4 ixy11 = permute(ixy1 + iw1);\n\n    vec4 gx00 = ixy00 * (1.0 / 7.0);\n    vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n    vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n    gx00 = fract(gx00) - 0.5;\n    gy00 = fract(gy00) - 0.5;\n    gz00 = fract(gz00) - 0.5;\n    vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n    vec4 sw00 = step(gw00, vec4(0.0));\n    gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n    gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n    vec4 gx01 = ixy01 * (1.0 / 7.0);\n    vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n    vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n    gx01 = fract(gx01) - 0.5;\n    gy01 = fract(gy01) - 0.5;\n    gz01 = fract(gz01) - 0.5;\n    vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n    vec4 sw01 = step(gw01, vec4(0.0));\n    gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n    gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n    vec4 gx10 = ixy10 * (1.0 / 7.0);\n    vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n    vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n    gx10 = fract(gx10) - 0.5;\n    gy10 = fract(gy10) - 0.5;\n    gz10 = fract(gz10) - 0.5;\n    vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n    vec4 sw10 = step(gw10, vec4(0.0));\n    gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n    gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n    vec4 gx11 = ixy11 * (1.0 / 7.0);\n    vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n    vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n    gx11 = fract(gx11) - 0.5;\n    gy11 = fract(gy11) - 0.5;\n    gz11 = fract(gz11) - 0.5;\n    vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n    vec4 sw11 = step(gw11, vec4(0.0));\n    gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n    gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n    vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n    vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n    vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n    vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n    vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n    vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n    vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n    vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n    vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n    vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n    vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n    vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n    vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n    vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n    vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n    vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n    vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n    g0000 *= norm00.x;\n    g0100 *= norm00.y;\n    g1000 *= norm00.z;\n    g1100 *= norm00.w;\n\n    vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n    g0001 *= norm01.x;\n    g0101 *= norm01.y;\n    g1001 *= norm01.z;\n    g1101 *= norm01.w;\n\n    vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n    g0010 *= norm10.x;\n    g0110 *= norm10.y;\n    g1010 *= norm10.z;\n    g1110 *= norm10.w;\n\n    vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n    g0011 *= norm11.x;\n    g0111 *= norm11.y;\n    g1011 *= norm11.z;\n    g1111 *= norm11.w;\n\n    float n0000 = dot(g0000, Pf0);\n    float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n    float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n    float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n    float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n    float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n    float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n    float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n    float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n    float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n    float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n    float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n    float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n    float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n    float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n    float n1111 = dot(g1111, Pf1);\n\n    vec4 fade_xyzw = fade(Pf0);\n    vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n    vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n    vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n    vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n    float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n    return 2.2 * n_xyzw;\n\n}\n',noise_perlin:"#include <noise_perlin_2D>\n#include <noise_perlin_3D>\n#include <noise_perlin_4D>\n",noise_psrd_2D:'// Periodic (tiling) 2-D simplex noise (hexagonal lattice gradient noise)\n// with rotating gradients and analytic derivatives.\n// Variants also without the derivative (no "d" in the name), without\n// the tiling property (no "p" in the name) and without the rotating\n// gradients (no "r" in the name).\n//\n// This is (yet) another variation on simplex noise. It\'s similar to the\n// version presented by Ken Perlin, but the grid is axis-aligned and\n// slightly stretched in the y direction to permit rectangular tiling.\n//\n// The noise can be made to tile seamlessly to any integer period in x and\n// any even integer period in y. Odd periods may be specified for y, but\n// then the actual tiling period will be twice that number.\n//\n// The rotating gradients give the appearance of a swirling motion, and can\n// serve a similar purpose for animation as motion along z in 3-D noise.\n// The rotating gradients in conjunction with the analytic derivatives\n// can make "flow noise" effects as presented by Perlin and Neyret.\n//\n// vec3 {p}s{r}dnoise(vec2 pos {, vec2 per} {, float rot})\n// "pos" is the input (x,y) coordinate\n// "per" is the x and y period, where per.x is a positive integer\n//    and per.y is a positive even integer\n// "rot" is the angle to rotate the gradients (any float value,\n//    where 0.0 is no rotation and 1.0 is one full turn)\n// The first component of the 3-element return vector is the noise value.\n// The second and third components are the x and y partial derivatives.\n//\n// float {p}s{r}noise(vec2 pos {, vec2 per} {, float rot})\n// "pos" is the input (x,y) coordinate\n// "per" is the x and y period, where per.x is a positive integer\n//    and per.y is a positive even integer\n// "rot" is the angle to rotate the gradients (any float value,\n//    where 0.0 is no rotation and 1.0 is one full turn)\n// The return value is the noise value.\n// Partial derivatives are not computed, making these functions faster.\n//\n// Author: Stefan Gustavson (stefan.gustavson@gmail.com)\n// Version 2016-05-10.\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// idea of using a permutation polynomial.\n//\n// Copyright (c) 2016 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/stegu/webgl-noise\n//\n\n// Hashed 2-D gradients with an extra rotation.\n// (The constant 0.0243902439 is 1/41)\nvec2 rgrad2( vec2 p, float rot ) {\n\n    // For more isotropic gradients, sin/cos can be used instead.\n    float u = permute( permute( p.x ) + p.y ) * 0.0243902439 + rot; // Rotate by shift\n    u = fract( u ) * 6.28318530718; // 2*pi\n    return vec2( cos( u ), sin( u ));\n\n}\n\n//\n// 2-D tiling simplex noise with rotating gradients and analytical derivative.\n// The first component of the 3-element return vector is the noise value,\n// and the second and third components are the x and y partial derivatives.\n//\nvec3 psrdnoise(vec2 pos, vec2 per, float rot) {\n  // Hack: offset y slightly to hide some rare artifacts\n  pos.y += 0.01;\n  // Skew to hexagonal grid\n  vec2 uv = vec2(pos.x + pos.y*0.5, pos.y);\n\n  vec2 i0 = floor(uv);\n  vec2 f0 = fract(uv);\n  // Traversal order\n  vec2 i1 = (f0.x > f0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\n  // Unskewed grid points in (x,y) space\n  vec2 p0 = vec2(i0.x - i0.y * 0.5, i0.y);\n  vec2 p1 = vec2(p0.x + i1.x - i1.y * 0.5, p0.y + i1.y);\n  vec2 p2 = vec2(p0.x + 0.5, p0.y + 1.0);\n\n  // Integer grid point indices in (u,v) space\n  i1 = i0 + i1;\n  vec2 i2 = i0 + vec2(1.0, 1.0);\n\n  // Vectors in unskewed (x,y) coordinates from\n  // each of the simplex corners to the evaluation point\n  vec2 d0 = pos - p0;\n  vec2 d1 = pos - p1;\n  vec2 d2 = pos - p2;\n\n  // Wrap i0, i1 and i2 to the desired period before gradient hashing:\n  // wrap points in (x,y), map to (u,v)\n  vec3 xw = mod(vec3(p0.x, p1.x, p2.x), per.x);\n  vec3 yw = mod(vec3(p0.y, p1.y, p2.y), per.y);\n  vec3 iuw = xw + 0.5 * yw;\n  vec3 ivw = yw;\n\n  // Create gradients from indices\n  vec2 g0 = rgrad2(vec2(iuw.x, ivw.x), rot);\n  vec2 g1 = rgrad2(vec2(iuw.y, ivw.y), rot);\n  vec2 g2 = rgrad2(vec2(iuw.z, ivw.z), rot);\n\n  // Gradients dot vectors to corresponding corners\n  // (The derivatives of this are simply the gradients)\n  vec3 w = vec3(dot(g0, d0), dot(g1, d1), dot(g2, d2));\n\n  // Radial weights from corners\n  // 0.8 is the square of 2/sqrt(5), the distance from\n  // a grid point to the nearest simplex boundary\n  vec3 t = 0.8 - vec3(dot(d0, d0), dot(d1, d1), dot(d2, d2));\n\n  // Partial derivatives for analytical gradient computation\n  vec3 dtdx = -2.0 * vec3(d0.x, d1.x, d2.x);\n  vec3 dtdy = -2.0 * vec3(d0.y, d1.y, d2.y);\n\n  // Set influence of each surflet to zero outside radius sqrt(0.8)\n  if (t.x < 0.0) {\n    dtdx.x = 0.0;\n    dtdy.x = 0.0;\n\tt.x = 0.0;\n  }\n  if (t.y < 0.0) {\n    dtdx.y = 0.0;\n    dtdy.y = 0.0;\n\tt.y = 0.0;\n  }\n  if (t.z < 0.0) {\n    dtdx.z = 0.0;\n    dtdy.z = 0.0;\n\tt.z = 0.0;\n  }\n\n  // Fourth power of t (and third power for derivative)\n  vec3 t2 = t * t;\n  vec3 t4 = t2 * t2;\n  vec3 t3 = t2 * t;\n\n  // Final noise value is:\n  // sum of ((radial weights) times (gradient dot vector from corner))\n  float n = dot(t4, w);\n\n  // Final analytical derivative (gradient of a sum of scalar products)\n  vec2 dt0 = vec2(dtdx.x, dtdy.x) * 4.0 * t3.x;\n  vec2 dn0 = t4.x * g0 + dt0 * w.x;\n  vec2 dt1 = vec2(dtdx.y, dtdy.y) * 4.0 * t3.y;\n  vec2 dn1 = t4.y * g1 + dt1 * w.y;\n  vec2 dt2 = vec2(dtdx.z, dtdy.z) * 4.0 * t3.z;\n  vec2 dn2 = t4.z * g2 + dt2 * w.z;\n\n  return 11.0*vec3(n, dn0 + dn1 + dn2);\n}\n\n//\n// 2-D tiling simplex noise with fixed gradients\n// and analytical derivative.\n// This function is implemented as a wrapper to "psrdnoise",\n// at the minimal cost of three extra additions.\n//\nvec3 psdnoise(vec2 pos, vec2 per) {\n  return psrdnoise(pos, per, 0.0);\n}\n\n//\n// 2-D tiling simplex noise with rotating gradients,\n// but without the analytical derivative.\n//\nfloat psrnoise(vec2 pos, vec2 per, float rot) {\n  // Offset y slightly to hide some rare artifacts\n  pos.y += 0.001;\n  // Skew to hexagonal grid\n  vec2 uv = vec2(pos.x + pos.y*0.5, pos.y);\n\n  vec2 i0 = floor(uv);\n  vec2 f0 = fract(uv);\n  // Traversal order\n  vec2 i1 = (f0.x > f0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\n  // Unskewed grid points in (x,y) space\n  vec2 p0 = vec2(i0.x - i0.y * 0.5, i0.y);\n  vec2 p1 = vec2(p0.x + i1.x - i1.y * 0.5, p0.y + i1.y);\n  vec2 p2 = vec2(p0.x + 0.5, p0.y + 1.0);\n\n  // Integer grid point indices in (u,v) space\n  i1 = i0 + i1;\n  vec2 i2 = i0 + vec2(1.0, 1.0);\n\n  // Vectors in unskewed (x,y) coordinates from\n  // each of the simplex corners to the evaluation point\n  vec2 d0 = pos - p0;\n  vec2 d1 = pos - p1;\n  vec2 d2 = pos - p2;\n\n  // Wrap i0, i1 and i2 to the desired period before gradient hashing:\n  // wrap points in (x,y), map to (u,v)\n  vec3 xw = mod(vec3(p0.x, p1.x, p2.x), per.x);\n  vec3 yw = mod(vec3(p0.y, p1.y, p2.y), per.y);\n  vec3 iuw = xw + 0.5 * yw;\n  vec3 ivw = yw;\n\n  // Create gradients from indices\n  vec2 g0 = rgrad2(vec2(iuw.x, ivw.x), rot);\n  vec2 g1 = rgrad2(vec2(iuw.y, ivw.y), rot);\n  vec2 g2 = rgrad2(vec2(iuw.z, ivw.z), rot);\n\n  // Gradients dot vectors to corresponding corners\n  // (The derivatives of this are simply the gradients)\n  vec3 w = vec3(dot(g0, d0), dot(g1, d1), dot(g2, d2));\n\n  // Radial weights from corners\n  // 0.8 is the square of 2/sqrt(5), the distance from\n  // a grid point to the nearest simplex boundary\n  vec3 t = 0.8 - vec3(dot(d0, d0), dot(d1, d1), dot(d2, d2));\n\n  // Set influence of each surflet to zero outside radius sqrt(0.8)\n  t = max(t, 0.0);\n\n  // Fourth power of t\n  vec3 t2 = t * t;\n  vec3 t4 = t2 * t2;\n\n  // Final noise value is:\n  // sum of ((radial weights) times (gradient dot vector from corner))\n  float n = dot(t4, w);\n\n  // Rescale to cover the range [-1,1] reasonably well\n  return 11.0*n;\n}\n\n//\n// 2-D tiling simplex noise with fixed gradients,\n// without the analytical derivative.\n// This function is implemented as a wrapper to "psrnoise",\n// at the minimal cost of three extra additions.\n//\nfloat psnoise(vec2 pos, vec2 per) {\n  return psrnoise(pos, per, 0.0);\n}\n\n//\n// 2-D non-tiling simplex noise with rotating gradients and analytical derivative.\n// The first component of the 3-element return vector is the noise value,\n// and the second and third components are the x and y partial derivatives.\n//\nvec3 srdnoise(vec2 pos, float rot) {\n  // Offset y slightly to hide some rare artifacts\n  pos.y += 0.001;\n  // Skew to hexagonal grid\n  vec2 uv = vec2(pos.x + pos.y*0.5, pos.y);\n\n  vec2 i0 = floor(uv);\n  vec2 f0 = fract(uv);\n  // Traversal order\n  vec2 i1 = (f0.x > f0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\n  // Unskewed grid points in (x,y) space\n  vec2 p0 = vec2(i0.x - i0.y * 0.5, i0.y);\n  vec2 p1 = vec2(p0.x + i1.x - i1.y * 0.5, p0.y + i1.y);\n  vec2 p2 = vec2(p0.x + 0.5, p0.y + 1.0);\n\n  // Integer grid point indices in (u,v) space\n  i1 = i0 + i1;\n  vec2 i2 = i0 + vec2(1.0, 1.0);\n\n  // Vectors in unskewed (x,y) coordinates from\n  // each of the simplex corners to the evaluation point\n  vec2 d0 = pos - p0;\n  vec2 d1 = pos - p1;\n  vec2 d2 = pos - p2;\n\n  vec3 x = vec3(p0.x, p1.x, p2.x);\n  vec3 y = vec3(p0.y, p1.y, p2.y);\n  vec3 iuw = x + 0.5 * y;\n  vec3 ivw = y;\n\n  // Avoid precision issues in permutation\n  iuw = mod289(iuw);\n  ivw = mod289(ivw);\n\n  // Create gradients from indices\n  vec2 g0 = rgrad2(vec2(iuw.x, ivw.x), rot);\n  vec2 g1 = rgrad2(vec2(iuw.y, ivw.y), rot);\n  vec2 g2 = rgrad2(vec2(iuw.z, ivw.z), rot);\n\n  // Gradients dot vectors to corresponding corners\n  // (The derivatives of this are simply the gradients)\n  vec3 w = vec3(dot(g0, d0), dot(g1, d1), dot(g2, d2));\n\n  // Radial weights from corners\n  // 0.8 is the square of 2/sqrt(5), the distance from\n  // a grid point to the nearest simplex boundary\n  vec3 t = 0.8 - vec3(dot(d0, d0), dot(d1, d1), dot(d2, d2));\n\n  // Partial derivatives for analytical gradient computation\n  vec3 dtdx = -2.0 * vec3(d0.x, d1.x, d2.x);\n  vec3 dtdy = -2.0 * vec3(d0.y, d1.y, d2.y);\n\n  // Set influence of each surflet to zero outside radius sqrt(0.8)\n  if (t.x < 0.0) {\n    dtdx.x = 0.0;\n    dtdy.x = 0.0;\n\tt.x = 0.0;\n  }\n  if (t.y < 0.0) {\n    dtdx.y = 0.0;\n    dtdy.y = 0.0;\n\tt.y = 0.0;\n  }\n  if (t.z < 0.0) {\n    dtdx.z = 0.0;\n    dtdy.z = 0.0;\n\tt.z = 0.0;\n  }\n\n  // Fourth power of t (and third power for derivative)\n  vec3 t2 = t * t;\n  vec3 t4 = t2 * t2;\n  vec3 t3 = t2 * t;\n\n  // Final noise value is:\n  // sum of ((radial weights) times (gradient dot vector from corner))\n  float n = dot(t4, w);\n\n  // Final analytical derivative (gradient of a sum of scalar products)\n  vec2 dt0 = vec2(dtdx.x, dtdy.x) * 4.0 * t3.x;\n  vec2 dn0 = t4.x * g0 + dt0 * w.x;\n  vec2 dt1 = vec2(dtdx.y, dtdy.y) * 4.0 * t3.y;\n  vec2 dn1 = t4.y * g1 + dt1 * w.y;\n  vec2 dt2 = vec2(dtdx.z, dtdy.z) * 4.0 * t3.z;\n  vec2 dn2 = t4.z * g2 + dt2 * w.z;\n\n  return 11.0*vec3(n, dn0 + dn1 + dn2);\n}\n\n//\n// 2-D non-tiling simplex noise with fixed gradients and analytical derivative.\n// This function is implemented as a wrapper to "srdnoise",\n// at the minimal cost of three extra additions.\n//\nvec3 sdnoise(vec2 pos) {\n  return srdnoise(pos, 0.0);\n}\n\n//\n// 2-D non-tiling simplex noise with rotating gradients,\n// without the analytical derivative.\n//\nfloat srnoise(vec2 pos, float rot) {\n  // Offset y slightly to hide some rare artifacts\n  pos.y += 0.001;\n  // Skew to hexagonal grid\n  vec2 uv = vec2(pos.x + pos.y*0.5, pos.y);\n\n  vec2 i0 = floor(uv);\n  vec2 f0 = fract(uv);\n  // Traversal order\n  vec2 i1 = (f0.x > f0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\n  // Unskewed grid points in (x,y) space\n  vec2 p0 = vec2(i0.x - i0.y * 0.5, i0.y);\n  vec2 p1 = vec2(p0.x + i1.x - i1.y * 0.5, p0.y + i1.y);\n  vec2 p2 = vec2(p0.x + 0.5, p0.y + 1.0);\n\n  // Integer grid point indices in (u,v) space\n  i1 = i0 + i1;\n  vec2 i2 = i0 + vec2(1.0, 1.0);\n\n  // Vectors in unskewed (x,y) coordinates from\n  // each of the simplex corners to the evaluation point\n  vec2 d0 = pos - p0;\n  vec2 d1 = pos - p1;\n  vec2 d2 = pos - p2;\n\n  // Wrap i0, i1 and i2 to the desired period before gradient hashing:\n  // wrap points in (x,y), map to (u,v)\n  vec3 x = vec3(p0.x, p1.x, p2.x);\n  vec3 y = vec3(p0.y, p1.y, p2.y);\n  vec3 iuw = x + 0.5 * y;\n  vec3 ivw = y;\n\n  // Avoid precision issues in permutation\n  iuw = mod289(iuw);\n  ivw = mod289(ivw);\n\n  // Create gradients from indices\n  vec2 g0 = rgrad2(vec2(iuw.x, ivw.x), rot);\n  vec2 g1 = rgrad2(vec2(iuw.y, ivw.y), rot);\n  vec2 g2 = rgrad2(vec2(iuw.z, ivw.z), rot);\n\n  // Gradients dot vectors to corresponding corners\n  // (The derivatives of this are simply the gradients)\n  vec3 w = vec3(dot(g0, d0), dot(g1, d1), dot(g2, d2));\n\n  // Radial weights from corners\n  // 0.8 is the square of 2/sqrt(5), the distance from\n  // a grid point to the nearest simplex boundary\n  vec3 t = 0.8 - vec3(dot(d0, d0), dot(d1, d1), dot(d2, d2));\n\n  // Set influence of each surflet to zero outside radius sqrt(0.8)\n  t = max(t, 0.0);\n\n  // Fourth power of t\n  vec3 t2 = t * t;\n  vec3 t4 = t2 * t2;\n\n  // Final noise value is:\n  // sum of ((radial weights) times (gradient dot vector from corner))\n  float n = dot(t4, w);\n\n  // Rescale to cover the range [-1,1] reasonably well\n  return 11.0*n;\n}\n\n//\n// 2-D non-tiling simplex noise with fixed gradients,\n// without the analytical derivative.\n// This function is implemented as a wrapper to "srnoise",\n// at the minimal cost of three extra additions.\n// Note: if this kind of noise is all you want, there are faster\n// GLSL implementations of non-tiling simplex noise out there.\n// This one is included mainly for completeness and compatibility\n// with the other functions in the file.\n//\nfloat snoise(vec2 pos) {\n  return srnoise(pos, 0.0);\n}\n',noise_simplex_2D:"//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n//\n\nfloat simplex( vec2 v ) {\n\n    const vec4 C = vec4( 0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                        0.024390243902439 ); // 1.0 / 41.0\n    // First corner\n    vec2 i  = floor( v + dot( v, C.yy ) );\n    vec2 x0 = v - i + dot( i, C.xx );\n\n    // Other corners\n    vec2 i1;\n    //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n    //i1.y = 1.0 - i1.x;\n    i1 = ( x0.x > x0.y ) ? vec2( 1.0, 0.0 ) : vec2( 0.0, 1.0 );\n    // x0 = x0 - 0.0 + 0.0 * C.xx ;\n    // x1 = x0 - i1 + 1.0 * C.xx ;\n    // x2 = x0 - 1.0 + 2.0 * C.xx ;\n    vec4 x12 = x0.xyxy + C.xxzz;\n    x12.xy -= i1;\n\n    // Permutations\n    i = mod289( i ); // Avoid truncation effects in permutation\n    vec3 p = permute( permute( i.y + vec3( 0.0, i1.y, 1.0 ) )\n        + i.x + vec3( 0.0, i1.x, 1.0 ) );\n\n    vec3 m = max( 0.5 - vec3( dot( x0, x0 ), dot( x12.xy, x12.xy ), dot( x12.zw, x12.zw ) ), 0.0 );\n    m = m*m ;\n    m = m*m ;\n\n    // Gradients: 41 points uniformly over a line, mapped onto a diamond.\n    // The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n    vec3 x = 2.0 * fract( p * C.www ) - 1.0;\n    vec3 h = abs( x ) - 0.5;\n    vec3 ox = floor( x + 0.5 );\n    vec3 a0 = x - ox;\n\n    // Normalise gradients implicitly by scaling m\n    // Approximation of: m *= inversesqrt( a0*a0 + h*h );\n    m *= 1.79284291400159 - 0.85373472095314 * ( a0 * a0 + h * h );\n\n    // Compute final noise value at P\n    vec3 g;\n    g.x  = a0.x * x0.x + h.x * x0.y;\n    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n    return 130.0 * dot( m, g );\n\n}\n",noise_simplex_3D_grad:"//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20150104 (JcBernack)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n//\n\nfloat simplex( vec3 v, out vec3 gradient ) {\n\n    const vec2  C = vec2( 1.0 / 6.0, 1.0 / 3.0 );\n    const vec4  D = vec4( 0.0, 0.5, 1.0, 2.0 );\n\n    // First corner\n    vec3 i  = floor( v + dot( v, C.yyy ) );\n    vec3 x0 = v - i + dot( i, C.xxx ) ;\n\n    // Other corners\n    vec3 g = step( x0.yzx, x0.xyz );\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n    // Permutations\n    i = mod289( i );\n    vec4 p = permute( permute( permute(\n                i.z + vec4( 0.0, i1.z, i2.z, 1.0 ) )\n            + i.y + vec4( 0.0, i1.y, i2.y, 1.0 ) )\n            + i.x + vec4( 0.0, i1.x, i2.x, 1.0 ) );\n\n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3 ns = n_ * D.wyz - D.xzx;\n\n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n    vec4 x = x_ * ns.x + ns.yyyy;\n    vec4 y = y_ * ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs( x ) - abs( y );\n\n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n\n    vec4 s0 = floor( b0 ) * 2.0 + 1.0;\n    vec4 s1 = floor( b1 ) * 2.0 + 1.0;\n    vec4 sh = - step( h, vec4( 0.0 ) );\n\n    vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww ;\n\n    vec3 p0 = vec3( a0.xy, h.x );\n    vec3 p1 = vec3( a0.zw, h.y );\n    vec3 p2 = vec3( a1.xy, h.z );\n    vec3 p3 = vec3( a1.zw, h.w );\n\n    //Normalise gradients\n    vec4 norm = taylorInvSqrt( vec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) ) );\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n\n    // Mix final noise value\n    vec4 m = max( 0.6 - vec4( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ), dot( x3, x3 ) ), 0.0 );\n    vec4 m2 = m * m;\n    vec4 m4 = m2 * m2;\n    vec4 pdotx = vec4( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 ), dot( p3, x3 ) );\n\n    // Determine noise gradient\n    vec4 temp = m2 * m * pdotx;\n    gradient = - 8.0 * ( temp.x * x0 + temp.y * x1 + temp.z * x2 + temp.w * x3 );\n    gradient += m4.x * p0 + m4.y * p1 + m4.z * p2 + m4.w * p3;\n    gradient *= 42.0;\n\n    return 42.0 * dot( m4, pdotx );\n\n}\n",noise_simplex_3D:"//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n//\n\nfloat simplex( vec3 v ) {\n\n    const vec2 C = vec2( 1.0 / 6.0, 1.0 / 3.0 );\n    const vec4 D = vec4( 0.0, 0.5, 1.0, 2.0 );\n\n    // First corner\n    vec3 i  = floor( v + dot( v, C.yyy ) );\n    vec3 x0 = v - i + dot( i, C.xxx );\n\n    // Other corners\n    vec3 g = step( x0.yzx, x0.xyz );\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n    // Permutations\n    i = mod289( i );\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n            + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n            + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3 ns = n_ * D.wyz - D.xzx;\n\n    vec4 j = p - 49.0 * floor( p * ns.z * ns.z );  //  mod(p,7*7)\n\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs( x ) - abs( y );\n\n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n\n    vec4 s0 = floor( b0 ) * 2.0 + 1.0;\n    vec4 s1 = floor( b1 ) * 2.0 + 1.0;\n    vec4 sh = - step( h, vec4( 0.0 ) );\n\n    vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww ;\n\n    vec3 p0 = vec3( a0.xy, h.x );\n    vec3 p1 = vec3( a0.zw, h.y );\n    vec3 p2 = vec3( a1.xy, h.z );\n    vec3 p3 = vec3( a1.zw, h.w );\n\n    //Normalise gradients\n    vec4 norm = taylorInvSqrt( vec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) ) );\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n\n    // Mix final noise value\n    vec4 m = max( 0.6 - vec4( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ), dot( x3, x3 ) ), 0.0 );\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot( p0, x0 ), dot( p1, x1 ),\n                                dot( p2, x2 ), dot( p3, x3 ) ) );\n\n}\n",noise_simplex_4D:"//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n//\n\nvec4 grad4( float j, vec4 ip ) {\n\n    const vec4 ones = vec4( 1.0, 1.0, 1.0, -1.0 );\n    vec4 p, s;\n\n    p.xyz = floor( fract( vec3( j ) * ip.xyz ) * 7.0 ) * ip.z - 1.0;\n    p.w = 1.5 - dot( abs( p.xyz ), ones.xyz );\n    s = vec4( lessThan( p, vec4( 0.0 ) ) );\n    p.xyz = p.xyz + ( s.xyz * 2.0 - 1.0 ) * s.www;\n\n    return p;\n\n}\n\n// (sqrt(5) - 1)/4 = F4, used once below\n#define F4 0.309016994374947451\n\nfloat simplex(vec4 v) {\n\n    const vec4 C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n                        0.276393202250021,  // 2 * G4\n                        0.414589803375032,  // 3 * G4\n                        -0.447213595499958); // -1 + 4 * G4\n\n    // First corner\n    vec4 i  = floor( v + dot( v, vec4( F4 ) ) );\n    vec4 x0 = v - i + dot( i, C.xxxx );\n\n    // Other corners\n\n    // Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n    vec4 i0;\n    vec3 isX = step( x0.yzw, x0.xxx );\n    vec3 isYZ = step( x0.zww, x0.yyz );\n    i0.x = isX.x + isX.y + isX.z;\n    i0.yzw = 1.0 - isX;\n    i0.y += isYZ.x + isYZ.y;\n    i0.zw += 1.0 - isYZ.xy;\n    i0.z += isYZ.z;\n    i0.w += 1.0 - isYZ.z;\n\n    vec4 i3 = clamp( i0, 0.0, 1.0 );\n    vec4 i2 = clamp( i0 - 1.0, 0.0, 1.0 );\n    vec4 i1 = clamp( i0 - 2.0, 0.0, 1.0 );\n\n    vec4 x1 = x0 - i1 + C.xxxx;\n    vec4 x2 = x0 - i2 + C.yyyy;\n    vec4 x3 = x0 - i3 + C.zzzz;\n    vec4 x4 = x0 + C.wwww;\n\n    // Permutations\n    i = mod289( i );\n    float j0 = permute( permute( permute( permute( i.w ) + i.z ) + i.y ) + i.x );\n    vec4 j1 = permute( permute( permute( permute (\n                i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n            + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n            + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n            + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n    // Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n    // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n    vec4 ip = vec4( 1.0 / 294.0, 1.0 / 49.0, 1.0 / 7.0, 0.0 );\n\n    vec4 p0 = grad4(j0,   ip);\n    vec4 p1 = grad4(j1.x, ip);\n    vec4 p2 = grad4(j1.y, ip);\n    vec4 p3 = grad4(j1.z, ip);\n    vec4 p4 = grad4(j1.w, ip);\n\n    // Normalise gradients\n    vec4 norm = taylorInvSqrt( vec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) ) );\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    p4 *= taylorInvSqrt( dot( p4, p4 ) );\n\n    // Mix contributions from the five corners\n    vec3 m0 = max( 0.6 - vec3( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ) ), 0.0 );\n    vec2 m1 = max( 0.6 - vec2( dot( x3, x3 ), dot( x4, x4 ) ), 0.0 );\n    m0 = m0 * m0;\n    m1 = m1 * m1;\n    return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n                + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n}\n",noise_simplex:"#include <noise_simplex_2D>\n#include <noise_simplex_3D>\n#include <noise_simplex_3D_grad>\n#include <noise_simplex_4D>\n",perturbation_share:"#ifdef HAS_PERTURBATIONMAP\n  uniform sampler2D u_perturbationSampler;\n  uniform float u_perturbationUOffset;\n  uniform float u_perturbationVOffset;\n#endif\n",perturbation_frag:"#ifdef HAS_PERTURBATIONMAP\n  vec2 getScreenUv(){\n    return gl_FragCoord.xy / u_resolution;\n  }\n\n  vec4 screenColor = texture2D(u_perturbationSampler, getScreenUv() + normalize(u_viewMat * vec4(normal, 1.)).xy * vec2(u_perturbationUOffset, u_perturbationVOffset));\n  gl_FragColor = mix(screenColor, gl_FragColor, gl_FragColor.a);\n\n#endif\n",refraction_share:"#ifdef HAS_REFRACTIONMAP\n\n    uniform sampler2D u_refractionSampler;\n    uniform mat4 u_PTMMatrix;\n    uniform float u_refractionDepth;\n\n#endif\n",refraction_frag:"#ifdef HAS_REFRACTIONMAP\n  vec4 refractionColor = vec4(0.);\n  vec3 refractDir = normalize(refract(-geometry.viewDir, geometry.normal, u_refractionRatio));\n  vec3 newPos = v_pos + refractDir * u_refractionDepth;\n  vec4 projectionPos = u_PTMMatrix * u_projMat * u_viewMat * vec4(newPos, 1.0);\n  vec2 projectionUv = projectionPos.xy / projectionPos.w;\n  refractionColor = texture2D(u_refractionSampler, projectionUv);\n  gl_FragColor = mix(refractionColor, gl_FragColor, gl_FragColor.a);\n\n#endif\n",clipPlane_vert_define:"#ifdef O3_CLIPPLANE_NUM\n    uniform vec4 u_clipPlanes[O3_CLIPPLANE_NUM];\n    varying float v_clipDistances[O3_CLIPPLANE_NUM];\n#endif\n",clipPlane_vert:"#ifdef O3_CLIPPLANE_NUM\n    for(int i = 0; i < O3_CLIPPLANE_NUM; i++){\n        v_clipDistances[i] = dot(vec4(v_pos,1.0), u_clipPlanes[i]);\n    }\n#endif\n",clipPlane_frag_define:"#ifdef O3_CLIPPLANE_NUM\n    varying float v_clipDistances[O3_CLIPPLANE_NUM];\n#endif\n",clipPlane_frag:"#ifdef O3_CLIPPLANE_NUM\n    for(int i = 0; i < O3_CLIPPLANE_NUM; i++){\n        if(v_clipDistances[i] < 0.0){\n            discard;\n        }\n    }\n#endif\n",gamma_frag:"#ifdef GAMMA\n    float gamma = 2.2;\n    gl_FragColor.rgb = pow(gl_FragColor.rgb, vec3(1.0 / gamma));\n#endif\n",oit_frag:"#if defined(ALPHA_BLEND) && defined(OIT_ENABLE)\n    if(gl_FragCoord.z > texture2D(u_depthSampler, gl_FragCoord.xy / u_resolution).r){\n        discard;\n    }\n    vec4 oitColor = gl_FragColor;\n\n    // Bavoil and Myers Method\n    gl_FragData[0]= vec4(oitColor.rgb * oitColor.a, oitColor.a);\n    gl_FragData[1]= vec4(1)/ 255.0; // \n\n\n    // Depth Weights Improve Occlusion\n//    float w = weight(gl_FragCoord.z, oitColor.a);\n//    gl_FragData[0] = vec4(oitColor.rgb * oitColor.a * w, oitColor.a);\n//    gl_FragData[1].r =oitColor.a * w;\n#endif\n",oit_frag_define:"#if defined(ALPHA_BLEND) && defined(OIT_ENABLE)\n\n    uniform sampler2D u_depthSampler;\n\n    float weight(float z, float a) {\n        return a * clamp(3e3 * pow(1.0 - z, 3.0), 1e-2, 3e3);\n//          return pow(z,-5.0);\n    }\n#endif\n"},{pbr_common_frag_define:"#ifndef EPSILON\n#define EPSILON 1e-6\n#endif\n\n#ifndef RECIPROCAL_PI\n    #define RECIPROCAL_PI 0.31830988618\n#endif\n\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n",pbr_util_frag_define:"vec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n    #ifdef MANUAL_SRGB\n\n        #ifdef SRGB_FAST_APPROXIMATION\n\n            vec3 linOut = pow(srgbIn.xyz, vec3(2.2));\n        #else\n\n         vec3 bLess = step(vec3(0.04045), srgbIn.xyz);\n         vec3 linOut = mix(srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055), vec3(2.4)), bLess);\n\n        #endif\n\n    return vec4(linOut, srgbIn.w);;\n\n    #else\n\n    return srgbIn;\n\n    #endif\n}\n\nfloat pow2( const in float x ) {\n    return x * x;\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n    return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\n\n// todo: enhance\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n    if( decayExponent > 0.0 ) {\n\n        #if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n        // based upon Frostbite 3 Moving to Physically-based Rendering\n        // page 32, equation 26: E[window1]\n        // https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n        // this is intended to be used on spot and point lights who are represented as luminous intensity\n        // but who must be converted to luminous irradiance for surface lighting calculation\n        float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n        float maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n        return distanceFalloff * maxDistanceCutoffFactor;\n\n        #else\n\n        return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n        #endif\n\n    }\n\n    return 1.0;\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n}\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n    return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\n\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n    return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n\n// \nfloat getLuminance(vec3 color)\n{\n    return dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\n",pbr_envmap_light_frag_define:"#ifdef O3_HAS_ENVMAP_LIGHT\n\nstruct EnvMapLight {\n    vec3 diffuse;\n    vec3 specular;\n    float mipMapLevel;\n    float diffuseIntensity;\n    float specularIntensity;\n    mat3 transformMatrix;\n};\n\n\nuniform EnvMapLight u_envMapLight;\n\n#ifdef O3_USE_DIFFUSE_ENV\n    uniform samplerCube u_env_diffuseSampler;\n#endif\n\n#ifdef O3_USE_SPECULAR_ENV\n    uniform samplerCube u_env_specularSampler;\n#endif\n\n#endif\n",pbr_base_frag_define:"#ifdef ALPHA_MASK\nuniform float u_alphaCutoff;\n#endif\n\nuniform vec4 u_baseColorFactor;\nuniform vec2 u_metallicRoughnessValue;\nuniform vec3 u_specularFactor;\nuniform float u_glossinessFactor;\n\nuniform float u_envMapIntensity;\nuniform float u_refractionRatio;\n\nuniform vec2 u_resolution;\n\n// todo: delete\nuniform float u_normalScale;\nuniform float u_occlusionStrength;\n\n",pbr_texture_frag_define:"#ifdef HAS_BASECOLORMAP\n\nuniform sampler2D u_baseColorSampler;\n\n#endif\n\n#ifdef O3_HAS_NORMALMAP\n\nuniform sampler2D u_normalSampler;\n\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n\nuniform sampler2D u_emissiveSampler;\nuniform vec3 u_emissiveFactor;\n\n#endif\n\n#ifdef HAS_METALMAP\n\nuniform sampler2D u_metallicSampler;\n\n#endif\n\n#ifdef HAS_ROUGHNESSMAP\n\nuniform sampler2D u_roughnessSampler;\n\n#endif\n\n#ifdef HAS_METALROUGHNESSMAP\n\nuniform sampler2D u_metallicRoughnessSampler;\n\n#endif\n\n\n#ifdef HAS_SPECULARGLOSSINESSMAP\n\nuniform sampler2D u_specularGlossinessSampler;\n\n#endif\n\n#ifdef HAS_OCCLUSIONMAP\n\nuniform sampler2D u_occlusionSampler;\n\n#endif\n\n#ifdef HAS_OPACITYMAP\n\nuniform sampler2D u_opacitySampler;\n\n#endif\n\n#ifdef HAS_REFLECTIONMAP\n\nuniform samplerCube u_reflectionSampler;\n\n#endif\n",pbr_runtime_frag_define:"struct IncidentLight {\n    vec3 color;\n    vec3 direction;\n    bool visible;\n};\nstruct ReflectedLight {\n    vec3 directDiffuse;\n    vec3 directSpecular;\n    vec3 indirectDiffuse;\n    vec3 indirectSpecular;\n};\nstruct GeometricContext {\n    vec3 position;\n    vec3 normal;\n    vec3 viewDir;\n};\nstruct PhysicalMaterial {\n    vec3    diffuseColor;\n    float   specularRoughness;\n    vec3    specularColor;\n};\n",pbr_normal_frag_define:"vec3 getNormal()\n{\n  #ifdef O3_HAS_NORMALMAP\n    #ifndef O3_HAS_TANGENT\n        #ifdef HAS_DERIVATIVES\n            vec3 pos_dx = dFdx(v_pos);\n            vec3 pos_dy = dFdy(v_pos);\n            vec3 tex_dx = dFdx(vec3(v_uv, 0.0));\n            vec3 tex_dy = dFdy(vec3(v_uv, 0.0));\n            vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n            #ifdef O3_HAS_NORMAL\n                vec3 ng = normalize(v_normal);\n            #else\n                vec3 ng = normalize( cross(pos_dx, pos_dy) );\n            #endif\n            t = normalize(t - ng * dot(ng, t));\n            vec3 b = normalize(cross(ng, t));\n            mat3 tbn = mat3(t, b, ng);\n        #else\n            #ifdef O3_HAS_NORMAL\n                vec3 ng = normalize(v_normal);\n            #else\n                vec3 ng = vec3(0.0, 0.0, 1.0);\n            #endif\n            mat3 tbn = mat3(vec3(0.0), vec3(0.0), ng);\n        #endif\n    #else\n        mat3 tbn = v_TBN;\n    #endif\n        vec3 n = texture2D(u_normalSampler, v_uv ).rgb;\n        n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_normalScale, u_normalScale, 1.0)));\n  #else\n    #ifdef O3_HAS_NORMAL\n        vec3 n = normalize(v_normal);\n    #elif defined(HAS_DERIVATIVES)\n        vec3 pos_dx = dFdx(v_pos);\n        vec3 pos_dy = dFdy(v_pos);\n        vec3 n = normalize( cross(pos_dx, pos_dy) );\n    #else\n        vec3 n= vec3(0.0,0.0,1.0);\n    #endif\n  #endif\n\n  n *= float( gl_FrontFacing ) * 2.0 - 1.0;\n\n  return n;\n}\n",pbr_brdf_cook_torrance_frag_define:"vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is \"roughness squared\" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4's roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n",pbr_direct_irradiance_frag_define:"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n    vec3 irradiance = dotNL * directLight.color;\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n        irradiance *= PI; // punctual light\n\n    #endif\n\n\n\n    reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\n    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n\n\n#ifdef O3_DIRECT_LIGHT_COUNT\n\n    void getDirectionalDirectLightIrradiance( const in DirectLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n        directLight.color = directionalLight.lightColor;\n        directLight.direction = -directionalLight.direction;\n        directLight.visible = true;\n    }\n\n#endif\n\n#ifdef O3_POINT_LIGHT_COUNT\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.lightColor;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef O3_SPOT_LIGHT_COUNT\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.lightColor;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n\n#endif\n",pbr_ibl_specular_frag_define:"// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\n    float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n    const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n    const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n    vec4 r = roughness * c0 + c1;\n\n    float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n    vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n    return specularColor * AB.x + AB.y;\n\n} // validated\n\n\n// taken from here: http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\nfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\n    //float envMapWidth = pow( 2.0, maxMIPLevelScalar );\n    //float desiredMIPLevel = log2( envMapWidth * sqrt( 3.0 ) ) - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\n    float maxMIPLevelScalar = float( maxMIPLevel );\n    float desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\n    // clamp to allowable LOD ranges.\n    return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n}\n\n#ifdef O3_HAS_ENVMAP_LIGHT\n\nvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\n    #if !defined(O3_USE_SPECULAR_ENV) && !defined(HAS_REFLECTIONMAP)\n\n        return u_envMapLight.specular * u_envMapLight.specularIntensity * u_envMapIntensity;\n\n    #else\n\n    #ifdef ENVMAPMODE_REFRACT\n\n        vec3 reflectVec = refract( -geometry.viewDir, geometry.normal, u_refractionRatio );\n\n    #else\n\n        vec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\n    #endif\n//        reflectVec = inverseTransformDirection( reflectVec, u_viewMat );\n\n        reflectVec =  u_envMapLight.transformMatrix * reflectVec;\n\n        float specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\n        #ifdef HAS_TEX_LOD\n            #ifdef HAS_REFLECTIONMAP\n                 vec4 envMapColor = textureCubeLodEXT( u_reflectionSampler, reflectVec, specularMIPLevel );\n            #else\n                vec4 envMapColor = textureCubeLodEXT( u_env_specularSampler, reflectVec, specularMIPLevel );\n            #endif\n\n        #else\n            #ifdef HAS_REFLECTIONMAP\n                 vec4 envMapColor = textureCube( u_reflectionSampler, reflectVec, specularMIPLevel );\n            #else\n                 vec4 envMapColor = textureCube( u_env_specularSampler, reflectVec, specularMIPLevel );\n            #endif\n        #endif\n\n        envMapColor.rgb = SRGBtoLINEAR( envMapColor * u_envMapLight.specularIntensity * u_envMapIntensity).rgb;\n\n        return envMapColor.rgb;\n\n    #endif\n\n}\n#endif\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n    float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n    float dotNL = dotNV;\n\n\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\n}\n",pbr_ibl_diffuse_frag_define:"void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#ifdef O3_HAS_AMBIENT_LIGHT\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n    vec3 irradiance = ambientLightColor;\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n\n        irradiance *= PI;\n\n    #endif\n\n    return irradiance;\n\n}\n\n#endif\n",pbr_begin_frag:"    vec3 normal = getNormal();\n    vec4 diffuseColor = u_baseColorFactor;\n    vec3 totalEmissiveRadiance = vec3(0.0);\n    float metalnessFactor = u_metallicRoughnessValue.r;\n    float roughnessFactor = u_metallicRoughnessValue.g;\n    vec3 specularFactor = u_specularFactor;\n    float glossinessFactor = u_glossinessFactor;\n\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    PhysicalMaterial material;\n    GeometricContext geometry;\n    IncidentLight directLight;\n\n    #ifdef HAS_BASECOLORMAP\n\n        vec4 baseMapColor = texture2D( u_baseColorSampler, v_uv );\n        baseMapColor = SRGBtoLINEAR( baseMapColor );\n        diffuseColor *= baseMapColor;\n\n    #endif\n\n    #ifdef O3_HAS_VERTEXCOLOR\n\n        diffuseColor.rgb *= v_color.rgb;\n\n        #ifdef O3_HAS_VERTEXALPHA\n\n            diffuseColor.a *= v_color.a;\n\n        #endif\n\n    #endif\n\n    #ifdef ALPHA_MASK\n\n        if( diffuseColor.a < u_alphaCutoff ) {\n            discard;\n        }\n\n    #endif\n\n\n    #if defined(ALPHA_BLEND) && defined(HAS_OPACITYMAP)\n\n        #ifdef GETOPACITYFROMRGB\n            diffuseColor.a *= getLuminance(texture2D( u_opacitySampler, v_opacityTexture ).rgb);\n        #else\n            diffuseColor.a *= texture2D( u_opacitySampler, v_opacityTexture ).a;\n        #endif\n\n    #endif\n\n    #ifdef UNLIT\n\n        gl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n    #else\n\n\n\n        #ifdef HAS_METALROUGHNESSMAP\n\n            vec4 metalRoughMapColor = texture2D( u_metallicRoughnessSampler, v_uv );\n            metalnessFactor *= metalRoughMapColor.b;\n            roughnessFactor *= metalRoughMapColor.g;\n\n        #else\n            #ifdef HAS_METALMAP\n\n            vec4 metalMapColor = texture2D( u_metallicSampler, v_uv );\n            metalnessFactor *= metalMapColor.b;\n\n            #endif\n\n            #ifdef HAS_ROUGHNESSMAP\n\n            vec4 roughMapColor = texture2D( u_roughnessSampler, v_uv );\n            roughnessFactor *= roughMapColor.g;\n\n            #endif\n        #endif\n\n        #ifdef HAS_SPECULARGLOSSINESSMAP\n\n            vec4 specularGlossinessColor = texture2D(u_specularGlossinessSampler, v_uv );\n            specularFactor *= specularGlossinessColor.rgb;\n            glossinessFactor *= specularGlossinessColor.a;\n\n        #endif\n\n\n        #ifdef IS_METALLIC_WORKFLOW\n            material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n            material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n//          material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n            material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT /* pow2( reflectivity )*/ ), diffuseColor.rgb, metalnessFactor );\n        #else\n            float specularStrength = max( max( specularFactor.r, specularFactor.g ), specularFactor.b );\n            material.diffuseColor = diffuseColor.rgb * ( 1.0 - specularStrength );\n            material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );\n            material.specularColor = specularFactor;\n        #endif\n\n        geometry.position = v_pos;\n        geometry.normal = normal;\n        geometry.viewDir = normalize( u_cameraPos - v_pos );\n",pbr_direct_irradiance_frag:"        #if defined( O3_DIRECT_LIGHT_COUNT ) && defined( RE_Direct )\n\n            DirectLight directionalLight;\n\n            for ( int i = 0; i < O3_DIRECT_LIGHT_COUNT; i ++ ) {\n\n                directionalLight = u_directLights[ i ];\n\n                getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n                RE_Direct( directLight, geometry, material, reflectedLight );\n\n            }\n\n        #endif\n\n        #if defined( O3_POINT_LIGHT_COUNT ) && defined( RE_Direct )\n\n            PointLight pointLight;\n\n            for ( int i = 0; i < O3_POINT_LIGHT_COUNT; i ++ ) {\n\n                pointLight = u_pointLights[ i ];\n\n                getPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n                RE_Direct( directLight, geometry, material, reflectedLight );\n\n            }\n\n        #endif\n\n        #if defined( O3_SPOT_LIGHT_COUNT ) && defined( RE_Direct )\n\n            SpotLight spotLight;\n\n            for ( int i = 0; i < O3_SPOT_LIGHT_COUNT; i ++ ) {\n\n                spotLight = u_spotLights[ i ];\n\n                getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n                RE_Direct( directLight, geometry, material, reflectedLight );\n\n            }\n\n        #endif\n",pbr_ibl_diffuse_frag:"#if defined(RE_IndirectDiffuse)\n\n    vec3 irradiance = vec3(0);\n\n    #if defined(O3_HAS_AMBIENT_LIGHT)\n        irradiance += getAmbientLightIrradiance(u_ambientLight.lightColor);\n    #endif\n\n    #if defined(O3_HAS_ENVMAP_LIGHT)\n\n        #ifdef O3_USE_DIFFUSE_ENV\n            vec3 lightMapIrradiance = textureCube(u_env_diffuseSampler, geometry.normal).rgb * u_envMapLight.diffuseIntensity;\n        #else\n            vec3 lightMapIrradiance = u_envMapLight.diffuse * u_envMapLight.diffuseIntensity;\n        #endif\n\n        #ifndef PHYSICALLY_CORRECT_LIGHTS\n            lightMapIrradiance *= PI;\n        #endif\n\n        irradiance += lightMapIrradiance;\n\n    #endif\n\n    RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n\n",pbr_ibl_specular_frag:"#if defined( RE_IndirectSpecular )\n\n    vec3 radiance = vec3( 0.0 );\n\n#endif\n\n\n\n#if defined( O3_HAS_ENVMAP_LIGHT ) && defined( RE_IndirectSpecular )\n\n    radiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), int(u_envMapLight.mipMapLevel) );\n\n#endif\n\n\n#if defined( RE_IndirectSpecular )\n\n    RE_IndirectSpecular( radiance, geometry, material, reflectedLight );\n\n#endif\n",pbr_end_frag:"#ifdef HAS_OCCLUSIONMAP\n\n    float ambientOcclusion = (texture2D(u_occlusionSampler, v_uv).r - 1.0) * u_occlusionStrength + 1.0;\n    reflectedLight.indirectDiffuse *= ambientOcclusion;\n\n    #if defined(O3_USE_SPECULAR_ENV)\n\n        float dotNV = saturate(dot(geometry.normal, geometry.viewDir));\n        reflectedLight.indirectSpecular *= computeSpecularOcclusion(dotNV, ambientOcclusion, material.specularRoughness);\n\n    #endif\n\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n\n    vec4 emissiveMapColor = texture2D(u_emissiveSampler, v_uv);\n    emissiveMapColor = SRGBtoLINEAR(emissiveMapColor);\n    totalEmissiveRadiance += u_emissiveFactor * emissiveMapColor.rgb;\n\n#endif\n\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\ngl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n#endif\n"});var nr,rr,ir=function(){function e(){}return e.parseVersion=function(e){return void 0===e&&(e="100"),"#version "+e+"\n"},e.parsePrecision=function(e,t,n){return"\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n          precision "+(n?e:t)+" float;\n          precision "+(n?e:t)+" int;\n\n          #define O3_VERTEX_PRECISION "+e+"\n          #define O3_FRAGMENT_PRECISION "+t+"\n        #else\n          precision mediump float;\n          precision mediump int;\n\n          #define O3_VERTEX_PRECISION mediump\n          #define O3_FRAGMENT_PRECISION mediump\n        #endif\n      "},e.parseShaderName=function(e){return"#define O3_SHADER_NAME "+e+"\n"},e.parseAttributeMacros=function(e){return"#define O3_ATTRIBUTE_MACROS_START\n"+e.map((function(e){return"#define "+e+"\n"})).join("")+"#define O3_ATTRIBUTE_MACROS_END\n"},e.parseCustomMacros=function(e){return"#define O3_CUSTOM_MACROS_START\n"+e.map((function(e){return"#define "+e+"\n"})).join("")+"#define O3_CUSTOM_MACROS_END\n"},e.parseShader=function(t){return e.parseIncludes(t)},e.parseIncludes=function(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,(function(t,n){var r=tr[n];return void 0===r?(Be.error('Shader slice "'+t.trim()+'" not founded.'),""):e.parseIncludes(r)}))},e.InjectShaderSlices=function(e){var t;t=e,Object.assign(tr,t)},e.parseExtension=function(e){return"#define O3_EXTENSION_START\n"+e.map((function(e){return"#extension "+e+" : enable\n"})).join("")+"#define O3_EXTENSION_END\n"},e.convertTo300=function(e,t){if(e.includes("#version 300 es"))return e;if(e=(e=(e=(e=(e=e.replace(/#version 100/,"#version 300 es")).replace(/\battribute\b/g,"in")).replace(/\bvarying\b/g,t?"in":"out")).replace(/\btexture(2D|Cube)\s*\(/g,"texture(")).replace(/\btexture(2D|Cube)LodEXT\s*\(/g,"textureLod("),t)if(/\bgl_FragData\[.+?\]/g.test(e)){var n=(e=e.replace(/\bgl_FragColor\b/g,"gl_FragData[0]")).match(/\bgl_FragData\[.+?\]/g);e=this.replaceMRTShader(e,n)}else e=(e=e.replace(/void\s+?main\s*\(/g,"out vec4 glFragColor;\nvoid main(")).replace(/\bgl_FragColor\b/g,"glFragColor");return e},e.getMaxDrawBuffers=function(e){for(var t=new Set,n=e.match(/\bgl_FragData\[.+?\]/g)||[],r=0;r<n.length;r++){var i=n[r].match(/\bgl_FragData\[(.+?)\]/);t.add(i[1])}return t.size},e.compatible=function(e){return/\bgl_FragData\[.+?\]/g.test(e)&&(e=e.replace(/\bgl_FragColor\b/g,"gl_FragData[0]")),e},e.replaceMRTShader=function(e,t){for(var n="",r=new Set,i=0;i<t.length;i++){var a=t[i].match(/\bgl_FragData\[(.+?)\]/);r.add(a[1])}return r.forEach((function(e){n+="layout(location="+e+") out vec4 fragOutColor"+e+";\n"})),n+="void main(",e=(e=e.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1")).replace(/void\s+?main\s*\(/g,n)},e}(),ar=function(e){function t(n){var r;return(r=e.call(this,null)||this).name=n,r.isValid=!1,r._uniforms=t.commonUniforms,r._attributes=t.commonAttributes,r.states=null,r.vertexShader="",r.fragmentShader="",r.version="100",r.autoConvert=!0,r.vertexPrecision="highp",r.fragmentPrecision="mediump",r.customMacros=[],r.shaderExtension100=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers"],r.shaderExtension300=[],r._needCompile=!0,r}R(t,e);var n=t.prototype;return n.compile=function(e,t,n,r){if(this.parseFog(e),this._needCompile){var i=e.engine._hardwareRenderer,a=null==i?void 0:i.isWebGL2;null==r.preCompile||r.preCompile(this);var o=this.getAttributeDefines(e,t,n,r);if(this._recreateHeader&&(this.attributes=this.attributes,this.uniforms=this.uniforms),this._vsHeader&&!this._recreateHeader||(this._vsHeader=ir.parseVersion(this.version)+ir.parseShaderName((this.name||"VOID").toUpperCase()+"_VERT")+"\n"+ir.parsePrecision(this.vertexPrecision,this.fragmentPrecision,!0)+"\n"+ir.parseAttributeMacros(o)+"\n"+ir.parseCustomMacros(this.customMacros)+"\n"),this._vsCode||(this._vsCode=ir.parseShader(this.vertexShader)),this.vertexShader=this._vsHeader+this._vsCode,this._fsHeader&&!this._recreateHeader||(this._fsHeader=ir.parseVersion(this.version)+ir.parseShaderName((this.name||"VOID").toUpperCase()+"_FRAG")+"\n"+ir.parseExtension(a?this.shaderExtension300:this.shaderExtension100)+ir.parsePrecision(this.vertexPrecision,this.fragmentPrecision)+"\n"+ir.parseAttributeMacros(o)+"\n"+ir.parseCustomMacros(this.customMacros)+"\n"),this._fsCode||(this._fsCode=ir.parseShader(this.fragmentShader)),this.fragmentShader=this._fsHeader+this._fsCode,this.autoConvert&&a&&"300 es"!==this.version){var s=i.capability.maxDrawBuffers;ir.getMaxDrawBuffers(this.fragmentShader)<=s&&(this.vertexShader=ir.convertTo300(this.vertexShader),this.fragmentShader=ir.convertTo300(this.fragmentShader,!0))}else a||"300es"===this.version||(this.fragmentShader=ir.compatible(this.fragmentShader));this._needCompile=!1,this._recreateHeader=!1,null==r.postCompile||r.postCompile(this)}},n.getAttributeDefines=function(e,t,n,r){var i=e.scene.engine._hardwareRenderer,a=i.gl,o=[];if(!n)return o;var s,u=Object.keys(n._vertexElementMap);if((u.indexOf("TEXCOORD_0")>-1&&o.push("O3_HAS_UV"),u.indexOf("NORMAL")>-1&&o.push("O3_HAS_NORMAL"),u.indexOf("TANGENT")>-1&&o.push("O3_HAS_TANGENT"),u.indexOf("JOINTS_0")>-1)&&(o.push("O3_HAS_SKIN"),null!=(s=t.jointNodes)&&s.length)){var c=i.renderStates.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),l=Math.floor((c-20)/4),f=t.jointNodes.length;f>l?i.canIUseMoreJoints?o.push("O3_USE_JOINT_TEXTURE"):Be.error("component's joints count("+f+") greater than device's MAX_VERTEX_UNIFORM_VECTORS number "+c+", suggest joint count less than "+l+".",t):r.maxJointsNum>0&&o.push("O3_JOINTS_NUM "+r.maxJointsNum)}u.indexOf("COLOR_0")>-1&&(o.push("O3_HAS_VERTEXCOLOR"),n._vertexElementMap.COLOR_0.format===Fn.Vector4&&o.push("O3_HAS_VERTEXALPHA"));var h=e.scene;return h.hasFogFeature&&o.push.apply(o,h.getFogMacro()),o},n.parseFog=function(e){var t=e.scene;if(t.hasFogFeature){var n=t.getFogMacro();this._fogMacro!==n&&(this._needCompile=!0,this._recreateHeader=!0,this._fogMacro=n)}},n.createMorphConfig=function(e,t){for(var n=Object.keys(e._vertexElementMap),r={},i=0;i<t;i++)n.indexOf("POSITION_"+i)>-1&&(r["a_position"+i]={name:"a_position"+i,semantic:"POSITION_"+i,type:ge.FLOAT_VEC3}),n.indexOf("NORMAL_"+i)>-1&&(r["a_normal"+i]={name:"a_normal"+i,semantic:"NORMAL_"+i,type:ge.FLOAT_VEC3}),n.indexOf("TANGENT_"+i)>-1&&(r["a_tangent"+i]={name:"a_tangent"+i,semantic:"TANGENT_"+i,type:ge.FLOAT_VEC3});return r},n._finalize=function(){this._glTechnique&&(this._glTechnique.finalize(!0),this._glTechnique=null)},S(t,[{key:"attributes",get:function(){return this._attributes},set:function(e){this._attributes=Object.assign({},t.commonAttributes,e)}},{key:"uniforms",get:function(){return this._uniforms},set:function(e){this._uniforms=Object.assign({},t.commonUniforms,e)}}]),t}(ht);ar.commonAttributes={a_position:{name:"a_position",semantic:"POSITION",type:ge.FLOAT_VEC3},a_uv:{name:"a_uv",semantic:"TEXCOORD_0",type:ge.FLOAT_VEC2},a_normal:{name:"a_noraml",semantic:"NORMAL",type:ge.FLOAT_VEC3},a_tangent:{name:"a_tangent",semantic:"TANGENT",type:ge.FLOAT_VEC4},a_color:{name:"a_color",semantic:"COLOR_0",type:ge.FLOAT_VEC4},a_joint:{name:"a_joint",semantic:"JOINTS_0",type:ge.FLOAT_VEC4},a_weight:{name:"a_weight",semantic:"WEIGHTS_0",type:ge.FLOAT_VEC4}},ar.commonUniforms={u_localMat:{name:"u_localMat",semantic:Ee.LOCAL,type:ge.FLOAT_MAT4},u_modelMat:{name:"u_modelMat",semantic:Ee.MODEL,type:ge.FLOAT_MAT4},u_viewMat:{name:"u_viewMat",semantic:Ee.VIEW,type:ge.FLOAT_MAT4},u_projMat:{name:"u_projMat",semantic:Ee.PROJECTION,type:ge.FLOAT_MAT4},u_MVMat:{name:"u_MVMat",semantic:Ee.MODELVIEW,type:ge.FLOAT_MAT4},u_MVPMat:{name:"u_MVPMat",semantic:Ee.MODELVIEWPROJECTION,type:ge.FLOAT_MAT4},u_normalMat:{name:"u_normalMat",semantic:Ee.MODELINVERSETRANSPOSE,type:ge.FLOAT_MAT3},u_cameraPos:{name:"u_cameraPos",type:ge.FLOAT_VEC3,semantic:Ee.EYEPOS},u_time:{name:"u_time",type:ge.FLOAT,semantic:Ee.TIME},u_jointMatrix:{name:"u_jointMatrix",semantic:Ee.JOINTMATRIX,type:ge.FLOAT_MAT4_ARRAY},u_jointSampler:{name:"u_jointSampler",semantic:Ee.JOINTTEXTURE,type:ge.SAMPLER_2D},u_jointCount:{name:"u_jointCount",semantic:Ee.JOINTCOUNT,type:ge.FLOAT},u_fogColor:{name:"u_fogColor",type:ge.FLOAT_VEC3},u_fogDensity:{name:"u_fogDensity",type:ge.FLOAT},u_fogNear:{name:"u_fogNear",type:ge.FLOAT},u_fogFar:{name:"u_fogFar",type:ge.FLOAT}},(rr=nr||(nr={}))[rr.PositiveX=0]="PositiveX",rr[rr.NegativeX=1]="NegativeX",rr[rr.PositiveY=2]="PositiveY",rr[rr.NegativeY=3]="NegativeY",rr[rr.PositiveZ=4]="PositiveZ",rr[rr.NegativeZ=5]="NegativeZ";var or,sr,ur,cr,lr,fr,hr,dr,_r=function(e){function t(t,n,r,i){var a;void 0===r&&(r=pn.R8G8B8A8),void 0===i&&(i=!0),(a=e.call(this,t)||this)._compressedFaceFilled=[0,0,0,0,0,0];var o=t._hardwareRenderer,s=o.gl,u=o.isWebGL2;if(!Sn._supportTextureFormat(r,o))throw new Error("Texture format is not supported:"+pn[r]);!i||u||Sn._isPowerOf2(n)||(Be.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),i=!1);var c=Sn._getFormatDetail(r,s,u);return a._glTexture=s.createTexture(),a._formatDetail=c,a._rhi=o,a._target=s.TEXTURE_CUBE_MAP,a._mipmap=i,a._width=n,a._height=n,a._format=r,a._mipmapCount=a._getMipmapCount(),c.isCompressed&&!u||a._initMipmap(!0),a.filterMode=_n.Bilinear,a.wrapModeU=a.wrapModeV=gn.Clamp,a}R(t,e);var n=t.prototype;return n.setPixelBuffer=function(e,t,n,r,i,a,o){void 0===n&&(n=0);var s=this._rhi.gl,u=this._rhi.isWebGL2,c=this._formatDetail,l=c.internalFormat,f=c.baseFormat,h=c.dataType,d=c.isCompressed,_=Math.max(1,this._width>>n);if(r=r||0,i=i||0,a=a||_-r,o=o||_-i,this._bind(),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),d){var m=1<<n;u||this._compressedFaceFilled[e]&m?s.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,r,i,a,o,l,t):(s.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,l,a,o,0,t),this._compressedFaceFilled[e]|=m)}else s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,r,i,a,o,f,h,t);this._unbind()},n.setImageSource=function(e,t,n,r,i,a,o){void 0===n&&(n=0),void 0===r&&(r=!1),void 0===i&&(i=!1);var s=this._rhi.gl,u=this._formatDetail,c=u.baseFormat,l=u.dataType;this._bind(),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,+r),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+i),s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,a||0,o||0,c,l,t),this._unbind()},n.getPixelBuffer=function(t,n,r,i,a,o){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");e.prototype._getPixelBuffer.call(this,t,n,r,i,a,o)},S(t,[{key:"format",get:function(){return this._format}}]),t}(Sn),mr=function(e){function t(t,n,r,i,a,o){var s;void 0===i&&(i=On.Depth),void 0===a&&(a=!1),void 0===o&&(o=!1),(s=e.call(this,t)||this)._isCube=!1,s._autoMipmap=!1;var u=t._hardwareRenderer,c=u.gl,l=u.isWebGL2;if(!Sn._supportRenderBufferDepthFormat(i,u,!0))throw new Error("RenderBufferDepthFormat is not supported:"+On[i]);if(o&&n!==r)throw new Error("The cube texture must have the same width and height");return!a||l||Sn._isPowerOf2(n)&&Sn._isPowerOf2(r)||(Be.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),a=!1),s._glTexture=c.createTexture(),s._formatDetail=Sn._getRenderBufferDepthFormatDetail(i,c,l),s._isCube=o,s._rhi=u,s._target=o?c.TEXTURE_CUBE_MAP:c.TEXTURE_2D,s._mipmap=a,s._width=n,s._height=r,s._format=i,s._mipmapCount=s._getMipmapCount(),s._initMipmap(o),s.filterMode=_n.Bilinear,s.wrapModeU=s.wrapModeV=gn.Clamp,s}return R(t,e),S(t,[{key:"format",get:function(){return this._format}},{key:"autoGenerateMipmaps",get:function(){return this._autoMipmap},set:function(e){this._autoMipmap=e}}]),t}(Sn),pr=function(e){function t(t,n,r,i,a,o){var s;void 0===a&&(a=On.Depth),void 0===o&&(o=1),(s=e.call(this,t)||this)._MSAAColorRenderBuffers=[];var u=t._hardwareRenderer,c=u.gl;if(!(a instanceof mr||Sn._supportRenderBufferDepthFormat(a,u,!1)))throw new Error("RenderBufferDepthFormat is not supported:"+On[a]);if((null==i?void 0:i.length)>1&&!u.canIUse(Ce.drawBuffers))throw new Error("MRT is not supported");if(s._colorTextures=i?i instanceof Array?i.slice():[i]:[],s._colorTextures.some((function(e){return e.width!==n||e.height!==r})))throw new Error("RenderColorTexture's size must as same as RenderTarget");if(a instanceof mr&&(a.width!==n||a.height!==r))throw new Error("RenderDepthTexture's size must as same as RenderTarget");if(s._colorTextures.length>1&&s._colorTextures.some((function(e){return e._isCube})))throw new Error("MRT+Cube+[,MSAA] is not supported");var l=u.capability.maxAntiAliasing;return o>l&&(Be.warn("MSAA antiAliasing exceeds the limit and is automatically downgraded to:"+l),o=l),s._rhi=u,s._width=n,s._height=r,s._frameBuffer=c.createFramebuffer(),s._antiAliasing=o,a instanceof mr&&(s._depthTexture=a),s._bindMainFBO(a),o>1&&(s._MSAAFrameBuffer=c.createFramebuffer(),s._bindMSAAFBO(a)),s}R(t,e);var n=t.prototype;return n.getColorTexture=function(e){return void 0===e&&(e=0),this._colorTextures[e]},n.destroy=function(){var e=this._rhi.gl;e.deleteFramebuffer(this._frameBuffer),this._depthRenderBuffer&&e.deleteRenderbuffer(this._depthRenderBuffer),this._MSAAFrameBuffer&&e.deleteFramebuffer(this._MSAAFrameBuffer),this._MSAADepthRenderBuffer&&e.deleteRenderbuffer(this._MSAADepthRenderBuffer);for(var t=0;t<this._colorTextures.length;t++)this._colorTextures[t].destroy();for(var n=0;n<this._MSAAColorRenderBuffers.length;n++)e.deleteRenderbuffer(this._MSAAColorRenderBuffers[n]);this._depthTexture&&this._depthTexture.destroy(),this._frameBuffer=null,this._colorTextures.length=0,this._depthTexture=null,this._depthRenderBuffer=null,this._MSAAFrameBuffer=null,this._MSAAColorRenderBuffers.length=0,this._MSAADepthRenderBuffer=null},n._activeRenderTarget=function(){var e=this._rhi.gl;this._MSAAFrameBuffer?e.bindFramebuffer(e.FRAMEBUFFER,this._MSAAFrameBuffer):e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer)},n._setRenderTargetFace=function(e){var t=this._rhi.gl,n=this._colorTextures[0],r=this._depthTexture;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),null!=n&&n._isCube&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n._glTexture,0),null!=r&&r._isCube&&t.framebufferTexture2D(t.FRAMEBUFFER,r._formatDetail.attachment,t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r._glTexture,0),this._activeRenderTarget()},n._blitRenderTarget=function(){var e=this._rhi.gl,t=e.COLOR_BUFFER_BIT|(this._depthTexture?e.DEPTH_BUFFER_BIT:0),n=this._colorTextures.length;e.bindFramebuffer(e.READ_FRAMEBUFFER,this._MSAAFrameBuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this._frameBuffer);for(var r=0;r<n;r++){var i=e.COLOR_ATTACHMENT0+r;this._blitDrawBuffers[r]=i,e.readBuffer(i),e.drawBuffers(this._blitDrawBuffers),e.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,t,e.NEAREST),this._blitDrawBuffers[r]=e.NONE}e.bindFramebuffer(e.FRAMEBUFFER,null)},n._bindMainFBO=function(e){var t=this._rhi.gl,n=this._rhi.isWebGL2,r=this._colorTextures.length,i=new Array(r);t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer);for(var a=0;a<r;a++){var o=this._colorTextures[a],s=t.COLOR_ATTACHMENT0+a;i[a]=s,o._isCube||t.framebufferTexture2D(t.FRAMEBUFFER,s,t.TEXTURE_2D,o._glTexture,0)}if(r>1&&t.drawBuffers(i),this._oriDrawBuffers=i,null!==e)if(e instanceof mr)e._isCube||t.framebufferTexture2D(t.FRAMEBUFFER,e._formatDetail.attachment,t.TEXTURE_2D,e._glTexture,0);else if(this._antiAliasing<=1){var u=Sn._getRenderBufferDepthFormatDetail(e,t,n),c=u.internalFormat,l=u.attachment,f=t.createRenderbuffer();this._depthRenderBuffer=f,t.bindRenderbuffer(t.RENDERBUFFER,f),t.renderbufferStorage(t.RENDERBUFFER,c,this._width,this._height),t.framebufferRenderbuffer(t.FRAMEBUFFER,l,t.RENDERBUFFER,f)}t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},n._bindMSAAFBO=function(e){var t=this._rhi.gl,n=this._rhi.isWebGL2,r=t.createRenderbuffer(),i=this._colorTextures.length;this._blitDrawBuffers=new Array(i),this._MSAADepthRenderBuffer=r,t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer);for(var a=0;a<i;a++){var o=t.createRenderbuffer();this._MSAAColorRenderBuffers[a]=o,this._blitDrawBuffers[a]=t.NONE,t.bindRenderbuffer(t.RENDERBUFFER,o),t.renderbufferStorageMultisample(t.RENDERBUFFER,this._antiAliasing,this._colorTextures[a]._formatDetail.internalFormat,this._width,this._height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+a,t.RENDERBUFFER,o)}if(t.drawBuffers(this._oriDrawBuffers),null!==e){var s=e instanceof mr?e._formatDetail:Sn._getRenderBufferDepthFormatDetail(e,t,n),u=s.internalFormat,c=s.attachment;t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorageMultisample(t.RENDERBUFFER,this._antiAliasing,u,this._width,this._height),t.framebufferRenderbuffer(t.FRAMEBUFFER,c,t.RENDERBUFFER,r)}this._checkFrameBuffer(),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},n._checkFrameBuffer=function(){var e=this._rhi.gl,t=this._rhi.isWebGL2,n=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(n){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case e.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}if(t&&n===e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.")},S(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"colorTextureCount",get:function(){return this._colorTextures.length}},{key:"depthTexture",get:function(){return this._depthTexture}},{key:"antiAliasing",get:function(){return this._antiAliasing}}]),t}(Q),vr=function(e){function t(t,n,r,i,a,o){var s;void 0===i&&(i=xn.R8G8B8A8),void 0===a&&(a=!1),void 0===o&&(o=!1),(s=e.call(this,t)||this)._isCube=!1,s._autoMipmap=!1;var u=t._hardwareRenderer,c=u.gl,l=u.isWebGL2;if(!Sn._supportRenderBufferColorFormat(i,u))throw new Error("RenderBufferColorFormat is not supported:"+xn[i]);if(o&&n!==r)throw new Error("The cube texture must have the same width and height");return!a||l||Sn._isPowerOf2(n)&&Sn._isPowerOf2(r)||(Be.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),a=!1),s._glTexture=c.createTexture(),s._formatDetail=Sn._getRenderBufferColorFormatDetail(i,c,l),s._isCube=o,s._rhi=u,s._target=o?c.TEXTURE_CUBE_MAP:c.TEXTURE_2D,s._mipmap=a,s._width=n,s._height=r,s._format=i,s._mipmapCount=s._getMipmapCount(),s._initMipmap(o),s.filterMode=_n.Bilinear,s.wrapModeU=s.wrapModeV=gn.Clamp,s}return R(t,e),t.prototype.getPixelBuffer=function(t,n,r,i,a,o){e.prototype._getPixelBuffer.call(this,t,n,r,i,a,o)},S(t,[{key:"format",get:function(){return this._format}},{key:"autoGenerateMipmaps",get:function(){return this._autoMipmap},set:function(e){this._autoMipmap=e}}]),t}(Sn),gr=function(e){function t(t){var n;return(n=e.call(this,t)||this)._worldSize=[],n._rotationAngle=0,n.renderMode="2D",n.tintColor=new T(1,1,1,1),n._worldSizeFactor=100,n.setTexture(void 0),n.setRect(void 0),n.setAnchor(void 0),n.setUvRect(),n.setWorldSize(),n._positionQuad={leftTop:new s,leftBottom:new s,rightTop:new s,rightBottom:new s},n}R(t,e);var n=t.prototype;return n.setTexture=function(e){e&&e.asset&&(e=e.asset),this._texture=e},n.setRect=function(e){var t,n,r,i;try{e&&JSON.parse(e)}catch(e){Be.warn("Rect is not valid JSON format")}this._rect=e||{x:0,y:0,width:null!=(t=null==(n=this._texture)?void 0:n.width)?t:0,height:null!=(r=null==(i=this._texture)?void 0:i.height)?r:0}},n.setAnchor=function(e){this._anchor=e||[.5,.5]},n.setWorldSize=function(){var e=this._worldSizeFactor;this._worldSize=[this._rect.width/e,this._rect.height/e]},n.setUvRect=function(){var e,t;this._texture?(e=this._texture.width,t=this._texture.height):(e=this._rect.width,t=this._rect.height),this._uvRect={u:this._rect.x/e,v:this._rect.y/t,width:this._rect.width/e,height:this._rect.height/t}},n.render=function(e){this._updatePositionQuad(e),this._transformByMatrix(),e._renderPipeline.pushSprite(this,this._positionQuad,this._uvRect,this.tintColor,this.texture,this.renderMode,e)},n._transformByMatrix=function(){if(this.transformMatrix){var e=this.transformMatrix,n=this._positionQuad.leftTop,r=t._tempVec40;r.setValue(n.x,n.y,n.z,1),n=this._positionQuad.leftBottom;var i=t._tempVec41;i.setValue(n.x,n.y,n.z,1),n=this._positionQuad.rightTop;var a=t._tempVec42;a.setValue(n.x,n.y,n.z,1),n=this._positionQuad.rightBottom;var o=t._tempVec43;o.setValue(n.x,n.y,n.z,1),T.transform(r,e,r),T.transform(i,e,i),T.transform(a,e,a),T.transform(o,e,o),this._positionQuad.leftTop.setValue(r.x,r.y,r.z),this._positionQuad.leftBottom.setValue(i.x,i.y,i.z),this._positionQuad.rightTop.setValue(a.x,a.y,a.z),this._positionQuad.rightBottom.setValue(o.x,o.y,o.z)}},n._updatePositionQuad=function(e){if("2D"===this.renderMode){var t=e.viewMatrix.elements,n=new s(t[0],t[4],t[8]),r=new s(t[1],t[5],t[9]),i=this.entity.worldPosition.clone(),a=this._worldSize,o=this.entity.scale;if(n.scale(a[0]*o.x),r.scale(a[1]*o.y),0!==this._rotationAngle){var u=new s(t[2],t[6],t[10]),c=new f;f.rotationAxisAngle(u,this._rotationAngle,c),s.transformByQuat(n,c,n),s.transformByQuat(r,c,r)}var l=new s,h=new s;s.scale(n,2*(this.anchor[0]-.5),l),s.scale(r,2*(this.anchor[1]-.5),h),i.subtract(l).add(h);var d=this._positionQuad.leftTop;s.subtract(i,n,d),d.add(r);var _=this._positionQuad.leftBottom;s.subtract(i,n,_),_.subtract(r);var m=this._positionQuad.rightBottom;s.add(i,n,m),m.subtract(r);var p=this._positionQuad.rightTop;s.add(i,n,p),p.add(r)}},S(t,[{key:"texture",get:function(){return this._texture},set:function(e){this.setTexture(e),this.setRect(),this.setUvRect(),this.setWorldSize()}},{key:"anchor",get:function(){return this._anchor},set:function(e){this._anchor=e||[.5,.5]}},{key:"rect",get:function(){return this._rect},set:function(e){this.setRect(e),this.setUvRect(),this.setWorldSize()}},{key:"rotationAngle",get:function(){return this._rotationAngle},set:function(e){this._rotationAngle=e}}]),t}(xt);gr._tempVec40=new T,gr._tempVec41=new T,gr._tempVec42=new T,gr._tempVec43=new T,(sr=or||(or={}))[sr.ONCE=0]="ONCE",sr[sr.LOOP=1]="LOOP",(cr=ur||(ur={}))[cr.FINISHED=0]="FINISHED",cr[cr.LOOP_END=1]="LOOP_END",cr[cr.FRAME_EVENT=2]="FRAME_EVENT",(fr=lr||(lr={}))[fr.LINEAR=0]="LINEAR",fr[fr.CUBICSPLINE=1]="CUBICSPLINE",fr[fr.STEP=2]="STEP",(dr=hr||(hr={}))[dr.position=0]="position",dr[dr.rotation=1]="rotation",dr[dr.scale=2]="scale",dr[dr.other=3]="other";var yr=function(e){function t(t){var n;return(n=e.call(this,null)||this).name=t,n.samplers=[],n.channels=[],n}R(t,e);var n=t.prototype;return n.addSampler=function(e,t,n,r){void 0===r&&(r=lr.LINEAR),r===lr.CUBICSPLINE&&(n<=4?r=lr.LINEAR:n/=3);var i={input:e,output:t,outputSize:n,interpolation:r};this.samplers.push(i)},n.addChannel=function(e,n,r){var i=this.samplers[e],a=t._tagetTypeMap[r],o={sampler:i,target:{id:n,path:r,pathType:null!=a?a:3}};this.channels.push(o)},n.getChannelCount=function(){return this.channels.length},n.getChannelObject=function(e){return this.channels[e]},n.getFrameCount=function(e){return this.channels[e].sampler.input.length},n.getFrameTime=function(e,t){return this.channels[e].sampler.input[t]},n.getChannelTimeLength=function(e){var t=this.channels[e].sampler,n=t.input.length;return t.input[n-1]},n.createChannelValue=function(e){var t=this.channels[e].sampler;return new Float32Array(t.outputSize)},n.evaluate=function(e,t,n,r,i){var a=this.channels[t],o=a.sampler.output,s=a.sampler.outputSize;switch(a.sampler.interpolation){case lr.CUBICSPLINE:this.evaluateCubicSpline(e,o,s,n,r,i);break;case lr.LINEAR:this.evaluateLinear(e,o,s,n,r,i)}return e},n.evaluateCubicSpline=function(e,t,n,r,i,a){for(var o=a*a,s=a*o,u=2*s-3*o+1,c=-2*s+3*o,l=s-2*o+a,f=s-o,h=n;h>=0;h--){var d=t[r*n*3+h],_=t[r*n*3+n+h],m=t[r*n*3+2*n+h],p=t[i*n*3+n+h];e[h]=_*u+p*c+d*l+m*f}},n.evaluateLinear=function(e,t,n,r,i,a){switch(n){case 1:e[0]=t[r]*(1-a)+t[i]*a;break;case 4:this._quaSlerp(e,t,r*n,t,i*n,a);break;default:for(var o=n;o>=0;o--)e[o]=t[r*n+o]*(1-a)+t[i*n+o]*a}},n._quaSlerp=function(e,t,n,r,i,a){var o,s,u,c,l,f=t[0+n],h=t[1+n],d=t[2+n],_=t[3+n],m=r[0+i],p=r[1+i],v=r[2+i],g=r[3+i];return(s=f*m+h*p+d*v+_*g)<0&&(s=-s,m=-m,p=-p,v=-v,g=-g),1-s>1e-6?(o=Math.acos(s),u=Math.sin(o),c=Math.sin((1-a)*o)/u,l=Math.sin(a*o)/u):(c=1-a,l=a),e[0]=c*f+l*m,e[1]=c*h+l*p,e[2]=c*d+l*v,e[3]=c*_+l*g,e},t}(ht);yr._tagetTypeMap={position:0,rotation:1,scale:2};var Er=function(e){function t(){var t;return(t=e.call(this,null)||this).layerWeight=1,t._activedEvents=[],t}R(t,e);var n=t.prototype;return n.canMix=function(e,t){if(!this._animClip||!this._isPlaying||this.isMixLayer||this.isFading)return!1;if(this._animClip.getChannelCount()!==e.getChannelCount())return!1;for(var n=this._animClip.getChannelCount()-1;n>=0;n--){var r=this._animClip.getChannelObject(n),i=this._findChannelTarget(t,r.target),a=e.getChannelObject(n);if(i!==this._findChannelTarget(t,a.target))return!1}return!0},n.mix=function(e,t,n,r,i){if(void 0===i&&(i={}),this._isPlaying=t.isPlaying,this._animClip=e,this._wrapMode=void 0!==i.wrapMode?i.wrapMode:t._wrapMode,this._addEvents(i),this._channelStates=[],this._animClipLength=0,this._isPlaying){for(var a=t._channelStates,o=this._animClip.getChannelCount()-1;o>=0;o--){var s=this._animClip.getChannelObject(o),u=this._findChannelTarget(r,s.target);this._channelStates[o]={frameTime:0,currentFrame:0,currentValue:this._animClip.createChannelValue(o),mixWeight:u?1:0},a[o].mixWeight=void 0===a[o].mixWeight?1:a[o].mixWeight,1===a[o].mixWeight&&(a[o].mixWeight=u?0:1);var c=this._animClip.getChannelTimeLength(o);this._animClipLength=this._animClipLength>c?this._animClipLength:c}return!0}return!1},n.removeMixWeight=function(){for(var e=this._channelStates.length-1;e>=0;e--)1===this._channelStates[e].mixWeight&&(this.mixTagetLayer._channelStates[e].mixWeight=1)},n.play=function(e,t,n){if(void 0===n&&(n={wrapMode:or.LOOP}),this._isPlaying=!!e,this._animClip=e,this._wrapMode=void 0!==n.wrapMode?n.wrapMode:or.LOOP,this._addEvents(n),this._channelStates=[],this._animClipLength=0,this._isPlaying){for(var r=[],i=this._animClip.getChannelCount()-1;i>=0;i--){var a=this._animClip.getChannelObject(i),o=this._findChannelTarget(t,a.target);o||Be.warn("Can not find channel target:"+a.target.id),this._channelStates[i]={frameTime:0,currentFrame:0,currentValue:this._animClip.createChannelValue(i)},r[i]={targetObject:o,path:a.target.path,pathType:a.target.pathType,outputSize:a.sampler.outputSize};var s=this._animClip.getChannelTimeLength(i);this._animClipLength=this._animClipLength>s?this._animClipLength:s}return r}return!1},n.stop=function(e){this._animClip&&this._isPlaying&&(e?this._isPlaying=!1:this._wrapMode=or.ONCE)},n.updateState=function(e){if(this._animClip&&this._isPlaying){this.isFading?(this.fadeDeltaTime+=e,this.layerWeight=1-this.fadeDeltaTime/this.fadeDuration,this.layerWeight<=0&&(this._isPlaying=!1)):this.crossFadeDuration&&(this.crossFadeDeltaTime+=e,this.layerWeight=this.crossFadeDeltaTime/this.crossFadeDuration,this.layerWeight>=1&&(this.layerWeight=1,delete this.crossFadeDuration)),e/=1e3,this._activeEvents(e);for(var t=0,n=this._animClip.getChannelCount()-1;n>=0;n--)this._updateChannelState(e,n)&&t++;0===t&&(this._isPlaying=!1,this.isMixLayer&&this.removeMixWeight())}},n.getChannelLayerWeight=function(e){return(this.hasMixLayer||this.isMixLayer)&&e<this._channelStates.length?this._channelStates[e].mixWeight*(this.isMixLayer?this.mixTagetLayer.layerWeight:this.layerWeight):this.layerWeight},n.getChannelValue=function(e){return this._channelStates[e].currentValue},n.triggerEvents=function(){var e=this;this._activedEvents&&this._activedEvents.forEach((function(t){e.trigger(t)})),this._activedEvents.length=0},n.jumpToFrame=function(e){for(var t=this._animClip.getChannelCount()-1;t>=0;t--){this._channelStates[t].frameTime=0,this._updateChannelState(e,t)}},n._updateChannelState=function(e,t){var n=this._animClip,r=this._channelStates[t],i=n.getChannelTimeLength(t);if(r.frameTime+=e,r.frameTime>i)switch(this._wrapMode){case or.ONCE:r.frameTime=i;break;case or.LOOP:r.frameTime=r.frameTime%this._animClipLength;break;default:Be.error("Unknown Anim wrap Mode: "+this._wrapMode)}if(r.mixWeight&&0===r.mixWeight)return!0;var a=Math.min(r.frameTime,i),o=this._getKeyAndAlpha(n.getChannelObject(t),a);return r.currentValue=n.evaluate(r.currentValue,t,o.currentKey,o.nextKey,o.alpha),!(this._wrapMode===or.ONCE&&r.frameTime>=i)},n._addEvents=function(e){var t=this;if(this.removeAllEventListeners(),this._frameEvents=[],e.events)for(var n=0,r=function(r){var i=e.events[r],a=i.type;i.type===ur.FRAME_EVENT&&(a="frameEvent"+n,n++,t._frameEvents.push({eventType:a,triggerTime:i.triggerTime,triggered:!1})),t.addEventListener(a,(function(e){i.callback()}))},i=e.events.length-1;i>=0;i--)r(i)},n._activeEvents=function(e){var t=this._animClip.durationIndex;if(this._frameEvents.length>0&&this._channelStates.length>0)for(var n=this._channelStates[t].frameTime+e,r=this._frameEvents.length-1;r>=0;r--){var i=this._frameEvents[r];!i.triggered&&n>i.triggerTime&&(this._activedEvents.push(new G(i.eventType,this)),i.triggered=!0)}if(this._channelStates.length>0&&this._channelStates[t].frameTime+e>=this._animClip.duration)if(this._wrapMode===or.LOOP){if(this._frameEvents.length>0)for(var a=this._frameEvents.length-1;a>=0;a--)this._frameEvents[a].triggered=!1;this.hasEvent(ur.LOOP_END)&&this._activedEvents.push(new G(ur.LOOP_END,this))}else this.hasEvent(ur.FINISHED)&&this._activedEvents.push(new G(ur.FINISHED,this))},n._findChannelTarget=function(e,t){var n=t.id,r=null;return r=e.name===n?e:e.findByName(n),"weights"===t.path?r.getComponent(wn):r},n._getKeyAndAlpha=function(e,t){for(var n=0,r=0,i=0,a=e.sampler.input,o=a.length,s=o-1;s>=0;s--)if(t>a[s]){n=t-a[s],r=s;break}if((i=r+1)>=o)switch(this._wrapMode){case or.ONCE:i=o-1;break;case or.LOOP:i=0}var u=a[i]-a[r];return{currentKey:r,nextKey:i,alpha:i===r||u<1e-5?1:n/u}},S(t,[{key:"isPlaying",get:function(){return this._animClip&&this._isPlaying}}]),t}($),Tr=Object.defineProperty,xr=Object.getOwnPropertyDescriptor,Ar=function(e,t,n,r){for(var i,a=r>1?void 0:r?xr(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Tr(t,n,a),a},Or=function(e){function t(t){var n;return(n=e.call(this,t)||this)._onUpdateIndex=-1,n._animSet={},n._animLayers=[new Er],n._timeScale=1,n}R(t,e),t.lerp=function(e,t,n,r,i){switch(i){case 1:e=t*(1-r)+n*r;break;case 4:var a=C(f,t),o=C(f,n),s=new f;f.slerp(a,o,r,s),e[0]=s.x,e[1]=s.y,e[2]=s.z,e[3]=s.w;break;default:for(var u=i;u>=0;u--)e[u]=t[u]*(1-r)+n[u]*r}return e};var n=t.prototype;return n.update=function(e){if(this.isPlaying()){e*=this._timeScale;for(var t=this._animLayers.length-1;t>=0;t--){this._animLayers[t].updateState(e)}this._updateValues();for(var n=this._animLayers.length-1;n>=0;n--){var r=this._animLayers[n];r.triggerEvents(),r.isPlaying||!r.isFading&&!r.isMixLayer||(this._animLayers.splice(n,1),this._removeRefMixLayers(r))}}},n.addAnimationClip=function(e,t){this._animSet[t]=e},n.removeAnimationClip=function(e){this._animSet[e]&&delete this._animSet[e]},n.getAnimationClipLength=function(e){var t=this._animSet[e];return t?t.getChannelTimeLength(0):0},n.getAnimationClip=function(e){return this._animSet[e]||null},n.isPlaying=function(){for(var e=this._animLayers.length-1;e>=0;e--)if(this._animLayers[e].isPlaying)return!0;return!1},n.playAnimationClip=function(e,t){var n=this._animSet[e];if(n){for(var r=null,i=this._animLayers.length-1;i>=0;i--)if(!this._animLayers[i].isFading&&!this._animLayers[i].isMixLayer){r=this._animLayers[i];break}r||(r=new Er,this._animLayers.push(r)),this._removeRefMixLayers(r),this._channelTargets=r.play(n,this.entity,t)}else Be.error("can not find anim clip: "+e)},n.crossFade=function(e,t,n){var r=this._animSet[e];if(r)if(!t||t<0)Be.error("crossFadeDuration can not less than 0!");else{for(var i=null,a=this._animLayers.length-1;a>=0;a--)if(this._animLayers[a].canMix(r,this.entity)){i=this._animLayers[a];break}if(i){for(var o=this._animLayers.length-1;o>=0;o--)this._animLayers[o].isFading&&this._animLayers.splice(o,1);i.isFading=!0,i.fadeDuration=t,i.fadeDeltaTime=0;var s=new Er;s.crossFadeDuration=t,s.crossFadeDeltaTime=0,s.play(r,this.entity,n),this._animLayers.push(s)}else this.playAnimationClip(e,n)}else Be.error("can not find anim clip: "+e)},n.mix=function(e,t,n){var r=this._animSet[e];if(r){var i=this.entity.findByName(t);if(i){for(var a=null,o=this._animLayers.length-1;o>=0;o--)if(this._animLayers[o].canMix(r,this.entity)){a=this._animLayers[o];break}if(a){this._removeRefMixLayers(null,i),a.hasMixLayer=!0;var s=new Er;s.isMixLayer=!0,s.mixTagetLayer=a,s.mixEntity=i,s.mix(r,a,this.entity,i,n),this._animLayers.push(s)}}else Be.error("can not find mix bone!")}else Be.error("can not find anim clip: "+e)},n.stop=function(e){for(var t=this._animLayers.length-1;t>=0;t--)this._animLayers[t].isFading?this._animLayers.splice(t,1):this._animLayers[t].stop(e)},n.jumpToFrame=function(e){e/=1e3;for(var t=this._animLayers.length-1;t>=0;t--)this._animLayers[t].jumpToFrame(e);this._updateValues()},n._removeRefMixLayers=function(e,t){if(e&&e.hasMixLayer)for(var n=this._animLayers.length-1;n>=0;n--){var r=this._animLayers[n];r.isMixLayer&&r.mixTagetLayer===e&&(r.removeMixWeight(),this._animLayers.splice(n,1))}if(t)for(var i=this._animLayers.length-1;i>=0;i--){var a=this._animLayers[i];a.isMixLayer&&(a.mixEntity===t||a.mixEntity.findByName(t)||t.findByName(a.mixEntity))&&(a.removeMixWeight(),this._animLayers.splice(i,1))}},n._updateValues=function(){if(0!==this._animLayers.length&&this._channelTargets)for(var e=this._channelTargets.length-1;e>=0;e--){var t=this._channelTargets[e],n=this._getChannelValue(e,t.outputSize),r=t.targetObject,i=t.path;if("weights"===i)r.setWeights(n);else{var a=n,o=r.transform;switch(t.pathType){case hr.position:var s=o.position;s.setValue(a[0],a[1],a[2]),o.position=s;break;case hr.rotation:var u=o.rotationQuaternion;u.setValue(a[0],a[1],a[2],a[3]),o.rotationQuaternion=u;break;case hr.scale:var c=o.scale;c.setValue(a[0],a[1],a[2]),o.scale=c;break;default:r[i]=n}}}},n._getChannelValue=function(e,n){for(var r=[],i=[],a=this._animLayers.length-1;a>=0;a--){var o=this._animLayers[a].getChannelLayerWeight(e);o>0&&(r.push(o),i.push(this._animLayers[a].getChannelValue(e)))}return 1===i.length?i[0]:2===i.length?t.lerp(i[0],i[0],i[1],r[1],n):(Be.error("Can not get channel value!"),!1)},n._onEnable=function(){this.engine._componentsManager.addOnUpdateAnimations(this)},n._onDisable=function(){this.engine._componentsManager.removeOnUpdateAnimations(this)},S(t,[{key:"timeScale",get:function(){return this._timeScale},set:function(e){e>0&&(this._timeScale=e)}}]),t}(Ze);Ar([k],Or.prototype,"_onUpdateIndex",2),Ar([j],Or.prototype,"_animSet",2),Ar([k],Or.prototype,"_animLayers",2),Ar([k],Or.prototype,"_timeScale",2),Ar([k],Or.prototype,"_channelTargets",2);var br=function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this).renderStates={enable:[],disable:[],functions:{}},r.emission=new T(0,0,0,1),r.ambient=new T(0,0,0,1),r.renderStates={},r}R(t,e);var n=t.prototype;return n.prepareDrawing=function(t,n,r){var i=t.camera,a=i.scene.findFeature($t);a.bindMaterialValues(this);var o=a.lightSortAmount.ambientLightCount;this._technique&&this._ambientLightCount===o||(this._ambientLightCount=o,this._generateTechnique(),this.bindLightUniformDefine(i)),e.prototype.prepareDrawing.call(this,t,n,r)},n.bindLightUniformDefine=function(e){var t=e.scene.findFeature($t);this._technique.uniforms=x({},t.getUniformDefine(),this._technique.uniforms)},n._internalGenerate=function(e,t){var n=this._generateMacros(),r=this._generateFragmentUniform(),i=new ar(e);i.isValid=!0,i.uniforms=r,i.attributes={},i.states=this.renderStates,i.customMacros=n,i.vertexShader="#include <common>\n#include <common_vert>\n#include <uv_share>\n#include <normal_share>\n#include <worldpos_share>\n#include <shadow_share>\n#include <morph_target_vert>\n\n#include <fog_share>\n\nvoid main() {\n\n    #include <begin_position_vert>\n    #include <begin_normal_vert>\n\n    #include <morph_vert>\n    #include <skinning_vert>\n    #include <uv_vert>\n    #include <normal_vert>\n    #include <worldpos_vert>\n    #include <shadow_vert>\n    #include <position_vert>\n\n    #include <fog_vert>\n\n}\n",i.fragmentShader=t,this._technique=i},n._generateMacros=function(){var e=[];return this.emission instanceof Rn&&e.push("O3_EMISSION_TEXTURE"),this.ambient instanceof Rn&&e.push("O3_AMBIENT_TEXTURE"),this._ambientLightCount&&e.push("O3_HAS_AMBIENT_LIGHT"),e},n._generateFragmentUniform=function(){var e={u_emission:{name:"u_emission",type:ge.FLOAT_VEC4},u_ambient:{name:"u_ambient",type:ge.FLOAT_VEC4}};return this.emission instanceof Rn&&(e.u_emission.type=ge.SAMPLER_2D),this.ambient instanceof Rn&&(e.u_ambient.type=ge.SAMPLER_2D),e},S(t,[{key:"emission",get:function(){return this.getValue("u_emission")},set:function(e){this.setValue("u_emission",e)}},{key:"ambient",get:function(){return this.getValue("u_ambient")},set:function(e){this.setValue("u_ambient",e)}}]),t}(Hn),Mr=function(e){function t(){return e.apply(this,arguments)||this}return R(t,e),t.prototype._generateTechnique=function(){this._internalGenerate("ConstantMaterial","#include <common>\n#include <common_frag>\n#include <uv_share>\n#include <mobile_material_frag>\n\n#include <fog_share>\n#include <ambient_light_frag>\n\nvoid main() {\n\n    #include <begin_mobile_frag>\n\n    gl_FragColor = emission + ambient;\n\n    #include <fog_frag>\n\n}\n")},t}(br),Sr=function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this)._directLightCount=0,r.diffuse=new T(1,1,1,1),r}R(t,e);var n=t.prototype;return n._generateTechnique=function(){this._internalGenerate("LambertMaterial","#include <common>\n#include <common_frag>\n#include <uv_share>\n#include <normal_share>\n\n#include <ambient_light_frag>\n#include <direct_light_frag>\n#include <mobile_material_frag>\n\n#include <fog_share>\n\nvoid main() {\n\n    #include <begin_mobile_frag>\n    #include <begin_normal_frag>\n    #include <mobile_lambert_frag>\n\n    gl_FragColor = emission + ambient + diffuse;\n\n    #include <fog_frag>\n\n}\n")},n.prepareDrawing=function(t,n,r){var i=t.camera,a=i.scene.findFeature($t).lightSortAmount.directLightCount;null!==this._technique&&this._directLightCount==a||(this._directLightCount=a,this._generateTechnique(),this.bindLightUniformDefine(i)),e.prototype.prepareDrawing.call(this,t,n,r)},n._generateFragmentUniform=function(){var t={};this.diffuse instanceof Rn?t.u_diffuse={name:"u_diffuse",type:ge.SAMPLER_2D}:t.u_diffuse={name:"u_diffuse",type:ge.FLOAT_VEC4};var n=e.prototype._generateFragmentUniform.call(this);return Object.assign(n,t)},n._generateMacros=function(){var t=e.prototype._generateMacros.call(this);return t.push("O3_NEED_WORLDPOS"),this._directLightCount>0&&t.push("O3_DIRECT_LIGHT_COUNT "+this._directLightCount),this.diffuse instanceof Rn&&t.push("O3_DIFFUSE_TEXTURE"),t},S(t,[{key:"diffuse",get:function(){return this.getValue("u_diffuse")},set:function(e){this.setValue("u_diffuse",e)}}]),t}(br),Rr=function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this)._directLightCount=0,r._pointLightCount=0,r._spotLightCount=0,r.diffuse=new T(1,1,1,1),r.specular=new T(1,1,1,1),r.shininess=16,r}R(t,e);var n=t.prototype;return n._generateTechnique=function(){this._internalGenerate("BlinnPhongMaterial","#include <common>\n#include <common_frag>\n\n#include <uv_share>\n#include <normal_share>\n#include <worldpos_share>\n\n#include <ambient_light_frag>\n#include <direct_light_frag>\n#include <point_light_frag>\n#include <spot_light_frag>\n#include <mobile_material_frag>\n\n#include <fog_share>\n\nvoid main() {\n\n    #include <begin_mobile_frag>\n    #include <begin_normal_frag>\n    #include <begin_viewdir_frag>\n    #include <mobile_blinnphong_frag>\n\n    gl_FragColor = emission + ambient + diffuse + specular;\n\n    #include <fog_frag>\n\n}\n")},n._generateMacros=function(){var t=e.prototype._generateMacros.call(this);return t.push("O3_NEED_WORLDPOS"),this.diffuse instanceof Rn&&t.push("O3_DIFFUSE_TEXTURE"),this.specular instanceof Rn&&t.push("O3_SPECULAR_TEXTURE"),this._directLightCount>0&&t.push("O3_DIRECT_LIGHT_COUNT "+this._directLightCount),this._pointLightCount>0&&t.push("O3_POINT_LIGHT_COUNT "+this._pointLightCount),this._spotLightCount>0&&t.push("O3_SPOT_LIGHT_COUNT "+this._spotLightCount),t},n.prepareDrawing=function(t,n,r){var i=t.camera,a=i.scene.findFeature($t).lightSortAmount,o=a.directLightCount,s=a.pointLightCount,u=a.spotLightCount;null!==this._technique&&this._directLightCount==o&&this._pointLightCount==s&&this._spotLightCount==u||(this._directLightCount=o,this._pointLightCount=s,this._spotLightCount=u,this._generateTechnique(),this.bindLightUniformDefine(i)),e.prototype.prepareDrawing.call(this,t,n,r)},n._generateFragmentUniform=function(){var t={};this.diffuse instanceof Rn?t.u_diffuse={name:"u_diffuse",type:ge.SAMPLER_2D}:t.u_diffuse={name:"u_diffuse",type:ge.FLOAT_VEC4},this.specular instanceof Rn?t.u_specular={name:"u_specular",type:ge.SAMPLER_2D}:t.u_specular={name:"u_specular",type:ge.FLOAT_VEC4},t.u_shininess={name:"u_shininess",type:ge.FLOAT};var n=e.prototype._generateFragmentUniform.call(this);return Object.assign(n,t)},S(t,[{key:"diffuse",get:function(){return this.getValue("u_diffuse")},set:function(e){this.setValue("u_diffuse",e)}},{key:"specular",get:function(){return this.getValue("u_specular")},set:function(e){this.setValue("u_specular",e)}},{key:"shininess",get:function(){return this.getValue("u_shininess")},set:function(e){this.setValue("u_shininess",e)}}]),t}(br),Lr="#include <common>\n#include <common_frag>\n\nuniform sampler2D u_diffuse;\nvarying vec3 v_pos;\nuniform vec4 u_tintColor;\nuniform float u_opacity;\n\nvoid main()\n{\n  #ifdef O3_DIFFUSE_TEXTURE\n    gl_FragColor = texture2D(u_diffuse, v_uv);\n  #else\n    gl_FragColor = vec4(1);\n  #endif\n}\n",Cr=function(e){function t(t,n){return e.call(this,t,n||"TextureMaterial")||this}R(t,e);var n=t.prototype;return n._generateTechnique=function(){this._internalGenerate("Texture",Lr)},n.setValue=function(t,n){"doubleSided"===t&&this._setDoubleSidedDisplay(n),e.prototype.setValue.call(this,t,n)},n._generateFragmentUniform=function(){var t={};return this.texture instanceof Rn&&(t.u_diffuse={name:"u_diffuse",paramName:"_MainTex",type:ge.SAMPLER_2D}),x({},e.prototype._generateFragmentUniform.call(this),t)},n._generateMacros=function(){var t=e.prototype._generateMacros.call(this);return this.texture instanceof Rn&&t.push("O3_DIFFUSE_TEXTURE"),t},n._setDoubleSidedDisplay=function(e){this._technique.states.disable=[],e&&this._technique.states.disable.push(oe.CULL_FACE)},S(t,[{key:"texture",get:function(){return this.getValue("u_diffuse")},set:function(e){this.setValue("u_diffuse",e)}},{key:"doubleSided",get:function(){return this.getValue("doubleSided")},set:function(e){this.setValue("doubleSided",e)}}]),t}(br);Cr.TECH_NAME="Texture";var Ir=function(e){function t(t,n){return e.call(this,t,n||"TransparentMaterial")||this}R(t,e);var n=t.prototype;return n._generateTechnique=function(){this.renderStates={enable:[oe.BLEND],disable:[oe.CULL_FACE],functions:{blendFunc:[xe.SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA],depthMask:[!1]}},this.renderType=ie.TRANSPARENT,this._internalGenerate("Transparent",Lr)},n._generateFragmentUniform=function(){var t={};return this.texture instanceof Rn&&(t.u_diffuse={name:"u_diffuse",paramName:"_MainTex",type:ge.SAMPLER_2D}),x({},e.prototype._generateFragmentUniform.call(this),t)},n._generateMacros=function(){var t=e.prototype._generateMacros.call(this);return this.texture instanceof Rn&&t.push("O3_DIFFUSE_TEXTURE"),t},S(t,[{key:"texture",get:function(){return this.getValue("u_diffuse")},set:function(e){this.setValue("u_diffuse",e)}}]),t}(br);Ir.TECH_NAME="Transparent";var wr=function(e){function t(n,r){var i;return(i=e.call(this,n,r)||this).vertexShader="",i.fragmentShader="",i.isValid=!0,i.attributes={},i._uniforms=t.commonUniforms,i._renderStates={enable:[],disable:[],functions:{}},i._enableConfig=[],i._disableConfig=[],i._functionsConfig={blendFunc:[xe.SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA]},i}R(t,e);var n=t.prototype;return n.prepareDrawing=function(t,n,r){var i=t.camera;if(!this._technique){var a=this._generateTechnique(i,n,r);this._technique=a}e.prototype.prepareDrawing.call(this,t,n,r)},n.updateTechnique=function(){this._technique=null},n._generateTechnique=function(e,t,n){var r=new ar("ShaderMaterial");return r.isValid=this.isValid,r.uniforms=this.uniforms,r.attributes=this.attributes,r.states=this.renderStates,r.vertexShader=this.vertexShader,r.fragmentShader=this.fragmentShader,r},n.addState=function(e,t){this.renderStates[e]=Pr(this.renderStates[e],t)},n.removeState=function(e,t){this.renderStates[e]=this.renderStates[e].filter((function(e){return e!==t}))},S(t,[{key:"renderStates",get:function(){return this._renderStates},set:function(e){var n=e.enable,r=void 0===n?[]:n,i=e.disable,a=void 0===i?[]:i,o=e.functions,s=void 0===o?{}:o,u=r.filter((function(e){return t.commonEnable.indexOf(e)<0})),c=a.filter((function(e){return t.commonDisable.indexOf(e)<0}));this._renderStates.enable=Pr(u,this._enableConfig),this._renderStates.disable=Pr(c,this._disableConfig),this._renderStates.functions=Object.assign({},s,this._functionsConfig)}},{key:"uniforms",get:function(){return this._uniforms},set:function(e){this._uniforms=Object.assign({},t.commonUniforms,e)}},{key:"blend",set:function(e){e?this._enableConfig=Pr(this._enableConfig,[oe.BLEND]):(this._enableConfig=this._enableConfig.filter((function(e){return e!==oe.BLEND})),this.removeState("enable",oe.BLEND)),this.renderStates=this._renderStates}},{key:"blendSrcFactor",set:function(e){this._functionsConfig.blendFunc[0]=e,this.renderStates=this._renderStates}},{key:"blendDstFactor",set:function(e){this._functionsConfig.blendFunc[1]=e,this.renderStates=this._renderStates}},{key:"doubleSide",set:function(e){e?this._disableConfig=Pr(this._disableConfig,[oe.CULL_FACE]):(this._disableConfig=this._disableConfig.filter((function(e){return e!==oe.CULL_FACE})),this.removeState("disable",oe.CULL_FACE)),this.renderStates=this._renderStates}},{key:"depthTest",set:function(e){e?(this._disableConfig=this._disableConfig.filter((function(e){return e!==oe.DEPTH_TEST})),this.removeState("disable",oe.DEPTH_TEST)):this._disableConfig=Pr(this._disableConfig,[oe.DEPTH_TEST]),this.renderStates=this._renderStates}}]),t}(Hn);function Pr(e,t){return e.concat(t.filter((function(t){return!(e.indexOf(t)>-1)})))}wr.commonUniforms={matModelViewProjection:{name:"matModelViewProjection",semantic:Ee.MODELVIEWPROJECTION,type:ge.FLOAT_MAT4},matModelView:{name:"matModelView",semantic:Ee.MODELVIEW,type:ge.FLOAT_MAT4}},wr.commonEnable=[oe.BLEND],wr.commonDisable=[oe.CULL_FACE,oe.DEPTH_TEST];var Nr,Fr,Dr=function(e){function t(t,n){var r;return(r=e.call(this,t)||this)._subGeometries=[],r._primitive=new Jn(t),r.name=n,r}R(t,e);var n=t.prototype;return n.setVertexBufferBinding=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this._primitive.setVertexBufferBinding(e,t,n)},n.setVertexBufferBindings=function(e,t){void 0===t&&(t=0),this._primitive.setVertexBufferBindings(e,t)},n.setIndexBufferBinding=function(e,t){this._primitive.setIndexBufferBinding(e,t)},n.setVertexElements=function(e){this._primitive.setVertexElements(e)},n.addSubGeometry=function(e,t,n){void 0===n&&(n=qn.Triangles);var r=new er(e,t,n);return this._subGeometries.push(r),r},n.removeSubGeometry=function(e){var t=this._subGeometries,n=t.indexOf(e);-1!==n&&t.splice(n,1)},n.clearSubGeometry=function(){this._subGeometries.length=0},n.destroy=function(){this._primitive&&(this._primitive.destroy(),this._primitive=null)},S(t,[{key:"vertexBufferBindings",get:function(){return this._primitive.vertexBufferBindings}},{key:"indexBufferBinding",get:function(){return this._primitive.indexBufferBinding}},{key:"vertexElements",get:function(){return this._primitive.vertexElements}},{key:"subGeometry",get:function(){return this._subGeometries[0]||null}},{key:"subGeometries",get:function(){return this._subGeometries}},{key:"instanceCount",get:function(){return this._primitive.instanceCount},set:function(e){this._primitive.instanceCount=e}},{key:"bounds",get:function(){return this._bounds},set:function(e){this._bounds=e}}]),t}(Q),Ur=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.render=function(e){var t=this.geometry;if(t){for(var n=t.subGeometries,r=e._renderPipeline,i=this._material,a=0,o=n.length;a<o;a++)if(i){var s=at.getFromPool();s.setValue(this,t._primitive,n[a],i),r.pushPrimitive(s)}}else Be.error("geometry is null.")},n._updateBounds=function(e){var t=this._geometry.bounds;if(t){var n=this._entity.transform.worldMatrix;s.transformCoordinate(t.min,n,e.min),s.transformCoordinate(t.max,n,e.max)}else e.min.setValue(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),e.max.setValue(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)},S(t,[{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry&&this._geometry._primitive._addRefCount(-1),e._primitive._addRefCount(1),this._geometry=e}},{key:"material",get:function(){return this._material},set:function(e){this._material&&this._material._addRefCount(-1),e._addRefCount(1),this._material=e}}]),t}(xt),Vr=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n._initialize=function(e,t,n){var r=[new $n("POSITION",0,Fn.Vector3,0),new $n("NORMAL",12,Fn.Vector3,0),new $n("TEXCOORD_0",24,Fn.Vector2,0)];this._initBuffer(e,t,n,32,r)},n._initBuffer=function(e,t,n,r,i){var a=i[0],o=new Kn(e,Gn.VertexBuffer,t,Pn.Static),s=new Kn(e,Gn.IndexBuffer,n,Pn.Static);this.setVertexBufferBinding(o,r),this.setIndexBufferBinding(s,Un.UInt16),this.setVertexElements(i),this.addSubGeometry(0,n.length),this._computeBounds(a,t)},n._computeBounds=function(e,t){var n=e,r=n.bindingIndex,i=this._primitive.vertexBufferBindings[r],a=i.stride,o=n.offset,u=i.buffer.byteLength/a,c=t;c instanceof ArrayBuffer||(c=c.buffer);for(var l=new DataView(c,o),f=new s(1/0,1/0,1/0),h=new s(-1/0,-1/0,-1/0),d=0;d<u;d++){var _=o+a*d,m=new s(l.getFloat32(_,!0),l.getFloat32(_+4,!0),l.getFloat32(_+8,!0));s.min(f,m,f),s.max(h,m,h)}var p=this.bounds;p?(f.cloneTo(p.min),h.cloneTo(p.max)):(p={min:f,max:h},this.bounds=p)},t}(Dr),Br=function(e){function t(t,n,r,i){var a;void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),a=e.call(this,t)||this;var o=n/2,s=r/2,u=i/2,c=new Float32Array([-o,s,-u,0,1,0,0,0,o,s,-u,0,1,0,1,0,o,s,u,0,1,0,1,1,-o,s,u,0,1,0,0,1,-o,-s,-u,0,-1,0,0,1,o,-s,-u,0,-1,0,1,1,o,-s,u,0,-1,0,1,0,-o,-s,u,0,-1,0,0,0,-o,s,-u,-1,0,0,0,0,-o,s,u,-1,0,0,1,0,-o,-s,u,-1,0,0,1,1,-o,-s,-u,-1,0,0,0,1,o,s,-u,1,0,0,1,0,o,s,u,1,0,0,0,0,o,-s,u,1,0,0,0,1,o,-s,-u,1,0,0,1,1,-o,s,u,0,0,1,0,0,o,s,u,0,0,1,1,0,o,-s,u,0,0,1,1,1,-o,-s,u,0,0,1,0,1,-o,s,-u,0,0,-1,1,0,o,s,-u,0,0,-1,0,0,o,-s,-u,0,0,-1,0,1,-o,-s,-u,0,0,-1,1,1]),l=new Uint16Array([0,2,1,2,0,3,4,6,7,6,4,5,8,10,9,10,8,11,12,14,15,14,12,13,16,18,17,18,16,19,20,22,23,22,20,21]);return a._initialize(t,c,l),a}return R(t,e),t}(Vr),Hr=function(e){function t(t,n,r,i,a,o,s,u){var c;return void 0===n&&(n=1),void 0===r&&(r=8),void 0===i&&(i=6),void 0===a&&(a=0),void 0===o&&(o=2*Math.PI),void 0===s&&(s=0),void 0===u&&(u=Math.PI),(c=e.call(this,t)||this)._parameters={radius:n||1,horizontalSegments:Math.max(3,Math.floor(r)),verticalSegments:Math.max(2,Math.floor(i)),alphaStart:a,alphaRange:o,thetaStart:s,thetaRange:u},c._thetaEnd=c._parameters.thetaStart+c._parameters.thetaRange,c.initialize(t),c}return R(t,e),t.prototype.initialize=function(e){for(var t=this._parameters,n=t.verticalSegments,r=t.horizontalSegments,i=0,a=[],o=new Float32Array((n+1)*(r+1)*8),s=[],u=0;u<=n;u++){for(var c=[],l=u/n,f=0;f<=r;f++){var h=f/r,d=-this._parameters.radius*Math.cos(this._parameters.alphaStart+h*this._parameters.alphaRange)*Math.sin(this._parameters.thetaStart+l*this._parameters.thetaRange),_=this._parameters.radius*Math.cos(this._parameters.thetaStart+l*this._parameters.thetaRange),m=this._parameters.radius*Math.sin(this._parameters.alphaStart+h*this._parameters.alphaRange)*Math.sin(this._parameters.thetaStart+l*this._parameters.thetaRange);d=Math.abs(d)<1e-6?0:d,_=Math.abs(_)<1e-6?0:_,m=Math.abs(m)<1e-6?0:m;var p=8*i;o[p]=d,o[p+1]=_,o[p+2]=m,o[p+3]=d,o[p+4]=_,o[p+5]=m,o[p+6]=h,o[p+7]=1-l,c.push(i++)}a.push(c)}for(var v=0;v<n;v++)for(var g=0;g<r;g++){var y=a[v][g+1],E=a[v][g],T=a[v+1][g],x=a[v+1][g+1];(0!==v||this._parameters.thetaStart>0)&&s.push(y,E,x),(v!==n-1||this._thetaEnd<Math.PI)&&s.push(E,T,x)}this._initialize(e,o,Uint16Array.from(s))},t}(Vr),zr=function(e){function t(t,n,r,i,a){var o;return void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),void 0===a&&(a=1),(o=e.call(this,t)||this)._parameters={width:n,height:r,horizontalSegments:Math.floor(i),verticalSegments:Math.floor(a)},o.halfWidth=o._parameters.width/2,o.halfHeight=o._parameters.height/2,o.initialize(t),o}return R(t,e),t.prototype.initialize=function(e){for(var t=this._parameters,n=t.verticalSegments,r=t.horizontalSegments,i=0,a=0,o=[],s=new Float32Array((n+1)*(r+1)*8),u=new Uint16Array(n*r*6),c=0;c<=n;c++){for(var l=[],f=c/n,h=0;h<=r;h++){var d=h/r,_=d*this._parameters.width-this.halfWidth,m=f*this._parameters.height-this.halfHeight;s[a++]=_,s[a++]=m,s[a++]=0,s[a++]=0,s[a++]=0,s[a++]=1,s[a++]=d,s[a++]=1-f,l.push(i++)}o.push(l)}i=0;for(var p=0;p<n;p++)for(var v=0;v<r;v++){var g=o[p][v+1],y=o[p][v],E=o[p+1][v],T=o[p+1][v+1];u[i++]=g,u[i++]=E,u[i++]=y,u[i++]=g,u[i++]=T,u[i++]=E}this._initialize(e,s,u)},t}(Vr),Gr=function(e){function t(t,n,r,i,a,o,s,u,c,l){var f;return void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),void 0===a&&(a=8),void 0===o&&(o=1),void 0===s&&(s=!1),void 0===u&&(u=0),void 0===c&&(c=2*Math.PI),void 0===l&&(l=ue.CCW),(f=e.call(this,t)||this).FrontFace=l,f._parameters={radiusTop:n,radiusBottom:r,height:i,radialSegments:a,heightSegments:o,openEnded:s,thetaStart:u,thetaLength:c},f._vertices=[],f._indices=[],f.index=0,f.indexArray=[],f.halfHeight=f._parameters.height/2,f.generateTorso(),!1===f._parameters.openEnded&&(f._parameters.radiusTop>0&&f.generateCap(!0),f._parameters.radiusBottom>0&&f.generateCap(!1)),f._initialize(t,Float32Array.from(f._vertices),Uint16Array.from(f._indices)),f}R(t,e);var n=t.prototype;return n.generateTorso=function(){var e,t,n=this._parameters,r=n.radialSegments,i=n.heightSegments,a=n.radiusBottom,o=n.radiusTop,u=n.height,c=new s,l=(a-o)/u;for(t=0;t<=i;t++){var f=[],h=t/i,d=h*(a-o)+o;for(e=0;e<=r;e++){var _=e/r,m=_*this._parameters.thetaLength+this._parameters.thetaStart,p=Math.sin(m),v=Math.cos(m),g=d*p,y=-h*u+this.halfHeight,E=d*v;this._vertices.push(g,y,E),c.setValue(p,l,v),c.normalize(),this._vertices.push(c.x,c.y,c.z),this.FrontFace===ue.CCW?this._vertices.push(_,h):this._vertices.push(1-_,h),f.push(this.index++)}this.indexArray.push(f)}for(e=0;e<r;e++)for(t=0;t<i;t++){var T=this.indexArray[t][e],x=this.indexArray[t+1][e],A=this.indexArray[t+1][e+1],O=this.indexArray[t][e+1];this._indices.push(T,x,O),this._indices.push(x,A,O)}},n.generateCap=function(e){var t,n=this._parameters.radialSegments,r=!0===e?this._parameters.radiusTop:this._parameters.radiusBottom,i=!0===e?1:-1,a=this.index;for(t=1;t<=n;t++)this._vertices.push(0,this.halfHeight*i,0),this._vertices.push(0,i,0),this._vertices.push(.5,.5),this.index++;var o=this.index;for(t=0;t<=n;t++){var s=t/n*this._parameters.thetaLength+this._parameters.thetaStart,u=Math.cos(s),c=Math.sin(s),l=r*c,f=this.halfHeight*i,h=r*u;this._vertices.push(l,f,h),this._vertices.push(0,i,0);var d=.5*u+.5,_=.5*c*i+.5;this._vertices.push(d,_),this.index++}for(t=0;t<n;t++){var m=a+t,p=o+t;!0===e?this._indices.push(p,p+1,m):this._indices.push(p+1,p,m)}},t}(Vr),kr=function(e){function t(t,n){var r;void 0===n&&(n={}),(r=e.call(this,t)||this).radius=1,r.segments=16,r.thetaStart=0,r.thetaLength=2*Math.PI,r.radius=n.radius||r.radius,r.segments=n.segments||r.segments,r.thetaStart=n.thetaStart||r.thetaStart,r.thetaLength=n.thetaLength||r.thetaLength;var i=A(r),a=i.segments,o=i.radius,s=new Float32Array(8*(a+2));s.set([0,0,0,0,0,1,.5,.5]);for(var u=8,c=0;c<=a;c++){var l=r.thetaStart+c/a*r.thetaLength,f=o*Math.cos(l),h=o*Math.sin(l);s[u++]=f,s[u++]=h,s[u++]=0,s[u++]=0,s[u++]=0,s[u++]=1,s[u++]=.5*(f/o+1),s[u++]=.5*(h/o+1)}var d=new Uint16Array(3*a);u=0;for(var _=1;_<=a;_++)d[u++]=_,d[u++]=_+1,d[u++]=0;return r._initialize(t,s,d),r}return R(t,e),t}(Vr),jr=function(e){function t(t){var n;n=e.call(this,t)||this;var r=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),i=new Uint16Array([0,1,2,3]);return n._initialize(t,r,i),n.subGeometry.topology=qn.TriangleFan,n}return R(t,e),t.prototype._initialize=function(e,t,n){var r=[new $n("POSITION",0,Fn.Vector3,0),new $n("TEXCOORD_0",12,Fn.Vector2,0)];this._initBuffer(e,t,n,20,r)},t}(Vr),Xr=function(e){function t(t,n){var r;void 0===t&&(t={}),(r=e.call(this,n)||this).parameters=t;for(var i=r.parameters.radius||1,a=r.parameters.tube||.4,o=Math.floor(r.parameters.radialSegments)||8,s=Math.floor(r.parameters.tubularSegments)||6,u=r.parameters.arc||2*Math.PI,c=new Float32Array((o+1)*(s+1)*3),l=new Uint16Array(o*s*6),f=0,h=0;h<=o;h++)for(var d=0;d<=s;d++){var _=d/s*u,m=h/o*Math.PI*2;c[f++]=(i+a*Math.cos(m))*Math.cos(_),c[f++]=(i+a*Math.cos(m))*Math.sin(_),c[f++]=a*Math.sin(m)}f=0;for(var p=1;p<=o;p++)for(var v=1;v<=s;v++){var g=(s+1)*p+v-1,y=(s+1)*(p-1)+v-1,E=(s+1)*(p-1)+v,T=(s+1)*p+v;l[f++]=g,l[f++]=y,l[f++]=T,l[f++]=y,l[f++]=E,l[f++]=T}return r._initialize(n,c,l),r}return R(t,e),t.prototype._initialize=function(e,t,n){var r=[new $n("POSITION",0,Fn.Vector3,0)];this._initBuffer(e,t,n,12,r)},t}(Vr),Wr=function(e){function t(t){return e.call(this,t)||this}R(t,e);var n=t.prototype;return n.init=function(e){this._props=e;var t=e.geometryType,n=void 0===t?Nr.Box:t;this.material=e.material,this.geometryType=n},n.setProp=function(e,t){this._props[e]=t,"material"===e?this.material=t:this.geometryType=this._props.geometryType},S(t,[{key:"geometryType",get:function(){return this._geometryType},set:function(e){switch(e){case"Sphere":var t=this._props,n=t.sphereRadius,r=t.sphereHorizontalSegments,i=t.sphereVerticalSegments,a=t.sphereAlphaStart,o=t.sphereAlphaRange,s=t.sphereThetaStart,u=t.sphereThetaRange;this.geometry=new Hr(this.engine,n,r,i,a,o,s,u);break;case"Cylinder":var c=this._props,l=c.cylinderRadiusTop,f=c.cylinderRadiusBottom,h=c.cylinderHeight,d=c.cylinderRadialSegments,_=c.cylinderHeightSegments,m=c.cylinderOpenEnded;this.geometry=new Gr(this.engine,l,f,h,d,_,m,void 0,void 0,void 0);break;case"Plane":var p=this._props,v=p.planeWidth,g=p.planeHeight,y=p.planeHorizontalSegments,E=p.planeVerticalSegments;this.geometry=new zr(this.engine,v,g,y,E);break;case"Box":var T=this._props,x=T.boxWidth,A=T.boxHeight,O=T.boxDepth;this.geometry=new Br(this.engine,x,A,O)}this._geometryType=e}},{key:"material",get:function(){return this._material},set:function(e){this._material=e||new Rr(this.engine,"mtl")}}]),t}(Ur);(Fr=Nr||(Nr={})).Box="Box",Fr.Cylinder="Cylinder",Fr.Plane="Plane",Fr.Sphere="Sphere";var qr=function(e){function t(n,r){return void 0===r&&(r=t.defaultName),e.call(this,n,r)||this}R(t,e);var n=t.prototype;return n.setModel=function(e){this.modelMatrix=e},n.prepareDrawing=function(t,n){null===this._technique&&this._generateTechnique(),this._cacheMat1||(this._cacheMat1=new h,this._cacheMat2=new h);var r=t.viewMatrix,i=t.projectionMatrix;h.multiply(r,this.modelMatrix,this._cacheMat1);var a=this._cacheMat1.elements;a[12]=a[13]=a[14]=0,h.multiply(i,this._cacheMat1,this._cacheMat2),this.setValue("u_mvpNoscale",this._cacheMat2),e.prototype.prepareDrawing.call(this,t,n,void 0)},n._generateTechnique=function(){var e=new ar(t.techniqueName);e.isValid=!0,e.uniforms=t.techniqueConfig.uniforms,e.attributes=t.techniqueConfig.attributes,e.states=t.techniqueConfig.states,e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader,this._technique=e},t}(Hn);qr.defaultName="SKY_BOX_MATERIAL",qr.techniqueName="SKY_BOX_TECHNIQUE",qr.vertexShader="#include <common_vert>\n\nuniform mat4 u_mvpNoscale;\n\nvarying vec3 v_cubeUV;\n\nvoid main() {\n\n    v_cubeUV = a_position.xyz;\n    gl_Position = u_mvpNoscale * vec4( a_position, 1.0 );\n    gl_Position.z = gl_Position.w;\n\n}\n",qr.fragmentShader="uniform samplerCube u_cube;\n\nvarying vec3 v_cubeUV;\n\nvoid main() {\n\n    gl_FragColor = textureCube( u_cube, v_cubeUV );\n\n}\n",qr.techniqueConfig={attributes:{},uniforms:{u_mvpNoscale:{name:"u_mvpNoscale",type:ge.FLOAT_MAT4},u_cube:{name:"u_cube",type:ge.SAMPLER_CUBE}},states:{disable:[oe.CULL_FACE],functions:{depthFunc:_e.LEQUAL}}};var Yr=function(e){function t(t){var n;return(n=e.call(this,t)||this).geometry=new Br(n.engine,2,2,2),n.material=new qr(n.engine),n}R(t,e);var n=t.prototype;return n.update=function(){this.material.setModel(this.entity.transform.worldMatrix)},n.render=function(t){this._skyBoxMap&&e.prototype.render.call(this,t)},S(t,[{key:"skyBoxMap",get:function(){return this._skyBoxMap},set:function(e){this._skyBoxMap=e,this.material.setValue("u_cube",e)}}]),t}(Ur),Kr=function(e){function t(n,r,i){var a;return void 0===r&&(r=t.MATERIAL_NAME),void 0===i&&(i={}),(a=e.call(this,n,r)||this).createDefaulteValues(),a.setUniforms(i),a.setStates(i),a}R(t,e);var n=t.prototype;return n.createDefaulteValues=function(){var e=this;this._uniformObj={baseColorFactor:new T(1,1,1,1),metallicFactor:1,roughnessFactor:1,metallicRoughness:new g(1,1),normalScale:1,emissiveFactor:new s(0,0,0),occlusionStrength:1,alphaCutoff:.5,specularFactor:new s(1,1,1),glossinessFactor:0,envMapIntensity:1,refractionRatio:1/1.33,refractionDepth:1,perturbationUOffset:0,perturbationVOffset:0},this._stateObj={alphaMode:"OPAQUE",doubleSided:!1,side:he.FRONT,unlit:!1,srgb:!1,srgbFast:!1,gamma:!1,blendFunc:[],blendFuncSeparate:[xe.SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA,xe.ONE,xe.ONE],depthMask:[!1],getOpacityFromRGB:!1,isMetallicWorkflow:!0,envMapModeRefract:!1},Object.keys(this._uniformObj).forEach((function(t){return e.setValueByParamName(t,e._uniformObj[t])}))},n.setUniforms=function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"baseColorFactor":t.baseColorFactor=e[n];break;case"opacity":t.opacity=e[n];break;case"opacityTexture":t.opacityTexture=e[n];break;case"baseColorTexture":t.baseColorTexture=e[n];break;case"metallicFactor":t.metallicFactor=e[n];break;case"roughnessFactor":t.roughnessFactor=e[n];break;case"metallicTexture":t.metallicTexture=e[n];break;case"roughnessTexture":t.roughnessTexture=e[n];break;case"metallicRoughnessTexture":t.metallicRoughnessTexture=e[n];break;case"normalTexture":t.normalTexture=e[n];break;case"normalScale":t.normalScale=e[n];break;case"emissiveTexture":t.emissiveTexture=e[n];break;case"emissiveFactor":t.emissiveFactor=e[n];break;case"occlusionTexture":t.occlusionTexture=e[n];break;case"occlusionStrength":t.occlusionStrength=e[n];break;case"alphaCutoff":t.alphaCutoff=e[n];break;case"specularFactor":t.specularFactor=e[n];break;case"glossinessFactor":t.glossinessFactor=e[n];break;case"specularGlossinessTexture":t.specularGlossinessTexture=e[n];break;case"reflectionTexture":t.reflectionTexture=e[n];break;case"envMapIntensity":t.envMapIntensity=e[n];break;case"refractionRatio":t.refractionRatio=e[n];break;case"refractionDepth":t.refractionDepth=e[n];break;case"refractionTexture":t.refractionTexture=e[n];break;case"perturbationTexture":t.perturbationTexture=e[n];break;case"perturbationUOffset":t.perturbationUOffset=e[n];break;case"perturbationVOffset":t.perturbationVOffset=e[n]}}))},n.setStates=function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"doubleSided":t.doubleSided=e[n];break;case"side":t.side=e[n];break;case"alphaMode":t.alphaMode=e[n];break;case"unlit":t.unlit=e[n];break;case"srgb":t.srgb=e[n];break;case"srgbFast":t.srgbFast=e[n];break;case"gamma":t.gamma=e[n];break;case"blendFunc":t.blendFunc=e[n];break;case"blendFuncSeparate":t.blendFuncSeparate=e[n];break;case"depthMask":t.depthMask=e[n];break;case"getOpacityFromRGB":t.getOpacityFromRGB=e[n];break;case"isMetallicWorkflow":t.isMetallicWorkflow=e[n];break;case"envMapModeRefract":t.envMapModeRefract=e[n]}}))},n.setValueByParamName=function(e,n){var r=t.TECH_CONFIG.uniforms,i=Object.keys(r).find((function(t){return r[t].paramName===e}));i&&this.setValue(i,n)},n.updateTechnique=function(e,t){var n;if(this[e]!==t){this._stateObj[e]=t;var r=null==(n=this.technique)?void 0:n.states;if(r)switch(e){case"doubleSided":case"side":if(this.doubleSided)r.disable.push(oe.CULL_FACE);else{var i=r.disable.indexOf(oe.CULL_FACE);switch(i>-1&&r.disable.splice(i,1),this.side){case he.FRONT:r.functions.cullFace=[le.BACK];break;case he.BACK:r.functions.cullFace=[le.FRONT];break;case he.NONE:r.functions.cullFace=[le.FRONT_AND_BACK];break;default:delete r.functions.cullFace}}break;case"blendFunc":case"blendFuncSeparate":this.blendFunc.length?r.functions.blendFunc=this.blendFunc:r.functions.blendFuncSeparate=this.blendFuncSeparate;break;case"depthMask":r.functions.depthMask=t;break;default:this._technique=null}}},n.prepareDrawing=function(t,n,r){var i,a=t.camera,o=a.scene,s=o.engine.canvas,u=o.findFeature($t),c=a._renderPipeline.canOIT;u.bindMaterialValues(this),this.setValue("u_resolution",new g(s.width,s.height));for(var l=0;l<this._clipPlaneCount;l++)this.setValue("u_clipPlanes["+l+"]",o.clipPlanes[l]);c&&this.setValue("u_depthSampler",a._renderPipeline.depthTexture);var f,h=u.lightSortAmount,d=h.ambientLightCount,_=h.directLightCount,m=h.pointLightCount,p=h.spotLightCount,v=h.envMapLightCount,y=h.useDiffuseEnv,E=h.useSpecularEnv;this._technique&&this._ambientLightCount===d&&this._envMapLightCount===v&&this._useDiffuseEnv===y&&this._useSpecularEnv===E&&this._directLightCount===_&&this._pointLightCount===m&&this._spotLightCount===p&&this._clipPlaneCount===(null==(i=o.clipPlanes)?void 0:i.length)&&this._useOIT===c||(this._ambientLightCount=d,this._envMapLightCount=v,this._useDiffuseEnv=y,this._useSpecularEnv=E,this._directLightCount=_,this._pointLightCount=m,this._spotLightCount=p,this._clipPlaneCount=null==(f=o.clipPlanes)?void 0:f.length,this._useOIT=c,this._generateTechnique(a,n,r));e.prototype.prepareDrawing.call(this,t,n,r)},n._generateTechnique=function(e,n,r){var i=this._generateShaderMacros(e,n,r),a=t.TECHNIQUE_NAME,o=t.STATIC_VERTEX_SHADER,s=t.STATIC_FRAGMENT_SHADER,u=this._generateConfig(),c=e.scene.findFeature($t),l=new ar(a);return l.isValid=!0,l.uniforms=x({},c.getUniformDefine(),u.uniforms),l.attributes=u.attributes,l.fragmentPrecision="highp",l.customMacros=i,l.states=u.states,l.vertexShader=o,l.fragmentShader=s,this._technique=l,l},n._generateShaderMacros=function(e,t,n){var r=e.scene.engine._hardwareRenderer,i=["O3_NEED_WORLDPOS"];n._vertexElementMap.NORMAL&&n._vertexElementMap.TANGENT||r.canIUse(Ce.standardDerivatives)&&i.push("HAS_DERIVATIVES");var a=Object.keys(this._values);return a.indexOf("u_baseColorSampler")>-1&&i.push("HAS_BASECOLORMAP"),a.indexOf("u_normalSampler")>-1&&i.push("O3_HAS_NORMALMAP"),a.indexOf("u_metallicSampler")>-1&&i.push("HAS_METALMAP"),a.indexOf("u_roughnessSampler")>-1&&i.push("HAS_ROUGHNESSMAP"),a.indexOf("u_metallicRoughnessSampler")>-1&&i.push("HAS_METALROUGHNESSMAP"),a.indexOf("u_emissiveSampler")>-1&&i.push("HAS_EMISSIVEMAP"),a.indexOf("u_occlusionSampler")>-1&&i.push("HAS_OCCLUSIONMAP"),a.indexOf("u_specularGlossinessSampler")>-1&&i.push("HAS_SPECULARGLOSSINESSMAP"),a.indexOf("u_perturbationSampler")>-1&&i.push("HAS_PERTURBATIONMAP"),a.indexOf("u_reflectionSampler")>-1&&i.push("HAS_REFLECTIONMAP"),a.indexOf("u_refractionSampler")>-1&&(this.setValueByParamName("PTMMatrix",new h(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1)),i.push("HAS_REFRACTIONMAP")),"MASK"===this.alphaMode?i.push("ALPHA_MASK"):"BLEND"!==this.alphaMode||this.refractionTexture||(i.push("ALPHA_BLEND"),a.indexOf("u_opacitySampler")>-1&&(i.push("HAS_OPACITYMAP"),this.getOpacityFromRGB&&i.push("GETOPACITYFROMRGB"))),this._envMapLightCount&&(i.push("O3_HAS_ENVMAP_LIGHT"),this._useDiffuseEnv&&i.push("O3_USE_DIFFUSE_ENV"),this._useSpecularEnv&&i.push("O3_USE_SPECULAR_ENV"),r.canIUse(Ce.shaderTextureLod)&&i.push("HAS_TEX_LOD")),this._ambientLightCount&&i.push("O3_HAS_AMBIENT_LIGHT"),this._directLightCount&&i.push("O3_DIRECT_LIGHT_COUNT "+this._directLightCount),this._pointLightCount&&i.push("O3_POINT_LIGHT_COUNT "+this._pointLightCount),this._spotLightCount&&i.push("O3_SPOT_LIGHT_COUNT "+this._spotLightCount),this._clipPlaneCount&&i.push("O3_CLIPPLANE_NUM "+this._clipPlaneCount),this._stateObj.unlit&&i.push("UNLIT"),this._stateObj.srgb&&i.push("MANUAL_SRGB"),this._stateObj.srgbFast&&i.push("SRGB_FAST_APPROXIMATION"),this._stateObj.gamma&&i.push("GAMMA"),this._stateObj.isMetallicWorkflow&&i.push("IS_METALLIC_WORKFLOW"),this._stateObj.envMapModeRefract&&i.push("ENVMAPMODE_REFRACT"),e._renderPipeline.canOIT&&i.push("OIT_ENABLE"),i},n._generateConfig=function(){var e=t.TECH_CONFIG.states,n={disable:e.disable.slice(),enable:e.enable.slice(),functions:Object.assign({},e.functions)};if(this.doubleSided)n.disable.push(oe.CULL_FACE);else switch(this.side){case he.FRONT:n.functions.cullFace=[le.BACK];break;case he.BACK:n.functions.cullFace=[le.FRONT];break;case he.NONE:n.functions.cullFace=[le.FRONT_AND_BACK];break;default:delete n.functions.cullFace}"BLEND"!==this.alphaMode||this.refractionTexture?this.renderType=ie.OPAQUE:(n.enable.push(oe.BLEND),this.blendFunc.length?n.functions.blendFunc=this._stateObj.blendFunc:n.functions.blendFuncSeparate=this._stateObj.blendFuncSeparate,n.functions.depthMask=this._stateObj.depthMask,this.renderType=ie.TRANSPARENT);for(var r={},i=0;i<this._clipPlaneCount;i++)r["u_clipPlanes["+i+"]"]={name:"u_clipPlanes["+i+"]",type:ge.FLOAT_VEC4};return t.TECH_CONFIG.uniforms=Object.assign({},t.TECH_CONFIG.uniforms,r),Object.assign({},t.TECH_CONFIG,{states:n})},n.clone=function(e){var n=new t(this._engine,e||this.name);for(var r in n.renderType=this.renderType,n.useFog=this.useFog,this._uniformObj){var i=this._uniformObj[r];n[r]=i instanceof Sn?i:F.clone(i)}return this._stateObj&&(n._stateObj=F.clone(this._stateObj)),n},S(t,[{key:"baseColorFactor",get:function(){return this._uniformObj.baseColorFactor},set:function(e){this._uniformObj.baseColorFactor=e,this.setValueByParamName("baseColorFactor",e)}},{key:"opacity",get:function(){return this.baseColorFactor[3]},set:function(e){this.baseColorFactor[3]=e}},{key:"baseColorTexture",get:function(){return this._uniformObj.baseColorTexture},set:function(e){this.setValueByParamName("baseColorTexture",e),this._uniformObj.baseColorTexture=e}},{key:"opacityTexture",get:function(){return this._uniformObj.opacityTexture},set:function(e){this.setValueByParamName("opacityTexture",e),this._uniformObj.opacityTexture=e}},{key:"metallicFactor",get:function(){return this._uniformObj.metallicFactor},set:function(e){this._uniformObj.metallicFactor=e,this._uniformObj.metallicRoughness.x=e,this.setValueByParamName("metallicRoughness",this._uniformObj.metallicRoughness)}},{key:"roughnessFactor",get:function(){return this._uniformObj.roughnessFactor},set:function(e){this._uniformObj.roughnessFactor=e,this._uniformObj.metallicRoughness.y=e,this.setValueByParamName("metallicRoughness",this._uniformObj.metallicRoughness)}},{key:"metallicTexture",get:function(){return this._uniformObj.metallicTexture},set:function(e){this.setValueByParamName("metallicTexture",e),this._uniformObj.metallicTexture=e}},{key:"roughnessTexture",get:function(){return this._uniformObj.roughnessTexture},set:function(e){this.setValueByParamName("roughnessTexture",e),this._uniformObj.roughnessTexture=e}},{key:"metallicRoughnessTexture",get:function(){return this._uniformObj.metallicRoughnessTexture},set:function(e){this.setValueByParamName("metallicRoughnessTexture",e),this._uniformObj.metallicRoughnessTexture=e}},{key:"normalTexture",get:function(){return this._uniformObj.normalTexture},set:function(e){this.setValueByParamName("normalTexture",e),this._uniformObj.normalTexture=e}},{key:"normalScale",get:function(){return this._uniformObj.normalScale},set:function(e){this._uniformObj.normalScale=e,this.setValueByParamName("normalScale",e)}},{key:"emissiveTexture",get:function(){return this._uniformObj.emissiveTexture},set:function(e){this.setValueByParamName("emissiveTexture",e),this._uniformObj.emissiveTexture=e}},{key:"emissiveFactor",get:function(){return this._uniformObj.emissiveFactor},set:function(e){this._uniformObj.emissiveFactor=e,this.setValueByParamName("emissiveFactor",e)}},{key:"occlusionTexture",get:function(){return this._uniformObj.occlusionTexture},set:function(e){this.setValueByParamName("occlusionTexture",e),this._uniformObj.occlusionTexture=e}},{key:"occlusionStrength",get:function(){return this._uniformObj.occlusionStrength},set:function(e){this._uniformObj.occlusionStrength=e,this.setValueByParamName("occlusionStrength",e)}},{key:"alphaCutoff",get:function(){return this._uniformObj.alphaCutoff},set:function(e){this._uniformObj.alphaCutoff=e,this.setValueByParamName("alphaCutoff",e)}},{key:"specularFactor",get:function(){return this._uniformObj.specularFactor},set:function(e){this.setValueByParamName("specularFactor",e),this._uniformObj.specularFactor=e}},{key:"glossinessFactor",get:function(){return this._uniformObj.glossinessFactor},set:function(e){this.setValueByParamName("glossinessFactor",e),this._uniformObj.glossinessFactor=e}},{key:"specularGlossinessTexture",get:function(){return this._uniformObj.specularGlossinessTexture},set:function(e){this.setValueByParamName("specularGlossinessTexture",e),this._uniformObj.specularGlossinessTexture=e}},{key:"reflectionTexture",get:function(){return this._uniformObj.reflectionTexture},set:function(e){this.setValueByParamName("reflectionTexture",e),this._uniformObj.reflectionTexture=e}},{key:"envMapIntensity",get:function(){return this._uniformObj.envMapIntensity},set:function(e){this.setValueByParamName("envMapIntensity",e),this._uniformObj.envMapIntensity=e}},{key:"refractionRatio",get:function(){return this._uniformObj.refractionRatio},set:function(e){this.setValueByParamName("refractionRatio",e),this._uniformObj.refractionRatio=e}},{key:"refractionDepth",get:function(){return this._uniformObj.refractionDepth},set:function(e){this.setValueByParamName("refractionDepth",e),this._uniformObj.refractionDepth=e}},{key:"refractionTexture",get:function(){return this._uniformObj.refractionTexture},set:function(e){this.setValueByParamName("refractionTexture",e),this._uniformObj.refractionTexture=e}},{key:"perturbationTexture",get:function(){return this._uniformObj.perturbationTexture},set:function(e){this.setValueByParamName("perturbationTexture",e),this._uniformObj.perturbationTexture=e}},{key:"perturbationUOffset",get:function(){return this._uniformObj.perturbationUOffset},set:function(e){this.setValueByParamName("perturbationUOffset",e),this._uniformObj.perturbationUOffset=e}},{key:"perturbationVOffset",get:function(){return this._uniformObj.perturbationVOffset},set:function(e){this.setValueByParamName("perturbationVOffset",e),this._uniformObj.perturbationVOffset=e}},{key:"alphaMode",get:function(){return this._stateObj.alphaMode},set:function(e){this.updateTechnique("alphaMode",e)}},{key:"doubleSided",get:function(){return this._stateObj.doubleSided},set:function(e){e?this._stateObj.side=he.DOUBLE:this._stateObj.side===he.DOUBLE&&(this._stateObj.side=he.FRONT),this.updateTechnique("doubleSided",e)}},{key:"side",get:function(){return this._stateObj.side},set:function(e){e===he.DOUBLE?this._stateObj.doubleSided=!0:this._stateObj.doubleSided=!1,this.updateTechnique("side",e)}},{key:"unlit",get:function(){return this._stateObj.unlit},set:function(e){this.updateTechnique("unlit",e)}},{key:"srgb",get:function(){return this._stateObj.srgb},set:function(e){this.updateTechnique("srgb",e)}},{key:"srgbFast",get:function(){return this._stateObj.srgbFast},set:function(e){this.updateTechnique("srgbFast",e)}},{key:"gamma",get:function(){return this._stateObj.gamma},set:function(e){this.updateTechnique("gamma",e)}},{key:"blendFunc",get:function(){return this._stateObj.blendFunc},set:function(e){this.updateTechnique("blendFunc",e)}},{key:"blendFuncSeparate",get:function(){return this._stateObj.blendFuncSeparate},set:function(e){this.updateTechnique("blendFuncSeparate",e)}},{key:"depthMask",get:function(){return this._stateObj.depthMask},set:function(e){this.updateTechnique("depthMask",e)}},{key:"getOpacityFromRGB",get:function(){return this._stateObj.getOpacityFromRGB},set:function(e){this.updateTechnique("getOpacityFromRGB",e)}},{key:"isMetallicWorkflow",get:function(){return this._stateObj.isMetallicWorkflow},set:function(e){this.updateTechnique("isMetallicWorkflow",e)}},{key:"envMapModeRefract",get:function(){return this._stateObj.envMapModeRefract},set:function(e){this.updateTechnique("envMapModeRefract",e)}}]),t}(Hn);Kr.MATERIAL_NAME="PBR_MATERIAL",Kr.TECHNIQUE_NAME="PBR_TECHNIQUE",Kr.STATIC_VERTEX_SHADER="#include <common>\n#include <common_vert>\n#include <uv_share>\n#include <color_share>\n#include <normal_share>\n#include <worldpos_share>\n#include <clipPlane_vert_define>\n#include <morph_target_vert>\n\n#include <fog_share>\n\nvoid main() {\n\n    #include <begin_position_vert>\n    #include <begin_normal_vert>\n\n    #include <morph_vert>\n    #include <skinning_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <normal_vert>\n    #include <worldpos_vert>\n    #include <clipPlane_vert>\n    #include <position_vert>\n\n    #include <fog_vert>\n}\n",Kr.STATIC_FRAGMENT_SHADER="#include <common>\n#include <common_frag>\n#include <pbr_common_frag_define>\n#include <pbr_util_frag_define>\n\n#include <fog_share>\n\n#include <uv_share>\n#include <normal_share>\n#include <color_share>\n#include <worldpos_share>\n#include <refraction_share>\n#include <perturbation_share>\n#include <clipPlane_frag_define>\n\n// light\n#include <ambient_light_frag>\n#include <direct_light_frag>\n#include <point_light_frag>\n#include <spot_light_frag>\n#include <pbr_envmap_light_frag_define>\n\n// prop & texture\n#include <pbr_base_frag_define>\n#include <pbr_texture_frag_define>\n\n// runtime context\n#include <pbr_runtime_frag_define>\n\n// todo: generalize\n#include <pbr_normal_frag_define>\n\n\n// todo: BxDF\n#include <pbr_brdf_cook_torrance_frag_define>\n\n\n// direct + indirect\n#include <pbr_direct_irradiance_frag_define>\n#include <pbr_ibl_diffuse_frag_define>\n#include <pbr_ibl_specular_frag_define>\n\n#include <oit_frag_define>\n\n\nvoid main() {\n    #include <clipPlane_frag>\n\n    #include <pbr_begin_frag>\n    #include <pbr_direct_irradiance_frag>\n    #include <pbr_ibl_diffuse_frag>\n    #include <pbr_ibl_specular_frag>\n    // todo: generalize texture logic\n    #include <pbr_end_frag>\n    #include <gamma_frag>\n    #include <refraction_frag>\n    #include <perturbation_frag>\n    #include <fog_frag>\n\n    #include <oit_frag>\n\n    // gl_FragColor = texture2D( u_baseColorSampler, v_uv );\n}\n",Kr.attribUniformVec4=12,Kr.TECH_CONFIG={attributes:{},uniforms:Object.assign({u_baseColorSampler:{name:"u_baseColorSampler",paramName:"baseColorTexture",type:ge.SAMPLER_2D},u_baseColorFactor:{name:"u_baseColorFactor",paramName:"baseColorFactor",type:ge.FLOAT_VEC4},u_normalSampler:{name:"u_normalSampler",paramName:"normalTexture",type:ge.SAMPLER_2D},u_normalScale:{name:"u_normalScale",paramName:"normalScale",type:ge.FLOAT},u_lightDirection:{name:"u_lightDirection",type:ge.FLOAT_VEC3},u_lightColor:{name:"u_lightColor",type:ge.FLOAT_VEC3},u_metallicRoughnessValue:{name:"u_metallicRoughnessValue",paramName:"metallicRoughness",type:ge.FLOAT_VEC2},u_metallicSampler:{name:"u_metallicSampler",paramName:"metallicTexture",type:ge.SAMPLER_2D},u_roughnessSampler:{name:"u_roughnessSampler",paramName:"roughnessTexture",type:ge.SAMPLER_2D},u_metallicRoughnessSampler:{name:"u_metallicRoughnessSampler",paramName:"metallicRoughnessTexture",type:ge.SAMPLER_2D},u_emissiveFactor:{name:"u_emissiveFactor",paramName:"emissiveFactor",type:ge.FLOAT_VEC3},u_emissiveSampler:{name:"u_emissiveSampler",paramName:"emissiveTexture",type:ge.SAMPLER_2D},u_occlusionSampler:{name:"u_occlusionSampler",paramName:"occlusionTexture",type:ge.SAMPLER_2D},u_occlusionStrength:{name:"u_occlusionStrength",paramName:"occlusionStrength",type:ge.FLOAT},u_alphaCutoff:{name:"u_alphaCutoff",paramName:"alphaCutoff",type:ge.FLOAT},u_opacitySampler:{name:"u_opacitySampler",paramName:"opacityTexture",type:ge.SAMPLER_2D},u_specularFactor:{name:"u_specularFactor",paramName:"specularFactor",type:ge.FLOAT_VEC3},u_glossinessFactor:{name:"u_glossinessFactor",paramName:"glossinessFactor",type:ge.FLOAT},u_specularGlossinessSampler:{name:"u_specularGlossinessSampler",paramName:"specularGlossinessTexture",type:ge.SAMPLER_2D},u_reflectionSampler:{name:"u_reflectionSampler",paramName:"reflectionTexture",type:ge.SAMPLER_CUBE},u_PTMMatrix:{name:"u_PTMMatrix",paramName:"PTMMatrix",type:ge.FLOAT_MAT4},u_envMapIntensity:{name:"u_envMapIntensity",paramName:"envMapIntensity",type:ge.FLOAT},u_refractionRatio:{name:"u_refractionRatio",paramName:"refractionRatio",type:ge.FLOAT},u_refractionDepth:{name:"u_refractionDepth",paramName:"refractionDepth",type:ge.FLOAT},u_refractionSampler:{name:"u_refractionSampler",paramName:"refractionTexture",type:ge.SAMPLER_2D},u_resolution:{name:"u_resolution",paramName:"resolution",type:ge.FLOAT_VEC2},u_perturbationSampler:{name:"u_perturbationSampler",paramName:"perturbationTexture",type:ge.SAMPLER_2D},u_perturbationUOffset:{name:"u_perturbationUOffset",paramName:"perturbationUOffset",type:ge.FLOAT},u_perturbationVOffset:{name:"u_perturbationVOffset",paramName:"perturbationVOffset",type:ge.FLOAT},u_depthSampler:{name:"u_depthSampler",type:ge.SAMPLER_2D}}),states:{disable:[],enable:[],functions:{}}};var Qr=function(e){function t(t){var n;return(n=e.call(this,t)||this)._time=0,n._isInit=!1,n._isStart=!1,n}R(t,e);var n=t.prototype;return n.initialize=function(e){this.maxCount=void 0!==e.maxCount?e.maxCount:1e3,this.once=e.once||!1,this.options=e.options||{},this.getOptions=e.getOptions,this.rotateToVelocity=e.rotateToVelocity||!1,e.blendFuncSeparate&&(this.blendFuncSeparate=e.blendFuncSeparate),this.blendFunc=e.blendFunc||[xe.SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA],this.useOriginColor=void 0===e.useOriginColor||e.useOriginColor,this.fragmentShader=e.fragmentShader||null,this.vertexShader=e.vertexShader||null,this.particleTex=e.texture||null,this.fadeIn=e.fadeIn||!1,this.fadeOut=void 0===e.fadeOut||e.fadeOut,this.particleMaskTex=e.maskTexture||null,this.isScaleByLifetime=e.isScaleByLifetime||!1,this.scaleFactor=e.scaleFactor||1,this.spriteSheet=e.spriteSheet||null,this.is2d=void 0===e.is2d||e.is2d,this.interleaved=e.spriteSheet||!0,this.setMaterial(),this.geometry=this._createGeometry(),this._isInit=!0;for(var t=this.getOptions?this.getOptions(this._time):this.options,n=0;n<this.maxCount;n++)this._spawnParticle(t,n);return this._vertexBuffer.setData(this._vertices),this},n.update=function(e){this._isInit&&this._isStart&&(this._time+=e/1e3,this.material.setValue("uTime",this._time))},n.setOptions=function(e){return void 0!==e&&(this.options=x({},this.options,e)),this},n.start=function(){this._isStart=!0,this._time=0,this.material.setValue("uActive",1)},n.stop=function(){this.material.setValue("uActive",0)},n.destroy=function(){e.prototype.destroy.call(this),this.options=null,this.particleTex&&(this.particleTex=null),this.particleMaskTex&&(this.particleMaskTex=null)},n.setMaterial=function(){var e=this._createTechnique(),t=new Hn(this.engine,"particleMaterial");t.technique=e,t.renderType=ie.TRANSPARENT,t.setValue("uOnce",this.once?1:0),t.setValue("uTime",this._time),this.particleTex&&(this.particleTex.wrapModeU=this.particleTex.wrapModeV=gn.Clamp,t.setValue("particleTex",this.particleTex)),this.particleMaskTex&&(this.particleMaskTex.wrapModeU=this.particleTex.wrapModeV=gn.Clamp,t.setValue("particleMaskTex",this.particleMaskTex)),this.material=t},n._createTechnique=function(){var e={attributes:{positionStart:{name:"positionStart",semantic:"POSITIONSTART",type:ge.FLOAT_VEC3},color:{name:"color",semantic:"COLOR",type:ge.FLOAT_VEC3},alpha:{name:"alpha",semantic:"ALPHA",type:ge.FLOAT},acceleration:{name:"acceleration",semantic:"ACCELERATION",type:ge.FLOAT_VEC3},velocity:{name:"velocity",semantic:"VELOCITY",type:ge.FLOAT_VEC3},startAngle:{name:"startAngle",semantic:"STARTANGLE",type:ge.FLOAT},lifeTime:{name:"lifeTime",semantic:"LIFETIME",type:ge.FLOAT},startTime:{name:"startTime",semantic:"STARTTIME",type:ge.FLOAT},size:{name:"size",semantic:"SIZE",type:ge.FLOAT},rotateRate:{name:"rotateRate",semantic:"ROTATERATE",type:ge.FLOAT},scaleFactor:{name:"scaleFactor",semantic:"SCALEFACTOR",type:ge.FLOAT},uv:{name:"uv",semantic:"UV",type:ge.FLOAT_VEC3},normalizedUv:{name:"normalizedUv",semantic:"NORMALIZED_UV",type:ge.FLOAT_VEC2}},uniforms:{uOnce:{name:"uOnce",type:ge.FLOAT},uActive:{name:"uActive",type:ge.FLOAT},uTime:{name:"uTime",type:ge.FLOAT},matModelViewProjection:{name:"matModelViewProjection",semantic:Ee.MODELVIEWPROJECTION,type:ge.FLOAT_MAT4},matModelView:{name:"matModelView",semantic:Ee.MODELVIEW,type:ge.FLOAT_MAT4}},states:{enable:[oe.BLEND],functions:{depthMask:[!1]}}};this.is2d?(e.uniforms.matViewInverse={name:"matViewInverse",semantic:Ee.VIEWINVERSE,type:ge.FLOAT_MAT4},e.uniforms.matProjection={name:"matProjection",semantic:Ee.PROJECTION,type:ge.FLOAT_MAT4},e.uniforms.matView={name:"matView",semantic:Ee.VIEW,type:ge.FLOAT_MAT4},e.uniforms.matWorld={name:"matWorld",semantic:Ee.MODEL,type:ge.FLOAT_MAT4}):e.states.disable=[oe.CULL_FACE],this.blendFuncSeparate?e.states.functions.blendFuncSeparate=this.blendFuncSeparate:e.states.functions.blendFunc=this.blendFunc,this.particleTex&&(e.uniforms.particleTex={name:"particleTex",type:ge.SAMPLER_2D}),this.particleMaskTex&&(e.uniforms.particleMaskTex={name:"particleMaskTex",type:ge.SAMPLER_2D});var t=new ar("particleTech");return t.isValid=!0,t.uniforms=e.uniforms,t.attributes=e.attributes,t.states=e.states,t.vertexShader=this._createVertexShader(),t.fragmentShader=this._createFragmentShader(),t},n._createGeometry=function(){for(var e=new Dr(this._entity.engine,"particleGeometry"),t=4*this.maxCount*96,n=new Float32Array(t),r=new Uint16Array(6*this.maxCount),i=0,a=0;i<this.maxCount;++i){var o=4*i;r[a++]=o+0,r[a++]=o+1,r[a++]=o+2,r[a++]=o+0,r[a++]=o+2,r[a++]=o+3}var s=[new $n("POSITIONSTART",0,Fn.Vector3,0),new $n("VELOCITY",12,Fn.Vector3,0),new $n("ACCELERATION",24,Fn.Vector3,0),new $n("COLOR",36,Fn.Vector3,0),new $n("ALPHA",48,Fn.Float,0),new $n("SIZE",52,Fn.Float,0),new $n("ROTATERATE",56,Fn.Float,0),new $n("STARTTIME",60,Fn.Float,0),new $n("LIFETIME",64,Fn.Float,0),new $n("STARTANGLE",68,Fn.Float,0),new $n("SCALEFACTOR",72,Fn.Float,0),new $n("UV",76,Fn.Vector3,0),new $n("NORMALIZED_UV",88,Fn.Vector2,0)],u=new Kn(this.engine,Gn.VertexBuffer,4*t,Pn.Dynamic),c=new Kn(this.engine,Gn.IndexBuffer,r,Pn.Dynamic);return e.setVertexBufferBinding(u,96),e.setIndexBufferBinding(c,Un.UInt16),e.setVertexElements(s),e.addSubGeometry(0,r.length),this._vertexBuffer=u,this._vertexStride=96,this._vertices=n,e},n._spawnParticle=function(e,t){var n=void 0!==e.position?e.position.clone():new s,r=void 0!==e.positionRandomness?e.positionRandomness.clone():new s,i=e.positionArray,a=void 0!==e.velocity?e.velocity.clone():new s,u=void 0!==e.velocityRandomness?e.velocityRandomness.clone():new s,c=void 0!==e.color?e.color.clone():new s(1,1,1),l=void 0!==e.colorRandomness?e.colorRandomness:1,f=void 0!==e.alpha?e.alpha:1,h=void 0!==e.alphaRandomness?e.alphaRandomness:0,d=void 0!==e.lifetime?e.lifetime:5,_=void 0!==e.size?e.size:1,m=void 0!==e.sizeRandomness?e.sizeRandomness:0,p=void 0!==e.smoothPosition&&e.smoothPosition,v=void 0!==e.startTimeRandomness?e.startTimeRandomness:0,g=void 0!==e.acceleration?e.acceleration.clone():new s,y=void 0!==e.accelerationRandomness?e.accelerationRandomness.clone():new s,E=void 0!==e.startAngle?e.startAngle:0,T=void 0!==e.startAngleRandomness?e.startAngleRandomness:0,x=void 0!==e.rotateRate?e.rotateRate:0,A=void 0!==e.rotateRateRandomness?e.rotateRateRandomness:0,O=void 0!==e.scaleFactor?e.scaleFactor:1,b=n.x,M=n.y,S=n.z;if(i){if(i.length!==this.maxCount)throw Error("The length of positionArray must be equal to maxCount.");b+=i[t].x,M+=i[t].y,S+=i[t].z}else b+=this._getRandom()*r.x,M+=this._getRandom()*r.y,S+=this._getRandom()*r.z;!0===p&&(b+=-a.x*this._getRandom(),M+=-a.y*this._getRandom(),S+=-a.z*this._getRandom());var R=a.x+this._getRandom()*u.x,L=a.y+this._getRandom()*u.y,C=a.z+this._getRandom()*u.z,I=g.x+this._getRandom()*y.x,w=g.y+this._getRandom()*y.y,P=g.z+this._getRandom()*y.z;c.x=o.clamp(c.x+this._getRandom()*l,0,1),c.y=o.clamp(c.y+this._getRandom()*l,0,1),c.z=o.clamp(c.z+this._getRandom()*l,0,1),_=Math.max(_+this._getRandom()*m*_*2,0);for(var N=d+this._getRandom()*d,F=E+this._getRandom()*Math.PI*T*2,D=x+this._getRandom()*A,U=o.clamp(f+this._getRandom()*h,0,1),V=Math.random()*v,B=this._vertices,H=0;H<4;H++){var z=(4*t+H)*this._vertexStride/4;B[z]=b,B[z+1]=M,B[z+2]=S,B[z+3]=R,B[z+4]=L,B[z+5]=C,B[z+6]=I,B[z+7]=w,B[z+8]=P,B[z+9]=c[0],B[z+10]=c[1],B[z+11]=c[2],B[z+12]=U,B[z+13]=_,B[z+14]=D,B[z+15]=V,B[z+16]=N,B[z+17]=F,B[z+18]=O,this._setUvs(t,H,z)}},n._setUvs=function(e,t,n){var r,i=this.spriteSheet,a=this.particleTex;if(a){var o=a.image?a.image.width:a.width,s=a.image?a.image.height:a.height;if(i){var u=i[e%i.length],c=u.x,l=u.y,f=u.w,h=u.h,d=c/o,_=l/s,m=d+f/o,p=_+h/s;r=[[d,p,h/f],[m,p,h/f],[m,_,h/f],[d,_,h/f]]}else r=[[0,0,s/o],[1,0,s/o],[1,1,s/o],[0,1,s/o]]}else r=[[0,0,1],[1,0,1],[1,1,1],[0,1,1]];var v=this._vertices,g=r[t];v[n+19]=g[0],v[n+20]=g[1],v[n+21]=g[2];var y=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]][t];v[n+22]=y[0],v[n+23]=y[1]},n._getRandom=function(){return Math.random()-.5},n._getShader=function(){return{vertexShader:"\n        precision highp float;\n        precision highp int;\n\n        attribute float lifeTime;\n        attribute float startTime;\n        attribute float size;\n        attribute float rotateRate;\n        attribute vec3 velocity;\n        attribute vec3 acceleration;\n        attribute vec3 positionStart;\n        attribute vec3 color;\n        attribute float alpha;\n        attribute float startAngle;\n        attribute float scaleFactor;\n        attribute vec3 uv;\n        attribute vec2 normalizedUv;\n        \n        uniform float uTime;\n        uniform float uOnce;\n        uniform float uActive;\n        uniform mat4 matModelViewProjection;\n        uniform mat4 matModelView;\n        uniform mat4 matViewInverse;\n        uniform mat4 matView;\n        uniform mat4 matProjection;\n        uniform mat4 matWorld;\n\n        varying vec3 v_color;\n        varying float v_alpha;\n        varying float lifeLeft;\n        varying mat2 vTextureMat;\n        varying vec2 v_uv;\n\n        mat2 rotation2d(float angle) {\n          float s = sin(angle);\n          float c = cos(angle);\n        \n          return mat2(\n            c, -s,\n            s, c\n          );\n        }\n\n        void main()\n        {\n          v_color = color;\n          v_uv = uv.xy;\n          v_alpha = alpha;\n          \n          // float deltaTime = max(mod(uTime, lifeTime), 0.0);\n          // \n          float life = lifeTime + startTime;\n          // \n          float deltaTime = max(mod(uTime, life) - startTime, 0.0);\n\n          bool isDying = false;\n\n          if (uOnce == 1.0 || uActive == 0.0) {\n            isDying = true;\n          }\n\n          if ((isDying && uTime > life)) {\n            deltaTime = life;\n          }\n\n          // \n          if (deltaTime == 0.0) {\n            deltaTime = life;\n          }\n\n          lifeLeft = 1.0 - deltaTime / lifeTime;\n          float scale = size;\n          vec3 position = positionStart + (velocity + acceleration * deltaTime * 0.5) * deltaTime;\n      ",postionShader:"\n        gl_Position = matModelViewProjection * vec4(position, 1.0 );\n      ",sizeVertexShader:"\n          scale *= pow(scaleFactor, deltaTime);\n      ",isScaleByLifetimeVertexShader:"\n          scale *= lifeLeft;\n      ",rotateToVelocityVertexShader:"\n        vec3 v = velocity + acceleration * deltaTime;\n        float angle = atan(v.z, v.x) * 2.0;\n        float s = sin(angle);\n        float c = cos(angle);\n      ",rotationVertexShader:"\n        float deltaAngle = deltaTime * rotateRate;\n        float angle = startAngle + deltaAngle;\n        float s = sin(angle);\n        float c = cos(angle);\n\n      ",rotation2dShader:"\n        vec2 rotatedPoint = rotation2d(angle) * vec2(normalizedUv.x, normalizedUv.y * uv.z);\n\n        vec3 basisX = matViewInverse[0].xyz;\n        vec3 basisZ = matViewInverse[1].xyz;\n\n        vec3 localPosition = vec3(basisX * rotatedPoint.x + \n                    basisZ * rotatedPoint.y) * scale + position;\n\n        gl_Position = matProjection * matView * vec4(localPosition + matWorld[3].xyz, 1.);\n      ",rotation3dShader:"\n        vec4 rotatedPoint = vec4((normalizedUv.x * c + normalizedUv.y * uv.z * s) * scale , 0., \n                                 (normalizedUv.x * s - normalizedUv.y * uv.z * c) * scale, 1.);\n      \n        vec4 orientation = vec4(0, 0, 0, 1);\n        vec4 q2 = orientation + orientation;\n        vec4 qx = orientation.xxxw * q2.xyzx;\n        vec4 qy = orientation.xyyw * q2.xyzy;\n        vec4 qz = orientation.xxzw * q2.xxzz;\n      \n        mat4 localMatrix = mat4(\n            (1.0 - qy.y) - qz.z, \n            qx.y + qz.w, \n            qx.z - qy.w,\n            0,\n      \n            qx.y - qz.w, \n            (1.0 - qx.x) - qz.z, \n            qy.z + qx.w,\n            0,\n      \n            qx.z + qy.w, \n            qy.z - qx.w, \n            (1.0 - qx.x) - qy.y,\n            0,\n      \n            position.x, position.y, position.z, 1);\n\n        rotatedPoint = localMatrix * rotatedPoint;\n\n        gl_Position = matModelViewProjection * rotatedPoint;\n      ",fragmentShader:"\n        precision mediump float;\n        precision mediump int;\n\n        varying vec3 v_color;\n        varying float v_alpha;\n        varying float lifeLeft;\n        varying vec2 v_uv;\n        uniform sampler2D particleTex;\n        uniform sampler2D particleMaskTex;\n\n        void main()\n        {\n          float alphaFactor = 1.0;\n      ",fadeInFragmentShader:"\n        float fadeInFactor = step(0.5, lifeLeft);\n        alphaFactor = 2.0 * fadeInFactor * (1.0 - lifeLeft) + (1.0 - fadeInFactor);\n      ",fadeOutFragmentShader:"\n        float fadeOutFactor = step(0.5, lifeLeft);\n        alphaFactor = alphaFactor * 2.0 * (1.0 - fadeOutFactor) * lifeLeft + alphaFactor * fadeOutFactor;\n      ",noImgFragmentShader:" \n        gl_FragColor = vec4( v_color, alphaFactor * v_alpha);\n      ",imgFragmentShader:"\n        vec4 tex = texture2D(particleTex, v_uv);\n      ",originColorFragmentShader:"\n        gl_FragColor = vec4(tex.rgb, alphaFactor * tex.a * v_alpha);\n      ",createColorFragmentShader:"\n        gl_FragColor = vec4(v_color * tex.rgb, alphaFactor * tex.a * v_alpha);\n      ",createColorWithMaskFragmentShader:"\n        vec4 maskTex = texture2D( particleMaskTex, v_uv);\n        gl_FragColor = vec4(v_color * tex.rgb + maskTex.a, alphaFactor * tex.a * v_alpha);\n      "}},n._createVertexShader=function(){var e=this._getShader(),t="";return this.vertexShader?t=this.vertexShader:(t=e.vertexShader,this.isScaleByLifetime?t+=e.isScaleByLifetimeVertexShader:t+=e.sizeVertexShader,this.rotateToVelocity?t+=e.rotateToVelocityVertexShader:t+=e.rotationVertexShader,this.is2d?t+=e.rotation2dShader:t+=e.rotation3dShader,t+="}"),t},n._createFragmentShader=function(){var e=this._getShader(),t="";return this.fragmentShader?t=this.fragmentShader:(t=e.fragmentShader,this.fadeIn&&(t+=e.fadeInFragmentShader),this.fadeOut&&(t+=e.fadeOutFragmentShader),this.particleTex?(t+=e.imgFragmentShader,this.useOriginColor?t+=e.originColorFragmentShader:this.particleMaskTex?t+=e.createColorWithMaskFragmentShader:t+=e.createColorFragmentShader):t+=e.noImgFragmentShader,t+="}"),t},t}(Ur),Zr=function(e){function t(t){return e.call(this,t)||this}R(t,e);var n=t.prototype;return n.init=function(e){if(this._options={position:e.__position,positionRandomness:e.__positionRandomness,velocity:e.__velocity,velocityRandomness:e.__velocityRandomness,acceleration:e.__acceleration,accelerationRandomness:e.__accelerationRandomness,color:e.__color,colorRandomness:e.__colorRandomness,lifetime:e.__lifetime,size:e.__size,sizeRandomness:e.__sizeRandomness,startAngle:e.__startAngle,startAngleRandomness:e.__startAngleRandomness,rotateRate:e.__rotateRate,rotateRateRandomness:e.__rotateRateRandomness,scaleFactor:e.__scaleFactor,alpha:e.__alpha,alphaRandomness:e.__alphaRandomness,startTimeRandomness:e.__startTimeRandomness},this._config={maxCount:e.__maxCount,once:e.__once,rotateToVelocity:e.__rotateToVelocity,isScaleByLifetime:e.__isScaleByLifetime,fadeIn:e.__fadeIn,fadeOut:e.__fadeOut,texture:e.__texture?e.__texture:null,maskTexture:e.__maskTexture?e.__maskTexture:null,useOriginColor:e.__useOriginColor,is2d:e.__is2d,options:this._options},e.__spriteSheet)if("object"==typeof e.__spriteSheet&&e.__spriteSheet.length)this._config.spriteSheet=e.__spriteSheet;else if("string"==typeof e.__spriteSheet)try{var t=JSON.parse(e.__spriteSheet);t.length&&(this._config.spriteSheet=t)}catch(e){}if(e.__positionArray)if("object"==typeof e.__positionArray&&e.__positionArray.length)this._options.positionArray=e.__positionArray;else if("string"==typeof e.__positionArray)try{var n=JSON.parse(e.__positionArray);n.length&&(this._options.positionArray=n)}catch(e){}e.__separate?this._config.blendFuncSeparate=[xe[e.__srcRGB||"SRC_ALPHA"],xe[e.__dstRGB||"ONE_MINUS_SRC_ALPHA"],xe[e.__srcAlpha||"SRC_ALPHA"],xe[e.__dstAlpha||"ONE_MINUS_SRC_ALPHA"]]:e.__src&&e.__dst&&(this._config.blendFunc=[xe[e.__src],xe[e.__dst]]),this.initialize(this._config),!0!==e.__defaultStart&&void 0!==e.__defaultStart||this.start()},n.updateOption=function(e,t){var n;this._options=x({},this._options,((n={})[e]=t,n)),this._config=x({},this._config,{options:x({},this._options)}),this.initialize(this._config),this.start()},n.updateConfig=function(e,t){var n;this._config=x({},this._config,((n={})[e]=t,n)),this.initialize(this._config),this.start()},S(t,[{key:"__position",set:function(e){this.updateOption("position",e)}},{key:"__positionRandomness",set:function(e){this.updateOption("positionRandomness",e)}},{key:"__velocity",set:function(e){this.updateOption("velocity",e)}},{key:"__velocityRandomness",set:function(e){this.updateOption("velocityRandomness",e)}},{key:"__acceleration",set:function(e){this.updateOption("acceleration",e)}},{key:"__accelerationRandomness",set:function(e){this.updateOption("accelerationRandomness",e)}},{key:"__color",set:function(e){this.updateOption("color",e)}},{key:"__colorRandomness",set:function(e){this.updateOption("colorRandomness",e)}},{key:"__lifetime",set:function(e){this.updateOption("lifetime",e)}},{key:"__size",set:function(e){this.updateOption("size",e)}},{key:"__sizeRandomness",set:function(e){this.updateOption("sizeRandomness",e)}},{key:"__startAngle",set:function(e){this.updateOption("startAngle",e)}},{key:"__startAngleRandomness",set:function(e){this.updateOption("startAngleRandomness",e)}},{key:"__rotateRate",set:function(e){this.updateOption("rotateRate",e)}},{key:"__rotateRateRandomness",set:function(e){this.updateOption("rotateRateRandomness",e)}},{key:"__scaleFactor",set:function(e){this.updateOption("scaleFactor",e)}},{key:"__alpha",set:function(e){this.updateOption("alpha",e)}},{key:"__alphaRandomness",set:function(e){this.updateOption("alphaRandomness",e)}},{key:"__startTimeRandomness",set:function(e){this.updateOption("startTimeRandomness",e)}},{key:"__positionArray",set:function(e){if("object"==typeof e&&e.length)this.updateOption("positionArray",e);else if("string"==typeof e)try{var t=JSON.parse(e);t.length?this.updateOption("positionArray",t):this.updateOption("positionArray",null)}catch(e){this.updateOption("positionArray",null)}else this.updateOption("positionArray",null)}},{key:"__maxCount",set:function(e){this.updateConfig("maxCount",e)}},{key:"__useOriginColor",set:function(e){this.updateConfig("useOriginColor",e)}},{key:"__once",set:function(e){this.updateConfig("once",e)}},{key:"__rotateToVelocity",set:function(e){this.updateConfig("rotateToVelocity",e)}},{key:"__isScaleByLifetime",set:function(e){this.updateConfig("isScaleByLifetime",e)}},{key:"__fadeIn",set:function(e){this.updateConfig("fadeIn",e)}},{key:"__fadeOut",set:function(e){this.updateConfig("fadeOut",e)}},{key:"__texture",set:function(e){this.updateConfig("texture",e)}},{key:"__maskTexture",set:function(e){this.updateConfig("maskTexture",e)}},{key:"__spriteSheet",set:function(e){if("object"==typeof e&&e.length)this.updateConfig("spriteSheet",e);else if("string"==typeof e)try{var t=JSON.parse(e);t.length?this.updateConfig("spriteSheet",t):this.updateConfig("spriteSheet",null)}catch(e){this.updateConfig("spriteSheet",null)}else this.updateConfig("spriteSheet",null)}},{key:"__is2d",set:function(e){this.updateConfig("is2d",e)}}]),t}(Qr),Jr=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n._generateTechnique=function(){var e=new ar("trail_tech");e.isValid=!0,e.uniforms={u_texture:{name:"u_texture",type:ge.SAMPLER_2D}},e.attributes={},e.states={enable:[oe.BLEND],functions:{blendFunc:[xe.SRC_ALPHA,xe.ONE],depthMask:[!1]}},e.customMacros=[],e.vertexShader="attribute vec3 a_position;\nattribute vec2 a_uv;\n\nvarying vec2 v_uv;\n\nuniform mat4 u_projMat;\nuniform mat4 u_viewMat;\n\nvoid main() {\n\n  gl_Position = u_projMat * u_viewMat * vec4( a_position, 1.0 );\n  v_uv = a_uv;\n\n}\n",e.fragmentShader="varying vec2 v_uv;\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n\n  gl_FragColor = texture2D(u_texture, v_uv);\n\n}\n",this._technique=e,this.renderType=ie.TRANSPARENT},n.prepareDrawing=function(t,n,r){null===this._technique&&this._generateTechnique(),e.prototype.prepareDrawing.call(this,t,n,r)},t}(Hn),$r=new s,ei=function(e){function t(t,n){var r;(r=e.call(this,t)||this)._stroke=n.stroke||.2,r._minSeg=n.minSeg||.02,r._lifetime=n.lifetime||1e3,r._maxPointNum=r._lifetime/1e3*t.engine.targetFrameRate,r._points=[],r._pointStates=[],r._strapPoints=[];for(var i=0;i<r._maxPointNum;i++)r._points.push(new s),r._pointStates.push(r._lifetime),r._strapPoints.push(new s),r._strapPoints.push(new s);r._curPointNum=0;var a=n.material||new Jr(r.engine,"trial_mtl");return r.material=a,r.setTexture(n.texture),r._initGeometry(),r}R(t,e);var n=t.prototype;return n.update=function(e){for(var t=0,n=0,r=0;r<this._curPointNum;r++)this._pointStates[r]-=e,this._pointStates[r]<0?t++:t>0&&(n=r-t,this._pointStates[n]=this._pointStates[r],this._points[r].cloneTo(this._points[n]));this._curPointNum-=t;var i=!0;if(this._curPointNum===this._maxPointNum)i=!1;else if(this._curPointNum>0){var a=this._points[this._points.length-1];s.distance(this.entity.worldPosition,a)<this._minSeg&&(i=!1)}i&&(this._pointStates[this._curPointNum]=this._lifetime,this.entity.worldPosition.cloneTo(this._points[this._curPointNum]),this._curPointNum++)},n.render=function(t){this._updateStrapVertices(t,this._points),this._updateStrapCoords(),this._vertexBuffer.setData(this._vertices),e.prototype.render.call(this,t)},n.setTexture=function(e){e&&this.material.setValue("u_texture",e)},n._initGeometry=function(){var e=new Dr(this._entity.engine),t=2*this._maxPointNum,n=20*t,r=new Float32Array(n),i=[new $n("POSITION",0,Fn.Vector3,0),new $n("TEXCOORD_0",12,Fn.Vector2,0)],a=new Kn(this.engine,4*n,Pn.Dynamic);e.setVertexBufferBinding(a,20),e.setVertexElements(i),e.addSubGeometry(0,t,qn.TriangleStrip),this._vertexBuffer=a,this._vertexStride=20,this._vertices=r,this.geometry=e},n._updateStrapVertices=function(e,t){var n=e.viewMatrix.elements,r=new s(n[0],n[4],n[8]),i=new s(n[1],n[5],n[9]),a=new s(n[2],n[6],n[10]),o=this._stroke;i.scale(o);var u=new s,c=new s,l=new f;s.transformByQuat(r,l,r),s.transformByQuat(i,l,i);var h=new s,d=new s,_=new s;r.normalize();for(var m=this._vertices,p=0;p<this._maxPointNum;p++){if(p<this._curPointNum){var v=t[p];p===this._curPointNum-1&&0!==p?s.subtract(v,t[p-1],_):s.subtract(t[p+1],v,_),this._projectOnPlane(_,a,_),_.normalize();var g=Math.acos(s.dot(r,_));s.cross(r,_,d),s.dot(d,a)<=0&&(g=2*Math.PI-g),f.rotationAxisAngle(a,g,l),s.transformByQuat(i,l,h),s.add(v,h,u),s.subtract(v,h,c)}var y=2*p*this._vertexStride/4,E=(2*p+1)*this._vertexStride/4;m[y]=u.x,m[y+1]=u.y,m[y+2]=u.z,m[E]=c.x,m[E+1]=c.y,m[E+2]=c.z}},n._updateStrapCoords=function(){if(this._prePointsNum!==this._curPointNum){this._prePointsNum=this._curPointNum;for(var e=this._curPointNum,t=1/e,n=this._vertices,r=0;r<e;r++){var i=1-r*t,a=2*r*this._vertexStride/4,o=(2*r+1)*this._vertexStride/4;n[a]=0,n[a+1]=i,n[o]=1,n[o+1]=i}}},n._projectOnVector=function(e,t,n){var r=t.clone();s.normalize(r,r);var i=s.dot(e,r);n.x=r.x*i,n.y=r.y*i,n.z=r.z*i},n._projectOnPlane=function(e,t,n){this._projectOnVector(e,t,$r),s.subtract(e,$r,n)},t}(Ur),ti=function(e){function t(t){var n;return(n=e.call(this,t)||this)._center=new s,n._size=new s,n.isShowCollider=!0,n.center=n.center,n.size=n.size,n.isShowCollider=n.isShowCollider,n}return R(t,e),S(t,[{key:"center",get:function(){return this._center},set:function(e){this._center=e,this.setBoxCenterSize(this._center,this._size)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e,this.setBoxCenterSize(this._center,this._size)}}]),t}(nn),ni=function(e){function t(t){var n;return(n=e.call(this,t)||this).__center=new s,n.__radius=1,n.isShowCollider=!0,n._center=n._center,n._radius=n._radius,n.isShowCollider=n.isShowCollider,n}return R(t,e),S(t,[{key:"_center",get:function(){return this.__center},set:function(e){this.__center=e,this.setSphere(this.__center,this.__radius)}},{key:"_radius",get:function(){return this.__radius},set:function(e){this.__radius=e,this.setSphere(this.__center,this.__radius)}}]),t}(rn);function ri(e,t){var n=e.center,r=new s(Math.max(t.min.x,Math.min(n.x,t.max.x)),Math.max(t.min.y,Math.min(n.y,t.max.y)),Math.max(t.min.z,Math.min(n.z,t.max.z)));return s.distance(n,r)<e.radius}ot.registerFeature(en);var ii=function(e){function t(t){var n;return(n=e.call(this,t)||this)._colliderManager=null,n._myCollider=null,n._overlopCollider=null,n}R(t,e);var n=t.prototype;return n.onUpdate=function(t){e.prototype.onUpdate.call(this,t);var n=null;if(this._colliderManager&&this._myCollider){var r=this._colliderManager.colliders;if(this._myCollider instanceof nn){this._box=this._getWorldBox(this._myCollider);for(var i=0,a=r.length;i<a;i++){var o=r[i];o!=this._myCollider&&this._boxCollision(o)&&(n=o,this.trigger(new G("collision",this,{collider:o})))}}else if(this._myCollider instanceof rn){this._sphere=this._getWorldSphere(this._myCollider);for(var s=0,u=r.length;s<u;s++){var c=r[s];c!=this._myCollider&&this._sphereCollision(c)&&(n=c,this.trigger(new G("collision",this,{collider:c})))}}}if(null!=n&&this._overlopCollider!=n&&this.trigger(new G("begin_overlop",this,{collider:n})),null!=this._overlopCollider&&this._overlopCollider!=n){var l=this._overlopCollider;this.trigger(new G("end_overlop",this,{collider:l}))}this._overlopCollider=n},n._getWorldBox=function(e){var n=e.entity.transform.worldMatrix,r=new s,i=new s;s.transformCoordinate(e.boxMax,n,r),s.transformCoordinate(e.boxMin,n,i);for(var a=t._tempVec3,o=e.getCorners(),u=0;u<8;u++)s.transformCoordinate(o[u],n,a),a.x>r.x&&(r.x=a.x),a.y>r.y&&(r.y=a.y),a.z>r.z&&(r.z=a.z),a.x<i.x&&(i.x=a.x),a.y<i.y&&(i.y=a.y),a.z<i.z&&(i.z=a.z);return{min:i,max:r}},n._getWorldSphere=function(e){var t=new s;return s.transformCoordinate(e.center,e.entity.transform.worldMatrix,t),{radius:e.radius,center:t}},n._boxCollision=function(e){if(e instanceof nn){var t=this._getWorldBox(e);return n=t,r=this._box,n.min.x<=r.max.x&&n.max.x>=r.min.x&&n.min.y<=r.max.y&&n.max.y>=r.min.y&&n.min.z<=r.max.z&&n.max.z>=r.min.z}var n,r;return e instanceof rn&&ri(this._getWorldSphere(e),this._box)},n._sphereCollision=function(e){if(e instanceof nn){var t=this._getWorldBox(e);return ri(this._sphere,t)}if(e instanceof rn){var n=this._getWorldSphere(e);return r=n,i=this._sphere,s.distance(r.center,i.center)<r.radius+r.radius}var r,i;return!1},n.onAwake=function(){this._colliderManager=this.scene.findFeature(en),this._myCollider=this.entity.getComponent(tn)},S(t,[{key:"overlopCollider",get:function(){return this._overlopCollider}}]),t}(gt);ii._tempVec3=new s;var ai=function(e){function t(t){var n;return(n=e.call(this,t)||this).color=new s(1,0,0),n}R(t,e);var n=t.prototype;return n._onEnable=function(){this.scene.findFeature(li).fog=this},n._onDisable=function(){this.scene.findFeature(li).fog=null},n.bindMaterialValues=function(e){},t}(Ze),oi=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).density=.0025,t}return R(t,e),t.prototype.bindMaterialValues=function(e){e.setValue("u_fogColor",this.color),e.setValue("u_fogDensity",this.density)},t}(ai);function si(){return!0}function ui(){return this.findFeature(li).macro}function ci(e){this.findFeature(li).bindFogToMaterial(e)}var li=function(e){function t(){var t;return(t=e.call(this)||this)._fog=null,t._macros=[],t}return R(t,e),t.prototype.bindFogToMaterial=function(e){return this.fog&&e.useFog&&this.fog.bindMaterialValues(e),this},S(t,[{key:"fog",get:function(){return this._fog},set:function(e){if(e!==this._fog){this._fog=e;var t=[];e instanceof ai&&(t.push("O3_HAS_FOG"),e instanceof oi&&t.push("O3_FOG_EXP2")),this._macros.length!==t.length&&(this._macros=t)}}},{key:"macro",get:function(){return this._macros}}]),t}(_t),fi=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).near=1,t.far=1e3,t}return R(t,e),t.prototype.bindMaterialValues=function(e){e.setValue("u_fogColor",this.color),e.setValue("u_fogNear",this.near),e.setValue("u_fogFar",this.far)},t}(ai);ot.registerFeature(li),ot.prototype.hasFogFeature=si,ot.prototype.getFogMacro=ui,ot.prototype.bindFogToMaterial=ci;var hi=0,di=function(e){function t(t){var n;return(n=e.call(this,t)||this).cacheId=hi++,n.renderPass=new Ot("_renderPass"+n.cacheId,-10),n.renderPass.renderOverride=!0,n.renderPass.preRender=n.preRender.bind(A(n)),n.renderPass.render=n.render.bind(A(n)),n.renderPass.postRender=n.postRender.bind(A(n)),n.addEventListener("enabled",(function(){n.renderPass.enabled=!0})),n.addEventListener("disabled",(function(){n.renderPass.enabled=!1})),n}R(t,e);var n=t.prototype;return n.init=function(e){void 0===e&&(e={}),this.isCube=!!e.isCube,this.camera=e.camera||this.scene._activeCameras[0],this.excludeRenderList=e.excludeRenderList||[],this.renderAll=!!e.renderAll,this.renderList=e.renderList||[],this.clipPlanes=e.clipPlanes||[];var t=e.width||1024,n=e.height||1024,r=e.samples||1;this.renderTarget=new pr(this.engine,t,n,new vr(this.engine,t,n,void 0,!1,this.isCube),On.Depth,r),this.renderTargetSwap=new pr(this.engine,t,n,new vr(this.engine,t,n,void 0,!1,this.isCube),On.Depth,r),this.renderPass.renderTarget=this.renderTarget},n.preRender=function(){this.oriClipPlane=this.scene.clipPlanes,this.scene.clipPlanes=this.clipPlanes},n.render=function(){var e=this,t=bt._getRenderContext(this.camera);this.renderItems.forEach((function(n){var r=n.component,i=n.primitive,a=n.subPrimitive,o=n.material;r.renderPassFlag&e.renderPassFlag&&(o.prepareDrawing(t,r,i),e.rhi.drawPrimitive(i,a,o))}))},n.postRender=function(){this.scene.clipPlanes=this.oriClipPlane,this.renderPass.enabled&&(this.onTextureChange&&(this.isCube?this.onTextureChange(this.cubeTexture):this.onTextureChange(this.texture,this.depthTexture)),this.renderPass.renderTarget===this.renderTarget?this.renderPass.renderTarget=this.renderTargetSwap:this.renderPass.renderTarget=this.renderTarget)},n.destroy=function(){this.enabled=!1,this.renderPipeline.removeRenderPass(this.renderPass),e.prototype.destroy.call(this),this.renderTarget.destroy(),this.renderTargetSwap.destroy()},n.onTextureChange=function(e,t){},S(t,[{key:"camera",get:function(){return this._camera},set:function(e){e!==this._camera&&(this._camera&&this.renderPipeline.removeRenderPass(this.renderPass),this._camera=e,e&&this.renderPipeline.addRenderPass(this.renderPass))}},{key:"texture",get:function(){var e;return null==(e=this.renderPass.renderTarget)?void 0:e.getColorTexture()}},{key:"depthTexture",get:function(){var e;return null==(e=this.renderPass.renderTarget)?void 0:e.depthTexture}},{key:"cubeTexture",get:function(){var e;return null==(e=this.renderPass.renderTarget)?void 0:e.getColorTexture()}},{key:"renderPipeline",get:function(){return this.camera._renderPipeline}},{key:"rhi",get:function(){return this.camera.scene.engine._hardwareRenderer}},{key:"renderItems",get:function(){var e=this,t=this.renderPipeline.opaqueQueue,n=this.renderPipeline.transparentQueue;return t.items.concat(n.items).filter((function(t){return!!t.primitive&&(!e.excludeRenderList.includes(t.material)&&(!!e.renderAll||(!!e.renderList.includes(t.material)||void 0)))}))}},{key:"samples",get:function(){return this.renderTarget.antiAliasing}}]),t}(Ze),_i=function(e){function t(t){return e.call(this,t)||this}R(t,e);var n=t.prototype;return n.init=function(t){void 0===t&&(t={}),e.prototype.init.call(this,t)},n.storeMaterial=function(){this.renderItems.forEach((function(e){var t=e.material;e.initialSide=t.side,t.side=he.BACK}))},n.restoreMaterial=function(){this.renderItems.forEach((function(e){e.material.side=e.initialSide,delete e.initialSide}))},n.preRender=function(){e.prototype.preRender.call(this),this.storeMaterial()},n.postRender=function(){e.prototype.postRender.call(this),this.restoreMaterial()},t}(di),mi=new s,pi=new s,vi=new s,gi=90*Math.PI/180,yi=function(e){function t(t){var n;return(n=e.call(this,t)||this).oriViewMatrix=new h,n.oriInverseViewMatrix=new h,n.oriProjectionMatrix=new h,n.oriInverseProjectionMatrix=new h,n}R(t,e);var n=t.prototype;return n.init=function(t){void 0===t&&(t={}),e.prototype.init.call(this,x({},t,{isCube:!0})),this.position=t.position||new s},n.storeCamera=function(){this.camera.viewMatrix.cloneTo(this.oriViewMatrix),this.camera.inverseViewMatrix.cloneTo(this.oriInverseViewMatrix),this.camera.projectionMatrix.cloneTo(this.oriProjectionMatrix),this.camera.inverseProjectionMatrix.cloneTo(this.oriInverseProjectionMatrix)},n.restoreCamera=function(){this.oriViewMatrix.cloneTo(this.camera.viewMatrix),this.oriInverseViewMatrix.cloneTo(this.camera.inverseViewMatrix),this.oriProjectionMatrix.cloneTo(this.camera.projectionMatrix),this.oriInverseProjectionMatrix.cloneTo(this.camera.inverseProjectionMatrix)},n.preRender=function(){e.prototype.preRender.call(this),this.storeCamera()},n.render=function(){for(var t=0;t<6;t++)this.rhi.setRenderTargetFace(this.renderPass.renderTarget,t),this.rhi.clearRenderTarget(this.renderPass.clearMode,this.renderPass.clearParam),this.setCamera(t),e.prototype.render.call(this),t<5&&this.rhi.blitRenderTarget(this.renderPass.renderTarget)},n.postRender=function(){e.prototype.postRender.call(this),this.restoreCamera()},n.setCamera=function(e){switch(e){case 0:pi.setValue(0,-1,0),vi.setValue(1,0,0);break;case 1:pi.setValue(0,-1,0),vi.setValue(-1,0,0);break;case 2:pi.setValue(0,0,1),vi.setValue(0,1,0);break;case 3:pi.setValue(0,0,-1),vi.setValue(0,-1,0);break;case 4:pi.setValue(0,-1,0),vi.setValue(0,0,1);break;case 5:pi.setValue(0,-1,0),vi.setValue(0,0,-1)}s.add(this.position,vi,mi),h.lookAt(this.position,mi,pi,this.camera.viewMatrix),h.invert(this.camera.viewMatrix,this.camera.inverseViewMatrix),h.perspective(gi,1,this.camera.nearClipPlane,this.camera.farClipPlane,this.camera.projectionMatrix),h.invert(this.camera.projectionMatrix,this.camera.inverseProjectionMatrix)},t}(di),Ei=function(){function e(e){void 0===e&&(e={engine:null,width:512,height:512}),this._mapSize=new g(e.width,e.height),this._renderTarget=new pr(e.engine,e.width,e.height,new vr(e.engine,e.width,e.height)),this.bias=.005,this.intensity=.2,this.radius=1,this.projectionMatrix=new h}var t=e.prototype;return t.initShadowProjectionMatrix=function(e){if(e instanceof Yt&&h.ortho(-5,5,-5,5,.1,50,this.projectionMatrix),e instanceof Zt&&h.perspective(o.degreeToRadian(50),1,.5,50,this.projectionMatrix),e instanceof Jt){var t=Math.min(Math.PI/2,2*e.angle*Math.sqrt(2));h.perspective(t,1,.1,e.distance+5,this.projectionMatrix)}},t.bindShadowValues=function(e,t,n){e.setValue("u_viewMatFromLight["+t+"]",n.viewMatrix),e.setValue("u_projMatFromLight["+t+"]",this.projectionMatrix);var r="u_shadows["+t+"]";e.setValue(r+".bias",this.bias),e.setValue(r+".intensity",this.intensity),e.setValue(r+".radius",this.radius),e.setValue(r+".mapSize",this._mapSize),e.setValue("u_shadowMaps["+t+"]",this.map)},e.getUniformDefine=function(e){var t={};t["u_viewMatFromLight["+e+"]"]={name:"u_viewMatFromLight["+e+"]",type:ge.FLOAT_MAT4},t["u_projMatFromLight["+e+"]"]={name:"u_projMatFromLight["+e+"]",type:ge.FLOAT_MAT4};var n="u_shadows["+e+"]";return t[n+".bias"]={name:n+".bias",type:ge.FLOAT},t[n+".intensity"]={name:n+".intensity",type:ge.FLOAT},t[n+".radius"]={name:n+".radius",type:ge.FLOAT},t[n+".mapSize"]={name:n+".mapSize",type:ge.FLOAT_VEC2},t["u_shadowMaps["+e+"]"]={name:"u_shadowMaps["+e+"]",type:ge.SAMPLER_2D},t},S(e,[{key:"renderTarget",get:function(){return this._renderTarget}},{key:"map",get:function(){return this._renderTarget.getColorTexture()}},{key:"mapSize",get:function(){return this._mapSize}}]),e}();Object.defineProperty(Wt.prototype,"enableShadow",{get:function(){return this._enableShadow},set:function(e){if(this._enableShadow=e,this._enableShadow){if(this instanceof qt)return void Be.warn("Has no shadow!");this.shadow=this.shadow||new Ei({engine:this.engine,width:512,height:512}),this.shadow.initShadowProjectionMatrix(this)}}}),Object.defineProperty(Ze.prototype,"recieveShadow",{get:function(){return this._recieveShadow},set:function(e){this._recieveShadow=e}}),Object.defineProperty(Ze.prototype,"castShadow",{get:function(){return this._castShadow},set:function(e){this._castShadow=e}});var Ti="#include <common_vert>\n#include <normal_share>\n#include <shadow_share>\n\nvoid main() {\n\n    #include <begin_position_vert>\n    #include <begin_normal_vert>\n    #include <skinning_vert>\n    #include <shadow_vert>\n    #include <position_vert>\n\n}\n",xi=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n._generateTechnique=function(e,t){var n=this._generateMacros(),r=this._generateFragmentUniform(),i=new ar(this.name);return i.isValid=!0,i.uniforms=r,i.attributes={},i.states={},i.customMacros=n,i.vertexShader=Ti,i.fragmentShader="precision mediump float;\n\n/**\n * \n*/\nvec4 pack (float depth) {\n\n  // rgba 432z,11/256\n  const vec4 bitShift = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n  const vec4 bitMask = vec4(1.0/256.0, 1.0/256.0, 1.0/256.0, 0.0);\n\n  vec4 rgbaDepth = fract(depth * bitShift); //z\n\n  // Cut off the value which do not fit in 8 bits\n  rgbaDepth -= rgbaDepth.gbaa * bitMask;\n\n  return rgbaDepth;\n}\n\nvoid main() {\n\n  // zrgba,z\n  gl_FragColor = pack(gl_FragCoord.z);\n\n}",i},n._generateFragmentUniform=function(){return{u_viewMatFromLight:{name:"u_viewMatFromLight",type:ge.FLOAT_MAT4},u_projMatFromLight:{name:"u_projMatFromLight",type:ge.FLOAT_MAT4}}},n._generateMacros=function(){var e=[];return e.push("O3_GENERATE_SHADOW_MAP"),e},t}(zn),Ai=function(e){function t(t,n,r,i,a,o){var s;return(s=e.call(this,t,n,r,i,a)||this).light=o,s}return R(t,e),t.prototype.preRender=function(e,t,n){this.replaceMaterial.setValue("u_viewMatFromLight",this.light.viewMatrix),this.replaceMaterial.setValue("u_projMatFromLight",this.light.shadow.projectionMatrix)},t}(Ot),Oi=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n._generateTechnique=function(e,t){var n=this._generateMacros(),r=this._generateFragmentUniform(),i=new ar(this.name);return i.autoConvert=!1,i.isValid=!0,i.uniforms=r,i.attributes={},i.states={},i.customMacros=n,i.vertexShader=Ti,i.fragmentShader="varying vec2 v_uv;\n\nuniform vec4 u_ambientLight;\n\n#ifdef O3_SHADOW_MAP_COUNT\n\nstruct Shadow {\n  float     bias;\n  float     intensity;\n  vec2      mapSize;\n  float     radius;\n};\n\nuniform Shadow u_shadows[O3_SHADOW_MAP_COUNT];\n\nuniform sampler2D u_shadowMaps[O3_SHADOW_MAP_COUNT];\n\nvarying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];\n\nconst vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0*256.0), 1.0/(256.0*256.0*256.0));\n\n/**\n* \n*/\nfloat unpack(const in vec4 rgbaDepth) {\n  return dot(rgbaDepth, bitShift);\n}\n\n/**\n* \n*/\nfloat getVisibility(vec4 positionFromLight, const in sampler2D shadowMap, vec2 mapSize, float intensity, float bias, float radius) {\n\n    vec3 shadowCoord = (positionFromLight.xyz/positionFromLight.w)/2.0 + 0.5;\n    float filterX = step(0.0, shadowCoord.x) * (1.0 - step(1.0, shadowCoord.x));\n    float filterY = step(0.0, shadowCoord.y) * (1.0 - step(1.0, shadowCoord.y));\n\n    shadowCoord.z -= bias;\n    vec2 texelSize = vec2( 1.0 ) / mapSize;\n\n    float visibility = 0.0;\n    for (float y = -1.0 ; y <=1.0 ; y+=1.0) {\n      for (float x = -1.0 ; x <=1.0 ; x+=1.0) {\n        vec2 uv = shadowCoord.xy + texelSize * vec2(x, y) * radius;\n        vec4 rgbaDepth = texture2D(shadowMap, uv);\n        float depth = unpack(rgbaDepth);\n        visibility += step(depth, shadowCoord.z) * intensity;\n      }\n    }\n\n    visibility *= ( 1.0 / 9.0 );\n    return visibility * filterX * filterY;\n\n}\n\n#endif\n\nvoid main() {\n\n  vec4 shadowColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n#ifdef O3_SHADOW_MAP_COUNT\n\n  float visibility = 1.0;\n\n  for(int i = 0; i < O3_SHADOW_MAP_COUNT; i++) {\n\n   visibility -= getVisibility(v_PositionFromLight[i], u_shadowMaps[i], u_shadows[i].mapSize, u_shadows[i].intensity, u_shadows[i].bias, u_shadows[i].radius);\n\n  }\n\n  visibility = clamp(visibility, 0.0, 1.0);\n  shadowColor = vec4(visibility, visibility, visibility, 1.0);\n\n#endif\n\n  gl_FragColor = shadowColor;\n}",i.states={enable:[oe.BLEND],functions:{depthFunc:[_e.LEQUAL],blendFunc:[xe.DST_COLOR,xe.ZERO]}},i},n._generateFragmentUniform=function(){for(var e={},t=0;t<this.shadowMapCount;t++){e=x({},e,Ei.getUniformDefine(t))}return e},n._generateMacros=function(){var e=[];return this.shadowMapCount>0&&e.push("O3_SHADOW_MAP_COUNT "+this.shadowMapCount),e},t}(zn),bi=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).clearMode=ne.DONT_CLEAR,t}return R(t,e),t.prototype.preRender=function(e,t,n){this.enabled=!1;var r=e.scene.findFeature($t);if(r){var i=e._renderPipeline.defaultRenderPass;this.renderTarget=i.renderTarget;for(var a=r.visibleLights,o=0,s=0,u=a.length;s<u;s++){var c=a[s];c.enableShadow&&(c.shadow.bindShadowValues(this.replaceMaterial,o,c),o++)}o!==this.replaceMaterial.shadowMapCount&&(this.replaceMaterial.shadowMapCount=o,this.replaceMaterial.clearTechniques()),o&&(this.enabled=!0)}},t}(Ot),Mi=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.preRender=function(e,t){var n=t.scene.findFeature($t);if(n&&n.visibleLights.length>0){this._shadowPass||this.addShadowPass(t);for(var r=n.visibleLights,i=0,a=r.length;i<a;i++){var o=r[i];if(o.enableShadow&&!o.shadowMapPass)o.shadowMapPass=this.addShadowMapPass(t,o);else if(!o.enableShadow&&o.shadowMapPass){t._renderPipeline.removeRenderPass(o.shadowMapPass),o.shadowMapPass=null}}this.updatePassRenderFlag(t._renderPipeline.opaqueQueue),this.updatePassRenderFlag(t._renderPipeline.transparentQueue)}},n.addShadowPass=function(e){var t=new Oi(e.engine,"shadowMaterial");this._shadowPass=new bi("ShadowPass",1,null,t,Oe.SHADOW),e._renderPipeline.addRenderPass(this._shadowPass)},n.addShadowMapPass=function(e,t){this._shadowMapMaterial=this._shadowMapMaterial||new xi(e.engine,"shadowMapMaterial");var n=new Ai("ShadowMapPass",-1,t.shadow.renderTarget,this._shadowMapMaterial,Oe.SHADOW_MAP,t);return e._renderPipeline.addRenderPass(n),n},n.updatePassRenderFlag=function(e){for(var t=e.items,n=0,r=t.length;n<r;n++){var i=t[n].component,a=i.recieveShadow,o=i.castShadow;!0===a?i.addPassMasks(Oe.SHADOW):!1===a&&i.removePassMasks(Oe.SHADOW),!0===o?i.addPassMasks(Oe.SHADOW_MAP):!1===o&&i.removePassMasks(Oe.SHADOW_MAP)}},t}(_t);function Si(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}ot.registerFeature(Mi),ot.registerFeature($t),ot.prototype.hasLight=function(){return this.findFeature($t).visibleLights.length>0};var Ri=function(){function e(e,t){var n=this;this._costs={},this._currentLoad=0,this._callbacks={},this._worker=new Worker(e),this._worker.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t.geometry);break;case"error":n._callbacks[t.id].reject(t);break;default:Be.error('DRACOWorker: Unexpected message, "'+t.type+'"')}},t?this._worker.postMessage({type:"init",decoderConfig:{wasmBinary:t}}):this._worker.postMessage({type:"init",decoderConfig:{}})}var t,n,r,i=e.prototype;return i.setCosts=function(e,t){this._costs[e]=t},i.addCurrentLoad=function(e){this._currentLoad+=e},i.setCallback=function(e,t,n){this._callbacks[e]={resolve:t,reject:n}},i.decode=function(e,t,n){this._worker.postMessage({type:"decode",id:e,taskConfig:t,buffer:n},[n])},i.releaseTask=function(e){this._currentLoad-=this._costs[e],delete this._callbacks[e],delete this._costs[e]},t=e,(n=[{key:"currentLoad",get:function(){return this._currentLoad}}])&&Si(t.prototype,n),r&&Si(t,r),e}(),Li='let decoderPending;\nlet decoderConfig;\n\nonmessage = function(e) {\n  const message = e.data;\n\n  switch (message.type) {\n    case "init":\n      decoderConfig = message.decoderConfig;\n      decoderPending = new Promise(function(resolve /*, reject*/) {\n        decoderConfig.onModuleLoaded = function(draco) {\n          // Module is Promise-like. Wrap before resolving to avoid loop.\n          resolve({ draco: draco });\n        };\n        DracoDecoderModule(decoderConfig);\n      });\n      break;\n\n    case "decode":\n      const buffer = message.buffer;\n      const taskConfig = message.taskConfig;\n      decoderPending.then(module => {\n        const draco = module.draco;\n        const decoder = new draco.Decoder();\n        const decoderBuffer = new draco.DecoderBuffer();\n        decoderBuffer.Init(new Int8Array(buffer), buffer.byteLength);\n        try {\n          const geometry = decodeGeometry(draco, decoder, decoderBuffer, taskConfig);\n          const buffers = geometry.attributes.map(attr => attr.array.buffer);\n          if (geometry.index) buffers.push(geometry.index.array.buffer);\n          self.postMessage({ type: "decode", id: message.id, geometry }, buffers);\n        } catch (error) {\n          console.error(error);\n          self.postMessage({ type: "error", id: message.id, error: error.message });\n        } finally {\n          draco.destroy(decoderBuffer);\n          draco.destroy(decoder);\n        }\n      });\n      break;\n  }\n};\n\nfunction decodeGeometry(draco, decoder, decoderBuffer, taskConfig) {\n  const attributeIDs = taskConfig.attributeIDs;\n  const attributeTypes = taskConfig.attributeTypes;\n\n  let dracoGeometry;\n  let decodingStatus;\n\n  const geometryType = decoder.GetEncodedGeometryType(decoderBuffer);\n  if (geometryType === draco.TRIANGULAR_MESH) {\n    dracoGeometry = new draco.Mesh();\n    decodingStatus = decoder.DecodeBufferToMesh(decoderBuffer, dracoGeometry);\n  } else {\n    throw new Error("DRACODecoder worker: Unexpected geometry type.");\n  }\n\n  if (!decodingStatus.ok() || dracoGeometry.ptr === 0) {\n    throw new Error("DRACODecoder worker: Decoding failed: " + decodingStatus.error_msg());\n  }\n\n  const geometry = { index: null, attributes: [] };\n\n  // Gather all vertex attributes.\n  for (let attributeName in attributeIDs) {\n    const attributeType = self[attributeTypes[attributeName]];\n\n    let attribute;\n    let attributeID;\n\n    // A Draco file may be created with default vertex attributes, whose attribute IDs\n    // are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,\n    // a Draco file may contain a custom set of attributes, identified by known unique\n    // IDs. glTF files always do the latter, and `.drc` files typically do the former.\n    if (taskConfig.useUniqueIDs) {\n      attributeID = attributeIDs[attributeName];\n      attribute = decoder.GetAttributeByUniqueId(dracoGeometry, attributeID);\n    } else {\n      attributeID = decoder.GetAttributeId(dracoGeometry, draco[attributeIDs[attributeName]]);\n      if (attributeID === -1) continue;\n      attribute = decoder.GetAttribute(dracoGeometry, attributeID);\n    }\n    geometry.attributes.push(decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute));\n  }\n  // Add index.\n  if (geometryType === draco.TRIANGULAR_MESH) {\n    // Generate mesh faces.\n    const numFaces = dracoGeometry.num_faces();\n    const numIndices = numFaces * 3;\n    let dataSize;\n    let ptr;\n    let index;\n    const indexType = self[taskConfig.indexType];\n\n    switch (indexType) {\n      case Uint16Array:\n        dataSize = numIndices * 2;\n        ptr = draco._malloc(dataSize);\n        decoder.GetTrianglesUInt16Array(dracoGeometry, dataSize, ptr);\n        index = new Uint16Array(draco.HEAPU16.buffer, ptr, numIndices).slice();\n        draco._free(ptr);\n        break;\n      case Uint32Array:\n        dataSize = numIndices * 4;\n        ptr = draco._malloc(dataSize);\n        decoder.GetTrianglesUInt32Array(dracoGeometry, dataSize, ptr);\n        index = new Uint32Array(draco.HEAPU32.buffer, ptr, numIndices).slice();\n        draco._free(ptr);\n      default:\n        throw new Error("DRACODecoder: Unexpected index type.");\n    }\n    geometry.index = { array: index, itemSize: 1 };\n  }\n  draco.destroy(dracoGeometry);\n  return geometry;\n}\n\nfunction decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute) {\n  const numComponents = attribute.num_components();\n  const numPoints = dracoGeometry.num_points();\n  const numValues = numPoints * numComponents;\n  let ptr;\n  let array;\n  let dataSize;\n  switch (attributeType) {\n    case Float32Array:\n      dataSize = numValues * 4;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_FLOAT32, dataSize, ptr);\n      array = new Float32Array(draco.HEAPF32.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Int8Array:\n      ptr = draco._malloc(numValues);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT8, numValues, ptr);\n      array = new Int8Array(draco.HEAP8.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Int16Array:\n      dataSize = numValues * 2;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT16, dataSize, ptr);\n      array = new Int16Array(draco.HEAP16.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Int32Array:\n      dataSize = numValues * 4;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT32, dataSize, ptr);\n      array = new Int32Array(draco.HEAP32.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Uint8Array:\n      ptr = draco._malloc(numValues);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT8, numValues, ptr);\n      array = new Uint8Array(draco.HEAPU8.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Uint16Array:\n      dataSize = numValues * 2;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT16, dataSize, ptr);\n      array = new Uint16Array(draco.HEAPU16.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    case Uint32Array:\n      dataSize = numValues * 4;\n      ptr = draco._malloc(dataSize);\n      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT32, dataSize, ptr);\n      array = new Uint32Array(draco.HEAPU32.buffer, ptr, numValues).slice();\n      draco._free(ptr);\n      break;\n\n    default:\n      throw new Error("DRACODecoder: Unexpected attribute type.");\n  }\n\n  return {\n    name: attributeName,\n    array: array,\n    itemSize: numComponents\n  };\n}\n',Ci="https://gw.alipayobjects.com/os/lib/alipay/draco-javascript/1.3.6/lib/",Ii=function(){function e(e){var t;(void 0===e&&(e={type:"wasm",workerLimit:4}),this.pool=[],this.workerLimit=Math.min(navigator.hardwareConcurrency||4,4),this.currentTaskId=1,this.taskCache=new WeakMap,e.workerLimit>this.workerLimit)?Be.warn("DRACOWorkerPool: Can not initialize worker pool with limit:"+e.workerLimit):this.workerLimit=null!=(t=e.workerLimit)?t:4;this.useJS="object"!=typeof WebAssembly||"js"===e.type,this.loadLibPromise=this.preloadLib()}var t=e.prototype;return t.preloadLib=function(){var e=this;return this.loadLibPromise?this.loadLibPromise:new Promise((function(t,n){e.useJS?Ut(Ci+"draco_decoder_gltf.js",{type:"text"}).then((function(e){var n=[e,Li].join("\n"),r=URL.createObjectURL(new Blob([n]));t({workerSourceURL:r,decoderWASMBinary:null})})).catch((function(e){n(e)})):Promise.all([Ut(Ci+"draco_wasm_wrapper_gltf.js",{type:"text"}),Ut(Ci+"draco_decoder_gltf.r3bin",{type:"arraybuffer"})]).then((function(e){var n=e[0],r=e[1],i=[n,Li].join("\n"),a=URL.createObjectURL(new Blob([i]));t({workerSourceURL:a,decoderWASMBinary:r})})).catch((function(e){n(e)}))}))},t.getWorker=function(){var e=this;return this.preloadLib().then((function(t){if(e.pool.length<e.workerLimit){var n=new Ri(t.workerSourceURL,t.decoderWASMBinary);e.pool.push(n)}else e.pool.sort((function(e,t){return e.currentLoad>t.currentLoad?-1:1}));return e.pool[e.pool.length-1]}))},t.decode=function(e,t){var n=this,r=JSON.stringify(t);if(this.taskCache.has(e)){var i=this.taskCache.get(e);if(i.key===r)return i.promise;if(0===e.byteLength)throw new Error("DRACODecoder: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var a,o=this.currentTaskId++,s=e.byteLength,u=new Promise((function(r,i){n.getWorker().then((function(n){a=n,n.setCosts(o,s),n.addCurrentLoad(s),n.setCallback(o,r,i),n.decode(o,t,e)})).catch((function(e){i(e)}))}));return u.finally((function(){a&&o&&a.releaseTask(o)})),this.taskCache.set(e,{key:r,promise:u}),u},e}();function wi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pi(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ni(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ni(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ni(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Di(e,t,n){return t&&Fi(e.prototype,t),n&&Fi(e,n),e}function Ui(e,t,n){return(Ui=Vi()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&zi(i,n.prototype),i}).apply(null,arguments)}function Vi(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Bi(){return(Bi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Hi(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,zi(e,t)}function zi(e,t){return(zi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gi=Object.defineProperty,ki=Object.getOwnPropertyDescriptor;var ji=function(e){function t(){return e.apply(this,arguments)||this}return Hi(t,e),t.prototype.load=function(e){var t=e.url;return function(e){return/^data:(.+?);base64,/.test(e)}(t)?new N((function(e){var n=t.slice(13+RegExp.$1.length);e(Uint8Array.from(atob(n),(function(e){return e.charCodeAt(0)})).buffer)})):this.request(t,Bi({},e,{type:"arraybuffer"}))},t}(kt);ji=function(e,t,n,r){for(var i,a=r>1?void 0:r?ki(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Gi(t,n,a),a}([B(Ht.Buffer,["bin","r3bin"],!1)],ji);var Xi,Wi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function qi(e){return{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}[e]}function Yi(e){return Wi[e]}function Ki(e,t,n){var r,i,a=e.bufferViews[t.bufferView],o=n[a.buffer],s=t.hasOwnProperty("byteOffset")?t.byteOffset:0,u=a.hasOwnProperty("byteOffset")?a.byteOffset:0,c=s+u,l=qi(t.type),f=l*t.count,h=null!=(r=a.byteStride)?r:0,d=Yi(t.componentType);if(h){i=new Uint8Array(f*d.BYTES_PER_ELEMENT);for(var _=new Uint8Array(o,u,a.byteLength),m=0,p=l*d.BYTES_PER_ELEMENT,v=0;v<t.count;v++){m=v*h+s;for(var g=0;g<p;g++)i[v*p+g]=_[m+g]}}else i=new Uint8Array(o,c,f*d.BYTES_PER_ELEMENT),i=new Uint8Array(i);return new d(i.buffer)}function Qi(e,t){var n=t[e.buffer],r=e.byteOffset||0;return n.slice(r,r+e.byteLength)}function Zi(e){return qi(e.type)*Yi(e.componentType).BYTES_PER_ELEMENT}function Ji(e,t,n,r){var i=qi(n.type);return new $n(t,0,function(e,t){if(e==ge.FLOAT)switch(t){case 1:return Fn.Float;case 2:return Fn.Vector2;case 3:return Fn.Vector3;case 4:return Fn.Vector4}if(e==ge.UNSIGNED_SHORT)switch(t){case 2:return Fn.UShort2;case 4:return Fn.UShort4}}(n.componentType,i),r)}function $i(e,t){return new Promise((function(n,r){var i=new window.Blob([e],{type:t}),a=new Image;a.src=URL.createObjectURL(i),a.crossOrigin="anonymous",a.onerror=function(){r(new Error("Failed to load image buffer"))},a.onload=function(){n(a)}}))}function ea(e,t){return/^(?:http|blob|data:|\/)/.test(t)?t:e.substring(0,e.lastIndexOf("/")+1)+t}var ta={init:function(){Xi||(Xi=new Ii)},parse:function(e,t,n,r){var i=n.bufferViews,a=n.accessors,o=e.bufferView,s=e.attributes,u={},c={};for(var l in s)u[l]=s[l];for(var f in t.attributes)if(void 0!==s[f]){var h=a[t.attributes[f]];c[f]=Yi(h.componentType).name}var d={attributeIDs:u,attributeTypes:c,useUniqueIDs:!0,indexType:Yi(a[t.indices].componentType).name},_=Qi(i[o],r);return Xi.decode(_,d).then((function(e){return e}))}},na={translation:"position",rotation:"rotation",scale:"scale",weights:"weights"},ra=0,ia={},aa={},oa=function(e){var t=new Mr(e,"default");return t.emission=new T(.749,.749,.749,1),t},sa="PBRMaterial",ua="KHR_lights",ca="KHR_draco_mesh_compression",la=null,fa={KHR_lights:la,KHR_materials_unlit:Kr,KHR_materials_pbrSpecularGlossiness:Kr,KHR_techniques_webgl:Hn,KHR_draco_mesh_compression:ta};function ha(e){Object.keys(e).forEach((function(t){if(void 0===ia[t])switch(ia[t]=e[t],t){case sa:fa.KHR_materials_unlit=Kr;break;case ua:la=e[t],fa.KHR_lights=la;break;default:Hn.isPrototypeOf(e[t])&&e[t].TECH_NAME&&(aa[e[t].TECH_NAME]=e[t])}}))}var da=function(e){function t(){return e.apply(this,arguments)||this}return Hi(t,e),t}(Q);function _a(e,t){var n={engine:t,gltf:e.gltf,buffers:e.buffers,asset:new da(t)};return n.asset.textures=e.textures,n.asset.meta=e.gltf,n.gltf.asset&&n.gltf.asset.version&&(n.gltf.version=Number(n.gltf.asset.version),n.gltf.isGltf2=n.gltf.version>=2&&n.gltf.version<=3),function(e){var t=e.gltf,n=e.asset,r=t.extensions,i=t.extensionsUsed,a=t.extensionsRequired;if(i){Be.info("extensionsUsed: ",i);for(var o=0;o<i.length;o++)Object.keys(fa).indexOf(i[o])>-1?fa[i[o]]||Be.warn("extension "+i[o]+" is used, you can add this extension into gltf"):Be.warn("extensionsUsed has unsupported extension "+i[o])}if(a){Be.info("extensionsRequired: "+a);for(var s=0;s<a.length;s++)(Object.keys(fa).indexOf(a[s])<0||!fa[a[s]])&&Be.error("model has not supported required extension "+a[s]),a[s]===ca&&fa.KHR_draco_mesh_compression.init()}r&&la&&r.KHR_lights&&(n.lights=la.parseLights(r.KHR_lights.lights))}(n),ma(n,"materials",pa).then((function(){return ma(n,"meshes",ya)})).then((function(){return ma(n,"nodes",Ta)})).then((function(){return ma(n,"scenes",xa)})).then((function(){return ma(n,"skins",va)})).then((function(){return ma(n,"animations",Ea)})).then((function(){return function(e){var t,n=e.asset,r=e.gltf,i=r.nodes||[],a=r.meshes;n.defaultScene=Aa("scenes",null!=(t=r.scene)?t:0,e);for(var o=i.length-1;o>=0;o--){var s=i[o],u=Aa("nodes",o,e);if(s.hasOwnProperty("children"))for(var c=s.children||[],l=c.length-1;l>=0;l--){var f=Aa("nodes",c[l],e);u.addChild(f)}if(s.hasOwnProperty("mesh")){var h=s.mesh;u.meshIndex=h;var d=a[h].primitives,_=Aa("meshes",h,e),m=void 0;if(s.hasOwnProperty("skin")||_.hasOwnProperty("weights")){var p=Aa("skins",s.skin,e),v=_.weights,g=u.addComponent(wn);g.mesh=_,g.skin=p,g.setWeights(v),m=g}else(m=u.addComponent(Mn)).mesh=_;for(var y=0,E=d.length;y<E;y++){var T=d[y].material;_.primitives[y].materialIndex=T;var x=void 0!==T?Aa("materials",T,e):oa(u.engine);m.setSharedMaterial(y,x)}}}var A=n.defaultScene.nodes;if(1===A.length)n.defaultSceneRoot=A[0];else{for(var O=new rt(e.engine),b=0;b<A.length;b++)O.addChild(A[b]);n.defaultSceneRoot=O}var M=n.defaultSceneRoot.addComponent(Or),S=n.animations;S&&S.forEach((function(e){M.addAnimationClip(e,e.name)}));return e.asset}(n)}))}function ma(e,t,n){var r=e.gltf,i=e.asset;if(i[t]||(i[t]=[]),r.hasOwnProperty(t)){var a=r[t]||[];Be.debug(t+":",a);for(var o=[],s=a.length-1;s>=0;s--)o.push(n(a[s],e));return Promise.all(o).then((function(e){for(var n=0;n<e.length;n++)i[t].push(e[n])}))}return Promise.resolve()}function pa(e,t){var n,r=t.gltf;t.asset;if(r.isGltf2&&void 0===e.technique){var i={},a={},o=e.pbrMetallicRoughness,u=e.normalTexture,c=e.emissiveTexture,l=(e.emissiveFactor,e.occlusionTexture),f=e.alphaMode,h=e.alphaCutoff,d=e.doubleSided,_=e.extensions;if(o){var m=o.baseColorFactor,p=o.baseColorTexture,v=o.metallicFactor,g=o.roughnessFactor,y=o.metallicRoughnessTexture;p&&(i.baseColorTexture=Aa("textures",p.index||0,t,!1)),m&&(i.baseColorFactor=Ui(T,m)),i.metallicFactor=void 0!==v?v:1,i.roughnessFactor=void 0!==g?g:1,y&&(i.metallicRoughnessTexture=Aa("textures",y.index||0,t,!1))}if(u){var E=u.index,x=(u.texCoord,u.scale);i.normalTexture=Aa("textures",E||0,t,!1),void 0!==typeof x&&(i.normalScale=x)}if(c&&(i.emissiveTexture=Aa("textures",c.index||0,t,!1)),l&&(i.occlusionTexture=Aa("textures",l.index||0,t,!1),void 0!==l.strength&&(i.occlusionStrength=l.strength)),a.doubleSided=!!d,a.alphaMode=f||"OPAQUE","MASK"===f&&(i.alphaCutoff=void 0===h?.5:h),_&&(_.KHR_materials_unlit&&(a.unlit=!0),_.KHR_materials_pbrSpecularGlossiness)){var A=_.KHR_materials_pbrSpecularGlossiness,O=A.diffuseFactor,b=A.diffuseTexture,M=A.specularFactor,S=A.glossinessFactor,R=A.specularGlossinessTexture;a.isMetallicWorkflow=!1,O&&(i.baseColorFactor=Ui(T,O)),b&&(i.baseColorTexture=Aa("textures",b.index||0,t,!1)),M&&(i.specularFactor=Ui(s,M)),void 0!==S&&(i.glossinessFactor=S),R&&(i.specularGlossinessTexture=Aa("textures",R.index||0,t,!1))}var L=e.unlit,C=e.srgb,I=e.gamma,w=e.blendFunc,P=e.depthMask;L&&(a.unlit=!0),C&&(a.srgb=!0),I&&(a.gamma=!0),w&&(a.blendFunc=w),void 0!==P&&(a.depthMask=P),n=new Kr(t.engine,e.name||Kr.MATERIAL_NAME,Object.assign({},i,a))}else{var N=e.technique;if(Be.warn("Deprecated: Please use a model that meets the glTF 2.0 specification"),"Texture"===N){(n=new Kr(t.engine,e.name||Kr.MATERIAL_NAME)).unlit=!0;var F=e.values._MainTex[0];n.baseColorTexture=Aa("textures",F||0,t,!1)}}return Promise.resolve(n)}function va(e,t){for(var n=t.gltf,r=t.buffers,i=e.joints.length,a=new cn(e.name),o=Ki(n,n.accessors[e.inverseBindMatrices],r),s=0;s<i;s++){var u=16*s,c=u+16;a.inverseBindMatrices[s]=Ui(h,o.subarray(u,c))}for(var l=0;l<i;l++){var f=Aa("nodes",e.joints[l],t);a.joints[l]=f.name}var d=Aa("nodes",null==e.skeleton?e.joints[0]:e.skeleton,t);return a.skeleton=d.name,Promise.resolve(a)}function ga(e,t,n,r,i,a,o,u){var c=0,l=[];for(var f in r.attributes){var h=r.attributes[f],d=i.accessors[h],_=Zi(d),m=Ji(0,f,d,c);l.push(m);var p=a(f),v=new Kn(u,Gn.VertexBuffer,p.byteLength,Pn.Static);if(v.setData(p),t.setVertexBufferBinding(v,_,c++),"POSITION"==m.semantic)for(var g=new s,y=p.length/3,E=e.bounds,T=E.min,x=E.max,A=0;A<y;A++){var O=3*A;g.setValue(p[O],p[O+1],p[O+2]),s.min(T,g,T),s.max(x,g,x)}}t.setVertexElements(l);var b=i.accessors[r.indices],M=o(),S=b.count,R=function(e){switch(e){case ge.UNSIGNED_BYTE:return Un.UInt8;case ge.UNSIGNED_SHORT:return Un.UInt16;case ge.UNSIGNED_INT:return Un.UInt32}}(b.componentType),L=R==Un.UInt32?4:R==Un.UInt16?2:1,C=new Kn(u,Gn.IndexBuffer,S*L,Pn.Static);return C.setData(M),t.setIndexBufferBinding(new Qn(C,R)),n.start=0,n.count=S,Promise.resolve(t)}function ya(e,t){for(var n=t.gltf,r=t.buffers,i=t.engine,a=new un(e.name),o=[],s=[],u=function(u){o.push(new Promise((function(o,c){var l,f=e.primitives[u],h=new Jn(i,f.name||e.name||u),d=new er;if(s.push(d),d.topology=null==f.mode?qn.Triangles:f.mode,f.hasOwnProperty("targets")&&(h.targets=[],a.weights=e.weights||new Array(f.targets.length).fill(0)),f.extensions&&f.extensions[ca]){var _=fa.KHR_draco_mesh_compression,m=f.extensions[ca];l=_.parse(m,f,n,r).then((function(e){return ga(a,h,d,f,n,(function(t){for(var n=0;n<e.attributes.length;n++)if(e.attributes[n].name===t)return e.attributes[n].array;return null}),(function(){return e.index.array}),t.engine)}))}else l=ga(a,h,d,f,n,(function(e){var t=f.attributes[e],i=n.accessors[t];return Ki(n,i,r)}),(function(){var e=n.accessors[f.indices];return Ki(n,e,r)}),t.engine);l.then((function(e){o(e)})).catch((function(e){c(e)}))})))},c=0;c<e.primitives.length;c++)u(c);return Promise.all(o).then((function(e){for(var t=0;t<e.length;t++)a.primitives.push(e[t]),a.groups.push(s[t]);return a}))}function Ea(e,t){for(var n=t.gltf,r=t.buffers,i=e.samplers||[],a=e.channels||[],o=n.animations.indexOf(e),s=new yr(e.name||"Animation"+o),u=-1,c=-1,l=0;l<i.length;l++){var f=i[l],h=n.accessors[f.input],d=n.accessors[f.output],_=Ki(n,h,r),m=Ki(n,d,r),p=qi(d.type);p*_.length!==m.length&&(p=m.length/_.length);var v=lr.LINEAR;switch(f.interpolation){case"CUBICSPLINE":v=lr.CUBICSPLINE;break;case"STEP":v=lr.STEP}var g=_[_.length-1];g>u&&(u=g,c=l),s.addSampler(_,m,p,v)}s.durationIndex=c,s.duration=u;for(var y=0;y<a.length;y++){var E=a[y],T=E.target,x=E.sampler,A=Aa("nodes",T.node,t),O=na[T.path];s.addChannel(x,A.name,O)}return Promise.resolve(s)}function Ta(e,t){var n=new rt(t.engine,e.name||"GLTF_NODE_"+ra++);if(e.hasOwnProperty("matrix")){var r=e.matrix,i=new h;i.setValueByArray(r);var a=new s,o=new s(1,1,1),u=new f;i.decompose(a,u,o),n.transform.position=a,n.transform.rotationQuaternion=u,n.transform.scale=o}else for(var c in na)if(e.hasOwnProperty(c)){var l=na[c];if("weights"===l)n[l]=e[c];else{var d=e[c],_=d.length,m=n[l];2===_?m.setValue(d[0],d[1]):3===_?m.setValue(d[0],d[1],d[2]):4===_&&m.setValue(d[0],d[1],d[2],d[3]),n[l]=m}}if(void 0!==e.camera){var p=t.gltf.cameras[e.camera],v=n.addComponent(Ft);if("orthographic"===p.type){v.isOrthographic=!0;var g=p.orthographic,y=g.ymag,E=g.xmag,T=g.zfar,x=g.znear;void 0!==x&&(v.nearClipPlane=x),void 0!==T&&(v.farClipPlane=T),y&&E&&(v.orthographicSize=Math.max(y,E)/2),void 0!==y&&E&&(v.orthographicSize=E/2),void 0!==E&&y&&(v.orthographicSize=y/2)}else{var A=p.perspective,O=(A.aspectRatio,A.yfov),b=A.zfar,M=A.znear;void 0!==O&&(v.fieldOfView=O),void 0!==b&&(v.farClipPlane=b),void 0!==M&&(v.nearClipPlane=M)}}if(e.extensions&&la&&e.extensions.KHR_lights){var S=e.extensions.KHR_lights.light;if(void 0!==S){var R=Aa("lights",S,t);if(R){var L=n.addComponent(R.ability);Object.assign(L,R.props)}}}return Promise.resolve(n)}function xa(e,t){for(var n=[],r=0;r<e.nodes.length;r++){var i=Aa("nodes",e.nodes[r],t);n.push(i)}if(e.extensions&&la&&e.extensions.KHR_lights){var a=e.extensions.KHR_lights.light;if(void 0!==a){var o=Aa("lights",a,t);o&&n[0].addComponent(o.ability,o.props)}}return Promise.resolve({nodes:n})}function Aa(e,t,n,r){void 0===r&&(r=!0);var i=n.asset,a=r?i[e].length-t-1:t;return i[e][a]}function Oa(e){var t=1313821514,n=5130562,r=new DataView(e),i={magic:r.getUint32(0,!0),version:r.getUint32(4,!0),length:r.getUint32(8,!0)};if(1179937895!==i.magic)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+i.magic.toString(16)),null;var a=r.getUint32(12,!0),o=r.getUint32(16,!0);if(o!==t)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+o.toString(16)),null;for(var s=new Uint8Array(e,20,a),u=JSON.parse(function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);return decodeURIComponent(encodeURIComponent(t))}(s)),c=[],l=20+a;l<i.length;){if(a=r.getUint32(l,!0),(o=r.getUint32(l+4,!0))!==n)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+o.toString(16)),null;var f=l+8,h=e.slice(f,f+a);c.push(h),l+=a+8}return{gltf:u,buffers:c}}var ba=Object.defineProperty,Ma=Object.getOwnPropertyDescriptor,Sa=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).requestGLTF=function(e,n){return t.request(e.url,Bi({},e,{type:"json"})).then((function(r){return t._loadGLTFResources(e,r,n)}))},t.requestGLB=function(e,n){return t.request(e.url,Bi({},e,{type:"arraybuffer"})).then(Oa).then((function(t){return Bi({},t,{baseUrl:e.url,resourceManager:n})})).then(t._loadImages)},t._loadImages=function(e){var t=e.gltf,n=e.buffers,r=e.baseUrl,i=e.resourceManager;return t.images?Promise.all(t.images.map((function(e){var a=e.uri,o=e.bufferView,s=e.mimeType;return a?i.load({url:ea(r,a),type:Ht.Texture2D}):$i(Qi(t.bufferViews[o],n),s).then((function(e){var t=new Rn(i.engine,e.width,e.height);return t.setImageSource(e),t.generateMipmaps(),t}))}))).then((function(e){return{gltf:t,buffers:n,textures:e}})):Promise.resolve({gltf:t,buffers:n})},t}Hi(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new N((function(r,i){(n.isGLB(e.url)?n.requestGLB:n.requestGLTF)(e,t).then((function(e){_a(e,t.engine).then((function(e){r(e)}))})).catch((function(t){console.error(t),i("Error loading glTF JSON from "+e.url)}))}))},n.isGLB=function(e){return"glb"===e.substring(e.lastIndexOf(".")+1)},n._loadGLTFResources=function(e,t,n){return this._loadBuffers(e.url,t,n).then(this._loadImages)},n._loadBuffers=function(e,t,n){return t.buffers?Promise.all(t.buffers.map((function(t){return t instanceof ArrayBuffer?Promise.resolve(t):n.load({url:ea(e,t.uri),type:Ht.Buffer})}))).then((function(r){return{buffers:r,gltf:t,baseUrl:e,resourceManager:n}})):Promise.resolve({baseUrl:e,gltf:t,resourceManager:n})},t}(kt);Sa=function(e,t,n,r){for(var i,a=r>1?void 0:r?Ma(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&ba(t,n,a),a}([B(Ht.Perfab,["gltf","glb"])],Sa);var Ra=Object.defineProperty,La=Object.getOwnPropertyDescriptor,Ca=function(e){function t(){return e.apply(this,arguments)||this}return Hi(t,e),t.prototype.load=function(e){return this.request(e.url,Bi({},e,{type:"json"}))},t}(kt);Ca=function(e,t,n,r){for(var i,a=r>1?void 0:r?La(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Ra(t,n,a),a}([B(Ht.JSON,["json"],!1)],Ca);var Ia=function(e,t,n,r){if(void 0===r&&(r=!1),!function(e){if(e.byteLength>=12){var t=new Uint8Array(e,0,12);if(171===t[0]&&75===t[1]&&84===t[2]&&88===t[3]&&32===t[4]&&49===t[5]&&49===t[6]&&187===t[7]&&13===t[8]&&10===t[9]&&26===t[10]&&10===t[11])return!0}return!1}(e))throw new Error("khronosTextureContainerParser: invalid KTX file, texture missing KTX identifier");var i=Uint32Array.BYTES_PER_ELEMENT,a=new DataView(e,12,13*i),o=67305985===a.getUint32(0,!0),s={buffer:e,glType:a.getUint32(1*i,o),glTypeSize:a.getUint32(2*i,o),glFormat:a.getUint32(3*i,o),glInternalFormat:a.getUint32(4*i,o),glBaseInternalFormat:a.getUint32(5*i,o),pixelWidth:a.getUint32(6*i,o),pixelHeight:a.getUint32(7*i,o),pixelDepth:a.getUint32(8*i,o),numberOfArrayElements:a.getUint32(9*i,o),numberOfFaces:a.getUint32(10*i,o),numberOfMipmapLevels:a.getUint32(11*i,o),bytesOfKeyValueData:a.getUint32(12*i,o),loadType:0};if(0!==s.glType)throw new Error("only compressed formats currently supported");if(s.numberOfMipmapLevels=Math.max(1,s.numberOfMipmapLevels),0===s.pixelHeight||0!==s.pixelDepth)throw new Error("only 2D textures currently supported");if(0!==s.numberOfArrayElements)throw new Error("texture arrays not currently supported");if(s.numberOfFaces!==t)throw new Error("number of faces expected"+t+", but found "+s.numberOfFaces);return n&&(s.mipmaps=function(e,t){for(var n=[],r=64+e.bytesOfKeyValueData,i=e.pixelWidth,a=e.pixelHeight,o=t?e.numberOfMipmapLevels:1,s=0;s<o;s++){var u=new Int32Array(e.buffer,r,1)[0];r+=4;for(var c=0;c<e.numberOfFaces;c++){var l=new Uint8Array(e.buffer,r,u);n.push({data:l,width:i,height:a}),r+=u,r+=3-(u+3)%4}i=Math.max(1,.5*i),a=Math.max(1,.5*a)}return n}(s,!0)),r&&(s.engineFormat=function(e){switch(e){case En.RGB_S3TC_DXT1_EXT:return pn.DXT1;case En.RGBA_S3TC_DXT5_EXT:return pn.DXT5;case En.RGB_ETC1_WEBGL:return pn.ETC1_RGB;case En.RGB8_ETC2:return pn.ETC2_RGB;case En.RGB8_PUNCHTHROUGH_ALPHA1_ETC2:return pn.ETC2_RGBA5;case En.RGBA8_ETC2_EAC:return pn.ETC2_RGBA8;case En.RGB_PVRTC_2BPPV1_IMG:return pn.PVRTC_RGB2;case En.RGBA_PVRTC_2BPPV1_IMG:return pn.PVRTC_RGBA2;case En.RGB_PVRTC_4BPPV1_IMG:return pn.PVRTC_RGB4;case En.RGBA_PVRTC_4BPPV1_IMG:return pn.PVRTC_RGBA4;case En.RGBA_ASTC_4X4_KHR:return pn.ASTC_4x4;case En.RGBA_ASTC_5X5_KHR:return pn.ASTC_5x5;case En.RGBA_ASTC_6X6_KHR:return pn.ASTC_6x6;case En.RGBA_ASTC_8X8_KHR:return pn.ASTC_8x8;case En.RGBA_ASTC_10X10_KHR:return pn.ASTC_10x10;case En.RGBA_ASTC_12X12_KHR:return pn.ASTC_12x12;default:var t=En[e];throw new Error("this format is not supported in Oasis Engine: "+t)}}(s.glInternalFormat)),s};function wa(e){var t=Ia(e,1,!0,!0);return{mipmaps:t.mipmaps,engineFormat:t.engineFormat,internalFormat:t.glInternalFormat,width:t.pixelWidth,height:t.pixelHeight}}var Pa=Object.defineProperty,Na=Object.getOwnPropertyDescriptor,Fa=function(e){function t(){return e.apply(this,arguments)||this}return Hi(t,e),t.prototype.load=function(e,t){var n=this;return new N((function(r,i){Promise.all(e.urls.map((function(t){return n.request(t,Bi({},e,{type:"arraybuffer"}))}))).then((function(e){for(var n=function(e){for(var t,n,r,i,a=[],o=0;o<e.length;o++){var s=Ia(e[o],1,!0,!0);a.push(s.mipmaps),0===o&&(r=s.pixelWidth,i=s.pixelHeight,t=s.glInternalFormat,n=s.engineFormat)}return{mipmapsFaces:a,engineFormat:n,internalFormat:t,width:r,height:i}}(e),i=n.width,a=n.mipmapsFaces,o=n.engineFormat,s=a[0].length>1,u=new _r(t.engine,i,o,s),c=0;c<6;c++)for(var l=a[c].length,f=0;f<l;f++){var h=a[c][f],d=h.data,_=h.width,m=h.height;u.setPixelBuffer(nr.PositiveX+c,d,f,0,0,_,m)}r(u)})).catch((function(e){i(e)}))}))},t}(kt);Fa=function(e,t,n,r){for(var i,a=r>1?void 0:r?Na(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Pa(t,n,a),a}([B(Ht.KTXCube,[])],Fa);var Da=Object.defineProperty,Ua=Object.getOwnPropertyDescriptor,Va=function(e){function t(){return e.apply(this,arguments)||this}return Hi(t,e),t.prototype.load=function(e,t){var n=this;return new N((function(r,i){n.request(e.url,Bi({},e,{type:"arraybuffer"})).then((function(e){for(var n=wa(e),i=n.width,a=n.height,o=n.mipmaps,s=n.engineFormat,u=o.length>1,c=new Rn(t.engine,i,a,s,u),l=0;l<o.length;l++){var f=o[l],h=f.width,d=f.height,_=f.data;c.setPixelBuffer(_,l,0,0,h,d)}r(c)})).catch((function(e){i(e)}))}))},t}(kt);Va=function(e,t,n,r){for(var i,a=r>1?void 0:r?Ua(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Da(t,n,a),a}([B(Ht.KTX,["ktx"])],Va);var Ba=Object.defineProperty,Ha=Object.getOwnPropertyDescriptor,za=function(e){function t(){return e.apply(this,arguments)||this}return Hi(t,e),t.prototype.load=function(e,t){var n=this;return new N((function(r,i){n.request(e.url,Bi({},e,{type:"image"})).then((function(n){var i=new Rn(t.engine,n.width,n.height);if(i._glTexture){if(i.setImageSource(n),i.generateMipmaps(),0!==e.url.indexOf("data:")){var a=e.url.split("/");i.name=a[a.length-1]}r(i)}})).catch((function(e){i(e)}))}))},t}(kt);za=function(e,t,n,r){for(var i,a=r>1?void 0:r?Ha(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Ba(t,n,a),a}([B(Ht.Texture2D,["png","jpg","webp","jpeg"])],za);var Ga=Object.defineProperty,ka=Object.getOwnPropertyDescriptor,ja=function(e){function t(){return e.apply(this,arguments)||this}return Hi(t,e),t.prototype.load=function(e,t){var n=this;return new N((function(r,i){Promise.all(e.urls.map((function(t){return n.request(t,Bi({},e,{type:"image"}))}))).then((function(e){var n=e[0],i=n.width;if(i===n.height){var a=new _r(t.engine,i);if(a._glTexture){for(var o=0;o<6;o++)a.setImageSource(nr.PositiveX+o,e[o],0);a.generateMipmaps(),r(a)}}else console.error("The cube texture must have the same width and height")})).catch((function(e){i(e)}))}))},t}(kt);ja=function(e,t,n,r){for(var i,a=r>1?void 0:r?ka(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&Ga(t,n,a),a}([B(Ht.TextureCube,[""])],ja);var Xa=function(e){function t(t){var n;return(n=e.call(this,t)||this)._hasBuiltNode=!1,n}return Hi(t,e),t.prototype.init=function(e){var t=this,n=e.asset,r=void 0===n?null:n,i=e.autoPlay,a=e.loop;if(e.isClone){var o=e.gltfRootName;o&&(this.GLTFNode=this.entity.findByName(o))}if(this.GLTFNode)this._hasBuiltNode=!0;else{var s="GLTF-"+Date.now();e.gltfRootName=s,this.GLTFNode=this.entity.createChild(s),this._hasBuiltNode=!1}this.asset=r,this.loop=a,this.autoPlay=i,this.addEventListener("enabled",(function(){t.GLTFNode.isActive=!0})),this.addEventListener("disabled",(function(){t.GLTFNode.isActive=!1}))},Di(t,[{key:"asset",get:function(){return this._asset},set:function(e){e&&e.defaultSceneRoot===this.GLTFNode||(this._hasBuiltNode||(this.GLTFNode.clearChildren(),null!==e&&(this.GLTFNode&&this.GLTFNode.destroy(),this.GLTFNode=e.defaultSceneRoot.clone(),this._animator=this.GLTFNode.getComponent(Or),this.entity.addChild(this.GLTFNode))),this._asset=e)}},{key:"animator",get:function(){return this._animator}},{key:"autoPlay",get:function(){return this._autoPlay},set:function(e){this._animator&&(e?this._animator.playAnimationClip(e,{wrapMode:this._loop}):this._animator.stop(!1)),this._autoPlay=e}},{key:"loop",get:function(){return this._loop},set:function(e){this._animator&&this.autoPlay&&this._animator.playAnimationClip(this._autoPlay,{wrapMode:e}),this._loop=e}}]),t}(Ze),Wa=function(){function e(){this.registeredPlugins=new Set,this.plugins=[]}var t=e.prototype;return t.register=function(e){this.registeredPlugins.add(e)},t.boot=function(e){for(var t,n=Pi(this.registeredPlugins.values());!(t=n()).done;){var r=t.value;"function"==typeof r&&(r=r(e)),this.plugins.push(r)}},t.reset=function(){this.registeredPlugins.clear(),this.plugins=[]},t.nodeAdded=function(e){this.delegateMethod("nodeAdded",e)},t.delegateMethod=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.plugins.forEach((function(t){return t[e]&&t[e].apply(t,n)}))},e}();function qa(e){return function(t,n,r){var i=r.value;r.value=function(){for(var t,n=this,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e.before&&(t=this.oasis.pluginManager).delegateMethod.apply(t,[e.before].concat(a)),Promise.resolve(i.apply(this,arguments)).then((function(t){return e.after&&n.oasis.pluginManager.delegateMethod(e.after,t),t}))}}}function Ya(e,t,n){if(t!==n&&null!=n){var r=[e[n],e[t]];e[t]=r[0],e[n]=r[1]}}function Ka(e){return e&&"asset"===e.type}function Qa(e){for(var t=[],n=Object.getPrototypeOf(e),r=Object.getOwnPropertyDescriptors(n),i=0,a=Object.entries(r);i<a.length;i++){var o=a[i],s=o[0];"function"==typeof o[1].get&&t.push(s)}return t}var Za={astc:1,s3tc:2,pvrtc:3,etc:4,etc1:5},Ja=function(){function e(e,t){this.resourceManager=e,this._resource=t,this._meta={},this._attachedResources=[],this.setMeta()}var t=e.prototype;return t.setMeta=function(){},t.loadWithAttachedResources=function(e,t,n){var r=this;return new Promise((function(i,a){r.load(e,t,n).then((function(){i({resources:[r],structure:{index:0,props:{}}})})).catch((function(e){a(e)}))}))},t.getProps=function(){return{}},t.bind=function(){},t.attach=function(){},t.update=function(e,t){if(Ka(t)){var n=this.resourceManager.get(t.id);n?this._resource[e]=n.resource:Be.warn("SchemaResource: "+this.meta.name+" can't find asset, which id is: "+t.id)}else this._resource[e]=t},t.updateMeta=function(e,t){this._meta[e]=t},t.onDestroy=function(){},Di(e,[{key:"resource",get:function(){return this._resource}},{key:"meta",get:function(){return this._meta}},{key:"attachedResources",get:function(){return this._attachedResources}}]),e}(),$a=function(e){function t(){return e.apply(this,arguments)||this}Hi(t,e);var n=t.prototype;return n.load=function(e,t,n){var r=this;return new Promise((function(i,a){var o,s,u,c;if(r.resourceManager.useCompressedTexture&&null!=t&&null!=(o=t.props)&&null!=(s=o.compression)&&s.compressions.length){var l=n.engine._hardwareRenderer,f=t.props.compression.compressions;f.sort((function(e,t){return Za[e.type]-Za[t.type]}));for(var h=0;h<f.length;h++){var d=f[h];if("ktx"===d.container&&l.canIUse(Ce[d.type])){c=d.url;break}}}c=null!=(u=c)?u:t.url,e.load({url:c,type:Ht.Texture2D}).then((function(e){r._resource=e,i(r)})).catch((function(e){a(e)}))}))},n.setMeta=function(){this.resource&&(this._meta.name=this.resource.name,this.resource.image&&(this._meta.url=this.resource.image.src))},t}(Ja),eo=function(e){function t(){return e.apply(this,arguments)||this}Hi(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(r){var i=new Kr(e.engine,t.name);for(var a in n.configProps=t.props,n.configProps)Ka(n.configProps[a])||(i[a]=n.configProps[a]);n._resource=i,n.setMeta(),r(n)}))},n.loadWithAttachedResources=function(e,t){var n=this;return new Promise((function(r,i){var a;t.resource instanceof Kr?a=new Promise((function(e){n._resource=t.resource,n.setMeta(),e(n)})):t.props?a=n.load(e,t):i("Load PBRMaterial Error"),a&&a.then((function(){var e={resources:[n],structure:{index:0,props:{}}},t=n._resource;Qa(n._resource).forEach((function(r){if(t[r]instanceof Sn){var i=new $a(n.resourceManager,t[r]);n.attachedResources.push(i),e.resources.push(i),e.structure.props[r]={index:e.resources.length-1}}})),r(e)}))}))},n.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},n.getProps=function(){var e=this,t={};return Qa(this.resource).forEach((function(n){return t[n]=e.resource[n]})),t},n.bind=function(){var e=this,t=this._resource;Object.keys(this.configProps).forEach((function(n){var r=e.configProps[n];if(Ka(r)){var i=e.resourceManager.get(r.id);i&&i instanceof $a?(t[n]=i.resource,e._attachedResources.push(i)):(t[n]=null,Be.warn("PBRMaterialResource: "+e.meta.name+" can't find asset \""+n+'", which id is: '+r.id))}else{if("side"===n)return;t[n]=r}}))},t}(Ja),to=function(e){function t(){return e.apply(this,arguments)||this}Hi(t,e);var n=t.prototype;return n.load=function(e,t,n){var r,i=this;return null!=(r=t.props)&&r.compression&&ta.init(),e.load({url:t.url,type:Ht.Perfab}).then((function(e){var n=e;t.props&&(n.newMaterial=t.props.newMaterial),i._resource=n}))},n.loadWithAttachedResources=function(e,t,n){var r=this;return new Promise((function(i){r.load(e,t,n).then((function(){for(var t=r.resource.materials,n=[],a={resources:[r],structure:{index:0,props:{newMaterial:[]}}},o=0;o<t.length;o++){var s=t[o],u=new eo(r.resourceManager);r._attachedResources.push(u),n.push(u.loadWithAttachedResources(e,{type:"PBRMaterial",name:s.name,resource:s}))}Promise.all(n).then((function(e){var t=a.structure.props.newMaterial;e.forEach((function(e){var n=e.structure,r=e.resources[n.index];for(var i in a.resources.push(r),n.index=a.resources.length-1,n.props)if(n.props.hasOwnProperty(i)){var o=n.props[i],s=e.resources[o.index];a.resources.push(s),o.index=a.resources.length-1}t.push(n)})),i(a)}))}))}))},n.setMeta=function(e){e&&(this.meta.name=e.name)},n.bind=function(){var e=this._resource;this.bindMaterials(e.newMaterial)},n.update=function(e,t){"newMaterial"===e?this.bindMaterials(t):this._resource[e]=t},n.bindMaterials=function(e){if(e&&e.length){for(var t=this._resource,n=t.meshes,r=0;r<e.length;r++){var i=this.resourceManager.get(e[r].id);i?(this._attachedResources.push(i),t.materials[r]=i.resource):Be.warn("GLTFResource: "+this.meta.name+' can\'t find asset "material", which id is: '+e[r].id)}for(var a=0;a<n.length;a++){var o=this.getNodeByMeshIndex(t.nodes,n.length-1-a);if(o)for(var s=0;s<n[a].primitives.length;s++){var u=n[a].primitives[s],c=o.getComponent(Mn),l=t.materials[t.materials.length-1-u.materialIndex];c&&l&&l instanceof Hn&&c.setSharedMaterial(s,l)}}}},n.getNodeByMeshIndex=function(e,t){for(var n=0;n<=e.length;n++){var r=e[n];if(r.meshIndex===t)return r}return null},t}(Ja),no=function(e){function t(){return e.apply(this,arguments)||this}Hi(t,e);var n=t.prototype;return n.loadShaderDefine=function(e){var t=this;return new Promise((function(n){var r=t.scripts[0].name;if(t.resourceManager.isLocal){var i,a;n(null!=(i=null==(a=e.options)?void 0:a.scripts[r])?i:{})}else{var o=document.getElementById(r);o&&document.body.removeChild(o);var s=document.createElement("script");s.crossOrigin="anonymous",s.onload=function(){var e,t=window.o3Scripts;n(null!=(e=t&&t[r])?e:{})},s.id=r,s.src=t._meta.url,document.body.appendChild(s)}})).then((function(e){var n=e.vertexShader,r=void 0===n?"":n,i=e.fragmentShader,a=void 0===i?"":i,o=e.states,s=void 0===o?{}:o,u=e.uniforms,c=void 0===u?{}:u,l=e.attributes,f=void 0===l?{}:l;t._resource.uniforms=c,t._resource.attributes=f,t._resource.vertexShader=r,t._resource.fragmentShader=a,t._resource.renderStates=s}))},n.createMaterial=function(e){var t=new wr(e,this.meta.name||"shader_mtl");this._resource=t},n.load=function(e,t,n){var r=this;return this.setMeta(t),this.scripts=t.props.scripts,this.createMaterial(n.engine),this.loadShaderDefine(n).then((function(){return new Promise((function(e,n){try{for(var i in t.props)r._resource[i]=t.props[i];r._resource.updateTechnique(),e(r)}catch(e){n("[shader material] createTechnique error")}}))}))},n.setMeta=function(e){e&&(this._meta.name=e.name,this._meta.url=e.url,this._meta.source=e.source)},n.updateMeta=function(t,n){var r=this;e.prototype.updateMeta.call(this,t,n),"url"===t&&this.loadShaderDefine().then((function(){try{r._resource.updateTechnique()}catch(e){console.error("[shader material] createTechnique error")}}))},n.update=function(e,t){this._resource[e]=t,this._resource.updateTechnique()},t}(Ja),ro={};function io(e){return function(t){ro[e]=t}}var ao=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).isInit=!1,t}Hi(t,e);var n=t.prototype;return n.initScriptContext=function(){this.isInit||(this.isInit=!0,window.__o3_script_context__={o3:Fo._components.o3,script:function(e){return function(t){ro[e]=t}}})},n.load=function(e,t,n){var r=this;return this.initScriptContext(),new Promise((function(e){var i=t.props.scripts;if(r.resourceManager.isLocal){for(var a=0;a<i.length;a++){var o,s=i[a].name;ro[s]=null==(o=n.options)?void 0:o.scripts[s]}e(r)}else{var u=document.createElement("script");u.crossOrigin="anonymous",r.setMeta(t),u.onload=function(){for(var t=window.o3Scripts,n=0;n<i.length;n++){var a=i[n].name;r._resource=t&&t[a],ro[a]=r._resource}e(r)},u.src=t.url,document.body.appendChild(u)}}))},n.setMeta=function(e){e&&(this._meta.name=e.name,this._meta.url=e.url,this._meta.source=e.source)},t}(Ja),oo=function(e){function t(){return e.apply(this,arguments)||this}Hi(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(r){var i=new Rr(e.engine,t.name);for(var a in t.props)i[a]=t.props[a];n._resource=i,n.setMeta(),r(n)}))},n.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},t}(Ja),so={px:0,nx:1,py:2,ny:3,pz:4,nz:5},uo=function(e){function t(){return e.apply(this,arguments)||this}Hi(t,e);var n=t.prototype;return n.load=function(e,t,n){var r=this;return new Promise((function(i,a){var o,s,u=[],c=Ht.TextureCube;if(r.resourceManager.useCompressedTexture&&null!=t&&null!=(o=t.props)&&null!=(s=o.compression)&&s.compressions.length){var l=n.engine._hardwareRenderer,f=t.props.compression.compressions;f.sort((function(e,t){return Za[e.type]-Za[t.type]}));for(var h=0;h<f.length;h++){var d=f[h];if("ktx"===d.container&&l.canIUse(Ce[d.type])){for(var _ in d.files)if(d.files.hasOwnProperty(_)){var m=d.files[_];u[so[_]]=m.url}console.warn(d.type),c=Ht.KTXCube;break}}}if(c===Ht.TextureCube)for(var p in t.props.images)if(t.props.images.hasOwnProperty(p)){var v=t.props.images[p];u[so[p]]=v.url}e.load({urls:u,type:c}).then((function(e){r._resource=e,i(r)})).catch((function(e){a(e)}))}))},n.setMeta=function(){this.resource&&(this.meta.name=this.resource.name)},t}(Ja),co=function(e){function t(){return e.apply(this,arguments)||this}Hi(t,e);var n=t.prototype;return n.load=function(e,t){var n=this;return new Promise((function(e){n._resource=t,n.setMetaData("name",n.resource.name),n.setMetaData("url",n.resource.url),e(n)}))},n.setMetaData=function(e,t){this._meta[e]=t},t}(Ja),lo=Object.defineProperty,fo=Object.getOwnPropertyDescriptor,ho=function(e,t,n,r){for(var i,a=r>1?void 0:r?fo(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&lo(t,n,a),a},_o=function(){function e(e){this.oasis=e,this.abilityMap={}}var t=e.prototype;return t.add=function(e){var t=e.type,n=e.node,r=e.props,i=e.id,a=e.index,o=this.oasis.nodeManager.get(n),s=this.getCompConstructor(t);if(s){var u=this.mixPropsToExplicitProps(r),c=o.addComponent(s),l=u.enabled;if(void 0!==l&&(c.enabled=l),"Model"===t||"GLTFModel"===t||"Particle"===t)c.init(u);else for(var f in u)null!==u[f]&&(c[f]=u[f]);var h=o._components;return Ya(h,h.length-1,a),c.id=i,this.abilityMap[i]=c,c}Be.error(t+" abiltiy is not defined")},t.update=function(e,t,n){return"Model"===this.get(e).constructor.name?n&&this.checkIsAsset(n)?this.get(e).setProp(t,this.oasis.resourceManager.get(n.id).resource):this.get(e).setProp(t,n):n&&this.checkIsAsset(n)?this.get(e)[t]=this.oasis.resourceManager.get(n.id).resource:this.get(e)[t]=n,{id:e,key:t,value:n}},t.get=function(e){return this.abilityMap[e]},t.delete=function(e){return this.abilityMap[e].destroy(),delete this.abilityMap[e],e},t.getCompConstructor=function(e){var t=e.split(".");if("script"===t[0])return ro[t[1]];var n=Fo._components.o3[e];if(!n)throw new Error(e+" is not defined");return n},t.mixPropsToExplicitProps=function(e){var t=Bi({},e);for(var n in e){var r=e[n];if(r&&this.checkIsAsset(r)){var i=this.oasis.resourceManager.get(r.id);i?t[n]=i.resource:(t[n]=null,Be.warn("AbilityManager: can't get asset \""+n+'", which id is '+r.id))}}return t},t.checkIsAsset=function(e){return"asset"===e.type},e}();ho([qa({after:"abilityAdded",before:"beforeAbilityAdded"})],_o.prototype,"add",1),ho([qa({before:"beforeAbilityUpdated",after:"abilityUpdated"})],_o.prototype,"update",1),ho([qa({after:"abilityDeleted",before:"beforeAbilityDeleted"})],_o.prototype,"delete",1);var mo=Object.defineProperty,po=Object.getOwnPropertyDescriptor,vo=function(e,t,n,r){for(var i,a=r>1?void 0:r?po(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&mo(t,n,a),a},go=function(){function e(e){this.oasis=e,this.nodeMap={},this.root=new rt(this.oasis.engine,"root")}var t=e.prototype;return t.addRootEntity=function(){this.oasis.engine.sceneManager.activeScene.addRootEntity(this.root)},t.add=function(e){return this.create(e),this.append(e.id,e.parent,e.index),this.get(e.id)},t.update=function(e,t,n){return this.get(e)[t]=n,{id:e,key:t,value:n}},t.get=function(e){return this.nodeMap[e]},t.reset=function(){this.nodeMap={}},t.delete=function(e){this.nodeMap[e].destroy(),delete this.nodeMap[e]},t.create=function(e){var t=e.isActive,n=e.position,r=e.rotation,i=e.scale,a=e.id,o=e.name,u=new rt(this.oasis.engine,o);return u.isActive=t,u.transform.position=new s(n[0],n[1],n[2]),u.transform.rotation=new s(r[0],r[1],r[2]),u.transform.scale=new s(i[0],i[1],i[2]),u.id=a,this.nodeMap[a]=u,u},t.append=function(e,t,n){var r=this.nodeMap[e],i=this.nodeMap[t]||this.root;i.addChild(r);var a=i._children;Ya(a,a.length-1,n)},e}();vo([qa({after:"nodeAdded"})],go.prototype,"add",1),vo([qa({before:"beforeNodeUpdated",after:"nodeUpdated"})],go.prototype,"update",1),vo([qa({before:"beforeNodeDeleted"})],go.prototype,"delete",1);var yo=Object.defineProperty,Eo=Object.getOwnPropertyDescriptor,To=function(e,t,n,r){for(var i,a=r>1?void 0:r?Eo(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&yo(t,n,a),a},xo={script:ao,gltf:to,texture:$a,cubeTexture:uo,PBRMaterial:eo,PBRSpecularMaterial:eo,unlitMaterial:eo,ShaderMaterial:no,BlinnPhongMaterial:oo,base:co},Ao=new Map;for(var Oo in xo)if(xo.hasOwnProperty(Oo)){var bo=xo[Oo];bo===eo?Ao.set(bo,"PBRMaterial"):Ao.set(bo,Oo)}var Mo=function(e,t){return new xo[t](e)};function So(e,t){xo.hasOwnProperty(e)||(xo[e]=t,Ao.set(t,e))}var Ro=function(){function e(e){this.oasis=e,this.resourceMap={},this.resourceIdMap=new WeakMap,this.maxId=0,this.engineResourceManager=this.oasis.engine.resourceManager}var t=e.prototype;return t.load=function(e){var t=this,n=Mo(this,e.type),r=n.load(this.oasis.engine.resourceManager,e,this.oasis);return this.maxId=Math.max(+e.id,this.maxId),r.then((function(){t.resourceMap[e.id]=n,t.resourceIdMap.set(n,e.id)})),r},t.add=function(e){var t=this,n=Mo(this,e.type);return new Promise((function(r){n.loadWithAttachedResources(t.oasis.engine.resourceManager,e,t.oasis).then((function(e){r(t.getAddResourceResult(e.resources,e.structure))}))}))},t.remove=function(e){var t=this;return new Promise((function(n){var r=t.resourceMap[e],i=[e],a=!1;if(delete t.resourceMap[e],r)for(var o=r.attachedResources,s=0;s<o.length;s++){var u=o[s],c=t.resourceIdMap.get(u);c&&(a=!0,t.remove(c).then((function(e){i.push.apply(i,e),n(i)})))}a||n(i)}))},t.update=function(e,t,n){var r=this.get(e);return r&&r.update(t,n),{resource:r,id:e,key:t,value:n}},t.updateMeta=function(e,t,n){var r=this.get(e);r&&r.updateMeta(t,n)},t.get=function(e){return this.resourceMap[e]},t.getAll=function(){return U(this.resourceMap)},t.getAddResourceResult=function(e,t){var n=this,r={},i=e[t.index],a=""+ ++this.maxId;for(var o in this.resourceMap[a]=i,this.resourceIdMap.set(i,a),r.id=this.maxId,r.type=Ao.get(i.constructor),r.meta=i.meta,r.props={},t.props)if(t.props.hasOwnProperty(o)){var s=t.props[o];s&&(Array.isArray(s)?r.props[o]=s.map((function(t){return n.getAddResourceResult(e,t)})):r.props[o]=this.getAddResourceResult(e,s))}return r},Di(e,[{key:"isLocal",get:function(){return this.oasis.options.local}},{key:"useCompressedTexture",get:function(){var e;return null==(e=this.oasis.options.useCompressedTexture)||e}}]),e}();To([qa({before:"beforeResourceRemove"})],Ro.prototype,"remove",1),To([qa({after:"resourceUpdated",before:"beforeResourceUpdate"})],Ro.prototype,"update",1);var Lo=Object.defineProperty,Co=Object.getOwnPropertyDescriptor,Io=function(e){function t(t,n){var r,i;return(i=e.call(this,t.engine)||this)._options=t,i.pluginManager=n,i.engine=null,i.oasis=wi(i),i.engine=t.engine,i.resetFeature(),i.schema=t.config,i.timeout=t.timeout,t.scripts=null!=(r=t.scripts)?r:{},i.nodeManager=new go(wi(i)),i.abilityManager=new _o(wi(i)),i.nodeManager.add=i.nodeManager.add.bind(i.nodeManager),i.abilityManager.add=i.abilityManager.add.bind(i.abilityManager),i.resourceManager=new Ro(wi(i)),t.fps&&(i.engine.targetFrameRate=t.fps,i.engine.vSyncCount=0),i}Hi(t,e);var n=t.prototype;return n.updateConfig=function(e){this.schema=e,this.init()},n.init=function(){var e=this;return this.loadResources().then((function(){e.bindResources(),e.parseEntities(),e.parseNodeAbilities(),e.attach(),e.nodeManager.addRootEntity(),e.pluginManager.boot(e)}))},n.loadResources=function(){var e=this,t=this.schema.assets,n=U(void 0===t?{}:t).filter((function(e){return!!xo[e.type]||(console.warn(e.type+" loader is not defined. the "+e.type+" type will be ignored."),!1)})).map((function(t){return e.resourceManager.load(t)}));return Promise.all(n)},n.bindResources=function(){this.resourceManager.getAll().forEach((function(e){e.bind()}))},n.parseEntities=function(){var e=this.schema.nodes;this.bfsNodes().map((function(t){return e[t]})).forEach(this.nodeManager.add)},n.parseNodeAbilities=function(){var e=this.schema.abilities;Object.keys(e).map((function(t){return Bi({id:t},e[t])})).forEach(this.abilityManager.add)},n.bfsNodes=function(){var e=this.schema.nodes,t=U(e).filter((function(t){return!e[t.parent]})).map((function(e){return e.id})),n=[];return function t(r){n=n.concat(r),r.forEach((function(n){var r=e[n].children;r&&t(r)}))}(t),n},n.resetFeature=function(){var e=this.engine.sceneManager.activeScene;e.features.splice(2,1),e.features.splice(3,1),e.hasFogFeature=void 0,e.getFogMacro=void 0,e.bindFogToMaterial=void 0},n.attach=function(){this.resourceManager.getAll().forEach((function(e){e.attach()}))},t.create=function(e,n){var r=new t(e,n);return r.init().then((function(){return e.autoPlay&&r.engine.run(),r}))},Di(t,[{key:"canvas",get:function(){return this._options.canvas}},{key:"options",get:function(){return this._options}}]),t}($);!function(e,t,n,r){for(var i,a=r>1?void 0:r?Co(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);r&&a&&Lo(t,n,a)}([qa({after:"schemaParsed"})],Io.prototype,"init",1);var wo=["color","center","size","__position","__positionRandomness","__color","__velocity","__velocityRandomness","__acceleration","__accelerationRandomness","_center"];function Po(e){for(var t=Object.keys(e),n=0,r=t.length;n<r;++n){var i=t[n],a=e[i];null!==a&&"object"==typeof a&&a.length>1&&("backgroundColor"===i||"tintColor"===i?e[i]=new T(a[0],a[1],a[2],a[3]):-1!==wo.indexOf(i)&&(e[i]=new s(a[0],a[1],a[2])))}}function No(e){if(void 0===e&&(e={}),e)for(var t=Object.keys(e),n=0,r=t.length;n<r;n++){var i=t[n],a=e[i];if("newMaterial"!==i&&"blendFuncSeparate"!==i&&"scripts"!==i)switch(null==a?void 0:a.length){case 2:e[i]=new g(a[0],a[1]);break;case 3:e[i]=new s(a[0],a[1],a[2]);break;case 4:e[i]=new T(a[0],a[1],a[2],a[3])}}}var Fo=function(){function e(){this.pluginManager=new Wa}var t=e.prototype;return t.parse=function(e){var t,n;3!==(null==e||null==(t=e.config)?void 0:t.version)&&console.warn('schema-parser: schema version "'+(null==e||null==(n=e.config)?void 0:n.version)+'" is out of date, please re-pull the latest version (version 3) of the schema');return function(e){for(var t=e.abilities,n=void 0===t?{}:t,r=e.assets,i=void 0===r?{}:r,a=Object.keys(n),o=Object.keys(i),s=0,u=a.length;s<u;++s)Po(n[a[s]].props);for(var c=0,l=o.length;c<l;++c)No(i[o[c]].props)}(e.config),Io.create(e,this.pluginManager)},t.register=function(e){this.pluginManager.register(e)},t.resetPlugins=function(){this.pluginManager.reset()},e.create=function(){return new e},e.registerComponents=function(e,t){this._components[e]||(this._components[e]={}),Object.assign(this._components[e],t)},e}();Fo._components={};var Do=Fo.create();function Uo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Vo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vo(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Vo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bo(){return(Bo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ho(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,zo(e,t)}function zo(e,t){return(zo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Go(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ko(e,t,n){return t&&Go(e.prototype,t),n&&Go(e,n),e}var jo=[];var Xo=function(){function e(e){this._gl=e,this._vertexShader=null,this._fragmentShader=null,this._vertexShaderSource=null,this._fragmentShaderSource=null,this._program=null,this._attributeCache={},this._uniformCache={}}e.requireProgram=function(t,n){var r=null;if(jo.some((function(e){if(e._gl===n&&e._vertexShaderSource===t.vertexShader&&e._fragmentShaderSource===t.fragmentShader)return r=e,!0})),!r){if(!(r=new e(n)).createFromSource(t.vertexShader,t.fragmentShader,t.attribLocSet))return null;jo.push(r)}return r},e.releaseProgram=function(e){var t=jo.indexOf(e);-1!==t&&jo.splice(t,1)};var t=e.prototype;return t.createFromSource=function(e,t,n){var r=this._gl,i=this._compileShader(r.VERTEX_SHADER,e);if(!i)return!1;var a=this._compileShader(r.FRAGMENT_SHADER,t);if(!a)return!1;var o=r.createProgram();if(r.attachShader(o,i),r.attachShader(o,a),n)for(var s in n)r.bindAttribLocation(o,n[s],s);return r.linkProgram(o),r.validateProgram(o),r.isContextLost()?(Be.error("Contex lost while linking program."),r.deleteShader(i),r.deleteShader(a),null):r.getProgramParameter(o,r.LINK_STATUS)||r.isContextLost()?(this._vertexShader=i,this._fragmentShader=a,this._vertexShaderSource=e,this._fragmentShaderSource=t,this._program=o,!0):(Be.error("Could not link WebGL program. \n"+r.getProgramInfoLog(o)),r.deleteProgram(o),!1)},t._compileShader=function(e,t){var n,r,i,a=this._gl,o=a.createShader(e);return a.shaderSource(o,t),a.compileShader(o),a.isContextLost()?(Be.error("Contex lost while compiling shader."),a.deleteShader(o),null):!Be.isEnabled||a.getShaderParameter(o,a.COMPILE_STATUS)||a.isContextLost()?o:(Be.error("Could not compile WebGL shader.\n"+(r=t.split("\n"),i=(r.length+1).toString().length+6,r.map((function(e,t){if((n="0:"+(t+1)).length>=i)return n.substring(0,i)+e;for(var r=0;r<i-n.length;r++)n+=" ";return n+e})).join("\n")+"\n")+a.getShaderInfoLog(o)),a.deleteShader(o),null)},t.getAttribLocation=function(e,t){return this._attributeCache.hasOwnProperty(t)?this._attributeCache[t]:this._attributeCache[t]=this._gl.getAttribLocation(e,t)},t.getUniformLocation=function(e,t){return this._uniformCache.hasOwnProperty(t)?this._uniformCache[t]:this._uniformCache[t]=this._gl.getUniformLocation(e,t)},t.finalize=function(){var t=this._gl;this._vertexShader&&t.deleteShader(this._vertexShader),this._fragmentShader&&t.deleteShader(this._fragmentShader),this._program&&t.deleteProgram(this._program),this._vertexShader=null,this._fragmentShader=null,this._vertexShaderSource=null,this._fragmentShaderSource=null,this._program=null,this._attributeCache={},this._uniformCache={},e.releaseProgram(this)},ko(e,[{key:"program",get:function(){return this._program}}]),e}(),Wo=function(){function e(e,t){this._rhi=e,this.asset=t}return ko(e,[{key:"rhi",get:function(){return this._rhi}}]),e}(),qo=function(e){function t(n,r){var i;(i=e.call(this,n,r)||this).cacheID=++t.cacheCounter,i._tech=r,i._activeTextureCount=0;var a=n.gl;if(i._program=Xo.requireProgram(r,a),i._program){i.valid=!0;var o=i._program.program;i._attributes={};var s=r.attributes;for(var u in s)i._attributes[u]={name:u,semantic:s[u].semantic,location:i._program.getAttribLocation(o,u)};i._uniforms={};var c=r.uniforms;for(var l in c){var f=i._program.getUniformLocation(o,l);null!==f&&(i._uniforms[l]={name:l,location:f})}}else i.valid=!1;return i}Ho(t,e);var n=t.prototype;return n.finalize=function(e){this._program&&e&&(this._program=null)},n.begin=function(e){var t=this.rhi.gl,n=this._program.program;this._activeTextureCount=0,t.useProgram(n);var r=this._uniforms,i=this._tech.uniforms;for(var a in i)if(r.hasOwnProperty(a)){var o=e.getValue(a);null!=o&&this._uploadUniformValue(i[a],r[a].location,o)}var s=this.rhi.renderStates;this._tech.states&&(s.pushStateBlock(this._tech.name),this._applyStates(s))},n.end=function(){this._tech.states&&this.rhi.renderStates.popStateBlock()},n._applyStates=function(e){var t=this._tech.states,n=t.enable;if(n)for(var r=0,i=n.length;r<i;r++)e.enable(n[r]);var a=t.disable;if(a)for(var o=0,s=a.length;o<s;o++)e.disable(a[o]);var u=t.functions;if(u)for(var c in u){var l=Array.isArray(u[c])?u[c]:[u[c]];e[c].apply(e,l)}},n._uploadUniformValue=function(e,t,n){var r=this.rhi.gl;switch(e.type){case ge.FLOAT:n.length?r.uniform1fv(t,n):r.uniform1f(t,n);break;case ge.FLOAT_ARRAY:r.uniform1fv(t,n);break;case ge.INT:n.length?r.uniform1iv(t,n):r.uniform1i(t,n);break;case ge.INT_ARRAY:r.uniform1iv(t,n);break;case ge.FLOAT_VEC2:r.uniform2f(t,n.x,n.y);break;case ge.FLOAT_VEC2_ARRAY:r.uniform2fv(t,n);break;case ge.FLOAT_VEC3:r.uniform3f(t,n.x,n.y,n.z);break;case ge.FLOAT_VEC3_ARRAY:r.uniform3fv(t,n);break;case ge.FLOAT_VEC4:r.uniform4f(t,n.x,n.y,n.z,n.w);break;case ge.FLOAT_VEC4_ARRAY:r.uniform4fv(t,n);break;case ge.INT_VEC2:r.uniform2i(t,n.x,n.y);break;case ge.INT_VEC2_ARRAY:r.uniform2iv(t,n);break;case ge.INT_VEC3:r.uniform3i(t,n.x,n.y,n.z);break;case ge.INT_VEC3_ARRAY:r.uniform3iv(t,n);break;case ge.INT_VEC4:r.uniform4i(t,n.x,n.y,n.z,n.w);break;case ge.INT_VEC4_ARRAY:r.uniform4iv(t,n);break;case ge.FLOAT_MAT2:r.uniformMatrix2fv(t,!1,n.elements);break;case ge.FLOAT_MAT2_ARRAY:r.uniformMatrix2fv(t,!1,n);break;case ge.FLOAT_MAT3:r.uniformMatrix3fv(t,!1,n.elements);break;case ge.FLOAT_MAT3_ARRAY:r.uniformMatrix3fv(t,!1,n);break;case ge.FLOAT_MAT4:r.uniformMatrix4fv(t,!1,n.elements);break;case ge.FLOAT_MAT4_ARRAY:r.uniformMatrix4fv(t,!1,n);break;case ge.SAMPLER_2D:this._uploadTexture(n,t);break;case ge.SAMPLER_2D_ARRAY:this._uploadTextures(n,t);break;case ge.SAMPLER_CUBE:this._uploadTexture(n,t);break;case ge.SAMPLER_CUBE_ARRAY:this._uploadTextures(n,t);break;default:Be.warn("UNKNOWN uniform type: "+e.type)}},n._uploadTexture=function(e,t){if(e){var n=this.rhi.gl,r=this._activeTextureCount++;n.activeTexture(n.TEXTURE0+r),n.bindTexture(e._target,e._glTexture),n.uniform1i(t,r)}},n._uploadTextures=function(e,t){this._tempSamplerArray&&this._tempSamplerArray.length===e.length||(this._tempSamplerArray=new Int32Array(e.length));for(var n=this.rhi.gl,r=0,i=e.length;r<i;r++){var a=e[r];if(a){var o=this._activeTextureCount++;n.activeTexture(n.TEXTURE0+o),n.bindTexture(a._target,a._glTexture),this._tempSamplerArray[r]=o}else this._tempSamplerArray[r]=-1}n.uniform1iv(t,this._tempSamplerArray)},ko(t,[{key:"program",get:function(){return this._program}},{key:"attributes",get:function(){return this._attributes}},{key:"uniforms",get:function(){return this._uniforms}}]),t}(Wo);qo.cacheCounter=0;var Yo=function(e){function t(t,n,r){var i;return(i=e.call(this,t,n)||this)._gl=t.gl,i._glTexture=n._glTexture,i._config=n,i._type=r,i}Ho(t,e);var n=t.prototype;return n.activeBinding=function(e){var t=this._gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(this._type,this._glTexture)},n.finalize=function(){},ko(t,[{key:"glTexture",get:function(){return this._glTexture}}]),t}(Wo),Ko=function(){function e(e){this._scale=new g;var t=e.width,n=e.height;this._webCanvas=e,this._width=t,this._height=n}var t=e.prototype;return t.resizeByClientSize=function(e){void 0===e&&(e=window.devicePixelRatio);var t=this._webCanvas;if(t instanceof HTMLCanvasElement){var n=t.clientWidth,r=t.clientHeight;this.width=n*e,this.height=r*e}},t.setScale=function(e,t){this._scale.setValue(e,t),this.scale=this._scale},ko(e,[{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._webCanvas.width=e,this._width=e)}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._webCanvas.height=e,this._height=e)}},{key:"scale",get:function(){var e=this._webCanvas;return e instanceof HTMLCanvasElement&&this._scale.setValue(e.clientWidth*devicePixelRatio/e.width,e.clientHeight*devicePixelRatio/e.height),this._scale},set:function(e){var t=this._webCanvas;t instanceof HTMLCanvasElement&&(t.style.transformOrigin="left top",t.style.transform="scale("+e.x+", "+e.y+")")}}]),e}(),Qo=function(){function e(e,t){void 0===t&&(t={}),this._rhi=e,this._objectSet={},this._checkList=[],this._nextID=1,this._enableCollect=void 0===t.enableCollect||!!t.enableCollect}var t=e.prototype;return t.requireObject=function(e,t){var n=null;if(e.cacheID&&(n=this._objectSet[e.cacheID]),!n||e.needRecreate){var r=this._nextID++,i=this._objectSet;n=new t(this._rhi,e),i[r]=n,n.cacheID=r,n.asset=e,e.cacheID=r,e.needRecreate=!1,this._enableCollect&&e.type===ee.Cache&&this._checkList.push(n)}return n.activeFrame=this._rhi.frameCount,n},t.compact=function(){if(this._enableCollect)for(var e=this._rhi.frameCount,t=this._checkList,n=this._objectSet,r=t.length-1;r>=0;r--){var i=t[r];i.activeFrame<e&&(delete n[i.cacheID],t.splice(r,1),i.finalize())}},t.finalize=function(){for(var e in this._objectSet){this._objectSet[e].finalize(!0)}this._objectSet={},this._checkList=[]},e}(),Zo=function(){function e(e){this._rhi=e,this.capabilityList=new Map,this.init(),this.compatibleAllInterface()}var t=e.prototype;return t.canIUse=function(e){return this.capabilityList.get(e)},t.canIUseCompressedTextureInternalFormat=function(e){var t=En.RGBA_ASTC_4X4_KHR,n=En.RGBA_ASTC_12X12_KHR,r=En.SRGB8_ALPHA8_ASTC_4X4_KHR,i=En.SRGB8_ALPHA8_ASTC_12X12_KHR,a=En.RGB_ETC1_WEBGL,o=En.R11_EAC,s=En.SRGB8_ALPHA8_ETC2_EAC,u=En.RGB_PVRTC_4BPPV1_IMG,c=En.RGBA_PVRTC_2BPPV1_IMG,l=En.RGB_S3TC_DXT1_EXT,f=En.RGBA_S3TC_DXT5_EXT;return e>=t&&n<=n||e>=r&&e<=i?this.canIUse(Ce.astc):e===a?this.canIUse(Ce.etc1):e>=o&&e<=s?this.canIUse(Ce.etc):e>=u&&e<=c?this.canIUse(Ce.pvrtc):e>=l&&e<=f&&this.canIUse(Ce.s3tc)},t.init=function(){var e=this.capabilityList,t=this.rhi.isWebGL2,n=this.rhi.requireExtension.bind(this.rhi),r=Ce.standardDerivatives,i=Ce.shaderTextureLod,a=Ce.elementIndexUint,o=Ce.depthTexture,s=Ce.vertexArrayObject,u=Ce.instancedArrays,c=Ce.multipleSample,l=Ce.drawBuffers,f=Ce.astc,h=Ce.astc_webkit,d=Ce.etc,_=Ce.etc_webkit,m=Ce.etc1,p=Ce.etc1_webkit,v=Ce.pvrtc,g=Ce.pvrtc_webkit,y=Ce.s3tc,E=Ce.s3tc_webkit,T=Ce.textureFloat,x=Ce.textureHalfFloat,A=Ce.textureFloatLinear,O=Ce.textureHalfFloatLinear,b=Ce.WEBGL_colorBufferFloat,M=Ce.colorBufferFloat,S=Ce.colorBufferHalfFloat,R=Ce.textureFilterAnisotropic;e.set(r,t||!!n(r)),e.set(i,t||!!n(i)),e.set(a,t||!!n(a)),e.set(o,t||!!n(o)),e.set(s,t||!!n(s)),e.set(u,t||!!n(u)),e.set(c,t),e.set(l,t||!!n(l)),e.set(T,t||!!n(T)),e.set(x,t||!!n(x)),e.set(A,!!n(A)),e.set(O,t||!!n(O)),e.set(M,t&&!!n(M)||!!n(b)),e.set(S,t&&!!n(M)||!!n(S)),e.set(R,!!n(R)),e.set(f,!(!n(f)&&!n(h))),e.set(d,!(!n(d)&&!n(_))),e.set(m,!(!n(m)&&!n(p))),e.set(v,!(!n(v)&&!n(g))),e.set(y,!(!n(y)&&!n(E)))},t.compatibleInterface=function(e,t){var n,r=this.rhi,i=r.gl;if(n=r.requireExtension(e))for(var a in t){var o=n[t[a]];null!=o&&o.bind?i[a]=o.bind(n):i[a]=o}},t.compatibleAllInterface=function(){var e=Ce.depthTexture,t=Ce.vertexArrayObject,n=Ce.instancedArrays,r=Ce.drawBuffers,i=Ce.textureFilterAnisotropic,a=Ce.textureHalfFloat,o=Ce.colorBufferHalfFloat,s=Ce.WEBGL_colorBufferFloat;if(!this.rhi.isWebGL2){this.compatibleInterface(e,{UNSIGNED_INT_24_8:"UNSIGNED_INT_24_8_WEBGL"}),this.compatibleInterface(t,{createVertexArray:"createVertexArrayOES",deleteVertexArray:"deleteVertexArrayOES",isVertexArray:"isVertexArrayOES",bindVertexArray:"bindVertexArrayOES"}),this.compatibleInterface(n,{drawArraysInstanced:"drawArraysInstancedANGLE",drawElementsInstanced:"drawElementsInstancedANGLE",vertexAttribDivisor:"vertexAttribDivisorANGLE"}),this.compatibleInterface(r,{MAX_DRAW_BUFFERS:"MAX_DRAW_BUFFERS_WEBGL"});var u={};if(this.canIUse(Ce.drawBuffers)){for(var c=this.maxDrawBuffers,l=0;l<c;l++)0!=l&&(u["COLOR_ATTACHMENT"+l]="COLOR_ATTACHMENT"+l+"_WEBGL"),u["DRAW_BUFFER"+l]="DRAW_BUFFER"+l+"_WEBGL";this.compatibleInterface(r,Bo({drawBuffers:"drawBuffersWEBGL"},u))}this.compatibleInterface(a,{HAFL_FLOAT:"HALF_FLOAT_OES"}),this.compatibleInterface(o,{RGBA16F:"RBGA16F_EXT"}),this.compatibleInterface(s,{RGBA32F:"RBGA32F_EXT"})}this.compatibleInterface(i,{TEXTURE_MAX_ANISOTROPY_EXT:"TEXTURE_MAX_ANISOTROPY_EXT"})},ko(e,[{key:"maxDrawBuffers",get:function(){return this._maxDrawBuffers||(this.canIUse(Ce.drawBuffers)?this._maxDrawBuffers=this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS):this._maxDrawBuffers=1),this._maxDrawBuffers}},{key:"maxAnisoLevel",get:function(){if(!this._maxAnisoLevel){var e=this._rhi.requireExtension(Ce.textureFilterAnisotropic);this._maxAnisoLevel=e?this._rhi.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}return this._maxAnisoLevel}},{key:"maxAntiAliasing",get:function(){if(!this._maxAntiAliasing){var e=this._rhi.gl,t=this.canIUse(Ce.multipleSample);this._maxAntiAliasing=t?e.getParameter(e.MAX_SAMPLES):1}return this._maxAntiAliasing}},{key:"rhi",get:function(){return this._rhi}},{key:"canIUseMoreJoints",get:function(){return this.canIUse(Ce.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}}]),e}(),Jo=function(){function e(e){this.rhi=e,this._requireResult={}}return e.prototype.requireExtension=function(e){return void 0!==this._requireResult[e]||(this._requireResult[e]=this.rhi.gl.getExtension(e)),this._requireResult[e]},e}(),$o=function(){function e(e,t){this.vao=new Map,this._primitive=t,this.canUseInstancedArrays=e.canIUse(Ce.instancedArrays),this._useVao=e.canIUse(Ce.vertexArrayObject),this.gl=e.gl}var t=e.prototype;return t.draw=function(e,t){var n=this.gl,r=this._primitive;if(this._useVao){this.vao.has(e.cacheID)||this.registerVAO(e);var i=this.vao.get(e.cacheID);n.bindVertexArray(i)}else this.bindBufferAndAttrib(e);var a=r.indexBufferBinding,o=r.instanceCount,s=r._glIndexType,u=t.topology,c=t.start,l=t.count;if(o)if(this.canUseInstancedArrays)if(a)if(this._useVao)n.drawElementsInstanced(u,l,s,c,o);else{var f=a.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,f),n.drawElementsInstanced(u,l,s,c,o),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArraysInstanced(u,c,l,o);else Be.error("ANGLE_instanced_arrays extension is not supported");else if(a)if(this._useVao)n.drawElements(u,l,s,c);else{var h=a.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,h),n.drawElements(u,l,s,c),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArrays(u,c,l);this._useVao?n.bindVertexArray(null):this.disableAttrib()},t.destroy=function(){if(this._useVao){var e=this.gl;this.vao.forEach((function(t){e.deleteVertexArray(t)}))}},t.bindBufferAndAttrib=function(e){var t=this.gl,n=this._primitive,r=n.vertexBufferBindings;this.attribLocArray=[];var i,a,o=e.attributes,s=n._vertexElementMap;for(var u in o){var c=o[u].location;if(-1!==c){var l=s[o[u].semantic];if(l){var f=r[l.bindingIndex],h=f.buffer,d=f.stride;a!==(i=h._nativeBuffer)&&(a=i,t.bindBuffer(t.ARRAY_BUFFER,i)),t.enableVertexAttribArray(c);var _=l._glElementInfo,m=_.size,p=_.type;t.vertexAttribPointer(c,m,p,l.normalized,d,l.offset),this.canUseInstancedArrays&&t.vertexAttribDivisor(c,l.instanceDivisor),this.attribLocArray.push(c)}else Be.warn("vertex attribute not found: "+u)}}t.bindBuffer(t.ARRAY_BUFFER,null)},t.disableAttrib=function(){for(var e=this.gl,t=0,n=this.attribLocArray.length;t<n;t++)e.disableVertexAttribArray(this.attribLocArray[t])},t.registerVAO=function(e){var t=this.gl,n=t.createVertexArray();t.bindVertexArray(n);var r=this._primitive.indexBufferBinding;r&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.buffer._nativeBuffer),this.bindBufferAndAttrib(e),t.bindVertexArray(null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.disableAttrib(),this.vao.set(e.cacheID,n)},e}(),es=function(){function e(e){this._stateStack=[],this._parameters={},this._gl=e,this._stateStack=[],this._parameters={},this._parameters[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS]=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._parameters[e.MAX_VERTEX_UNIFORM_VECTORS]=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this._parameters[e.MAX_VERTEX_ATTRIBS]=e.getParameter(e.MAX_VERTEX_ATTRIBS),this._parameters[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS]=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._parameters[e.BLEND]=!1,e.disable(e.BLEND),this._parameters[e.CULL_FACE]=!0,e.enable(e.CULL_FACE),this._parameters[e.DEPTH_TEST]=!0,e.enable(e.DEPTH_TEST),this._parameters[e.DITHER]=!1,e.disable(e.DITHER),this._parameters[e.POLYGON_OFFSET_FILL]=!1,e.disable(e.POLYGON_OFFSET_FILL),this._parameters[e.SAMPLE_ALPHA_TO_COVERAGE]=!1,e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),this._parameters[e.SAMPLE_COVERAGE]=!1,e.disable(e.SAMPLE_COVERAGE),this._parameters[e.SCISSOR_TEST]=!1,e.disable(e.SCISSOR_TEST),this._parameters[e.STENCIL_TEST]=!1,e.disable(e.STENCIL_TEST),this._parameters[e.COLOR_WRITEMASK]=[!0,!0,!0,!0],e.colorMask(!0,!0,!0,!0),this._parameters[e.DEPTH_WRITEMASK]=!0,e.depthMask(!0),this._parameters[e.BLEND_SRC_RGB]=e.ONE,this._parameters[e.BLEND_SRC_ALPHA]=e.ONE,this._parameters[e.BLEND_DST_RGB]=e.ZERO,this._parameters[e.BLEND_DST_ALPHA]=e.ZERO,e.blendFunc(e.ONE,e.ZERO),this._parameters[e.BLEND_EQUATION_RGB]=e.FUNC_ADD,this._parameters[e.BLEND_EQUATION_ALPHA]=e.FUNC_ADD,this._parameters[e.CULL_FACE_MODE]=e.BACK,e.cullFace(e.BACK),this._parameters[e.FRONT_FACE]=e.CCW,e.frontFace(e.CCW),this._parameters[e.DEPTH_FUNC]=e.LESS,e.depthFunc(e.LESS),this._parameters[e.DEPTH_RANGE]=[0,1],e.depthRange(0,1),this._parameters[e.POLYGON_OFFSET_FACTOR]=0,this._parameters[e.POLYGON_OFFSET_UNITS]=0,e.polygonOffset(0,0),this._parameters[e.SCISSOR_BOX]=[0,0,e.canvas.width,e.canvas.height],this._parameters[e.STENCIL_FUNC]=e.ALWAYS,this._parameters[e.STENCIL_VALUE_MASK]=255,this._parameters[e.STENCIL_REF]=0,e.stencilFunc(e.ALWAYS,0,255),this._parameters[e.STENCIL_WRITEMASK]=255,e.stencilMask(255),this._parameters[e.STENCIL_FAIL]=e.KEEP,this._parameters[e.STENCIL_PASS_DEPTH_FAIL]=e.KEEP,this._parameters[e.STENCIL_PASS_DEPTH_PASS]=e.KEEP}var t=e.prototype;return t.getParameter=function(e){return this._parameters[e]},t.pushStateBlock=function(e){var t={name:e,states:[]};this._stateStack.push(t)},t.popStateBlock=function(){for(var e,t=Uo(this._stateStack.pop().states);!(e=t()).done;){var n=e.value,r=n.func,i=n.args,a=n.parameters;for(var o in r.apply(this._gl,i),a)this._parameters[o]=a[o]}},t._getStateStackTop=function(){var e=this._stateStack.length;return e>0?this._stateStack[e-1]:null},t._pushState=function(e,t,n){var r=this._getStateStackTop();r&&r.states.push({func:e,args:t,parameters:n})},t.enable=function(e){if(!0!==this._parameters[e]){this._parameters[e]=!0,this._gl.enable(e);var t={};t[e]=!1,this._pushState(this._gl.disable,[e],t)}},t.disable=function(e){if(!1!==this._parameters[e]){this._parameters[e]=!1,this._gl.disable(e);var t={};t[e]=!0,this._pushState(this._gl.enable,[e],t)}},t.blendFunc=function(e,t){var n=this._gl,r=this._parameters;if(r[n.BLEND_SRC_RGB]!==e||r[n.BLEND_SRC_ALPHA]!==e||r[n.BLEND_DST_RGB]!==t||r[n.BLEND_DST_ALPHA]!==t){var i=[r[n.BLEND_SRC_RGB],r[n.BLEND_DST_RGB],r[n.BLEND_SRC_ALPHA],r[n.BLEND_DST_ALPHA]],a={};a[n.BLEND_SRC_RGB]=r[n.BLEND_SRC_RGB],a[n.BLEND_DST_RGB]=r[n.BLEND_DST_RGB],a[n.BLEND_SRC_ALPHA]=r[n.BLEND_SRC_ALPHA],a[n.BLEND_DST_ALPHA]=r[n.BLEND_DST_ALPHA],this._pushState(n.blendFuncSeparate,i,a),r[n.BLEND_SRC_RGB]=e,r[n.BLEND_SRC_ALPHA]=e,r[n.BLEND_DST_RGB]=t,r[n.BLEND_DST_ALPHA]=t,n.blendFunc(e,t)}},t.blendFuncSeparate=function(e,t,n,r){var i=this._gl,a=this._parameters;if(a[i.BLEND_SRC_RGB]!==e||a[i.BLEND_SRC_ALPHA]!==n||a[i.BLEND_DST_RGB]!==t||a[i.BLEND_DST_ALPHA]!==r){var o=[a[i.BLEND_SRC_RGB],a[i.BLEND_DST_RGB],a[i.BLEND_SRC_ALPHA],a[i.BLEND_DST_ALPHA]],s={};s[i.BLEND_SRC_RGB]=a[i.BLEND_SRC_RGB],s[i.BLEND_DST_RGB]=a[i.BLEND_DST_RGB],s[i.BLEND_SRC_ALPHA]=a[i.BLEND_SRC_ALPHA],s[i.BLEND_DST_ALPHA]=a[i.BLEND_DST_ALPHA],this._pushState(i.blendFuncSeparate,o,s),a[i.BLEND_SRC_RGB]=e,a[i.BLEND_SRC_ALPHA]=n,a[i.BLEND_DST_RGB]=t,a[i.BLEND_DST_ALPHA]=r,i.blendFuncSeparate(e,t,n,r)}},t.blendEquationSeparate=function(e,t){var n=this._gl,r=this._parameters;if(r[n.BLEND_EQUATION_RGB]!==e||r[n.BLEND_EQUATION_ALPHA]!==t){var i=[r[n.BLEND_EQUATION_RGB],r[n.BLEND_EQUATION_ALPHA]],a={};a[n.BLEND_EQUATION_RGB]=r[n.BLEND_EQUATION_RGB],a[n.BLEND_EQUATION_ALPHA]=r[n.BLEND_EQUATION_ALPHA],this._pushState(n.blendEquationSeparate,i,a),r[n.BLEND_EQUATION_RGB]=e,r[n.BLEND_EQUATION_ALPHA]=t,n.blendEquationSeparate(e,t)}},t.colorMask=function(e,t,n,r){var i=this._gl,a={};a[i.COLOR_WRITEMASK]=this._parameters[i.COLOR_WRITEMASK],this._pushState(i.colorMask,this._parameters[i.COLOR_WRITEMASK],a),this._parameters[i.COLOR_WRITEMASK]=[e,t,n,r],i.colorMask(e,t,n,r)},t.depthMask=function(e){var t=this._gl;if(this._parameters[t.DEPTH_WRITEMASK]!==e){var n={};n[t.DEPTH_WRITEMASK]=this._parameters[t.DEPTH_WRITEMASK],this._pushState(t.depthMask,[this._parameters[t.DEPTH_WRITEMASK]],n),this._parameters[t.DEPTH_WRITEMASK]=e,t.depthMask(e)}},t.cullFace=function(e){var t=this._gl;if(this._parameters[t.CULL_FACE_MODE]!==e){var n={};n[t.CULL_FACE_MODE]=this._parameters[t.CULL_FACE_MODE],this._pushState(t.cullFace,[this._parameters[t.CULL_FACE_MODE]],n),this._parameters[t.CULL_FACE_MODE]=e,t.cullFace(e)}},t.frontFace=function(e){var t=this._gl;if(this._parameters[t.FRONT_FACE]!==e){var n={};n[t.FRONT_FACE]=this._parameters[t.FRONT_FACE],this._pushState(t.frontFace,[this._parameters[t.FRONT_FACE]],n),this._parameters[t.FRONT_FACE]=e,t.frontFace(e)}},t.depthFunc=function(e){var t=this._gl;if(this._parameters[t.DEPTH_FUNC]!==e){var n={};n[t.DEPTH_FUNC]=this._parameters[t.DEPTH_FUNC],this._pushState(t.depthFunc,[this._parameters[t.DEPTH_FUNC]],n),this._parameters[t.DEPTH_FUNC]=e,t.depthFunc(e)}},t.depthRange=function(e,t){var n=this._gl,r=this._parameters[n.DEPTH_RANGE];if(r[0]!==e||r[1]!==t){var i={};i[n.DEPTH_RANGE]=r,this._pushState(n.depthRange,[this._parameters[n.DEPTH_RANGE]],i),this._parameters[n.DEPTH_RANGE]=[e,t],n.depthRange(e,t)}},t.polygonOffset=function(e,t){var n=this._gl;if(this._parameters[n.POLYGON_OFFSET_FACTOR]!==e||this._parameters[n.POLYGON_OFFSET_UNITS]!==t){var r={};r[n.POLYGON_OFFSET_FACTOR]=this._parameters[n.POLYGON_OFFSET_FACTOR],r[n.POLYGON_OFFSET_UNITS]=this._parameters[n.POLYGON_OFFSET_UNITS],this._pushState(n.polygonOffset,[this._parameters[n.POLYGON_OFFSET_FACTOR],this._parameters[n.POLYGON_OFFSET_UNITS]],r),this._parameters[n.POLYGON_OFFSET_FACTOR]=e,this._parameters[n.POLYGON_OFFSET_UNITS]=t,n.polygonOffset(e,t)}},t.scissor=function(e,t,n,r){var i=this._gl,a=this._parameters[i.SCISSOR_BOX];if(a[0]!==e||a[1]!==t||a[2]!==n||a[3]!==r){var o={};o[i.SCISSOR_BOX]=a,this._pushState(i.scissor,a,o),this._parameters[i.SCISSOR_BOX]=[e,t,n,r],i.scissor(e,t,n,r)}},t.stencilFunc=function(e,t,n){var r=this._gl;if(this._parameters[r.STENCIL_FUNC]!==e||this._parameters[r.STENCIL_REF]!==t||this._parameters[r.STENCIL_VALUE_MASK]!==n){var i=[this._parameters[r.STENCIL_FUNC],this._parameters[r.STENCIL_REF],this._parameters[r.STENCIL_VALUE_MASK]],a={};a[r.STENCIL_FUNC]=i[0],a[r.STENCIL_REF]=i[1],a[r.STENCIL_VALUE_MASK]=i[2],this._pushState(r.stencilFunc,i,a),this._parameters[r.STENCIL_FUNC]=e,this._parameters[r.STENCIL_REF]=t,this._parameters[r.STENCIL_VALUE_MASK]=n,r.stencilFunc(e,t,n)}},t.stencilOp=function(e,t,n){var r=this._gl;if(this._parameters[r.STENCIL_FAIL]!==e||this._parameters[r.STENCIL_PASS_DEPTH_FAIL]!==t||this._parameters[r.STENCIL_PASS_DEPTH_PASS]!==n){var i=[this._parameters[r.STENCIL_FAIL],this._parameters[r.STENCIL_PASS_DEPTH_FAIL],this._parameters[r.STENCIL_PASS_DEPTH_PASS]],a={};a[r.STENCIL_FAIL]=i[0],a[r.STENCIL_PASS_DEPTH_FAIL]=i[1],a[r.STENCIL_PASS_DEPTH_PASS]=i[2],this._pushState(r.stencilOp,i,a),this._parameters[r.STENCIL_FAIL]=e,this._parameters[r.STENCIL_BACK_PASS_DEPTH_FAIL]=t,this._parameters[r.STENCIL_PASS_DEPTH_PASS]=n,r.stencilOp(e,t,n)}},t.stencilMask=function(e){var t=this._gl;if(this._parameters[t.STENCIL_WRITEMASK]!==e){var n={};n[t.STENCIL_WRITEMASK]=this._parameters[t.STENCIL_WRITEMASK],this._pushState(t.stencilMask,[this._parameters[t.STENCIL_WRITEMASK]],n),this._parameters[t.STENCIL_WRITEMASK]=e,t.stencilMask(e)}},e}(),ts=function(){function e(e){this.gl=e,this._initVertexAttributes(e),this._vbo=e.createBuffer(),this._maxBatchCount=0,this._vertBuffer=null,this._vertCursor=0,this._drawSpriteCount=0}var t=e.prototype;return t.setMaxBatchCount=function(e){var t=6*e*9;this._vertBuffer&&this._vertBuffer.length>=t||(this._maxBatchCount=e,this._vertBuffer=new Float32Array(t))},t.beginDraw=function(e){this._vertCursor=0,this._drawSpriteCount=0,e>this._maxBatchCount&&this.setMaxBatchCount(e)},t.drawSprite=function(e,t,n){if(this._drawSpriteCount++,this._drawSpriteCount>this._maxBatchCount)Be.warn("Sprite: sprite count overflow");else{var r=n,i=t.u,a=t.v,o=t.u+t.width,s=t.v+t.height;this._pushVertex(e.leftTop,new g(i,a),r),this._pushVertex(e.leftBottom,new g(i,s),r),this._pushVertex(e.rightBottom,new g(o,s),r),this._pushVertex(e.rightBottom,new g(o,s),r),this._pushVertex(e.rightTop,new g(o,a),r),this._pushVertex(e.leftTop,new g(i,a),r)}},t.endDraw=function(){var e=this._vertCursor/9;if(!(e<=0)){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,this._vbo),t.bufferData(t.ARRAY_BUFFER,this._vertBuffer,t.DYNAMIC_DRAW);for(var n=0,r=this._vertAttributes.length;n<r;n++){var i=this._vertAttributes[n];t.vertexAttribPointer(i.lastShaderLoc,i.size,i.type,i.normalized,i.stride,i.offset),t.enableVertexAttribArray(i.lastShaderLoc)}t.drawArrays(t.TRIANGLES,0,e),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null);for(var a=0,o=this._vertAttributes.length;a<o;a++)t.disableVertexAttribArray(this._vertAttributes[a].lastShaderLoc)}},t._initVertexAttributes=function(e){var t={name:"a_pos",size:3,offset:0,lastShaderLoc:0},n={name:"a_uv",size:2,offset:12,lastShaderLoc:1},r={name:"a_color",size:4,offset:20,lastShaderLoc:2};this._vertAttributes=[t,n,r];for(var i,a=Uo(this._vertAttributes);!(i=a()).done;){var o=i.value;o.type=e.FLOAT,o.normalized=!1,o.stride=36}},t._pushVertex=function(e,t,n){var r=this._vertBuffer,i=this._vertCursor;r[i]=e.x,r[i+1]=e.y,r[i+2]=e.z,r[i+3]=t.x,r[i+4]=t.y,r[i+5]=n.x,r[i+6]=n.y,r[i+7]=n.z,r[i+8]=n.w,this._vertCursor+=9},t.finalize=function(){this._vbo&&(this.gl.deleteBuffer(this._vbo),this._vbo=null)},e}(),ns={name:"spriteTech3D",vertexShader:"\nprecision highp float;\n\nuniform mat4 matProjection;\nuniform mat4 matView;\n\nattribute vec3 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvoid main()\n{\n  gl_Position = matProjection * matView * vec4(a_pos,1.0);\n  v_uv = a_uv;\n  v_color = a_color;\n}\n",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\n\nuniform sampler2D s_diffuse;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvoid main()\n{\n  // AlphaMaskTint ColorFade Out\n  vec4 baseColor = texture2D(s_diffuse, v_uv);\n  gl_FragColor = baseColor * v_color;\n}\n",attribLocSet:{a_pos:0,a_uv:1,a_color:2},attributes:{a_pos:{name:"a_pos",semantic:"POSITION",type:ge.FLOAT_VEC3},a_uv:{name:"a_uv",semantic:"TEXCOORD_0",type:ge.FLOAT_VEC2},a_color:{name:"a_color",semantic:"COLOR",type:ge.FLOAT_VEC3}},uniforms:{matProjection:{name:"matProjection",semantic:Ee.PROJECTION,type:ge.FLOAT_MAT4},matView:{name:"matView",semantic:Ee.VIEW,type:ge.FLOAT_MAT4},s_diffuse:{name:"s_diffuse",type:ge.SAMPLER_2D}},states:{disable:[oe.CULL_FACE],enable:[oe.BLEND],functions:{blendFunc:[xe.SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA],depthMask:[!1]}}};var rs,is,as=function(){function e(e){var t;this._gl=e.gl,this._batchedQueue=[],this._targetTexture=null,this._glSprite=new ts(e.gl),this._glTech=new qo(e,ns),this._material={values:t={},setValue:function(e,n){t[e]=n},getValue:function(e){return t[e]}},this._camera=null}var t=e.prototype;return t.flush=function(){if(0!==this._batchedQueue.length)if(this._targetTexture){this._material.setValue("s_diffuse",this._targetTexture),this._material.setValue("matView",this._camera.viewMatrix),this._material.setValue("matProjection",this._camera.projectionMatrix),this._glTech.begin(this._material),this._glSprite.beginDraw(this._batchedQueue.length);for(var e=0,t=this._batchedQueue.length;e<t;e++){var n=this._batchedQueue[e].positionQuad,r=this._batchedQueue[e].uvRect,i=this._batchedQueue[e].tintColor;this._glSprite.drawSprite(n,r,i)}this._glSprite.endDraw(),this._glTech.end(),this._batchedQueue=[],this._targetTexture=null,this._camera=null}else Be.error("No texture!")},t.canBatch=function(e,t,n){return null===this._targetTexture||e===this._targetTexture&&n===this._camera},t.drawSprite=function(e,t,n,r,i,a){this.canBatch(r,i,a)||this.flush(),this._targetTexture=r,this._camera=a,this._batchedQueue.push({positionQuad:e,uvRect:t,tintColor:n})},t.finalize=function(){this._glSprite.finalize(),this._glTech.finalize()},e}();(is=rs||(rs={}))[is.Auto=0]="Auto",is[is.WebGL2=1]="WebGL2",is[is.WebGL1=2]="WebGL1";var os=function(){function e(e){void 0===e&&(e={}),this._options=e}var t=e.prototype;return t.init=function(e){var t,n=this._options,r=e._webCanvas,i=n.webGLMode||0;if(0!=i&&1!=i||(!(t=r.getContext("webgl2",n))&&r instanceof HTMLCanvasElement&&(t=r.getContext("experimental-webgl2",n)),this._isWebGL2=!0),t||0!=i&&2!=i||(!(t=r.getContext("webgl",n))&&r instanceof HTMLCanvasElement&&(t=r.getContext("experimental-webgl",n)),this._isWebGL2=!1),!t)throw new Error("Get GL Context FAILED.");this._gl=t,this._renderStates=new es(t),this._assetsCache=new Qo(this,n),this._extensions=new Jo(this),this._capability=new Zo(this),this._frameCount=0,this._options=null},t.createPlatformPrimitive=function(e){return new $o(this,e)},t.requireExtension=function(e){return this._extensions.requireExtension(e)},t.canIUse=function(e){return this.capability.canIUse(e)},t.canIUseCompressedTextureInternalFormat=function(e){return this.capability.canIUseCompressedTextureInternalFormat(e)},t.viewport=function(e,t,n,r){var i=this._gl;i.viewport(e,i.drawingBufferHeight-t-r,n,r)},t.colorMask=function(e,t,n,r){this._gl.colorMask(e,t,n,r)},t.beginFrame=function(){this._frameCount++},t.clearRenderTarget=function(e,t){var n=this._gl;switch(e){case ne.SOLID_COLOR:n.clearColor(t.x,t.y,t.z,t.w),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);break;case ne.DEPTH_ONLY:n.clear(n.DEPTH_BUFFER_BIT);break;case ne.COLOR_ONLY:n.clearColor(t.x,t.y,t.z,t.w),n.clear(n.COLOR_BUFFER_BIT);break;case ne.STENCIL_ONLY:n.clear(n.STENCIL_BUFFER_BIT);break;case ne.ALL_CLEAR:n.clearColor(t.x,t.y,t.z,t.w),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT);break;case ne.DONT_CLEAR:}},t.drawPrimitive=function(e,t,n){var r=n.technique._glTechnique;r||(r=n.technique._glTechnique=new qo(this,n.technique)),r.valid&&(e&&r?(r.begin(n),e.draw(r,t),r.end()):Be.error("draw primitive failed."))},t.drawSprite=function(e,t,n,r,i,a){this._spriteBatcher||(this._spriteBatcher=new as(this)),this._spriteBatcher.drawSprite(e,t,n,r,i,a)},t.flushSprite=function(){this._spriteBatcher&&this._spriteBatcher.flush()},t.activeRenderTarget=function(e,t){var n=this._gl;if(e){e._activeRenderTarget();var r=e.width,i=e.height;n.viewport(0,0,r,i)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);var a=t.viewport,o=n.drawingBufferWidth,s=n.drawingBufferHeight;this.viewport(a.x*o,a.y*s,a.z*o,a.w*s)}},t.blitRenderTarget=function(e){e&&e._MSAAFrameBuffer&&e._blitRenderTarget()},t.setRenderTargetFace=function(e,t){e&&e._setRenderTargetFace(t)},t.endFrame=function(){this._frameCount%8==0&&this._assetsCache.compact()},t.destroy=function(){this._assetsCache.finalize()},ko(e,[{key:"isWebGL2",get:function(){return this._isWebGL2}},{key:"gl",get:function(){return this._gl}},{key:"assetsCache",get:function(){return this._assetsCache}},{key:"renderStates",get:function(){return this._renderStates}},{key:"capability",get:function(){return this._capability}},{key:"frameCount",get:function(){return this._frameCount}},{key:"canIUseMoreJoints",get:function(){return this.capability.canIUseMoreJoints}}]),e}(),ss=function(e){function t(t,n){var r=new Ko("string"==typeof t?document.getElementById(t):t),i=new os(n);return e.call(this,r,i)||this}return Ho(t,e),ko(t,[{key:"canvas",get:function(){return this._canvas}}]),t}(ct);Fo.registerComponents("o3",{GLTFModel:Xa,SpriteRenderer:gr,PointLight:Zt,AmbientLight:qt,DirectLight:Yt,EnvironmentMapLight:Qt,Particle:Zr,SkyBox:Yr,BoxCollider:ti,GeometryRenderer:Ur,Camera:Ft,Component:Ze,SphereCollider:ni,PlaneProbe:_i,Model:Wr})},function(e,t,n){"use strict";n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return v})),n.d(t,"c",(function(){return M}));var r=n(0),i=n(9);function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return Array.isArray(e)&&Object(r.h)(e[0])?e[1]:e}var u={random:function(e){return e[0]instanceof Array?new _(e):new d(e)},static:function(e){return new f(e)},constant:function(e){return new f(e)},curve:function(e){return new v(e)},linear:function(e){return new m(e)},randomSet:function(e){return new h(e)},color:function(e){return new f(Object(i.b)(e,!0))},colors:function(e){return new h(e.map((function(e){return Object(i.b)(e,!0)})))},lines:function(e){return 2===e.length&&0===e[0][0]&&1===e[1][0]?new m([e[0][1],e[1][1]]):new g(e)},gradient:function(e){return new p(e)},path:function(e){return new y(e)},bezier:function(e){return new E(e)}};function c(e){return e&&isNaN(+e)?u[e[0]](e[1]):new f(e||0)}var l=function(){function e(e){this.onCreate(e)}var t=e.prototype;return t.onCreate=function(e){throw Error("not_implement")},t.getIntegrateValue=function(e,t,n){throw Error("not_implement")},t.getIntegrateByTime=function(e,t){throw Error("not_implement")},t.getValue=function(e){throw Error("not_implement")},t.toUniform=function(e){throw Error("not_implement")},t.map=function(e){throw Error("not_implement")},t.scaleXCoord=function(e){return this},e}(),f=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(e){this._value=e},n.getIntegrateValue=function(e,t,n){return this._value*(t-e)},n.getIntegrateByTime=function(e,t){return.5*this._value*(t*t-e*e)},n.getValue=function(e){return this._value},n.toUniform=function(e){return new Float32Array([0,this._value,0,0])},n.map=function(e){var t=this._value;return this._value=t instanceof Array?t.map(e):e(t),this},t}(l),h=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(e){this._items=e},n.getValue=function(e){var t=this._items;return t[Math.floor(Math.random()*t.length)]},n.map=function(e){return this._items=this._items.map(e),this},t}(l),d=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(e){this._min=e[0],this._max=e[1]},n.getValue=function(e){return Object(r.l)(this._min,this._max)},n.toUniform=function(e){return new Float32Array([4,this._min,this._max,0])},n.map=function(e){return this._min=e(this._min),this._max=e(this._max),this},t}(l),_=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(e){this._min=e[0],this._max=e[1]},n.getValue=function(e){for(var t=this._min,n=this._max,r=[],i=0;i<t.length;i++){var a=Math.random();r[i]=t[i]*(1-a)+n[i]*a}return r},n.map=function(e){return this._min=this._min.map(e),this._max=this._max.map(e),this},t}(l),m=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(e){this._min=e[0],this._max=e[1],this._xCoord=1},n.getValue=function(e){return e/=this._xCoord,this._min*(1-e)+this._max*e},n.toUniform=function(){return new Float32Array([1,this._min,this._max,this._xCoord])},n.getIntegrateValue=function(e,t,n){var r=this._min,i=this._max,a=this._xCoord*(n||1);return((r+t/a*(i-r)+r)*t-(r+e/a*(i-r)+r)*e)/2},n.getIntegrateByTime=function(e,t){return x(t,0,this._xCoord,this._min,this._max)-x(e,0,this._xCoord,this._min,this._max)},n.map=function(e){return this._min=e(this._min),this._max=e(this._max),this},n.scaleXCoord=function(e){return this._xCoord=e,this},t}(l),p=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(e){this.stops=Object(i.a)(e,!0)},n.getValue=function(e){for(var t=this.stops,n=t.length-1,r=0;r<n;r++){var a=t[r],o=t[r+1];if(a.stop<=e&&o.stop>e){var s=(e-a.stop)/(o.stop-a.stop);return Object(i.f)(a.color,o.color,s,!0)}}return n.color.slice()},t}(l),v=function(e){function t(){return e.apply(this,arguments)||this}a(t,e),t.getAllData=function(e){for(var t=new Float32Array(4*e.index),n=0,r=0,i=e.curves;n<i.length;n++){var a=i[n].toData();t.set(a,r),r+=a.length}return t};var n=t.prototype;return n.onCreate=function(e){var t=1/0,n=-1/0;if(Number.isFinite(e[0])&&Number.isFinite(e[1])){for(var i=[],a=2;a<e.length;a++)i.push(e[a].slice(0,4));this.keys=i,this.min=e[0],this.dist=e[1]-e[0]}else{for(var o=this.keys=e.map((function(e){if(e instanceof Array)return t=Math.min(t,e[1]),n=Math.max(n,e[1]),e.slice(0,4);if(Object(r.g)(e))return t=Math.min(t,e.value),n=Math.max(n,e.value),[e.time,e.value,e.inTangent||0,e.outTangent||0];throw Error("invalid keyframe")})),s=n-t,u=0;u<o.length;u++){var c=o[u];c[1]=(c[1]-t)/s}this.min=t,this.dist=s}this.isCurveValue=!0},n.getValue=function(e){var t=this.keys,n=this.min,r=this.dist;if(e<=t[0][0])return t[0][1]*r+n;for(var i=t.length-1,a=0;a<i;a++){var o=t[a],s=t[a+1];if(e>o[0]&&e<=s[0])return A(e,o,s)*r+n}return t[i][1]*r+n},n.getIntegrateByTime=function(e,t){var n=this._integrate(t,!0)-this._integrate(e,!0);return this.min+n*this.dist},n.getIntegrateValue=function(e,t,n){n=n||1;var r=(this._integrate(t/n,!1)-this._integrate(e/n,!1))*n;return this.min+r*this.dist},n._integrate=function(e,t){var n=this.keys;if(e<=n[0][0])return 0;for(var r=0,i=n.length-1,a=t?b:O,o=0;o<i;o++){var s=n[o],u=n[o+1],c=s[0],l=u[0];if(e>c&&e<=l)return r+a(e,s,u);r+=a(l,s,u)}return r},n.toData=function(){for(var e=this.keys,t=new Float32Array(4*e.length),n=0,r=0;n<e.length;n++,r+=4)t.set(e[n],r);return t},n.toUniform=function(e){var t=e.index,n=this.keys;return e.curves.push(this),e.index+=n.length,e.max=Math.max(e.max,n.length),e.curveCount+=n.length,new Float32Array([2,t+1/n.length,this.min,this.dist])},n.map=function(e){return this.keys.forEach((function(t){t[1]=e(t[1])})),this},n.scaleXCoord=function(e){return this.keys.forEach((function(t){return t[0]=e*t[0]})),this},t}(l),g=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(e){this.keys=e.map((function(e){return e.slice?e.slice(0,2):[e.time,e.value]})).sort((function(e,t){return e[0]-t[0]})),this.isLineSeg=!0},n.getValue=function(e){var t=this.keys;if(e<t[0][0])return t[0][1];for(var n=t.length-1,r=0;r<n;r++){var i=t[r],a=t[r+1],o=i[0],s=a[0];if(e>=o&&e<=s){var u=(e-o)/(s-o),c=i[1];return c+u*(a[1]-c)}}return t[n][1]},n.getIntegrateValue=function(e,t,n){return this._integrate(t,!1,n)-this._integrate(e,!1,n)},n.getIntegrateByTime=function(e,t){return this._integrate(t,!0)-this._integrate(e,!0)},n._integrate=function(e,t,n){var r=this.keys;if(e<=r[0][0])return 0;n=n||1;for(var i=0,a=r.length-1,o=t?x:T,s=0;s<a;s++){var u=r[s],c=r[s+1],l=u[0]*n,f=c[0]*n;if(e>l&&e<=f)return i+o(e,l,f,u[1],c[1]);i+=o(f,l,f,u[1],c[1])}return i},n.toData=function(){for(var e=this.keys,t=new Float32Array(4*Math.ceil(e.length/2)),n=0,r=0;n<e.length;n++,r+=2)t.set(e[n],r);return t.set(e[e.length-1],t.length-2),t},n.toUniform=function(e){var t=e.index,n=this.keys,r=Math.ceil(n.length/2);return e.lineSegCount+=r,e.curves.push(this),e.index+=r,e.max=Math.max(e.max,r),new Float32Array([3,t,r,0])},n.map=function(e){return this.keys.forEach((function(t){return t[1]=e(t[1])})),this},n.scaleXCoord=function(e){return this.keys.forEach((function(t){return t[0]=e*t[0]})),this},t}(l),y=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(e){this.keys=e[0],this.values=e[1]},n.getValue=function(e){for(var t=this.keys,n=this.values,r=0;r<t.length-1;r++){var i=t[r],a=t[r+1];if(i[0]<=e&&a[0]>=e){var o=(A(e,i,a)-i[1])/(a[1]-i[1]);return this._calculateVec(r,o)}}return e<=0?n[0].slice():n[n.length-1].slice()},n._calculateVec=function(e,t){for(var n=this.values[e],r=this.values[e+1],i=[],a=0;a<n.length;a++)i[a]=n[a]*(1-t)+r[a]*t;return i},t}(l),E=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onCreate=function(t){e.prototype.onCreate.call(this,t),this.cps=t[2]},n._calculateVec=function(e,t){for(var n=this.values[e],r=this.values[e+1],i=this.cps[e+e],a=this.cps[e+e+1],o=[],s=1-t,u=s*s*s,c=3*t*s*s,l=3*t*t*s,f=t*t*t,h=0;h<n.length;h++)o[h]=u*n[h]+c*i[h]+l*a[h]+f*r[h];return o},t}(y);function T(e,t,n,r,i){var a=e-t;return(r+r+(i-r)*a/(n-t))*a/2}function x(e,t,n,r,i){var a=e*e,o=t*t;return(2*(a*e)*(r-i)+3*a*(t*i-n*r)-o*t*(2*r+i)+3*o*n*r)/(6*(t-n))}function A(e,t,n){var r=n[0]-t[0],i=t[3]*r,a=n[2]*r,o=(e-t[0])/r,s=o*o,u=s*o,c=u-2*s+o,l=u-s,f=-2*u+3*s;return(2*u-3*s+1)*t[1]+c*i+l*a+f*n[1]}function O(e,t,n){var r=n[0]-t[0],i=t[3]*r,a=n[2]*r,o=t[0],s=t[1],u=n[1],c=o-e,l=c*c,f=l*c;return(i+a+2*s-2*u)*f*c/(4*r*r*r)+(2*i+a+3*s-3*u)*f/(3*r*r)+i*l/2/r-s*c}function b(e,t,n){var r=n[0]-t[0],i=t[3]*r,a=n[2]*r,o=t[0],s=t[1],u=n[1],c=o-e,l=c*c,f=l*c,h=r*r,d=h*r;return(-30*d*s*(o+e)*c+10*h*i*(o+2*e)*l+5*r*(o+3*e)*(2*i+a+3*s-3*u)*f+3*(o+4*e)*(i+a+2*s-2*u)*f*c)/60/d}function M(){return{curves:[],index:0,max:0,lineSegCount:0,curveCount:0}}},function(e,t){
/*!
 * Hilo3d 1.15.18
 * Copyright (c) 2017-present Alibaba Group Holding Ltd.
 * @license MIT
 */
window.Hilo3d=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=113)}([function(e,t,n){
/*!
  @fileoverview gl-matrix - High performance matrix and vector operations
  @author Brandon Jones
  @author Colin MacKenzie IV
  @version 2.7.0

  Copyright (c) 2015-2018, Brandon Jones, Colin MacKenzie IV.

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
  THE SOFTWARE.

  */
"undefined"!=typeof self&&self,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=function(e){t.ARRAY_TYPE=e},t.toRadian=function(e){return e*i},t.equals=function(e,t){return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))};var r=t.EPSILON=1e-6;t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,t.RANDOM=Math.random;var i=Math.PI/180},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=i,t.clone=function(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,n,i){var a=new r.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=i,a},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},t.subtract=a,t.multiply=o,t.divide=s,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},t.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},t.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},t.distance=u,t.squaredDistance=c,t.length=l,t.squaredLength=f,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=a*o),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e[3]=s+r*(n[3]-s),e},t.random=function(e,t){var n,i,a,o,s,u;t=t||1;do{s=(n=2*r.RANDOM()-1)*n+(i=2*r.RANDOM()-1)*i}while(s>=1);do{u=(a=2*r.RANDOM()-1)*a+(o=2*r.RANDOM()-1)*o}while(u>=1);var c=Math.sqrt((1-s)/u);return e[0]=t*n,e[1]=t*i,e[2]=t*a*c,e[3]=t*o*c,e},t.transformMat4=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e},t.transformQuat=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2],c=n[3],l=c*r+s*a-u*i,f=c*i+u*r-o*a,h=c*a+o*i-s*r,d=-o*r-s*i-u*a;return e[0]=l*c+d*-o+f*-u-h*-s,e[1]=f*c+d*-s+h*-o-l*-u,e[2]=h*c+d*-u+l*-s-f*-o,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],s=t[0],u=t[1],c=t[2],l=t[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-c)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-l)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function i(){var e=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function a(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function o(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function s(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function u(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+a*a)}function c(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a}function l(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function f(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}t.sub=a,t.mul=o,t.div=s,t.dist=u,t.sqrDist=c,t.len=l,t.sqrLen=f,t.forEach=function(){var e=i();return function(t,n,r,i,a,o){var s,u=void 0;for(n||(n=4),r||(r=0),s=i?Math.min(i*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],a(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=i,t.clone=function(e){var t=new r.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=a,t.fromValues=o,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},t.subtract=s,t.multiply=u,t.divide=c,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},t.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},t.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},t.distance=l,t.squaredDistance=f,t.squaredLength=h,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=d,t.dot=_,t.cross=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e},t.lerp=function(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e},t.hermite=function(e,t,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,c=o*(a-1),l=o*(3-2*a);return e[0]=t[0]*s+n[0]*u+r[0]*c+i[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+i[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+i[2]*l,e},t.bezier=function(e,t,n,r,i,a){var o=1-a,s=o*o,u=a*a,c=s*o,l=3*a*s,f=3*u*o,h=u*a;return e[0]=t[0]*c+n[0]*l+r[0]*f+i[0]*h,e[1]=t[1]*c+n[1]*l+r[1]*f+i[1]*h,e[2]=t[2]*c+n[2]*l+r[2]*f+i[2]*h,e},t.random=function(e,t){t=t||1;var n=2*r.RANDOM()*Math.PI,i=2*r.RANDOM()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=i*t,e},t.transformMat4=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e},t.transformMat3=function(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e},t.transformQuat=function(e,t,n){var r=n[0],i=n[1],a=n[2],o=n[3],s=t[0],u=t[1],c=t[2],l=i*c-a*u,f=a*s-r*c,h=r*u-i*s,d=i*h-a*f,_=a*l-r*h,m=r*f-i*l,p=2*o;return l*=p,f*=p,h*=p,d*=2,_*=2,m*=2,e[0]=s+l+d,e[1]=u+f+_,e[2]=c+h+m,e},t.rotateX=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.rotateY=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.rotateZ=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.angle=function(e,t){var n=o(e[0],e[1],e[2]),r=o(t[0],t[1],t[2]);d(n,n),d(r,r);var i=_(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=t[0],s=t[1],u=t[2];return Math.abs(n-o)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function i(){var e=new r.ARRAY_TYPE(3);return r.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function a(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function o(e,t,n){var i=new r.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=n,i}function s(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function u(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function c(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function l(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function f(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function h(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function d(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function _(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}t.sub=s,t.mul=u,t.div=c,t.dist=l,t.sqrDist=f,t.len=a,t.sqrLen=h,t.forEach=function(){var e=i();return function(t,n,r,i,a,o){var s,u=void 0;for(n||(n=3),r||(r=0),s=i?Math.min(i*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],a(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setAxes=t.sqlerp=t.rotationTo=t.equals=t.exactEquals=t.normalize=t.sqrLen=t.squaredLength=t.len=t.length=t.lerp=t.dot=t.scale=t.mul=t.add=t.set=t.copy=t.fromValues=t.clone=void 0,t.create=u,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=c,t.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>r.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},t.multiply=l,t.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=a*u-i*s,e[3]=o*u-r*s,e},t.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u-a*s,e[1]=i*u+o*s,e[2]=a*u+r*s,e[3]=o*u-i*s,e},t.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+i*s,e[1]=i*u-r*s,e[2]=a*u+o*s,e[3]=o*u-a*s,e},t.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},t.slerp=f,t.random=function(e){var t=r.RANDOM(),n=r.RANDOM(),i=r.RANDOM(),a=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=a*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=h,t.fromEuler=function(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return e[0]=a*u*l-o*s*c,e[1]=o*s*l+a*u*c,e[2]=o*u*c-a*s*l,e[3]=o*u*l+a*s*c,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var r=s(n(0)),i=s(n(5)),a=s(n(2)),o=s(n(1));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function u(){var e=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function c(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function l(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+o*s+i*c-a*u,e[1]=i*l+o*u+a*s-r*c,e[2]=a*l+o*c+r*u-i*s,e[3]=o*l-r*s-i*u-a*c,e}function f(e,t,n,i){var a=t[0],o=t[1],s=t[2],u=t[3],c=n[0],l=n[1],f=n[2],h=n[3],d=void 0,_=void 0,m=void 0,p=void 0,v=void 0;return(_=a*c+o*l+s*f+u*h)<0&&(_=-_,c=-c,l=-l,f=-f,h=-h),1-_>r.EPSILON?(d=Math.acos(_),m=Math.sin(d),p=Math.sin((1-i)*d)/m,v=Math.sin(i*d)/m):(p=1-i,v=i),e[0]=p*a+v*c,e[1]=p*o+v*l,e[2]=p*s+v*f,e[3]=p*u+v*h,e}function h(e,t){var n=t[0]+t[4]+t[8],r=void 0;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*a+o]-t[3*o+a])*r,e[a]=(t[3*a+i]+t[3*i+a])*r,e[o]=(t[3*o+i]+t[3*i+o])*r}return e}t.clone=o.clone,t.fromValues=o.fromValues,t.copy=o.copy,t.set=o.set,t.add=o.add,t.mul=l,t.scale=o.scale,t.dot=o.dot,t.lerp=o.lerp;var d=t.length=o.length,_=(t.len=d,t.squaredLength=o.squaredLength),m=(t.sqrLen=_,t.normalize=o.normalize);t.exactEquals=o.exactEquals,t.equals=o.equals,t.rotationTo=function(){var e=a.create(),t=a.fromValues(1,0,0),n=a.fromValues(0,1,0);return function(r,i,o){var s=a.dot(i,o);return s<-.999999?(a.cross(e,t,i),a.len(e)<1e-6&&a.cross(e,n,i),a.normalize(e,e),c(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(a.cross(e,i,o),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,m(r,r))}}(),t.sqlerp=function(){var e=u(),t=u();return function(n,r,i,a,o,s){return f(e,r,o,s),f(t,i,a,s),f(n,e,t,2*s*(1-s)),n}}(),t.setAxes=function(){var e=i.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],m(t,h(t,e))}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new r.ARRAY_TYPE(16);return r.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},t.clone=function(e){var t=new r.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,n,i,a,o,s,u,c,l,f,h,d,_,m,p){var v=new r.ARRAY_TYPE(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=i,v[4]=a,v[5]=o,v[6]=s,v[7]=u,v[8]=c,v[9]=l,v[10]=f,v[11]=h,v[12]=d,v[13]=_,v[14]=m,v[15]=p,v},t.set=function(e,t,n,r,i,a,o,s,u,c,l,f,h,d,_,m,p){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=h,e[12]=d,e[13]=_,e[14]=m,e[15]=p,e},t.identity=i,t.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],_=t[12],m=t[13],p=t[14],v=t[15],g=n*s-r*o,y=n*u-i*o,E=n*c-a*o,T=r*u-i*s,x=r*c-a*s,A=i*c-a*u,O=l*m-f*_,b=l*p-h*_,M=l*v-d*_,S=f*p-h*m,R=f*v-d*m,L=h*v-d*p,C=g*L-y*R+E*S+T*M-x*b+A*O;return C?(C=1/C,e[0]=(s*L-u*R+c*S)*C,e[1]=(i*R-r*L-a*S)*C,e[2]=(m*A-p*x+v*T)*C,e[3]=(h*x-f*A-d*T)*C,e[4]=(u*M-o*L-c*b)*C,e[5]=(n*L-i*M+a*b)*C,e[6]=(p*E-_*A-v*y)*C,e[7]=(l*A-h*E+d*y)*C,e[8]=(o*R-s*M+c*O)*C,e[9]=(r*M-n*R-a*O)*C,e[10]=(_*x-m*E+v*g)*C,e[11]=(f*E-l*x-d*g)*C,e[12]=(s*b-o*S-u*O)*C,e[13]=(n*S-r*b+i*O)*C,e[14]=(m*y-_*T-p*g)*C,e[15]=(l*T-f*y+h*g)*C,e):null},t.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],_=t[12],m=t[13],p=t[14],v=t[15];return e[0]=s*(h*v-d*p)-f*(u*v-c*p)+m*(u*d-c*h),e[1]=-(r*(h*v-d*p)-f*(i*v-a*p)+m*(i*d-a*h)),e[2]=r*(u*v-c*p)-s*(i*v-a*p)+m*(i*c-a*u),e[3]=-(r*(u*d-c*h)-s*(i*d-a*h)+f*(i*c-a*u)),e[4]=-(o*(h*v-d*p)-l*(u*v-c*p)+_*(u*d-c*h)),e[5]=n*(h*v-d*p)-l*(i*v-a*p)+_*(i*d-a*h),e[6]=-(n*(u*v-c*p)-o*(i*v-a*p)+_*(i*c-a*u)),e[7]=n*(u*d-c*h)-o*(i*d-a*h)+l*(i*c-a*u),e[8]=o*(f*v-d*m)-l*(s*v-c*m)+_*(s*d-c*f),e[9]=-(n*(f*v-d*m)-l*(r*v-a*m)+_*(r*d-a*f)),e[10]=n*(s*v-c*m)-o*(r*v-a*m)+_*(r*c-a*s),e[11]=-(n*(s*d-c*f)-o*(r*d-a*f)+l*(r*c-a*s)),e[12]=-(o*(f*p-h*m)-l*(s*p-u*m)+_*(s*h-u*f)),e[13]=n*(f*p-h*m)-l*(r*p-i*m)+_*(r*h-i*f),e[14]=-(n*(s*p-u*m)-o*(r*p-i*m)+_*(r*u-i*s)),e[15]=n*(s*h-u*f)-o*(r*h-i*f)+l*(r*u-i*s),e},t.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11],d=e[12],_=e[13],m=e[14],p=e[15];return(t*o-n*a)*(f*p-h*m)-(t*s-r*a)*(l*p-h*_)+(t*u-i*a)*(l*m-f*_)+(n*s-r*o)*(c*p-h*d)-(n*u-i*o)*(c*m-f*d)+(r*u-i*s)*(c*_-l*d)},t.multiply=a,t.translate=function(e,t,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,d=void 0,_=void 0,m=void 0,p=void 0,v=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],c=t[3],l=t[4],f=t[5],h=t[6],d=t[7],_=t[8],m=t[9],p=t[10],v=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=c,e[4]=l,e[5]=f,e[6]=h,e[7]=d,e[8]=_,e[9]=m,e[10]=p,e[11]=v,e[12]=o*r+l*i+_*a+t[12],e[13]=s*r+f*i+m*a+t[13],e[14]=u*r+h*i+p*a+t[14],e[15]=c*r+d*i+v*a+t[15]),e},t.scale=function(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,n,i){var a,o,s,u,c,l,f,h,d,_,m,p,v,g,y,E,T,x,A,O,b,M,S,R,L=i[0],C=i[1],I=i[2],w=Math.sqrt(L*L+C*C+I*I);return w<r.EPSILON?null:(L*=w=1/w,C*=w,I*=w,a=Math.sin(n),s=1-(o=Math.cos(n)),u=t[0],c=t[1],l=t[2],f=t[3],h=t[4],d=t[5],_=t[6],m=t[7],p=t[8],v=t[9],g=t[10],y=t[11],E=L*L*s+o,T=C*L*s+I*a,x=I*L*s-C*a,A=L*C*s-I*a,O=C*C*s+o,b=I*C*s+L*a,M=L*I*s+C*a,S=C*I*s-L*a,R=I*I*s+o,e[0]=u*E+h*T+p*x,e[1]=c*E+d*T+v*x,e[2]=l*E+_*T+g*x,e[3]=f*E+m*T+y*x,e[4]=u*A+h*O+p*b,e[5]=c*A+d*O+v*b,e[6]=l*A+_*O+g*b,e[7]=f*A+m*O+y*b,e[8]=u*M+h*S+p*R,e[9]=c*M+d*S+v*R,e[10]=l*M+_*S+g*R,e[11]=f*M+m*S+y*R,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+c*r,e[5]=o*i+l*r,e[6]=s*i+f*r,e[7]=u*i+h*r,e[8]=c*i-a*r,e[9]=l*i-o*r,e[10]=f*i-s*r,e[11]=h*i-u*r,e},t.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-c*r,e[1]=o*i-l*r,e[2]=s*i-f*r,e[3]=u*i-h*r,e[8]=a*r+c*i,e[9]=o*r+l*i,e[10]=s*r+f*i,e[11]=u*r+h*i,e},t.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+c*r,e[1]=o*i+l*r,e[2]=s*i+f*r,e[3]=u*i+h*r,e[4]=c*i-a*r,e[5]=l*i-o*r,e[6]=f*i-s*r,e[7]=h*i-u*r,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,n){var i,a,o,s=n[0],u=n[1],c=n[2],l=Math.sqrt(s*s+u*u+c*c);return l<r.EPSILON?null:(s*=l=1/l,u*=l,c*=l,i=Math.sin(t),o=1-(a=Math.cos(t)),e[0]=s*s*o+a,e[1]=u*s*o+c*i,e[2]=c*s*o-u*i,e[3]=0,e[4]=s*u*o-c*i,e[5]=u*u*o+a,e[6]=c*u*o+s*i,e[7]=0,e[8]=s*c*o+u*i,e[9]=u*c*o-s*i,e[10]=c*c*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=o,t.fromQuat2=function(e,t){var n=new r.ARRAY_TYPE(3),i=-t[0],a=-t[1],s=-t[2],u=t[3],c=t[4],l=t[5],f=t[6],h=t[7],d=i*i+a*a+s*s+u*u;return d>0?(n[0]=2*(c*u+h*i+l*s-f*a)/d,n[1]=2*(l*u+h*a+f*i-c*s)/d,n[2]=2*(f*u+h*s+c*a-l*i)/d):(n[0]=2*(c*u+h*i+l*s-f*a),n[1]=2*(l*u+h*a+f*i-c*s),n[2]=2*(f*u+h*s+c*a-l*i)),o(e,t,n),e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(u*u+c*c+l*l),e},t.getRotation=function(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e},t.fromRotationTranslationScale=function(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,c=a+a,l=o+o,f=i*u,h=i*c,d=i*l,_=a*c,m=a*l,p=o*l,v=s*u,g=s*c,y=s*l,E=r[0],T=r[1],x=r[2];return e[0]=(1-(_+p))*E,e[1]=(h+y)*E,e[2]=(d-g)*E,e[3]=0,e[4]=(h-y)*T,e[5]=(1-(f+p))*T,e[6]=(m+v)*T,e[7]=0,e[8]=(d+g)*x,e[9]=(m-v)*x,e[10]=(1-(f+_))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,n,r,i){var a=t[0],o=t[1],s=t[2],u=t[3],c=a+a,l=o+o,f=s+s,h=a*c,d=a*l,_=a*f,m=o*l,p=o*f,v=s*f,g=u*c,y=u*l,E=u*f,T=r[0],x=r[1],A=r[2],O=i[0],b=i[1],M=i[2],S=(1-(m+v))*T,R=(d+E)*T,L=(_-y)*T,C=(d-E)*x,I=(1-(h+v))*x,w=(p+g)*x,P=(_+y)*A,N=(p-g)*A,F=(1-(h+m))*A;return e[0]=S,e[1]=R,e[2]=L,e[3]=0,e[4]=C,e[5]=I,e[6]=w,e[7]=0,e[8]=P,e[9]=N,e[10]=F,e[11]=0,e[12]=n[0]+O-(S*O+C*b+P*M),e[13]=n[1]+b-(R*O+I*b+N*M),e[14]=n[2]+M-(L*O+w*b+F*M),e[15]=1,e},t.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,c=n*o,l=r*o,f=r*s,h=i*o,d=i*s,_=i*u,m=a*o,p=a*s,v=a*u;return e[0]=1-f-_,e[1]=l+v,e[2]=h-p,e[3]=0,e[4]=l-v,e[5]=1-c-_,e[6]=d+m,e[7]=0,e[8]=h+p,e[9]=d-m,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,n,r,i,a,o){var s=1/(n-t),u=1/(i-r),c=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(o+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*c,e[15]=0,e},t.perspective=function(e,t,n,r,i){var a=1/Math.tan(t/2),o=void 0;return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e},t.perspectiveFromFieldOfView=function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),c=2/(i+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(i-a)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},t.ortho=function(e,t,n,r,i,a,o){var s=1/(t-n),u=1/(r-i),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(o+a)*c,e[15]=1,e},t.lookAt=function(e,t,n,a){var o=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,d=void 0,_=void 0,m=void 0,p=t[0],v=t[1],g=t[2],y=a[0],E=a[1],T=a[2],x=n[0],A=n[1],O=n[2];return Math.abs(p-x)<r.EPSILON&&Math.abs(v-A)<r.EPSILON&&Math.abs(g-O)<r.EPSILON?i(e):(h=p-x,d=v-A,_=g-O,o=E*(_*=m=1/Math.sqrt(h*h+d*d+_*_))-T*(d*=m),s=T*(h*=m)-y*_,u=y*d-E*h,(m=Math.sqrt(o*o+s*s+u*u))?(o*=m=1/m,s*=m,u*=m):(o=0,s=0,u=0),c=d*u-_*s,l=_*o-h*u,f=h*s-d*o,(m=Math.sqrt(c*c+l*l+f*f))?(c*=m=1/m,l*=m,f*=m):(c=0,l=0,f=0),e[0]=o,e[1]=c,e[2]=h,e[3]=0,e[4]=s,e[5]=l,e[6]=d,e[7]=0,e[8]=u,e[9]=f,e[10]=_,e[11]=0,e[12]=-(o*p+s*v+u*g),e[13]=-(c*p+l*v+f*g),e[14]=-(h*p+d*v+_*g),e[15]=1,e)},t.targetTo=function(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=r[0],u=r[1],c=r[2],l=i-n[0],f=a-n[1],h=o-n[2],d=l*l+f*f+h*h;d>0&&(l*=d=1/Math.sqrt(d),f*=d,h*=d);var _=u*h-c*f,m=c*l-s*h,p=s*f-u*l;return(d=_*_+m*m+p*p)>0&&(_*=d=1/Math.sqrt(d),m*=d,p*=d),e[0]=_,e[1]=m,e[2]=p,e[3]=0,e[4]=f*p-h*m,e[5]=h*_-l*p,e[6]=l*m-f*_,e[7]=0,e[8]=l,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},t.subtract=s,t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},t.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=e[9],d=e[10],_=e[11],m=e[12],p=e[13],v=e[14],g=e[15],y=t[0],E=t[1],T=t[2],x=t[3],A=t[4],O=t[5],b=t[6],M=t[7],S=t[8],R=t[9],L=t[10],C=t[11],I=t[12],w=t[13],P=t[14],N=t[15];return Math.abs(n-y)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-E)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-T)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(o-x)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-A)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-O)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(c-b)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(l-M)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(f-S)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(h-R)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(d-L)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(_-C)<=r.EPSILON*Math.max(1,Math.abs(_),Math.abs(C))&&Math.abs(m-I)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(p-w)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(w))&&Math.abs(v-P)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(g-N)<=r.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function a(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],_=t[11],m=t[12],p=t[13],v=t[14],g=t[15],y=n[0],E=n[1],T=n[2],x=n[3];return e[0]=y*r+E*s+T*f+x*m,e[1]=y*i+E*u+T*h+x*p,e[2]=y*a+E*c+T*d+x*v,e[3]=y*o+E*l+T*_+x*g,y=n[4],E=n[5],T=n[6],x=n[7],e[4]=y*r+E*s+T*f+x*m,e[5]=y*i+E*u+T*h+x*p,e[6]=y*a+E*c+T*d+x*v,e[7]=y*o+E*l+T*_+x*g,y=n[8],E=n[9],T=n[10],x=n[11],e[8]=y*r+E*s+T*f+x*m,e[9]=y*i+E*u+T*h+x*p,e[10]=y*a+E*c+T*d+x*v,e[11]=y*o+E*l+T*_+x*g,y=n[12],E=n[13],T=n[14],x=n[15],e[12]=y*r+E*s+T*f+x*m,e[13]=y*i+E*u+T*h+x*p,e[14]=y*a+E*c+T*d+x*v,e[15]=y*o+E*l+T*_+x*g,e}function o(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,u=i+i,c=a+a,l=r*s,f=r*u,h=r*c,d=i*u,_=i*c,m=a*c,p=o*s,v=o*u,g=o*c;return e[0]=1-(d+m),e[1]=f+g,e[2]=h-v,e[3]=0,e[4]=f-g,e[5]=1-(l+m),e[6]=_+p,e[7]=0,e[8]=h+v,e[9]=_-p,e[10]=1-(l+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function s(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}t.mul=a,t.sub=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){var t=new r.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,n,i,a,o,s,u,c){var l=new r.ARRAY_TYPE(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=i,l[4]=a,l[5]=o,l[6]=s,l[7]=u,l[8]=c,l},t.set=function(e,t,n,r,i,a,o,s,u,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=c,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=l*o-s*c,h=-l*a+s*u,d=c*a-o*u,_=n*f+r*h+i*d;return _?(_=1/_,e[0]=f*_,e[1]=(-l*r+i*c)*_,e[2]=(s*r-i*o)*_,e[3]=h*_,e[4]=(l*n-i*u)*_,e[5]=(-s*n+i*a)*_,e[6]=d*_,e[7]=(-c*n+r*u)*_,e[8]=(o*n-r*a)*_,e):null},t.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8];return e[0]=o*l-s*c,e[1]=i*c-r*l,e[2]=r*s-i*o,e[3]=s*u-a*l,e[4]=n*l-i*u,e[5]=i*a-n*s,e[6]=a*c-o*u,e[7]=r*u-n*c,e[8]=n*o-r*a,e},t.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8];return t*(c*a-o*u)+n*(-c*i+o*s)+r*(u*i-a*s)},t.multiply=i,t.translate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=n[0],d=n[1];return e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=h*r+d*o+c,e[7]=h*i+d*s+l,e[8]=h*a+d*u+f,e},t.rotate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=Math.sin(n),d=Math.cos(n);return e[0]=d*r+h*o,e[1]=d*i+h*s,e[2]=d*a+h*u,e[3]=d*o-h*r,e[4]=d*s-h*i,e[5]=d*u-h*a,e[6]=c,e[7]=l,e[8]=f,e},t.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,c=n*o,l=r*o,f=r*s,h=i*o,d=i*s,_=i*u,m=a*o,p=a*s,v=a*u;return e[0]=1-f-_,e[3]=l-v,e[6]=h+p,e[1]=l+v,e[4]=1-c-_,e[7]=d-m,e[2]=h-p,e[5]=d+m,e[8]=1-c-f,e},t.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],_=t[12],m=t[13],p=t[14],v=t[15],g=n*s-r*o,y=n*u-i*o,E=n*c-a*o,T=r*u-i*s,x=r*c-a*s,A=i*c-a*u,O=l*m-f*_,b=l*p-h*_,M=l*v-d*_,S=f*p-h*m,R=f*v-d*m,L=h*v-d*p,C=g*L-y*R+E*S+T*M-x*b+A*O;return C?(C=1/C,e[0]=(s*L-u*R+c*S)*C,e[1]=(u*M-o*L-c*b)*C,e[2]=(o*R-s*M+c*O)*C,e[3]=(i*R-r*L-a*S)*C,e[4]=(n*L-i*M+a*b)*C,e[5]=(r*M-n*R-a*O)*C,e[6]=(m*A-p*x+v*T)*C,e[7]=(p*E-_*A-v*y)*C,e[8]=(_*x-m*E+v*g)*C,e):null},t.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},t.subtract=a,t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},t.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],h=t[0],d=t[1],_=t[2],m=t[3],p=t[4],v=t[5],g=t[6],y=t[7],E=t[8];return Math.abs(n-h)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-d)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-_)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-m)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-p)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-v)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(c-g)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(l-y)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(f-E)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function i(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=n[0],d=n[1],_=n[2],m=n[3],p=n[4],v=n[5],g=n[6],y=n[7],E=n[8];return e[0]=h*r+d*o+_*c,e[1]=h*i+d*s+_*l,e[2]=h*a+d*u+_*f,e[3]=m*r+p*o+v*c,e[4]=m*i+p*s+v*l,e[5]=m*a+p*u+v*f,e[6]=g*r+y*o+E*c,e[7]=g*i+y*s+E*l,e[8]=g*a+y*u+E*f,e}function a(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}t.mul=i,t.sub=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.sqrDist=t.dist=t.div=t.mul=t.sub=t.len=void 0,t.create=i,t.clone=function(e){var t=new r.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=function(e,t){var n=new r.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,n){return e[0]=t,e[1]=n,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},t.subtract=a,t.multiply=o,t.divide=s,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},t.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},t.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},t.distance=u,t.squaredDistance=c,t.length=l,t.squaredLength=f,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},t.lerp=function(e,t,n,r){var i=t[0],a=t[1];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e},t.random=function(e,t){t=t||1;var n=2*r.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},t.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},t.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},t.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},t.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},t.rotate=function(e,t,n,r){var i=t[0]-n[0],a=t[1]-n[1],o=Math.sin(r),s=Math.cos(r);return e[0]=i*s-a*o+n[0],e[1]=i*o+a*s+n[1],e},t.angle=function(e,t){var n=e[0],r=e[1],i=t[0],a=t[1],o=n*n+r*r;o>0&&(o=1/Math.sqrt(o));var s=i*i+a*a;s>0&&(s=1/Math.sqrt(s));var u=(n*i+r*a)*o*s;return u>1?0:u<-1?Math.PI:Math.acos(u)},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){var n=e[0],i=e[1],a=t[0],o=t[1];return Math.abs(n-a)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function i(){var e=new r.ARRAY_TYPE(2);return r.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function a(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function o(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function s(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function u(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function c(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function l(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function f(e){var t=e[0],n=e[1];return t*t+n*n}t.len=l,t.sub=a,t.mul=o,t.div=s,t.dist=u,t.sqrDist=c,t.sqrLen=f,t.forEach=function(){var e=i();return function(t,n,r,i,a,o){var s,u=void 0;for(n||(n=2),r||(r=0),s=i?Math.min(i*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],a(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sqrLen=t.squaredLength=t.len=t.length=t.dot=t.mul=t.setReal=t.getReal=void 0,t.create=function(){var e=new r.ARRAY_TYPE(8);return r.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},t.clone=function(e){var t=new r.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},t.fromValues=function(e,t,n,i,a,o,s,u){var c=new r.ARRAY_TYPE(8);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=a,c[5]=o,c[6]=s,c[7]=u,c},t.fromRotationTranslationValues=function(e,t,n,i,a,o,s){var u=new r.ARRAY_TYPE(8);u[0]=e,u[1]=t,u[2]=n,u[3]=i;var c=.5*a,l=.5*o,f=.5*s;return u[4]=c*i+l*n-f*t,u[5]=l*i+f*e-c*n,u[6]=f*i+c*t-l*e,u[7]=-c*e-l*t-f*n,u},t.fromRotationTranslation=s,t.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},t.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},t.fromMat4=function(e,t){var n=i.create();a.getRotation(n,t);var o=new r.ARRAY_TYPE(3);return a.getTranslation(o,t),s(e,n,o),e},t.copy=u,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},t.set=function(e,t,n,r,i,a,o,s,u){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e},t.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},t.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},t.getTranslation=function(e,t){var n=t[4],r=t[5],i=t[6],a=t[7],o=-t[0],s=-t[1],u=-t[2],c=t[3];return e[0]=2*(n*c+a*o+r*u-i*s),e[1]=2*(r*c+a*s+i*o-n*u),e[2]=2*(i*c+a*u+n*s-r*o),e},t.translate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=.5*n[0],u=.5*n[1],c=.5*n[2],l=t[4],f=t[5],h=t[6],d=t[7];return e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=o*s+i*c-a*u+l,e[5]=o*u+a*s-r*c+f,e[6]=o*c+r*u-i*s+h,e[7]=-r*s-i*u-a*c+d,e},t.rotateX=function(e,t,n){var r=-t[0],a=-t[1],o=-t[2],s=t[3],u=t[4],c=t[5],l=t[6],f=t[7],h=u*s+f*r+c*o-l*a,d=c*s+f*a+l*r-u*o,_=l*s+f*o+u*a-c*r,m=f*s-u*r-c*a-l*o;return i.rotateX(e,t,n),r=e[0],a=e[1],o=e[2],s=e[3],e[4]=h*s+m*r+d*o-_*a,e[5]=d*s+m*a+_*r-h*o,e[6]=_*s+m*o+h*a-d*r,e[7]=m*s-h*r-d*a-_*o,e},t.rotateY=function(e,t,n){var r=-t[0],a=-t[1],o=-t[2],s=t[3],u=t[4],c=t[5],l=t[6],f=t[7],h=u*s+f*r+c*o-l*a,d=c*s+f*a+l*r-u*o,_=l*s+f*o+u*a-c*r,m=f*s-u*r-c*a-l*o;return i.rotateY(e,t,n),r=e[0],a=e[1],o=e[2],s=e[3],e[4]=h*s+m*r+d*o-_*a,e[5]=d*s+m*a+_*r-h*o,e[6]=_*s+m*o+h*a-d*r,e[7]=m*s-h*r-d*a-_*o,e},t.rotateZ=function(e,t,n){var r=-t[0],a=-t[1],o=-t[2],s=t[3],u=t[4],c=t[5],l=t[6],f=t[7],h=u*s+f*r+c*o-l*a,d=c*s+f*a+l*r-u*o,_=l*s+f*o+u*a-c*r,m=f*s-u*r-c*a-l*o;return i.rotateZ(e,t,n),r=e[0],a=e[1],o=e[2],s=e[3],e[4]=h*s+m*r+d*o-_*a,e[5]=d*s+m*a+_*r-h*o,e[6]=_*s+m*o+h*a-d*r,e[7]=m*s-h*r-d*a-_*o,e},t.rotateByQuatAppend=function(e,t,n){var r=n[0],i=n[1],a=n[2],o=n[3],s=t[0],u=t[1],c=t[2],l=t[3];return e[0]=s*o+l*r+u*a-c*i,e[1]=u*o+l*i+c*r-s*a,e[2]=c*o+l*a+s*i-u*r,e[3]=l*o-s*r-u*i-c*a,s=t[4],u=t[5],c=t[6],l=t[7],e[4]=s*o+l*r+u*a-c*i,e[5]=u*o+l*i+c*r-s*a,e[6]=c*o+l*a+s*i-u*r,e[7]=l*o-s*r-u*i-c*a,e},t.rotateByQuatPrepend=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+o*s+i*c-a*u,e[1]=i*l+o*u+a*s-r*c,e[2]=a*l+o*c+r*u-i*s,e[3]=o*l-r*s-i*u-a*c,s=n[4],u=n[5],c=n[6],l=n[7],e[4]=r*l+o*s+i*c-a*u,e[5]=i*l+o*u+a*s-r*c,e[6]=a*l+o*c+r*u-i*s,e[7]=o*l-r*s-i*u-a*c,e},t.rotateAroundAxis=function(e,t,n,i){if(Math.abs(i)<r.EPSILON)return u(e,t);var a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);i*=.5;var o=Math.sin(i),s=o*n[0]/a,c=o*n[1]/a,l=o*n[2]/a,f=Math.cos(i),h=t[0],d=t[1],_=t[2],m=t[3];e[0]=h*f+m*s+d*l-_*c,e[1]=d*f+m*c+_*s-h*l,e[2]=_*f+m*l+h*c-d*s,e[3]=m*f-h*s-d*c-_*l;var p=t[4],v=t[5],g=t[6],y=t[7];return e[4]=p*f+y*s+v*l-g*c,e[5]=v*f+y*c+g*s-p*l,e[6]=g*f+y*l+p*c-v*s,e[7]=y*f-p*s-v*c-g*l,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},t.multiply=c,t.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},t.lerp=function(e,t,n,r){var i=1-r;return l(t,n)<0&&(r=-r),e[0]=t[0]*i+n[0]*r,e[1]=t[1]*i+n[1]*r,e[2]=t[2]*i+n[2]*r,e[3]=t[3]*i+n[3]*r,e[4]=t[4]*i+n[4]*r,e[5]=t[5]*i+n[5]*r,e[6]=t[6]*i+n[6]*r,e[7]=t[7]*i+n[7]*r,e},t.invert=function(e,t){var n=h(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},t.normalize=function(e,t){var n=h(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,i=t[1]/n,a=t[2]/n,o=t[3]/n,s=t[4],u=t[5],c=t[6],l=t[7],f=r*s+i*u+a*c+o*l;e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=(s-r*f)/n,e[5]=(u-i*f)/n,e[6]=(c-a*f)/n,e[7]=(l-o*f)/n}return e},t.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=t[0],h=t[1],d=t[2],_=t[3],m=t[4],p=t[5],v=t[6],g=t[7];return Math.abs(n-f)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-h)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-d)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-_)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-m)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-p)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))&&Math.abs(c-v)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-g)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))};var r=o(n(0)),i=o(n(3)),a=o(n(4));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function s(e,t,n){var r=.5*n[0],i=.5*n[1],a=.5*n[2],o=t[0],s=t[1],u=t[2],c=t[3];return e[0]=o,e[1]=s,e[2]=u,e[3]=c,e[4]=r*c+i*u-a*s,e[5]=i*c+a*o-r*u,e[6]=a*c+r*s-i*o,e[7]=-r*o-i*s-a*u,e}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function c(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[4],u=n[5],c=n[6],l=n[7],f=t[4],h=t[5],d=t[6],_=t[7],m=n[0],p=n[1],v=n[2],g=n[3];return e[0]=r*g+o*m+i*v-a*p,e[1]=i*g+o*p+a*m-r*v,e[2]=a*g+o*v+r*p-i*m,e[3]=o*g-r*m-i*p-a*v,e[4]=r*l+o*s+i*c-a*u+f*g+_*m+h*v-d*p,e[5]=i*l+o*u+a*s-r*c+h*g+_*p+d*m-f*v,e[6]=a*l+o*c+r*u-i*s+d*g+_*v+f*p-h*m,e[7]=o*l-r*s-i*u-a*c+_*g-f*m-h*p-d*v,e}t.getReal=i.copy,t.setReal=i.copy,t.mul=c;var l=t.dot=i.dot,f=t.length=i.length,h=(t.len=f,t.squaredLength=i.squaredLength);t.sqrLen=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new r.ARRAY_TYPE(6);return r.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},t.clone=function(e){var t=new r.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,n,i,a,o){var s=new r.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s[4]=a,s[5]=o,s},t.set=function(e,t,n,r,i,a,o){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=n*a-r*i;return u?(u=1/u,e[0]=a*u,e[1]=-r*u,e[2]=-i*u,e[3]=n*u,e[4]=(i*s-a*o)*u,e[5]=(r*o-n*s)*u,e):null},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=i,t.rotate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=Math.sin(n),l=Math.cos(n);return e[0]=r*l+a*c,e[1]=i*l+o*c,e[2]=r*-c+a*l,e[3]=i*-c+o*l,e[4]=s,e[5]=u,e},t.scale=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=n[0],l=n[1];return e[0]=r*c,e[1]=i*c,e[2]=a*l,e[3]=o*l,e[4]=s,e[5]=u,e},t.translate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=n[0],l=n[1];return e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=r*c+a*l+s,e[5]=i*c+o*l+u,e},t.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},t.subtract=a,t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},t.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=t[0],l=t[1],f=t[2],h=t[3],d=t[4],_=t[5];return Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-f)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-h)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-_)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function i(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=n[0],l=n[1],f=n[2],h=n[3],d=n[4],_=n[5];return e[0]=r*c+a*l,e[1]=i*c+o*l,e[2]=r*f+a*h,e[3]=i*f+o*h,e[4]=r*d+a*_+s,e[5]=i*d+o*_+u,e}function a(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}t.mul=i,t.sub=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},t.clone=function(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.fromValues=function(e,t,n,i){var a=new r.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=i,a},t.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},t.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*a-i*r;return o?(o=1/o,e[0]=a*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},t.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=i,t.rotate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+a*s,e[1]=i*u+o*s,e[2]=r*-s+a*u,e[3]=i*-s+o*u,e},t.scale=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],u=n[1];return e[0]=r*s,e[1]=i*s,e[2]=a*u,e[3]=o*u,e},t.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},t.subtract=a,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],s=t[0],u=t[1],c=t[2],l=t[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-c)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-l)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))},t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},t.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function i(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*s+a*u,e[1]=i*s+o*u,e[2]=r*c+a*l,e[3]=i*c+o*l,e}function a(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}t.mul=i,t.sub=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=t.vec3=t.vec2=t.quat2=t.quat=t.mat4=t.mat3=t.mat2d=t.mat2=t.glMatrix=void 0;var r=d(n(0)),i=d(n(9)),a=d(n(8)),o=d(n(5)),s=d(n(4)),u=d(n(3)),c=d(n(7)),l=d(n(6)),f=d(n(2)),h=d(n(1));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.glMatrix=r,t.mat2=i,t.mat2d=a,t.mat3=o,t.mat4=s,t.quat=u,t.quat2=c,t.vec2=l,t.vec3=f,t.vec4=h}])},function(e,t,n){"use strict";var r=function(){var e,t;try{e=Object.defineProperty,t=Object.defineProperties,e({},"$",{value:0})}catch(n){"__defineGetter__"in Object&&(e=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e},t=function(t,n){for(var r in n)n.hasOwnProperty(r)&&e(t,r,n[r]);return t})}var n=function(e){for(var n=1,r=arguments.length;n<r;n++){var i=arguments[n],a=void 0;for(var o in i){var s=i[o];!s||"object"!=typeof s||void 0===s.value&&"function"!=typeof s.get&&"function"!=typeof s.set?e[o]=s:(a=a||{})[o]=s}a&&t(e,a)}return e},r=function(){if(Object.__proto__)return function(e){return{__proto__:e}};var e=function(){};return function(t){return e.prototype=t,new e}}(),i={Extends:function(e){var t=this.prototype,i=r(e.prototype);n(this,e),n(i,t),i.constructor=this,this.prototype=i,this.superclass=e.prototype},Mixes:function(e){e instanceof Array||(e=[e]);for(var t,r=this.prototype;t=e.shift();)n(r,t.prototype||t)},Statics:function(e){n(this,e)}},a=function(e){var t,r,a={};for(r in e)t=e[r],i.hasOwnProperty(r)?i[r].call(this,t):a[r]=t;n(this.prototype,a)};return{create:function(e){var t=(e=e||{}).hasOwnProperty("constructor")?e.constructor:function(){};return a.call(t,e),t},mix:n}}();t.a=r},function(e,t,n){"use strict";var r={};n.r(r),n.d(r,"ACTIVE_ATTRIBUTES",(function(){return o})),n.d(r,"ACTIVE_ATTRIBUTE_MAX_LENGTH",(function(){return s})),n.d(r,"ACTIVE_TEXTURE",(function(){return u})),n.d(r,"ACTIVE_UNIFORMS",(function(){return c})),n.d(r,"ACTIVE_UNIFORM_MAX_LENGTH",(function(){return l})),n.d(r,"ALIASED_LINE_WIDTH_RANGE",(function(){return f})),n.d(r,"ALIASED_POINT_SIZE_RANGE",(function(){return h})),n.d(r,"ALPHA",(function(){return d})),n.d(r,"ALPHA_BITS",(function(){return _})),n.d(r,"ALWAYS",(function(){return m})),n.d(r,"ARRAY_BUFFER",(function(){return p})),n.d(r,"ARRAY_BUFFER_BINDING",(function(){return v})),n.d(r,"ATTACHED_SHADERS",(function(){return g})),n.d(r,"BACK",(function(){return y})),n.d(r,"BLEND",(function(){return E})),n.d(r,"BLEND_COLOR",(function(){return T})),n.d(r,"BLEND_DST_ALPHA",(function(){return x})),n.d(r,"BLEND_DST_RGB",(function(){return A})),n.d(r,"BLEND_EQUATION",(function(){return O})),n.d(r,"BLEND_EQUATION_ALPHA",(function(){return b})),n.d(r,"BLEND_EQUATION_RGB",(function(){return M})),n.d(r,"BLEND_SRC_ALPHA",(function(){return S})),n.d(r,"BLEND_SRC_RGB",(function(){return R})),n.d(r,"BLUE_BITS",(function(){return L})),n.d(r,"BOOL",(function(){return C})),n.d(r,"BOOL_VEC2",(function(){return I})),n.d(r,"BOOL_VEC3",(function(){return w})),n.d(r,"BOOL_VEC4",(function(){return P})),n.d(r,"BROWSER_DEFAULT_WEBGL",(function(){return N})),n.d(r,"BUFFER_SIZE",(function(){return F})),n.d(r,"BUFFER_USAGE",(function(){return D})),n.d(r,"BYTE",(function(){return U})),n.d(r,"CCW",(function(){return V})),n.d(r,"CLAMP_TO_EDGE",(function(){return B})),n.d(r,"COLOR_ATTACHMENT0",(function(){return H})),n.d(r,"COLOR_BUFFER_BIT",(function(){return z})),n.d(r,"COLOR_CLEAR_VALUE",(function(){return G})),n.d(r,"COLOR_WRITEMASK",(function(){return k})),n.d(r,"COMPILE_STATUS",(function(){return j})),n.d(r,"COMPRESSED_TEXTURE_FORMATS",(function(){return X})),n.d(r,"CONSTANT_ALPHA",(function(){return W})),n.d(r,"CONSTANT_COLOR",(function(){return q})),n.d(r,"CONTEXT_LOST_WEBGL",(function(){return Y})),n.d(r,"CULL_FACE",(function(){return K})),n.d(r,"CULL_FACE_MODE",(function(){return Q})),n.d(r,"CURRENT_PROGRAM",(function(){return Z})),n.d(r,"CURRENT_VERTEX_ATTRIB",(function(){return J})),n.d(r,"CW",(function(){return $})),n.d(r,"DECR",(function(){return ee})),n.d(r,"DECR_WRAP",(function(){return te})),n.d(r,"DELETE_STATUS",(function(){return ne})),n.d(r,"DEPTH_ATTACHMENT",(function(){return re})),n.d(r,"DEPTH_BITS",(function(){return ie})),n.d(r,"DEPTH_BUFFER_BIT",(function(){return ae})),n.d(r,"DEPTH_CLEAR_VALUE",(function(){return oe})),n.d(r,"DEPTH_COMPONENT",(function(){return se})),n.d(r,"DEPTH_COMPONENT16",(function(){return ue})),n.d(r,"DEPTH_FUNC",(function(){return ce})),n.d(r,"DEPTH_RANGE",(function(){return le})),n.d(r,"DEPTH_STENCIL",(function(){return fe})),n.d(r,"DEPTH_STENCIL_ATTACHMENT",(function(){return he})),n.d(r,"DEPTH_TEST",(function(){return de})),n.d(r,"DEPTH_WRITEMASK",(function(){return _e})),n.d(r,"DITHER",(function(){return me})),n.d(r,"DONT_CARE",(function(){return pe})),n.d(r,"DST_ALPHA",(function(){return ve})),n.d(r,"DST_COLOR",(function(){return ge})),n.d(r,"DYNAMIC_DRAW",(function(){return ye})),n.d(r,"ELEMENT_ARRAY_BUFFER",(function(){return Ee})),n.d(r,"ELEMENT_ARRAY_BUFFER_BINDING",(function(){return Te})),n.d(r,"EQUAL",(function(){return xe})),n.d(r,"FASTEST",(function(){return Ae})),n.d(r,"FLOAT",(function(){return Oe})),n.d(r,"FLOAT_MAT2",(function(){return be})),n.d(r,"FLOAT_MAT3",(function(){return Me})),n.d(r,"FLOAT_MAT4",(function(){return Se})),n.d(r,"FLOAT_VEC2",(function(){return Re})),n.d(r,"FLOAT_VEC3",(function(){return Le})),n.d(r,"FLOAT_VEC4",(function(){return Ce})),n.d(r,"FRAGMENT_SHADER",(function(){return Ie})),n.d(r,"FRAMEBUFFER",(function(){return we})),n.d(r,"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",(function(){return Pe})),n.d(r,"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",(function(){return Ne})),n.d(r,"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",(function(){return Fe})),n.d(r,"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",(function(){return De})),n.d(r,"FRAMEBUFFER_BINDING",(function(){return Ue})),n.d(r,"FRAMEBUFFER_COMPLETE",(function(){return Ve})),n.d(r,"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",(function(){return Be})),n.d(r,"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",(function(){return He})),n.d(r,"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",(function(){return ze})),n.d(r,"FRAMEBUFFER_UNSUPPORTED",(function(){return Ge})),n.d(r,"FRONT",(function(){return ke})),n.d(r,"FRONT_AND_BACK",(function(){return je})),n.d(r,"FRONT_FACE",(function(){return Xe})),n.d(r,"FUNC_ADD",(function(){return We})),n.d(r,"FUNC_REVERSE_SUBTRACT",(function(){return qe})),n.d(r,"FUNC_SUBTRACT",(function(){return Ye})),n.d(r,"GENERATE_MIPMAP_HINT",(function(){return Ke})),n.d(r,"GEQUAL",(function(){return Qe})),n.d(r,"GREATER",(function(){return Ze})),n.d(r,"GREEN_BITS",(function(){return Je})),n.d(r,"HIGH_FLOAT",(function(){return $e})),n.d(r,"HIGH_INT",(function(){return et})),n.d(r,"INCR",(function(){return tt})),n.d(r,"INCR_WRAP",(function(){return nt})),n.d(r,"INFO_LOG_LENGTH",(function(){return rt})),n.d(r,"INT",(function(){return it})),n.d(r,"INT_VEC2",(function(){return at})),n.d(r,"INT_VEC3",(function(){return ot})),n.d(r,"INT_VEC4",(function(){return st})),n.d(r,"INVALID_ENUM",(function(){return ut})),n.d(r,"INVALID_FRAMEBUFFER_OPERATION",(function(){return ct})),n.d(r,"INVALID_OPERATION",(function(){return lt})),n.d(r,"INVALID_VALUE",(function(){return ft})),n.d(r,"INVERT",(function(){return ht})),n.d(r,"KEEP",(function(){return dt})),n.d(r,"LEQUAL",(function(){return _t})),n.d(r,"LESS",(function(){return mt})),n.d(r,"LINEAR",(function(){return pt})),n.d(r,"LINEAR_MIPMAP_LINEAR",(function(){return vt})),n.d(r,"LINEAR_MIPMAP_NEAREST",(function(){return gt})),n.d(r,"LINES",(function(){return yt})),n.d(r,"LINE_LOOP",(function(){return Et})),n.d(r,"LINE_STRIP",(function(){return Tt})),n.d(r,"LINE_WIDTH",(function(){return xt})),n.d(r,"LINK_STATUS",(function(){return At})),n.d(r,"LOW_FLOAT",(function(){return Ot})),n.d(r,"LOW_INT",(function(){return bt})),n.d(r,"LUMINANCE",(function(){return Mt})),n.d(r,"LUMINANCE_ALPHA",(function(){return St})),n.d(r,"MAX_COMBINED_TEXTURE_IMAGE_UNITS",(function(){return Rt})),n.d(r,"MAX_CUBE_MAP_TEXTURE_SIZE",(function(){return Lt})),n.d(r,"MAX_FRAGMENT_UNIFORM_VECTORS",(function(){return Ct})),n.d(r,"MAX_RENDERBUFFER_SIZE",(function(){return It})),n.d(r,"MAX_TEXTURE_IMAGE_UNITS",(function(){return wt})),n.d(r,"MAX_TEXTURE_SIZE",(function(){return Pt})),n.d(r,"MAX_VARYING_VECTORS",(function(){return Nt})),n.d(r,"MAX_VERTEX_ATTRIBS",(function(){return Ft})),n.d(r,"MAX_VERTEX_TEXTURE_IMAGE_UNITS",(function(){return Dt})),n.d(r,"MAX_VERTEX_UNIFORM_VECTORS",(function(){return Ut})),n.d(r,"MAX_VIEWPORT_DIMS",(function(){return Vt})),n.d(r,"MEDIUM_FLOAT",(function(){return Bt})),n.d(r,"MEDIUM_INT",(function(){return Ht})),n.d(r,"MIRRORED_REPEAT",(function(){return zt})),n.d(r,"NEAREST",(function(){return Gt})),n.d(r,"NEAREST_MIPMAP_LINEAR",(function(){return kt})),n.d(r,"NEAREST_MIPMAP_NEAREST",(function(){return jt})),n.d(r,"NEVER",(function(){return Xt})),n.d(r,"NICEST",(function(){return Wt})),n.d(r,"NONE",(function(){return qt})),n.d(r,"NOTEQUAL",(function(){return Yt})),n.d(r,"NO_ERROR",(function(){return Kt})),n.d(r,"NUM_COMPRESSED_TEXTURE_FORMATS",(function(){return Qt})),n.d(r,"ONE",(function(){return Zt})),n.d(r,"ONE_MINUS_CONSTANT_ALPHA",(function(){return Jt})),n.d(r,"ONE_MINUS_CONSTANT_COLOR",(function(){return $t})),n.d(r,"ONE_MINUS_DST_ALPHA",(function(){return en})),n.d(r,"ONE_MINUS_DST_COLOR",(function(){return tn})),n.d(r,"ONE_MINUS_SRC_ALPHA",(function(){return nn})),n.d(r,"ONE_MINUS_SRC_COLOR",(function(){return rn})),n.d(r,"OUT_OF_MEMORY",(function(){return an})),n.d(r,"PACK_ALIGNMENT",(function(){return on})),n.d(r,"POINTS",(function(){return sn})),n.d(r,"POLYGON_OFFSET_FACTOR",(function(){return un})),n.d(r,"POLYGON_OFFSET_FILL",(function(){return cn})),n.d(r,"POLYGON_OFFSET_UNITS",(function(){return ln})),n.d(r,"RED_BITS",(function(){return fn})),n.d(r,"RENDERBUFFER",(function(){return hn})),n.d(r,"RENDERBUFFER_ALPHA_SIZE",(function(){return dn})),n.d(r,"RENDERBUFFER_BINDING",(function(){return _n})),n.d(r,"RENDERBUFFER_BLUE_SIZE",(function(){return mn})),n.d(r,"RENDERBUFFER_DEPTH_SIZE",(function(){return pn})),n.d(r,"RENDERBUFFER_GREEN_SIZE",(function(){return vn})),n.d(r,"RENDERBUFFER_HEIGHT",(function(){return gn})),n.d(r,"RENDERBUFFER_INTERNAL_FORMAT",(function(){return yn})),n.d(r,"RENDERBUFFER_RED_SIZE",(function(){return En})),n.d(r,"RENDERBUFFER_STENCIL_SIZE",(function(){return Tn})),n.d(r,"RENDERBUFFER_WIDTH",(function(){return xn})),n.d(r,"RENDERER",(function(){return An})),n.d(r,"REPEAT",(function(){return On})),n.d(r,"REPLACE",(function(){return bn})),n.d(r,"RGB",(function(){return Mn})),n.d(r,"RGB5_A1",(function(){return Sn})),n.d(r,"RGB565",(function(){return Rn})),n.d(r,"RGBA",(function(){return Ln})),n.d(r,"RGBA4",(function(){return Cn})),n.d(r,"SAMPLER_2D",(function(){return In})),n.d(r,"SAMPLER_CUBE",(function(){return wn})),n.d(r,"SAMPLES",(function(){return Pn})),n.d(r,"SAMPLE_ALPHA_TO_COVERAGE",(function(){return Nn})),n.d(r,"SAMPLE_BUFFERS",(function(){return Fn})),n.d(r,"SAMPLE_COVERAGE",(function(){return Dn})),n.d(r,"SAMPLE_COVERAGE_INVERT",(function(){return Un})),n.d(r,"SAMPLE_COVERAGE_VALUE",(function(){return Vn})),n.d(r,"SCISSOR_BOX",(function(){return Bn})),n.d(r,"SCISSOR_TEST",(function(){return Hn})),n.d(r,"SHADER_COMPILER",(function(){return zn})),n.d(r,"SHADER_SOURCE_LENGTH",(function(){return Gn})),n.d(r,"SHADER_TYPE",(function(){return kn})),n.d(r,"SHADING_LANGUAGE_VERSION",(function(){return jn})),n.d(r,"SHORT",(function(){return Xn})),n.d(r,"SRC_ALPHA",(function(){return Wn})),n.d(r,"SRC_ALPHA_SATURATE",(function(){return qn})),n.d(r,"SRC_COLOR",(function(){return Yn})),n.d(r,"STATIC_DRAW",(function(){return Kn})),n.d(r,"STENCIL_ATTACHMENT",(function(){return Qn})),n.d(r,"STENCIL_BACK_FAIL",(function(){return Zn})),n.d(r,"STENCIL_BACK_FUNC",(function(){return Jn})),n.d(r,"STENCIL_BACK_PASS_DEPTH_FAIL",(function(){return $n})),n.d(r,"STENCIL_BACK_PASS_DEPTH_PASS",(function(){return er})),n.d(r,"STENCIL_BACK_REF",(function(){return tr})),n.d(r,"STENCIL_BACK_VALUE_MASK",(function(){return nr})),n.d(r,"STENCIL_BACK_WRITEMASK",(function(){return rr})),n.d(r,"STENCIL_BITS",(function(){return ir})),n.d(r,"STENCIL_BUFFER_BIT",(function(){return ar})),n.d(r,"STENCIL_CLEAR_VALUE",(function(){return or})),n.d(r,"STENCIL_FAIL",(function(){return sr})),n.d(r,"STENCIL_FUNC",(function(){return ur})),n.d(r,"STENCIL_INDEX",(function(){return cr})),n.d(r,"STENCIL_INDEX8",(function(){return lr})),n.d(r,"STENCIL_PASS_DEPTH_FAIL",(function(){return fr})),n.d(r,"STENCIL_PASS_DEPTH_PASS",(function(){return hr})),n.d(r,"STENCIL_REF",(function(){return dr})),n.d(r,"STENCIL_TEST",(function(){return _r})),n.d(r,"STENCIL_VALUE_MASK",(function(){return mr})),n.d(r,"STENCIL_WRITEMASK",(function(){return pr})),n.d(r,"STREAM_DRAW",(function(){return vr})),n.d(r,"SUBPIXEL_BITS",(function(){return gr})),n.d(r,"TEXTURE",(function(){return yr})),n.d(r,"TEXTURE0",(function(){return Er})),n.d(r,"TEXTURE1",(function(){return Tr})),n.d(r,"TEXTURE2",(function(){return xr})),n.d(r,"TEXTURE3",(function(){return Ar})),n.d(r,"TEXTURE4",(function(){return Or})),n.d(r,"TEXTURE5",(function(){return br})),n.d(r,"TEXTURE6",(function(){return Mr})),n.d(r,"TEXTURE7",(function(){return Sr})),n.d(r,"TEXTURE8",(function(){return Rr})),n.d(r,"TEXTURE9",(function(){return Lr})),n.d(r,"TEXTURE10",(function(){return Cr})),n.d(r,"TEXTURE11",(function(){return Ir})),n.d(r,"TEXTURE12",(function(){return wr})),n.d(r,"TEXTURE13",(function(){return Pr})),n.d(r,"TEXTURE14",(function(){return Nr})),n.d(r,"TEXTURE15",(function(){return Fr})),n.d(r,"TEXTURE16",(function(){return Dr})),n.d(r,"TEXTURE17",(function(){return Ur})),n.d(r,"TEXTURE18",(function(){return Vr})),n.d(r,"TEXTURE19",(function(){return Br})),n.d(r,"TEXTURE20",(function(){return Hr})),n.d(r,"TEXTURE21",(function(){return zr})),n.d(r,"TEXTURE22",(function(){return Gr})),n.d(r,"TEXTURE23",(function(){return kr})),n.d(r,"TEXTURE24",(function(){return jr})),n.d(r,"TEXTURE25",(function(){return Xr})),n.d(r,"TEXTURE26",(function(){return Wr})),n.d(r,"TEXTURE27",(function(){return qr})),n.d(r,"TEXTURE28",(function(){return Yr})),n.d(r,"TEXTURE29",(function(){return Kr})),n.d(r,"TEXTURE30",(function(){return Qr})),n.d(r,"TEXTURE31",(function(){return Zr})),n.d(r,"TEXTURE_2D",(function(){return Jr})),n.d(r,"TEXTURE_BINDING_2D",(function(){return $r})),n.d(r,"TEXTURE_BINDING_CUBE_MAP",(function(){return ei})),n.d(r,"TEXTURE_CUBE_MAP",(function(){return ti})),n.d(r,"TEXTURE_CUBE_MAP_NEGATIVE_X",(function(){return ni})),n.d(r,"TEXTURE_CUBE_MAP_NEGATIVE_Y",(function(){return ri})),n.d(r,"TEXTURE_CUBE_MAP_NEGATIVE_Z",(function(){return ii})),n.d(r,"TEXTURE_CUBE_MAP_POSITIVE_X",(function(){return ai})),n.d(r,"TEXTURE_CUBE_MAP_POSITIVE_Y",(function(){return oi})),n.d(r,"TEXTURE_CUBE_MAP_POSITIVE_Z",(function(){return si})),n.d(r,"TEXTURE_MAG_FILTER",(function(){return ui})),n.d(r,"TEXTURE_MIN_FILTER",(function(){return ci})),n.d(r,"TEXTURE_WRAP_S",(function(){return li})),n.d(r,"TEXTURE_WRAP_T",(function(){return fi})),n.d(r,"TRIANGLES",(function(){return hi})),n.d(r,"TRIANGLE_FAN",(function(){return di})),n.d(r,"TRIANGLE_STRIP",(function(){return _i})),n.d(r,"UNPACK_ALIGNMENT",(function(){return mi})),n.d(r,"UNPACK_COLORSPACE_CONVERSION_WEBGL",(function(){return pi})),n.d(r,"UNPACK_FLIP_Y_WEBGL",(function(){return vi})),n.d(r,"UNPACK_PREMULTIPLY_ALPHA_WEBGL",(function(){return gi})),n.d(r,"UNSIGNED_BYTE",(function(){return yi})),n.d(r,"UNSIGNED_INT",(function(){return Ei})),n.d(r,"UNSIGNED_SHORT",(function(){return Ti})),n.d(r,"UNSIGNED_SHORT_4_4_4_4",(function(){return xi})),n.d(r,"UNSIGNED_SHORT_5_5_5_1",(function(){return Ai})),n.d(r,"UNSIGNED_SHORT_5_6_5",(function(){return Oi})),n.d(r,"VALIDATE_STATUS",(function(){return bi})),n.d(r,"VENDOR",(function(){return Mi})),n.d(r,"VERSION",(function(){return Si})),n.d(r,"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",(function(){return Ri})),n.d(r,"VERTEX_ATTRIB_ARRAY_ENABLED",(function(){return Li})),n.d(r,"VERTEX_ATTRIB_ARRAY_NORMALIZED",(function(){return Ci})),n.d(r,"VERTEX_ATTRIB_ARRAY_POINTER",(function(){return Ii})),n.d(r,"VERTEX_ATTRIB_ARRAY_SIZE",(function(){return wi})),n.d(r,"VERTEX_ATTRIB_ARRAY_STRIDE",(function(){return Pi})),n.d(r,"VERTEX_ATTRIB_ARRAY_TYPE",(function(){return Ni})),n.d(r,"VERTEX_SHADER",(function(){return Fi})),n.d(r,"VIEWPORT",(function(){return Di})),n.d(r,"ZERO",(function(){return Ui}));var i={};n.r(i),n.d(i,"VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",(function(){return Vi})),n.d(i,"UNMASKED_VENDOR_WEBGL",(function(){return Bi})),n.d(i,"UNMASKED_RENDERER_WEBGL",(function(){return Hi})),n.d(i,"MAX_TEXTURE_MAX_ANISOTROPY_EXT",(function(){return zi})),n.d(i,"TEXTURE_MAX_ANISOTROPY_EXT",(function(){return Gi})),n.d(i,"COMPRESSED_RGB_S3TC_DXT1_EXT",(function(){return ki})),n.d(i,"COMPRESSED_RGBA_S3TC_DXT1_EXT",(function(){return ji})),n.d(i,"COMPRESSED_RGBA_S3TC_DXT3_EXT",(function(){return Xi})),n.d(i,"COMPRESSED_RGBA_S3TC_DXT5_EXT",(function(){return Wi})),n.d(i,"COMPRESSED_R11_EAC",(function(){return qi})),n.d(i,"COMPRESSED_SIGNED_R11_EAC",(function(){return Yi})),n.d(i,"COMPRESSED_RG11_EAC",(function(){return Ki})),n.d(i,"COMPRESSED_SIGNED_RG11_EAC",(function(){return Qi})),n.d(i,"COMPRESSED_RGB8_ETC2",(function(){return Zi})),n.d(i,"COMPRESSED_RGBA8_ETC2_EAC",(function(){return Ji})),n.d(i,"COMPRESSED_SRGB8_ETC2",(function(){return $i})),n.d(i,"COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",(function(){return ea})),n.d(i,"COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",(function(){return ta})),n.d(i,"COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",(function(){return na})),n.d(i,"COMPRESSED_RGB_PVRTC_4BPPV1_IMG",(function(){return ra})),n.d(i,"COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",(function(){return ia})),n.d(i,"COMPRESSED_RGB_PVRTC_2BPPV1_IMG",(function(){return aa})),n.d(i,"COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",(function(){return oa})),n.d(i,"COMPRESSED_RGB_ETC1_WEBGL",(function(){return sa})),n.d(i,"COMPRESSED_RGB_ATC_WEBGL",(function(){return ua})),n.d(i,"COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",(function(){return ca})),n.d(i,"COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",(function(){return la})),n.d(i,"UNSIGNED_INT_24_8_WEBGL",(function(){return fa})),n.d(i,"HALF_FLOAT_OES",(function(){return ha})),n.d(i,"RGBA32F_EXT",(function(){return da})),n.d(i,"RGB32F_EXT",(function(){return _a})),n.d(i,"FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",(function(){return ma})),n.d(i,"UNSIGNED_NORMALIZED_EXT",(function(){return pa})),n.d(i,"MIN_EXT",(function(){return va})),n.d(i,"MAX_EXT",(function(){return ga})),n.d(i,"SRGB_EXT",(function(){return ya})),n.d(i,"SRGB_ALPHA_EXT",(function(){return Ea})),n.d(i,"SRGB8_ALPHA8_EXT",(function(){return Ta})),n.d(i,"FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",(function(){return xa})),n.d(i,"FRAGMENT_SHADER_DERIVATIVE_HINT_OES",(function(){return Aa})),n.d(i,"COLOR_ATTACHMENT0_WEBGL",(function(){return Oa})),n.d(i,"COLOR_ATTACHMENT1_WEBGL",(function(){return ba})),n.d(i,"COLOR_ATTACHMENT2_WEBGL",(function(){return Ma})),n.d(i,"COLOR_ATTACHMENT3_WEBGL",(function(){return Sa})),n.d(i,"COLOR_ATTACHMENT4_WEBGL",(function(){return Ra})),n.d(i,"COLOR_ATTACHMENT5_WEBGL",(function(){return La})),n.d(i,"COLOR_ATTACHMENT6_WEBGL",(function(){return Ca})),n.d(i,"COLOR_ATTACHMENT7_WEBGL",(function(){return Ia})),n.d(i,"COLOR_ATTACHMENT8_WEBGL",(function(){return wa})),n.d(i,"COLOR_ATTACHMENT9_WEBGL",(function(){return Pa})),n.d(i,"COLOR_ATTACHMENT10_WEBGL",(function(){return Na})),n.d(i,"COLOR_ATTACHMENT11_WEBGL",(function(){return Fa})),n.d(i,"COLOR_ATTACHMENT12_WEBGL",(function(){return Da})),n.d(i,"COLOR_ATTACHMENT13_WEBGL",(function(){return Ua})),n.d(i,"COLOR_ATTACHMENT14_WEBGL",(function(){return Va})),n.d(i,"COLOR_ATTACHMENT15_WEBGL",(function(){return Ba})),n.d(i,"DRAW_BUFFER0_WEBGL",(function(){return Ha})),n.d(i,"DRAW_BUFFER1_WEBGL",(function(){return za})),n.d(i,"DRAW_BUFFER2_WEBGL",(function(){return Ga})),n.d(i,"DRAW_BUFFER3_WEBGL",(function(){return ka})),n.d(i,"DRAW_BUFFER4_WEBGL",(function(){return ja})),n.d(i,"DRAW_BUFFER5_WEBGL",(function(){return Xa})),n.d(i,"DRAW_BUFFER6_WEBGL",(function(){return Wa})),n.d(i,"DRAW_BUFFER7_WEBGL",(function(){return qa})),n.d(i,"DRAW_BUFFER8_WEBGL",(function(){return Ya})),n.d(i,"DRAW_BUFFER9_WEBGL",(function(){return Ka})),n.d(i,"DRAW_BUFFER10_WEBGL",(function(){return Qa})),n.d(i,"DRAW_BUFFER11_WEBGL",(function(){return Za})),n.d(i,"DRAW_BUFFER12_WEBGL",(function(){return Ja})),n.d(i,"DRAW_BUFFER13_WEBGL",(function(){return $a})),n.d(i,"DRAW_BUFFER14_WEBGL",(function(){return eo})),n.d(i,"DRAW_BUFFER15_WEBGL",(function(){return to})),n.d(i,"MAX_COLOR_ATTACHMENTS_WEBGL",(function(){return no})),n.d(i,"MAX_DRAW_BUFFERS_WEBGL",(function(){return ro})),n.d(i,"VERTEX_ARRAY_BINDING_OES",(function(){return io})),n.d(i,"QUERY_COUNTER_BITS_EXT",(function(){return ao})),n.d(i,"CURRENT_QUERY_EXT",(function(){return oo})),n.d(i,"QUERY_RESULT_EXT",(function(){return so})),n.d(i,"QUERY_RESULT_AVAILABLE_EXT",(function(){return uo})),n.d(i,"TIME_ELAPSED_EXT",(function(){return co})),n.d(i,"TIMESTAMP_EXT",(function(){return lo})),n.d(i,"GPU_DISJOINT_EXT",(function(){return fo}));var a={};n.r(a),n.d(a,"POSITION",(function(){return ho})),n.d(a,"NORMAL",(function(){return _o})),n.d(a,"DEPTH",(function(){return mo})),n.d(a,"DISTANCE",(function(){return po}));var o=35721,s=35722,u=34016,c=35718,l=35719,f=33902,h=33901,d=6406,_=3413,m=519,p=34962,v=34964,g=35717,y=1029,E=3042,T=32773,x=32970,A=32968,O=32777,b=34877,M=32777,S=32971,R=32969,L=3412,C=35670,I=35671,w=35672,P=35673,N=37444,F=34660,D=34661,U=5120,V=2305,B=33071,H=36064,z=16384,G=3106,k=3107,j=35713,X=34467,W=32771,q=32769,Y=37442,K=2884,Q=2885,Z=35725,J=34342,$=2304,ee=7683,te=34056,ne=35712,re=36096,ie=3414,ae=256,oe=2931,se=6402,ue=33189,ce=2932,le=2928,fe=34041,he=33306,de=2929,_e=2930,me=3024,pe=4352,ve=772,ge=774,ye=35048,Ee=34963,Te=34965,xe=514,Ae=4353,Oe=5126,be=35674,Me=35675,Se=35676,Re=35664,Le=35665,Ce=35666,Ie=35632,we=36160,Pe=36049,Ne=36048,Fe=36051,De=36050,Ue=36006,Ve=36053,Be=36054,He=36057,ze=36055,Ge=36061,ke=1028,je=1032,Xe=2886,We=32774,qe=32779,Ye=32778,Ke=33170,Qe=518,Ze=516,Je=3411,$e=36338,et=36341,tt=7682,nt=34055,rt=35716,it=5124,at=35667,ot=35668,st=35669,ut=1280,ct=1286,lt=1282,ft=1281,ht=5386,dt=7680,_t=515,mt=513,pt=9729,vt=9987,gt=9985,yt=1,Et=2,Tt=3,xt=2849,At=35714,Ot=36336,bt=36339,Mt=6409,St=6410,Rt=35661,Lt=34076,Ct=36349,It=34024,wt=34930,Pt=3379,Nt=36348,Ft=34921,Dt=35660,Ut=36347,Vt=3386,Bt=36337,Ht=36340,zt=33648,Gt=9728,kt=9986,jt=9984,Xt=512,Wt=4354,qt=0,Yt=517,Kt=0,Qt=34466,Zt=1,Jt=32772,$t=32770,en=773,tn=775,nn=771,rn=769,an=1285,on=3333,sn=0,un=32824,cn=32823,ln=10752,fn=3410,hn=36161,dn=36179,_n=36007,mn=36178,pn=36180,vn=36177,gn=36163,yn=36164,En=36176,Tn=36181,xn=36162,An=7937,On=10497,bn=7681,Mn=6407,Sn=32855,Rn=36194,Ln=6408,Cn=32854,In=35678,wn=35680,Pn=32937,Nn=32926,Fn=32936,Dn=32928,Un=32939,Vn=32938,Bn=3088,Hn=3089,zn=36346,Gn=35720,kn=35663,jn=35724,Xn=5122,Wn=770,qn=776,Yn=768,Kn=35044,Qn=36128,Zn=34817,Jn=34816,$n=34818,er=34819,tr=36003,nr=36004,rr=36005,ir=3415,ar=1024,or=2961,sr=2964,ur=2962,cr=6401,lr=36168,fr=2965,hr=2966,dr=2967,_r=2960,mr=2963,pr=2968,vr=35040,gr=3408,yr=5890,Er=33984,Tr=33985,xr=33986,Ar=33987,Or=33988,br=33989,Mr=33990,Sr=33991,Rr=33992,Lr=33993,Cr=33994,Ir=33995,wr=33996,Pr=33997,Nr=33998,Fr=33999,Dr=34e3,Ur=34001,Vr=34002,Br=34003,Hr=34004,zr=34005,Gr=34006,kr=34007,jr=34008,Xr=34009,Wr=34010,qr=34011,Yr=34012,Kr=34013,Qr=34014,Zr=34015,Jr=3553,$r=32873,ei=34068,ti=34067,ni=34070,ri=34072,ii=34074,ai=34069,oi=34071,si=34073,ui=10240,ci=10241,li=10242,fi=10243,hi=4,di=6,_i=5,mi=3317,pi=37443,vi=37440,gi=37441,yi=5121,Ei=5125,Ti=5123,xi=32819,Ai=32820,Oi=33635,bi=35715,Mi=7936,Si=7938,Ri=34975,Li=34338,Ci=34922,Ii=34373,wi=34339,Pi=34340,Ni=34341,Fi=35633,Di=2978,Ui=0,Vi=35070,Bi=37445,Hi=37446,zi=34047,Gi=34046,ki=33776,ji=33777,Xi=33778,Wi=33779,qi=37488,Yi=37489,Ki=37490,Qi=37491,Zi=37492,Ji=37493,$i=37494,ea=37495,ta=37496,na=37497,ra=35840,ia=35842,aa=35841,oa=35843,sa=36196,ua=35986,ca=35986,la=34798,fa=34042,ha=36193,da=34836,_a=34837,ma=33297,pa=35863,va=32775,ga=32776,ya=35904,Ea=35906,Ta=35907,xa=33296,Aa=35723,Oa=36064,ba=36065,Ma=36066,Sa=36067,Ra=36068,La=36069,Ca=36070,Ia=36071,wa=36072,Pa=36073,Na=36074,Fa=36075,Da=36076,Ua=36077,Va=36078,Ba=36079,Ha=34853,za=34854,Ga=34855,ka=34856,ja=34857,Xa=34858,Wa=34859,qa=34860,Ya=34861,Ka=34862,Qa=34863,Za=34864,Ja=34865,$a=34866,eo=34867,to=34868,no=36063,ro=34852,io=34229,ao=34916,oo=34917,so=34918,uo=34919,co=35007,lo=36392,fo=36795,ho="POSITION",_o="NORMAL",mo="DEPTH",po="DISTANCE",vo={webgl:r,webglExtensions:i,Hilo:a};Object.assign(vo,r,i,a),t.a=vo},function(e,t,n){"use strict";var r={},i={_cache:r,level:7,LEVEL_NONE:0,LEVEL_LOG:1,LEVEL_WARN:2,LEVEL_ERROR:4,log:function(){var e=this.console;return 1&this.level&&e.log.apply(e,arguments),this},warn:function(){var e=this.console;return 2&this.level&&e.warn.apply(e,arguments),this},error:function(){var e=this.console;return 4&this.level&&e.error.apply(e,arguments),this},logOnce:function(e){return r["log_"+e]||(r["log_"+e]=!0,this.log.apply(this,Array.prototype.slice.call(arguments,1))),this},warnOnce:function(e){return r["warn_"+e]||(r["warn_"+e]=!0,this.warn.apply(this,Array.prototype.slice.call(arguments,1))),this},errorOnce:function(e){return r["error_"+e]||(r["error_"+e]=!0,this.error.apply(this,Array.prototype.slice.call(arguments,1))),this},_console:console,get console(){return this._console},set console(e){this._console=e}};t.a=i},function(e,t,n){"use strict";n.r(t),n.d(t,"each",(function(){return p})),n.d(t,"getRelativePath",(function(){return d})),n.d(t,"convertUint8ArrayToString",(function(){return _})),n.d(t,"getExtension",(function(){return m})),n.d(t,"getIndexFromSortedArray",(function(){return v})),n.d(t,"insertToSortedArray",(function(){return g})),n.d(t,"padLeft",(function(){return y})),n.d(t,"getTypedArrayClass",(function(){return A})),n.d(t,"copyArrayData",(function(){return O})),n.d(t,"isStrOrNumber",(function(){return b})),n.d(t,"getTypedArrayGLType",(function(){return E})),n.d(t,"getBlobUrl",(function(){return R})),n.d(t,"isBlobUrl",(function(){return M})),n.d(t,"revokeBlobUrl",(function(){return S})),n.d(t,"isArrayLike",(function(){return L})),n.d(t,"getElementRect",(function(){return C})),n.d(t,"serialRun",(function(){return I})),n.d(t,"hasOwnProperty",(function(){return w}));var r=n(3),i=n(2);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o,s=i.a.BYTE,u=i.a.UNSIGNED_BYTE,c=i.a.SHORT,l=i.a.UNSIGNED_SHORT,f=i.a.UNSIGNED_INT,h=i.a.FLOAT;function d(e,t){if(/^(?:http|blob|data:|\/)/.test(t))return t;var n;for(e=e.replace(/\/[^/]*?$/,"").split("/"),t=t.split("/"),n=0;n<t.length;n++){var r=t[n];if(".."===r)e.pop();else if("."!==r)break}return e.join("/")+"/"+t.slice(n).join("/")}function _(e,t){if(window.TextDecoder)return o||(o=new TextDecoder("utf-8")),e instanceof Uint8Array||(e=new Uint8Array(e)),o.decode(e);for(var n="",r=0;r<e.length;r++)n+=String.fromCharCode(e[r]);return t&&(n=decodeURIComponent(escape(n))),n}function m(e){var t=String(e).match(/\/?[^/]+\.(\w+)(\?\S+)?$/i);return t&&t[1].toLowerCase()||null}function p(e,t){e&&(Array.isArray(e)?e.forEach(t):Object.keys(e).forEach((function(n){t(e[n],n)})))}function v(e,t,n){if(!e||!e.length)return[0,0];for(var r=0,i=e.length-1;r<=i;){var a=r+i>>1,o=n(e[a],t);if(0===o)return[a,a];o<0?r=a+1:i=a-1}return r>i?[i,r]:[r,i]}function g(e,t,n){var r=v(e,t,n);e.splice(r[1],0,t)}function y(e,t,n){return t<=e.length?e:new Array(t-e.length+1).join(n||"0")+e}function E(e){return e instanceof Float32Array?h:e instanceof Int8Array?s:e instanceof Uint8Array?u:e instanceof Int16Array?c:e instanceof Uint16Array?l:e instanceof Uint32Array?f:h}var T,x,A=(a(T={},s,Int8Array),a(T,u,Uint8Array),a(T,c,Int16Array),a(T,l,Uint16Array),a(T,f,Uint32Array),a(T,h,Float32Array),x=T,function(e){return x[e]||Float32Array});function O(e,t,n,r,i){if(e&&t){t.isGeometryData&&(t=t.data);for(var a=0;a<i;a++)e[n+a]=t[r+a]}}function b(e){return"string"==typeof e||"number"==typeof e}function M(e){return/^blob:/.test(e)}function S(e){window.URL&&URL.revokeObjectURL(e)}function R(e,t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),window.Blob&&window.URL)try{var n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}catch(t){r.a.warn("new Blob error",e)}return"data:".concat(e,";base64,").concat(btoa(_(t)))}function L(e){return Array.isArray(e)||e.BYTES_PER_ELEMENT||e.length}function C(e){var t,n=document.documentElement;try{t=e.getBoundingClientRect()}catch(n){t={top:e.offsetTop,left:e.offsetLeft,right:e.offsetLeft+e.offsetWidth,bottom:e.offsetTop+e.offsetHeight}}var r=(window.pageXOffset||n.scrollLeft)-(n.clientLeft||0)||0,i=(window.pageYOffset||n.scrollTop)-(n.clientTop||0)||0,a=window.getComputedStyle?getComputedStyle(e):e.currentStyle,o=parseInt,s=o(a.paddingLeft)+o(a.borderLeftWidth)||0,u=o(a.paddingTop)+o(a.borderTopWidth)||0,c=o(a.paddingRight)+o(a.borderRightWidth)||0,l=o(a.paddingBottom)+o(a.borderBottomWidth)||0,f=t.top||0,h=t.left||0;return{left:h+r+s,top:f+i+u,width:(t.right||0)-c-h-s,height:(t.bottom||0)-l-f-u}}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Array.isArray(e)||(e=Object.values(e)),e.reduce((function(e,n,r){return e.then((function(){return t(n,r)}))}),Promise.resolve())}function w(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},function(e,t,n){"use strict";var r=n(0),i=n(1).a.create({className:"Vector3",isVector3:!0,constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.elements=r.vec3.fromValues(e,t,n)},copy:function(e){return r.vec3.copy(this.elements,e.elements),this},clone:function(){var e=this.elements;return new this.constructor(e[0],e[1],e[2])},toArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[0+t]=n[0],e[1+t]=n[1],e[2+t]=n[2],e},fromArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return n[0]=e[t+0],n[1]=e[t+1],n[2]=e[t+2],this},set:function(e,t,n){return r.vec3.set(this.elements,e,t,n),this},add:function(e,t){return t||(t=e,e=this),r.vec3.add(this.elements,e.elements,t.elements),this},subtract:function(e,t){return t||(t=e,e=this),r.vec3.subtract(this.elements,e.elements,t.elements),this},multiply:function(e,t){return t||(t=e,e=this),r.vec3.multiply(this.elements,e.elements,t.elements),this},divide:function(e,t){return t||(t=e,e=this),r.vec3.divide(this.elements,e.elements,t.elements),this},ceil:function(){return r.vec3.ceil(this.elements,this.elements),this},floor:function(){return r.vec3.floor(this.elements,this.elements),this},min:function(e,t){return t||(t=e,e=this),r.vec3.min(this.elements,e.elements,t.elements),this},max:function(e,t){return t||(t=e,e=this),r.vec3.max(this.elements,e.elements,t.elements),this},round:function(){return r.vec3.round(this.elements,this.elements),this},scale:function(e){return r.vec3.scale(this.elements,this.elements,e),this},scaleAndAdd:function(e,t,n){return n||(n=t,t=this),r.vec3.scaleAndAdd(this.elements,t.elements,n.elements,e),this},distance:function(e,t){return t||(t=e,e=this),r.vec3.distance(e.elements,t.elements)},squaredDistance:function(e,t){return t||(t=e,e=this),r.vec3.squaredDistance(e.elements,t.elements)},length:function(){return r.vec3.length(this.elements)},squaredLength:function(){return r.vec3.squaredLength(this.elements)},negate:function(){return r.vec3.negate(this.elements,this.elements),this},inverse:function(e){return e||(e=this),r.vec3.inverse(this.elements,e.elements),this},normalize:function(){return r.vec3.normalize(this.elements,this.elements),this},dot:function(e,t){return t||(t=e,e=this),r.vec3.dot(e.elements,t.elements)},cross:function(e,t){return t||(t=e,e=this),r.vec3.cross(this.elements,e.elements,t.elements),this},lerp:function(e,t){return r.vec3.lerp(this.elements,this.elements,e.elements,t),this},hermite:function(e,t,n,i,a){return r.vec3.hermite(this.elements,e.elements,t.elements,n.elements,i.elements,a),this},bezier:function(e,t,n,i,a){return r.vec3.bezier(this.elements,e.elements,t.elements,n.elements,i.elements,a),this},random:function(e){return r.vec3.random(this.elements,e),this},transformMat3:function(e){return r.vec3.transformMat3(this.elements,this.elements,e.elements),this},transformMat4:function(e){return r.vec3.transformMat4(this.elements,this.elements,e.elements),this},transformDirection:function(e){var t=this.elements,n=e.elements,r=t[0],i=t[1],a=t[2];return t[0]=r*n[0]+i*n[4]+a*n[8],t[1]=r*n[1]+i*n[5]+a*n[9],t[2]=r*n[2]+i*n[6]+a*n[10],this},transformQuat:function(e){return r.vec3.transformQuat(this.elements,this.elements,e.elements),this},rotateX:function(e,t){return r.vec3.rotateX(this.elements,this.elements,e.elements,t),this},rotateY:function(e,t){return r.vec3.rotateY(this.elements,this.elements,e.elements,t),this},rotateZ:function(e,t){return r.vec3.rotateZ(this.elements,this.elements,e.elements,t),this},exactEquals:function(e,t){return t||(t=e,e=this),r.vec3.exactEquals(e.elements,t.elements)},equals:function(e,t){return t||(t=e,e=this),r.vec3.equals(e.elements,t.elements)},x:{get:function(){return this.elements[0]},set:function(e){this.elements[0]=e}},y:{get:function(){return this.elements[1]},set:function(e){this.elements[1]=e}},z:{get:function(){return this.elements[2]},set:function(e){this.elements[2]=e}}});i.prototype.sub=i.prototype.subtract,i.prototype.mul=i.prototype.multiply,i.prototype.div=i.prototype.divide,i.prototype.dist=i.prototype.distance,i.prototype.sqrDist=i.prototype.squaredDistance,i.prototype.len=i.prototype.length,i.prototype.sqrLen=i.prototype.squaredLength,t.a=i},function(e,t,n){"use strict";var r,i={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(r=0,function(e){var t=++r;return e?t=e+"_"+t:t+="",t}),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},degToRad:function(e){return e*this.DEG2RAD},radToDeg:function(e){return e*this.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}};t.a=i},function(e,t,n){"use strict";var r,i=n(0),a=n(1),o=n(5),s=n(10),u=new o.a,c=new o.a,l=a.a.create({className:"Matrix4",isMatrix4:!0,constructor:function(){this.elements=i.mat4.create()},copy:function(e){return i.mat4.copy(this.elements,e.elements),this},clone:function(){var e=new this.constructor;return i.mat4.copy(e.elements,this.elements),e},toArray:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,r=0;r<16;r++)e[t+r]=n[r];return e},fromArray:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,r=0;r<16;r++)n[r]=e[t+r];return this},set:function(e,t,n,r,a,o,s,u,c,l,f,h,d,_,m,p){return i.mat4.set(this.elements,e,t,n,r,a,o,s,u,c,l,f,h,d,_,m,p),this},identity:function(){return i.mat4.identity(this.elements),this},transpose:function(){return i.mat4.transpose(this.elements,this.elements),this},invert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return i.mat4.invert(this.elements,e.elements),this},adjoint:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return i.mat4.adjoint(this.elements,e.elements),this},determinant:function(){return i.mat4.determinant(this.elements)},multiply:function(e,t){return t||(t=e,e=this),i.mat4.multiply(this.elements,e.elements,t.elements),this},premultiply:function(e){return this.multiply(e,this),this},translate:function(e){return i.mat4.translate(this.elements,this.elements,e.elements),this},scale:function(e){return i.mat4.scale(this.elements,this.elements,e.elements),this},rotate:function(e,t){return i.mat4.rotate(this.elements,this.elements,e,t.elements),this},rotateX:function(e){return i.mat4.rotateX(this.elements,this.elements,e),this},rotateY:function(e){return i.mat4.rotateY(this.elements,this.elements,e),this},rotateZ:function(e){return i.mat4.rotateZ(this.elements,this.elements,e),this},fromTranslation:function(e){return i.mat4.fromTranslation(this.elements,e.elements),this},fromScaling:function(e){return i.mat4.fromScaling(this.elements,e.elements),this},fromRotation:function(e,t){return i.mat4.fromRotation(this.elements,e,t.elements),this},fromXRotation:function(e){return i.mat4.fromXRotation(this.elements,e),this},fromYRotation:function(e){return i.mat4.fromYRotation(this.elements,e),this},fromZRotation:function(e){return i.mat4.fromZRotation(this.elements,e),this},fromRotationTranslation:function(e,t){return i.mat4.fromRotationTranslation(this.elements,e.elements,t.elements),this},getTranslation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.a;return i.mat4.getTranslation(e.elements,this.elements),e},getScaling:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.a;return i.mat4.getScaling(e.elements,this.elements),e},getRotation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.a;return i.mat4.getRotation(e.elements,this.elements),e},fromRotationTranslationScale:function(e,t,n){return i.mat4.fromRotationTranslationScale(this.elements,e.elements,t.elements,n.elements),this},fromRotationTranslationScaleOrigin:function(e,t,n,r){return i.mat4.fromRotationTranslationScaleOrigin(this.elements,e.elements,t.elements,n.elements,r.elements),this},fromQuat:function(e){return i.mat4.fromQuat(this.elements,e.elements),this},frustum:function(e,t,n,r,a,o){return i.mat4.frustum(this.elements,e,t,n,r,a,o),this},perspective:function(e,t,n,r){return i.mat4.perspective(this.elements,e,t,n,r),this},perspectiveFromFieldOfView:function(e,t,n){return i.mat4.perspectiveFromFieldOfView(this.elements,e,t,n),this},ortho:function(e,t,n,r,a,o){return i.mat4.ortho(this.elements,e,t,n,r,a,o),this},lookAt:function(e,t,n){return e.isVector3||(e=u.set(e.x,e.y,e.z)),t.isVector3||(t=c.set(t.x,t.y,t.z)),i.mat4.lookAt(this.elements,e.elements,t.elements,n.elements),this},targetTo:function(e,t,n){e.isVector3||(e=u.set(e.x,e.y,e.z)),t.isVector3||(t=c.set(t.x,t.y,t.z)),e=e.elements,t=t.elements,n=n.elements;var r=this.elements,i=e[0],a=e[1],o=e[2],s=n[0],l=n[1],f=n[2],h=i-t[0],d=a-t[1],_=o-t[2],m=h*h+d*d+_*_;m>0?(h*=m=1/Math.sqrt(m),d*=m,_*=m):_=1;var p=l*_-f*d,v=f*h-s*_,g=s*d-l*h;return(m=p*p+v*v+g*g)>0?(p*=m=1/Math.sqrt(m),v*=m,g*=m):(m=(p=l*_-f*d)*p+(v=f*h-(s+=1e-7)*_)*v+(g=s*d-l*h)*g,p*=m=1/Math.sqrt(m),v*=m,g*=m),r[0]=p,r[1]=v,r[2]=g,r[3]=0,r[4]=d*g-_*v,r[5]=_*p-h*g,r[6]=h*v-d*p,r[7]=0,r[8]=h,r[9]=d,r[10]=_,r[11]=0,r[12]=i,r[13]=a,r[14]=o,r[15]=1,this},frob:function(){return i.mat4.frob(this.elements)},add:function(e,t){return t||(t=e,e=this),i.mat4.add(this.elements,e.elements,t.elements),this},subtract:function(e,t){return t||(t=e,e=this),i.mat4.subtract(this.elements,e.elements,t.elements),this},exactEquals:function(e,t){return t||(t=e,e=this),i.mat4.exactEquals(e.elements,t.elements)},equals:function(e,t){return t||(t=e,e=this),i.mat4.equals(e.elements,t.elements)},compose:function(e,t,n,r){return r?this.fromRotationTranslationScaleOrigin(e,t,n,r):this.fromRotationTranslationScale(e,t,n),this},decompose:function(e,t,n,i){return this.getScaling(n),this.getTranslation(t),r||(r=new l),this.determinant()<0&&(n.x*=-1),r.copy(this),u.inverse(n),r.scale(u),e.fromMat4(r),i&&i.set(0,0,0),this}});l.prototype.sub=l.prototype.subtract,l.prototype.mul=l.prototype.multiply,t.a=l},function(e,t,n){"use strict";var r=n(1),i=n(12),a=n(4),o=r.a.create({Extends:i.a,className:"Color",isColor:!0,r:{get:function(){return this.x},set:function(e){this.x=e}},g:{get:function(){return this.y},set:function(e){this.y=e}},b:{get:function(){return this.z},set:function(e){this.z=e}},a:{get:function(){return this.w},set:function(e){this.w=e}},constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;o.superclass.constructor.call(this,e,t,n,r)},toRGBArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e},fromUintArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.elements[0]=e[t]/255,this.elements[1]=e[t+1]/255,this.elements[2]=e[t+2]/255,this.elements[3]=e[t+3]/255,this},fromHEX:function(e){return"number"==typeof e?e=Object(a.padLeft)(e.toString(16),6):("#"===e[0]&&(e=e.slice(1)),3===e.length&&(e=e.replace(/(\w)/g,"$1$1"))),this.elements[0]=parseInt(e.slice(0,2),16)/255,this.elements[1]=parseInt(e.slice(2,4),16)/255,this.elements[2]=parseInt(e.slice(4,6),16)/255,this},toHEX:function(){for(var e="",t=0;t<3;t++)e+=Object(a.padLeft)(Math.floor(255*this.elements[t]).toString(16),2);return e}});t.a=o},function(e,t,n){"use strict";var r=n(34),i=n.n(r);t.a=i.a},function(e,t,n){"use strict";var r=n(0),i=n(11),a=n(1),o=n(9),s=new i.a,u=a.a.create({Mixes:o.a,className:"Quaternion",isQuaternion:!0,constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.elements=r.quat.fromValues(e,t,n,i)},copy:function(e,t){return r.quat.copy(this.elements,e.elements),t||this.fire("update"),this},clone:function(){var e=this.elements;return new this.constructor(e[0],e[1],e[2],e[3])},toArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e},fromArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=this.elements;return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],n||this.fire("update"),this},set:function(e,t,n,i,a){return r.quat.set(this.elements,e,t,n,i),a||this.fire("update"),this},identity:function(e){return r.quat.identity(this.elements),e||this.fire("update"),this},rotationTo:function(e,t,n){return r.quat.rotationTo(this.elements,e.elements,t.elements),n||this.fire("update"),this},setAxes:function(e,t,n,i){return r.quat.setAxes(this.elements,e.elements,t.elements,n.elements),i||this.fire("update"),this},setAxisAngle:function(e,t,n){return r.quat.setAxisAngle(this.elements,e.elements,t),n||this.fire("update"),this},getAxisAngle:function(e){return r.quat.getAxisAngle(e.elements,this.elements)},add:function(e,t){return r.quat.add(this.elements,this.elements,e.elements),t||this.fire("update"),this},multiply:function(e,t){return r.quat.multiply(this.elements,this.elements,e.elements),t||this.fire("update"),this},premultiply:function(e,t){return r.quat.multiply(this.elements,e.elements,this.elements),t||this.fire("update"),this},scale:function(e,t){return r.quat.scale(this.elements,this.elements,e),t||this.fire("update"),this},rotateX:function(e,t){return r.quat.rotateX(this.elements,this.elements,e),t||this.fire("update"),this},rotateY:function(e,t){return r.quat.rotateY(this.elements,this.elements,e),t||this.fire("update"),this},rotateZ:function(e,t){return r.quat.rotateZ(this.elements,this.elements,e),t||this.fire("update"),this},calculateW:function(e){return r.quat.calculateW(this.elements,this.elements),e||this.fire("update"),this},dot:function(e){return r.quat.dot(this.elements,e.elements)},lerp:function(e,t,n){return r.quat.lerp(this.elements,this.elements,e.elements,t),n||this.fire("update"),this},slerp:function(e,t,n){return r.quat.slerp(this.elements,this.elements,e.elements,t),n||this.fire("update"),this},sqlerp:function(e,t,n,i,a,o){return r.quat.sqlerp(this.elements,e.elements,t.elements,n.elements,i.elements,a),o||this.fire("update"),this},invert:function(e){return r.quat.invert(this.elements,this.elements),e||this.fire("update"),this},conjugate:function(e){return r.quat.conjugate(this.elements,this.elements),e||this.fire("update"),this},length:function(){return r.quat.length(this.elements)},squaredLength:function(){return r.quat.squaredLength(this.elements)},normalize:function(e){return r.quat.normalize(this.elements,this.elements),e||this.fire("update"),this},fromMat3:function(e,t){return r.quat.fromMat3(this.elements,e.elements),t||this.fire("update"),this},fromMat4:function(e,t){return s.fromMat4(e),this.fromMat3(s,t),this},exactEquals:function(e){return r.quat.exactEquals(this.elements,e.elements)},equals:function(e){return r.quat.equals(this.elements,e.elements)},fromEuler:function(e,t){var n=.5*e.x,r=.5*e.y,i=.5*e.z,a=e.order||"ZYX",o=Math.sin(n),s=Math.cos(n),u=Math.sin(r),c=Math.cos(r),l=Math.sin(i),f=Math.cos(i),h=this.elements;return"XYZ"===a?(h[0]=o*c*f+s*u*l,h[1]=s*u*f-o*c*l,h[2]=s*c*l+o*u*f,h[3]=s*c*f-o*u*l):"YXZ"===a?(h[0]=o*c*f+s*u*l,h[1]=s*u*f-o*c*l,h[2]=s*c*l-o*u*f,h[3]=s*c*f+o*u*l):"ZXY"===a?(h[0]=o*c*f-s*u*l,h[1]=s*u*f+o*c*l,h[2]=s*c*l+o*u*f,h[3]=s*c*f-o*u*l):"ZYX"===a?(h[0]=o*c*f-s*u*l,h[1]=s*u*f+o*c*l,h[2]=s*c*l-o*u*f,h[3]=s*c*f+o*u*l):"YZX"===a?(h[0]=o*c*f+s*u*l,h[1]=s*u*f+o*c*l,h[2]=s*c*l-o*u*f,h[3]=s*c*f-o*u*l):"XZY"===a&&(h[0]=o*c*f-s*u*l,h[1]=s*u*f-o*c*l,h[2]=s*c*l+o*u*f,h[3]=s*c*f+o*u*l),t||this.fire("update"),this},x:{get:function(){return this.elements[0]},set:function(e){this.elements[0]=e,this.fire("update")}},y:{get:function(){return this.elements[1]},set:function(e){this.elements[1]=e,this.fire("update")}},z:{get:function(){return this.elements[2]},set:function(e){this.elements[2]=e,this.fire("update")}},w:{get:function(){return this.elements[3]},set:function(e){this.elements[3]=e,this.fire("update")}}});u.prototype.mul=u.prototype.multiply,u.prototype.len=u.prototype.length,u.prototype.sqrLen=u.prototype.squaredLength,t.a=u},function(e,t,n){"use strict";var r=n(0),i=n(1).a.create({className:"Matrix3",isMatrix3:!0,constructor:function(){this.elements=r.mat3.create()},copy:function(e){return r.mat3.copy(this.elements,e.elements),this},clone:function(){var e=new this.constructor;return r.mat3.copy(e.elements,this.elements),e},toArray:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,r=0;r<9;r++)e[t+r]=n[r];return e},fromArray:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,r=0;r<9;r++)n[r]=e[t+r];return this},set:function(e,t,n,i,a,o,s,u,c){return r.mat3.set(this.elements,e,t,n,i,a,o,s,u,c),this},identity:function(){return r.mat3.identity(this.elements),this},transpose:function(){return r.mat3.transpose(this.elements,this.elements),this},invert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return r.mat3.invert(this.elements,e.elements),this},adjoint:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return r.mat3.adjoint(this.elements,e.elements),this},determinant:function(){return r.mat3.determinant(this.elements)},multiply:function(e,t){return t||(t=e,e=this),r.mat3.multiply(this.elements,e.elements,t.elements),this},premultiply:function(e){return this.multiply(e,this),this},translate:function(e){return r.mat3.translate(this.elements,this.elements,e.elements),this},rotate:function(e){return r.mat3.rotate(this.elements,this.elements,e),this},scale:function(e){return r.mat3.scale(this.elements,this.elements,e.elements),this},fromTranslation:function(e){return r.mat3.fromTranslation(this.elements,e.elements),this},fromRotation:function(e){return r.mat3.fromRotation(this.elements,e),this},fromScaling:function(e){return r.mat3.fromScaling(this.elements,e.elements),this},fromQuat:function(e){return r.mat3.fromQuat(this.elements,e.elements),this},normalFromMat4:function(e){return r.mat3.normalFromMat4(this.elements,e.elements),this},fromMat4:function(e){return r.mat3.fromMat4(this.elements,e.elements),this},frob:function(){return r.mat3.frob(this.elements)},add:function(e,t){return t||(t=e,e=this),r.mat3.add(this.elements,e.elements,t.elements),this},subtract:function(e,t){return t||(t=e,e=this),r.mat3.subtract(this.elements,e.elements,t.elements),this},exactEquals:function(e,t){return t||(t=e,e=this),r.mat3.exactEquals(e.elements,t.elements)},equals:function(e,t){return t||(t=e,e=this),r.mat3.equals(e.elements,t.elements)},fromRotationTranslationScale:function(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e);return this.set(r*a,-i*o,0,r*o,i*a,0,t,n,1),this}});i.prototype.sub=i.prototype.subtract,i.prototype.mul=i.prototype.multiply,t.a=i},function(e,t,n){"use strict";var r=n(0),i=n(1).a.create({className:"Vector4",isVector4:!0,constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.elements=r.vec4.fromValues(e,t,n,i)},copy:function(e){return r.vec4.copy(this.elements,e.elements),this},clone:function(){var e=this.elements;return new this.constructor(e[0],e[1],e[2],e[3])},toArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[0+t]=n[0],e[1+t]=n[1],e[2+t]=n[2],e[3+t]=n[3],e},fromArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return n[0]=e[t+0],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],this},set:function(e,t,n,i){return r.vec4.set(this.elements,e,t,n,i),this},add:function(e,t){return t||(t=e,e=this),r.vec4.add(this.elements,e.elements,t.elements),this},subtract:function(e,t){return t||(t=e,e=this),r.vec4.subtract(this.elements,e.elements,t.elements),this},multiply:function(e,t){return t||(t=e,e=this),r.vec4.multiply(this.elements,e.elements,t.elements),this},divide:function(e,t){return t||(t=e,e=this),r.vec4.divide(this.elements,e.elements,t.elements),this},ceil:function(){return r.vec4.ceil(this.elements,this.elements),this},floor:function(){return r.vec4.floor(this.elements,this.elements),this},min:function(e,t){return t||(t=e,e=this),r.vec4.min(this.elements,e.elements,t.elements),this},max:function(e,t){return t||(t=e,e=this),r.vec4.max(this.elements,e.elements,t.elements),this},round:function(){return r.vec4.round(this.elements,this.elements),this},scale:function(e){return r.vec4.scale(this.elements,this.elements,e),this},scaleAndAdd:function(e,t,n){return n||(n=t,t=this),r.vec4.scaleAndAdd(this.elements,t.elements,n.elements,e),this},distance:function(e,t){return t||(t=e,e=this),r.vec4.distance(e.elements,t.elements)},squaredDistance:function(e,t){return t||(t=e,e=this),r.vec4.squaredDistance(e.elements,t.elements)},length:function(){return r.vec4.length(this.elements)},squaredLength:function(){return r.vec4.squaredLength(this.elements)},negate:function(){return r.vec4.negate(this.elements,this.elements),this},inverse:function(e){return e||(e=this),r.vec4.inverse(this.elements,e.elements),this},normalize:function(){return r.vec4.normalize(this.elements,this.elements),this},dot:function(e,t){return t||(t=e,e=this),r.vec4.dot(e.elements,t.elements)},lerp:function(e,t){return r.vec4.lerp(this.elements,this.elements,e.elements,t),this},random:function(e){return e=e||1,this.elements[0]=Math.random(),this.elements[1]=Math.random(),this.elements[2]=Math.random(),this.elements[3]=Math.random(),this.normalize(),this.scale(e),this},transformMat4:function(e){return r.vec4.transformMat4(this.elements,this.elements,e.elements),this},transformQuat:function(e){return r.vec4.transformQuat(this.elements,this.elements,e.elements),this},exactEquals:function(e,t){return t||(t=e,e=this),r.vec4.exactEquals(e.elements,t.elements)},equals:function(e,t){return t||(t=e,e=this),r.vec4.equals(e.elements,t.elements)},x:{get:function(){return this.elements[0]},set:function(e){this.elements[0]=e}},y:{get:function(){return this.elements[1]},set:function(e){this.elements[1]=e}},z:{get:function(){return this.elements[2]},set:function(e){this.elements[2]=e}},w:{get:function(){return this.elements[3]},set:function(e){this.elements[3]=e}}});i.prototype.sub=i.prototype.subtract,i.prototype.mul=i.prototype.multiply,i.prototype.div=i.prototype.divide,i.prototype.dist=i.prototype.distance,i.prototype.sqrDist=i.prototype.squaredDistance,i.prototype.len=i.prototype.length,i.prototype.sqrLen=i.prototype.squaredLength,t.a=i},function(e,t,n){"use strict";var r=n(1),i=n(6),a=n(7),o=n(3),s=new a.a,u=i.a.DEG2RAD,c=i.a.RAD2DEG,l=r.a.create({className:"Euler",isEuler:!0,order:"ZYX",constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.elements=new Float32Array([e,t,n]),this.updateDegrees()},clone:function(){var e=new this.constructor;return e.copy(this),e},copy:function(e){return this.elements[0]=e.x,this.elements[1]=e.y,this.elements[2]=e.z,this.order=e.order,this.updateDegrees(),this},set:function(e,t,n){return this.elements[0]=e,this.elements[1]=t,this.elements[2]=n,this.updateDegrees(),this},setDegree:function(e,t,n){return this._degX=e,this._degY=t,this._degZ=n,this.updateRadians(),this},fromArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.elements[0]=e[t],this.elements[1]=e[t+1],this.elements[2]=e[t+2],this.updateDegrees(),this},toArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.elements[0],e[t+1]=this.elements[1],e[t+2]=this.elements[2],e},fromMat4:function(e,t){var n=e.elements,r=n[0],a=n[1],s=n[2],u=n[4],c=n[5],l=n[6],f=n[8],h=n[9],d=n[10];t=t||this.order,this.order=t;var _=i.a.clamp;return"XYZ"===t?(this.elements[1]=Math.asin(_(f,-1,1)),Math.abs(f)<.99999?(this.elements[0]=Math.atan2(-h,d),this.elements[2]=Math.atan2(-u,r)):(this.elements[0]=Math.atan2(l,c),this.elements[2]=0)):"YXZ"===t?(this.elements[0]=Math.asin(-_(h,-1,1)),Math.abs(h)<.99999?(this.elements[1]=Math.atan2(f,d),this.elements[2]=Math.atan2(a,c)):(this.elements[1]=Math.atan2(-s,r),this.elements[2]=0)):"ZXY"===t?(this.elements[0]=Math.asin(_(l,-1,1)),Math.abs(l)<.99999?(this.elements[1]=Math.atan2(-s,d),this.elements[2]=Math.atan2(-u,c)):(this.elements[1]=0,this.elements[2]=Math.atan2(a,r))):"ZYX"===t?(this.elements[1]=Math.asin(-_(s,-1,1)),Math.abs(s)<.99999?(this.elements[0]=Math.atan2(l,d),this.elements[2]=Math.atan2(a,r)):(this.elements[0]=0,this.elements[2]=Math.atan2(-u,c))):"YZX"===t?(this.elements[2]=Math.asin(_(a,-1,1)),Math.abs(a)<.99999?(this.elements[0]=Math.atan2(-h,c),this.elements[1]=Math.atan2(-s,r)):(this.elements[0]=0,this.elements[1]=Math.atan2(f,d))):"XZY"===t?(this.elements[2]=Math.asin(-_(u,-1,1)),Math.abs(u)<.99999?(this.elements[0]=Math.atan2(l,c),this.elements[1]=Math.atan2(f,r)):(this.elements[0]=Math.atan2(-h,d),this.elements[1]=0)):o.a.warn("Euler fromMat4() unsupported order: "+t),this.updateDegrees(),this},fromQuat:function(e,t){return s.fromQuat(e),this.fromMat4(s,t)},updateDegrees:function(){return this._degX=this.elements[0]*c,this._degY=this.elements[1]*c,this._degZ=this.elements[2]*c,this},updateRadians:function(){return this.elements[0]=this._degX*u,this.elements[1]=this._degY*u,this.elements[2]=this._degZ*u,this},degX:{get:function(){return this._degX},set:function(e){this._degX=e,this.elements[0]=e*u}},degY:{get:function(){return this._degY},set:function(e){this._degY=e,this.elements[1]=e*u}},degZ:{get:function(){return this._degZ},set:function(e){this._degZ=e,this.elements[2]=e*u}},x:{get:function(){return this.elements[0]},set:function(e){this.elements[0]=e,this._degX=e*c}},y:{get:function(){return this.elements[1]},set:function(e){this.elements[1]=e,this._degY=e*c}},z:{get:function(){return this.elements[2]},set:function(e){this.elements[2]=e,this._degZ=e*c}}});t.a=l},function(e,t,n){"use strict";var r=n(0),i=n(1).a.create({className:"Vector2",isVector2:!0,constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.elements=r.vec2.fromValues(e,t)},copy:function(e){return r.vec2.copy(this.elements,e.elements),this},clone:function(){var e=this.elements;return new this.constructor(e[0],e[1])},toArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[0+t]=n[0],e[1+t]=n[1],e},fromArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return n[0]=e[t+0],n[1]=e[t+1],this},set:function(e,t){return r.vec2.set(this.elements,e,t),this},add:function(e,t){return t||(t=e,e=this),r.vec2.add(this.elements,e.elements,t.elements),this},subtract:function(e,t){return t||(t=e,e=this),r.vec2.subtract(this.elements,e.elements,t.elements),this},multiply:function(e,t){return t||(t=e,e=this),r.vec2.multiply(this.elements,e.elements,t.elements),this},divide:function(e,t){return t||(t=e,e=this),r.vec2.divide(this.elements,e.elements,t.elements),this},ceil:function(){return r.vec2.ceil(this.elements,this.elements),this},floor:function(){return r.vec2.floor(this.elements,this.elements),this},min:function(e,t){return t||(t=e,e=this),r.vec2.min(this.elements,e.elements,t.elements),this},max:function(e,t){return t||(t=e,e=this),r.vec2.max(this.elements,e.elements,t.elements),this},round:function(){return r.vec2.round(this.elements,this.elements),this},scale:function(e){return r.vec2.scale(this.elements,this.elements,e),this},scaleAndAdd:function(e,t,n){return n||(n=t,t=this),r.vec2.scaleAndAdd(this.elements,t.elements,n.elements,e),this},distance:function(e,t){return t||(t=e,e=this),r.vec2.distance(e.elements,t.elements)},squaredDistance:function(e,t){return t||(t=e,e=this),r.vec2.squaredDistance(e.elements,t.elements)},length:function(){return r.vec2.length(this.elements)},squaredLength:function(){return r.vec2.squaredLength(this.elements)},negate:function(){return r.vec2.negate(this.elements,this.elements),this},inverse:function(e){return e||(e=this),r.vec2.inverse(this.elements,e.elements),this},normalize:function(){return r.vec2.normalize(this.elements,this.elements),this},dot:function(e,t){return t||(t=e,e=this),r.vec2.dot(e.elements,t.elements)},cross:function(e,t){return t||(t=e,e=this),r.vec2.cross(this.elements,e.elements,t.elements),this},lerp:function(e,t){return r.vec2.lerp(this.elements,this.elements,e.elements,t),this},random:function(e){return r.vec2.random(this.elements,e),this},transformMat3:function(e){return r.vec2.transformMat3(this.elements,this.elements,e.elements),this},transformMat4:function(e){return r.vec2.transformMat4(this.elements,this.elements,e.elements),this},exactEquals:function(e,t){return t||(t=e,e=this),r.vec2.exactEquals(e.elements,t.elements)},equals:function(e,t){return t||(t=e,e=this),r.vec2.equals(e.elements,t.elements)},x:{get:function(){return this.elements[0]},set:function(e){this.elements[0]=e}},y:{get:function(){return this.elements[1]},set:function(e){this.elements[1]=e}}});i.prototype.sub=i.prototype.subtract,i.prototype.mul=i.prototype.multiply,i.prototype.div=i.prototype.divide,i.prototype.dist=i.prototype.distance,i.prototype.sqrDist=i.prototype.squaredDistance,i.prototype.len=i.prototype.length,i.prototype.sqrLen=i.prototype.squaredLength,t.a=i},function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a=n(1),o={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR",COLOR_0:"COLOR",COLOR_1:"COLOR_1",TEXCOORD:"TEXCOORD",TEXCOORD_0:"TEXCOORD",TEXCOORD_1:"TEXCOORD_1",TEXCOORD_2:"TEXCOORD_2",TANGENT:"TANGENT",JOINT:"JOINT",JOINTS_0:"JOINT",WEIGHT:"WEIGHT",WEIGHTS_0:"WEIGHT"},s=["POSITION","NORMAL","COLOR","TEXCOORD","TANGENT","JOINT","WEIGHT","OTHER","TEXCOORD_1","TEXCOORD_2","COLOR_1"],u={POSITION:0,NORMAL:1,COLOR:2,TEXCOORD:3,TANGENT:4,JOINT:5,WEIGHT:6,OTHER:7,TEXCOORD_1:8,TEXCOORD_2:9,COLOR_1:10},c={POSITION:"vertices",NORMAL:"normals",COLOR:"colors",TEXCOORD:"uvs",TEXCOORD_1:"uvs1",TEXCOORD_2:"uvs2",TANGENT:"tangents",JOINT:"skinIndices",WEIGHT:"skinWeights"},l={vertices:"POSITION",_normals:"NORMAL",colors:"COLOR",uvs:"TEXCOORD",uvs1:"TEXCOORD_1",uvs2:"TEXCOORD_2",_tangents:"TANGENT",skinIndices:"JOINT",skinWeights:"WEIGHT"},f={POSITION:3,NORMAL:3,COLOR:3,COLOR_1:3,TEXCOORD:2,TEXCOORD_1:2,TEXCOORD_2:2,TANGENT:4,JOINT:4,WEIGHT:4},h=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indices=t,this.mode=n,this.attrs=[],this.attrIndexMap={}}return i(e,null,[{key:"cp",value:function(e){return e}},{key:"minus",value:function(e,t){return e-t}},{key:"plus",value:function(e,t){return e+t}},{key:"pp",value:function(e,t,n,r){return r-t-n+e}},{key:"depp",value:function(e,t,n,r){return t+n-e+r}},{key:"ATTR",get:function(){return o}},{key:"ATTR_NAME_ID",get:function(){return u}}]),i(e,[{key:"getAttrLength",value:function(){return this.attrs[0].data.length/this.attrs[0].itemCount}},{key:"attrIdToName",value:function(e){return s[e]||"OTHER"}},{key:"addAttr",value:function(e,t,n){o[e]?(this.attrIndexMap[e]=this.attrs.length,n||(n=f[e])):n||(n=1),this.attrs.push({name:e,itemCount:n,data:t})}},{key:"getAttr",value:function(e){if(this.attrIndexMap[e])return this.attrs[this.attrIndexMap[e]];for(var t=this.attrs.length-1;t>=0;t--){var n=this.attrs[t];if(n.name===e)return n}}},{key:"cal",value:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];this.attrs.forEach((function(r,a){for(var o=r.data,s=e.attrs[a].data,u=t*r.itemCount,c=r.itemCount-1;c>=0;c--)s[u+c]=n.apply(null,i.map((function(e){return o[e*r.itemCount+c]})))}))}},{key:"quantize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.attrs.forEach((function(t){if("JOINT"!==t.name&&0!=e[t.name]){var n=a.encode(t.data,e[t.name]||12);t.quantizationBit=n.quantizationBit,t.min=n.min,t.max=n.max,t.data=n.data}}))}},{key:"dequantize",value:function(){this.attrs.forEach((function(e){e.quantizationBit&&(e.data=a.decode(e.data,e.quantizationBit,e.min,e.max))}))}},{key:"convertTypedArray",value:function(){!this.indices||this.indices instanceof Array||(this.indices=Array.from(this.indices)),this.attrs.forEach((function(e){e.data instanceof Array||e.data instanceof Float32Array||(e.data=Array.from(e.data))}))}},{key:"clearEBAttrs",value:function(){delete this.clers,delete this.holes,delete this.handles}},{key:"convertToTypedArray",value:function(){this.indices instanceof Array&&(this.getAttrLength()>65535?this.indices=new Uint32Array(this.indices):this.indices=new Uint16Array(this.indices)),this.attrs.forEach((function(e){e.data instanceof Array&&(e.data=new Float32Array(e.data))}))}},{key:"prepareToWorkerSend",value:function(){return this.clearEBAttrs(),this.convertToTypedArray(),this.getAllBuffers()}},{key:"clone",value:function(){var t=new e(Array.from(this.indices),this.mode);return Object.assign(t.attrIndexMap,this.attrIndexMap),t.attrs=this.attrs.map((function(e){var t=Object.assign({},e);return t.data=Array.from(t.data),t})),t}},{key:"cloneStruct",value:function(){var t=new e;return t.mode=this.mode,this.indices&&(t.indices=[]),Object.assign(t.attrIndexMap,this.attrIndexMap),t.attrs=this.attrs.map((function(e){var t=Object.assign({},e);return t.data=[],t})),t}},{key:"toHilo3dGeometry",value:function(e,t){var n=t||new e.Geometry;return this.indices&&(this.indices.BYTES_PER_ELEMENT?n.indices=new e.GeometryData(this.indices,1):this.getAttrLength()>65535?n.indices=new e.GeometryData(new Uint32Array(this.indices),1):n.indices=new e.GeometryData(new Uint16Array(this.indices),1)),this.attrs.forEach((function(t){var r=c[t.name];r&&(t.data.BYTES_PER_ELEMENT?n[r]=new e.GeometryData(t.data,t.itemCount):n[r]=new e.GeometryData(new Float32Array(t.data),t.itemCount))})),n}},{key:"getAllBuffers",value:function(){var e=[];return this.indices.BYTES_PER_ELEMENT&&e.push(this.indices.buffer),this.attrs.forEach((function(t){t.data&&t.data.BYTES_PER_ELEMENT&&e.push(t.data.buffer)})),e}}],[{key:"fromGLTFPrimitive",value:function(t){var n=new e(t.indices,t.mode),r=t.attributes,i=0;for(var a in r.POSITION&&(i=r.POSITION.length/3),r)if(o[a]){var s=f[o[a]];i&&(s=r[a].length/i),n.addAttr(o[a],r[a],s)}else console.warn("Dont support attribute",a);return n}},{key:"fromHilo3dGeometry",value:function(t){var n=new e(t.indices.data,t.mode);for(var r in l)t[r]&&n.addAttr(l[r],t[r].data,t[r].size);return n}}]),e}();e.exports=h},function(e,t){var n={};function r(e){return n[e]||(n[e]=Math.pow(2,e)-1),n[e]}e.exports={cal:function(e,t,n,i){var a=r(i),o=n-t;return Math.round((e-t)/o*a)},encode:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=e.length,i=r(t),a=1/0,o=-1/0,s=0;s<n;s++)a=Math.min(a,e[s]),o=Math.max(o,e[s]);var u=o-a||1,c=[];for(s=0;s<n;s++)c[s]=Math.round((e[s]-a)/u*i);return{min:a,max:o,quantizationBit:t,data:c}},encodeWithMinAndMax:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8,o=e.length,s=r(a),u=i-n||1,c=0;c<o;c++)t[c]=Math.round((e[c]-n)/u*s);return t},decode:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=e.length,o=r(t),s=i-n,u=new Float32Array(a),c=0;c<a;c++)u[c]=n+s*(e[c]/o);return u},normalize:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=e.length,i=0;i<r;i+=n){for(var a=0,o=0;o<n;o++)a+=e[i+o]*e[i+o];for(a=Math.sqrt(a),o=0;o<n;o++)t[i+o]=e[i+o]/a}return t}}},function(e,t,n){e.exports=n(3)},function(e,t,n){var r=n(4);r.Geometry=n(0),e.exports=r},function(e,t,n){var r=n(0),i=n(5),a=n(7),o=n(8),s=n(9),u=[i],c=[a];function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e instanceof Uint8Array&&(t=e.byteOffset,e=e.buffer),function(e){return new u[e.type](e).decompress()}(function(e,t){var n=new Uint8Array(e,t,4);if(65!==n[0]||77!==n[1]||67!==n[2])throw new Error("The file is not AMC format!");var r=c[n[3]].read(e,t+4);return r.geometry.type=n[3],r.geometry}(e,t))}var f,h=null,d=null;function _(e,t){return!h&&s()?(h=new o({wasmURL:e,memPages:t}),d=h.init()):d||Promise.resolve()}function m(e,t,n){if(h||_(t,n),!h||!h.isReady)return l(e);try{return h.decompress(e)}catch(t){return console.warn("wasm decompress error",t),l(e)}}var p=null;function v(e){return e=e||"https://g.alicdn.com/hilo/amc/0.1.27/worker.js",p||(!1===f||"undefined"==typeof Worker?Promise.reject("dont support web worker"):p=/^(?:http|blob|data:|\/\/)/.test(e)?new Promise((function(t,n){var r=new XMLHttpRequest;r.addEventListener("load",(function(){if("undefined"==typeof URL||"undefined"==typeof Blob)f=new Worker("data:application/javascript, ".concat(this.responseText));else{var e=URL.createObjectURL(new Blob([this.responseText]));f=new Worker(e)}f.onerror=function(e){console.log("web worker error",e),f=!1,n(e)},t(f)})),r.addEventListener("error",(function(e){return n(e)})),r.open("get",e,!0),r.send()})):new Promise((function(t,n){(f=new Worker(e)).onerror=function(e){console.log("web worker init error",e),f=!1,n(e)},t(f)})))}var g=0;function y(e,t,n,i){return t=t&&s(),e=new Uint8Array(e),v(i).then((function(i){return new Promise((function(a,o){var s=g++,u=function(t){if(t.data.id===s)if(i.removeEventListener("message",u),u=null,t.data.data){var n=t.data.data;n.constructor=r,n.__proto__=r.prototype,a(n)}else a(l(e))};i.addEventListener("message",u),i.postMessage({id:s,data:e,useWASM:t,wasmURL:n},[e.buffer])}))})).catch((function(r){return t?m(e,n):l(e)}))}e.exports={initWASM:_,initWorker:v,decompress:function(e,t,n){var r=s();return!r||e.byteLength>1048576?y(e,r,t,n):r?Promise.resolve(m(e,t)):Promise.resolve(l(e))},decompressWithJS:l,decompressWithWASM:m,decompressWithWorker:y,destory:function(){f&&(f.terminate(),f=null,p=null),h&&(h=null,d=null)}}},function(e,t,n){function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=n(0),a=(n(1),n(6)),o=a.map,u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geometry=t,this.faceCount=t.clers.length,this.clers=t.clers,this.holes=t.holes,this.handles=t.handles,this.createHandleMap(this.handles),this.vertexCount=t.getAttrLength(),this.noParallelogramPrediction=!!t.noParallelogramPrediction}var t;return(t=[{key:"nextCorner",value:function(e){return e<0?-1:e+(e%3==2?-2:1)}},{key:"prevCorner",value:function(e){return e<0?-1:e+(e%3?-1:2)}},{key:"createHandleMap",value:function(e){var t=this.handlesMap={};if(e)for(var n=e.length-1;n>=0;n-=2)t[e[n]]=e[n-1]}},{key:"mapBoundary",value:function(e){for(var t=this.indices,n=e.length,r=this.currentVertex,i=this.currentVertex-n+1,a=n-1;a>=0;a--)t[this.nextCorner(e[a])]=r,r=i,t[this.prevCorner(e[a])]=i++;this.currentVertex-=n}},{key:"mapHoleBoundary",value:function(e){for(var t=this.indices,n=e.length,r=this.currentVertex-n+1,i=r,a=n-1;a>=0;a--)t[this.nextCorner(e[a])]=r++,t[this.prevCorner(e[a])]=a?r:i;this.currentVertex-=n}},{key:"fixNegativeIndex",value:function(e){for(var t=e,n=this.indices;n[e]<0;){if(t===-n[-n[e]]||n[e]===n[-n[e]]){console.warn("dead loop bug!!"),n[s]=0;break}n[e]=n[-n[e]]}}},{key:"fixIndicesAndReadVertice",value:function(){for(var e,t=this.indices,n=this.handlesMap,r=this.clers,i=r.length,o=-1,s=[],u=0,c=0;u<i;u++,c+=3)-1===o?(this.fixNegativeIndex(c+1),this.fixNegativeIndex(c+2)):(t[c+1]=t[this.prevCorner(o)],t[c+2]=t[this.nextCorner(o)]),this.fixNegativeIndex(c),-1===o?(this.readVertex(t[c+2]),this.readVertex(t[c+1]),this.readVertex(t[c])):this.readVertex(t[c],o),o=c+1,(e=r[u])!==a.S||n[u]?e===a.E||e===a.F?o=s.pop():e===a.R&&(o=c+2):s.push(c+2),e===a.F&&(o=-1,delete this.lastReadVertexIndex),this._onDecompressFace(u,e)}},{key:"readVertex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(!this.readedVertexMap[e]&&(this.readedVertexMap[e]=1,!this.noParallelogramPrediction)){var n=this.indices,r=this.geometry;-1===t?void 0!==this.lastReadVertexIndex&&r.cal(r,e,i.plus,this.lastReadVertexIndex,e):r.cal(r,e,i.depp,n[t],n[this.prevCorner(t)],n[this.nextCorner(t)],e),this.lastReadVertexIndex=e}}},{key:"markCorner",value:function(e,t){var n=this.indices;void 0===n[this.nextCorner(e)]&&(n[this.nextCorner(e)]=-this.prevCorner(t[0])),void 0===n[this.prevCorner(e)]&&(n[this.prevCorner(e)]=-this.nextCorner(t[t.length-1]))}},{key:"onFaceC",value:function(e){var t=this.indices,n=3*this.currentFace,r=this.currentVertex--;t[n]=r;var i=e.pop();return t[this.nextCorner(i)]=r,t[this.prevCorner(i)]=-this.nextCorner(e[e.length-1]),i=e.shift(),t[this.prevCorner(i)]=r,t[this.nextCorner(i)]=-this.prevCorner(e[0]),e.push(n),e}},{key:"onFaceL",value:function(e){var t=3*this.currentFace;return this.markCorner(e.pop(),e),e.unshift(t+2),e.push(t),e}},{key:"onFaceF",value:function(e,t){return e&&this.mapBoundary(e),this.onFaceE(null,t)}},{key:"onFaceE",value:function(e,t){var n=3*this.currentFace;return e&&t.push(e),[n+2,n+1,n]}},{key:"onFaceR",value:function(e){var t=3*this.currentFace;return this.markCorner(e.pop(),e),e.push(t+1,t),e}},{key:"onHandleEnd",value:function(e,t,n){var r=this.indices,i=3*this.currentFace,a=this.handlesMap[this.currentFace],o=t.splice(0,e);return t.shift(),n.push(o),r[this.nextCorner(a)]=-(i+1),r[this.prevCorner(a)]=-this.nextCorner(o[o.length-1]),r[i]=-this.prevCorner(o[0]),t.push(i),t}},{key:"onHandleStart",value:function(e,t){for(var n,i=this.indices,a=3*this.currentFace,o=this.handlesMap[this.currentFace],s=t.length-1;s>=0;s--){var u=t[s].indexOf(o);if(u>=0){var c,l=(n=t.splice(s,1)[0]).splice(0,u);n.shift(),(c=n).push.apply(c,r(l));break}}return i[this.nextCorner(o)]=-(a+1),i[this.prevCorner(o)]=-this.nextCorner(n[n.length-1]),i[a]=-this.prevCorner(e[0]),(e=n.concat(e)).push(a),e}},{key:"onFaceS",value:function(e,t,n){var r=this.handlesMap,i=this.indices,a=3*this.currentFace;if(r[this.currentFace]){this.markCorner(e.pop(),e);var o=e.indexOf(r[this.currentFace]);e=o>=0?this.onHandleEnd(o,e,n):this.onHandleStart(e,n)}else{var s=e.pop();this.markCorner(s,e),i[a]=-this.nextCorner(s);var u=t.pop();this.markCorner(u.pop(),u),(e=u.concat(e)).push(a)}return e}},{key:"onFaceM",value:function(e,t,n){var r=this.indices,i=3*this.currentFace,a=e.splice(0,this.holes[this.currentHole--]);this.mapHoleBoundary(a);var o=r[this.prevCorner(a[0])];r[i]=o;var s=e.pop();return r[this.prevCorner(s)]=-this.nextCorner(e[e.length-1]),r[this.nextCorner(s)]=o,s=e.shift(),r[this.prevCorner(s)]=o,r[this.nextCorner(s)]=-this.prevCorner(e[0]),e.push(i),e}},{key:"decompress",value:function(){this.readedVertexMap=new Uint8Array(this.vertexCount);var e=this.faceCount,t=this.indices=new Array(3*e);this.currentFace=e-1,this.currentVertex=this.vertexCount-1,this.currentHole=this.holes.length-1;for(var n,r=this.clers,i=[],a=[];this.currentFace>=0;){var s="onFace"+o[r[this.currentFace]];this[s]?n=this[s](n,i,a):console.warn("has no ".concat(s)),this.currentFace--}return this.mapBoundary(n),this.fixIndicesAndReadVertice(this.indices),this.geometry.indices=t,this.geometry.dequantize(),this.geometry}},{key:"_onDecompressFace",value:function(e,t){this.onDecompressFace&&this.onDecompressFace(e,t)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}();e.exports=u},function(e,t){var n={C:0,R:1,L:2,S:3,E:4,M:5,F:6},r=[];for(var i in n)r[n[i]]=i;n.map=r,e.exports=n},function(e,t,n){var r=n(0);function i(e,t,n,r){return new e(t.slice(n,n+r*e.BYTES_PER_ELEMENT))}e.exports={read:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new DataView(e),a=new r,o=function(e,t){var n={};return n.version=e.getUint8(t++),n.faceCount=e.getUint32(t,!0),t+=4,n.vertexCount=e.getUint32(t,!0),t+=4,n.attrCount=e.getUint8(t++),n.noParallelogramPrediction=e.getUint8(t++),n.holesCount=e.getUint16(t,!0),t+=2,n.handlesCount=e.getUint16(t,!0),t+=2,n.headerBytes=15,n}(n,t);return t+=o.headerBytes,a.mode="CLERS",t=function(e,t,n,r){for(var a=0;a<r.attrCount;a++){var o={},s=t.getUint16(n,!0);n+=2,o.name=e.attrIdToName(s),o.itemCount=t.getUint8(n++),o.quantizationBit=t.getUint8(n++),o.min=t.getFloat32(n,!0),n+=4,o.max=t.getFloat32(n,!0),n+=4,o.data=i(Int16Array,t.buffer,n,o.itemCount*r.vertexCount),n+=o.itemCount*r.vertexCount*2,e.attrs.push(o)}return n}(a,n,t=function(e,t,n,r){return e.clers=new Uint8Array(t.buffer,n,r.faceCount),n+r.faceCount}(a,n,t=function(e,t,n,r){return r.handlesCount?(e.handles=i(Uint32Array,t.buffer,n,2*r.handlesCount),n+8*r.handlesCount):(e.handles=[],n)}(a,n,t=function(e,t,n,r){return r.holesCount?(e.holes=i(Uint16Array,t.buffer,n,r.holesCount),n+2*r.holesCount):(e.holes=[],n)}(a,n,t,o),o),o),o),{header:o,geometry:a,offset:t}}}},function(e,t,n){var r=n(0),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wasmURL=t.wasmURL||"https://ossgw.alicdn.com/tmall-c3/tmx/70b8d82ccf33e97a124e54c2d6a3e0c7.wasm",this.memPages=t.memPages||256,this.memPages<256&&(this.memPages=256),this.isReady=!1}var t;return(t=[{key:"initASMJS",value:function(){this.isReady=!0,this.dv=new DataView(HEAP8.buffer),this.heap8=HEAP8,this.ins={exports:{__Z7AMCinitj:Module.__Z7AMCinitj,__Z12AMDecompressv:Module.__Z12AMDecompressv}}}},{key:"init",value:function(){var e=this,t=this.memory=new WebAssembly.Memory({initial:this.memPages});this.dv=new DataView(t.buffer);var n=this.heap8=new Uint8Array(t.buffer),r={global:{NaN:5,Infinity:6},env:{memoryBase:0,memory:t,_malloc:function(){return 2097152},_memset:function(e,t,r){return n.fill(t,e,e+r),e},_printf:function(e,t){for(var r=e;n[r];)r++;var i=String.fromCharCode.apply(String,function(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(n.slice(e,r))),a=0;i=i.replace(/%([duf])/g,(function(e,n){return"d"===n||"u"===n?dv.getInt32(t+4*a++,!0):"f"===n?dv.getFloat32(t+4*a++,!0):void 0})),console.log(i)}}};return fetch(this.wasmURL).then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,r)})).then((function(t){e.module=t,e.ins=t.instance,e.isReady=!0})).catch((function(e){return console.log("wasm load error, use js ver")}))}},{key:"getDataAddr",value:function(e){return this.ins.exports.__Z7AMCinitj(e)}},{key:"decompress",value:function(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var t=this.dv,n=this.heap8,i=this.getDataAddr(e.length);n.set(e,i);var a=this.ins.exports.__Z12AMDecompressv();if(a<=0)throw console.error("decompression error code: "+a),new Error("decompression error code: "+a);for(var o=t.getUint32(a,!0),s=t.getUint32(a+4,!0),u=t.getUint32(a+8,!0),c=t.getUint32(a+12,!0),l=[],f=0;f<c;f++){var h=a+16+12*f;l.push([t.getUint32(h,!0),t.getUint32(h+4,!0),t.getUint32(h+8,!0)])}var d=new Uint32Array(t.buffer,s,3*o);d=u>65536?new Uint32Array(d):new Uint16Array(d);var _=new r(d);return l.forEach((function(e){var n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),3!==n.length);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(e),r=n[0],i=n[1],a=n[2],o=new Float32Array(t.buffer.slice(a,a+u*i*4));_.addAttr(_.attrIdToName(r),o,i)})),_}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}();e.exports=i},function(e,t){var n;e.exports=function(){return void 0===n&&(n=function(){if("undefined"==typeof WebAssembly||"undefined"==typeof fetch||function(){if(!/iPad|iPhone|iPod/i.test(navigator.userAgent))return!1;if(/OS (\d+)_(\d+)_?(\d+)?/i.test(navigator.userAgent)){var e=Number(RegExp.$1),t=Number(RegExp.$2);if(11===e&&t>=3||e>11)return!1}return!0}())return!1;try{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)}catch(e){return console.log("err while check WebAssembly",e),!1}}()),n}}])},function(e,t,n){"use strict";var r=n(35),i=n.n(r),a=n(1),o=n(5),s=a.a.create({className:"Ray",isRay:!0,origin:{get:function(){return this._origin},set:function(e){this._origin=e,this._ray.origin=e.elements}},direction:{get:function(){return this._direction},set:function(e){this._direction=e,this._ray.direction=e.elements}},constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._ray=new i.a,this.origin=e.origin||new o.a(0,0,0),this.direction=e.direction||new o.a(0,0,-1)},set:function(e,t){return this.origin=e,this.direction=t,this},copy:function(e){this.origin.copy(e.origin),this.direction.copy(e.direction)},clone:function(){return new this.constructor({origin:this.origin.clone(),direction:this.direction.clone()})},fromCamera:function(e,t,n,r,i){e.isPerspectiveCamera?(e.worldMatrix.getTranslation(this.origin),this.direction.set(t,n,0),this.direction.copy(e.unprojectVector(this.direction,r,i)),this.direction.sub(this.origin).normalize()):e.isOrthographicCamera&&(this.origin.set(t,n,(e.near+e.far)/(e.near-e.far)),this.origin.copy(e.unprojectVector(this.origin,r,i)),this.direction.set(0,0,-1).transformDirection(e.worldMatrix).normalize())},transformMat4:function(e){this.origin.transformMat4(e),this.direction.transformDirection(e).normalize()},sortPoints:function(e,t){var n=this;t?e.sort((function(e,r){return n.squaredDistance(e[t])-n.squaredDistance(r[t])})):e.sort((function(e,t){return n.squaredDistance(e)-n.squaredDistance(t)}))},squaredDistance:function(e){return this.origin.squaredDistance(e)},distance:function(e){return this.origin.distance(e)},intersectsSphere:function(e,t){var n=this._ray.intersectsSphere(e,t);return this._getRes(n)},intersectsPlane:function(e,t){var n=this._ray.intersectsPlane(e,t);return this._getRes(n)},intersectsTriangle:function(e){var t=this._ray.intersectsTriangle(e);return this._getRes(t)},intersectsBox:function(e){var t=this._ray.intersectsBox(e);return this._getRes(t)},intersectsTriangleCell:function(e,t){var n=this._ray.intersectsTriangleCell(e,t);return this._getRes(n)},_getRes:function(e){return e?new o.a(e[0],e[1],e[2]):null}});t.a=s},function(e,t,n){"use strict";var r=n(0),i=n(1),a=n(9),o=n(5),s=i.a.create({Mixes:a.a,Extends:o.a,className:"Vector3Notifier",isVector3Notifier:!0,constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.elements=r.vec3.fromValues(e,t,n)},copy:function(e){return r.vec3.copy(this.elements,e.elements),this.fire("update"),this},clone:function(){var e=this.elements;return new this.constructor(e[0],e[1],e[2])},toArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[0+t]=n[0],e[1+t]=n[1],e[2+t]=n[2],e},fromArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return n[0]=e[t+0],n[1]=e[t+1],n[2]=e[t+2],this.fire("update"),this},set:function(e,t,n){return r.vec3.set(this.elements,e,t,n),this.fire("update"),this},add:function(e,t){return t||(t=e,e=this),r.vec3.add(this.elements,e.elements,t.elements),this.fire("update"),this},subtract:function(e,t){return t||(t=e,e=this),r.vec3.subtract(this.elements,e.elements,t.elements),this.fire("update"),this},multiply:function(e,t){return t||(t=e,e=this),r.vec3.multiply(this.elements,e.elements,t.elements),this.fire("update"),this},divide:function(e,t){return t||(t=e,e=this),r.vec3.divide(this.elements,e.elements,t.elements),this.fire("update"),this},ceil:function(){return r.vec3.ceil(this.elements,this.elements),this.fire("update"),this},floor:function(){return r.vec3.floor(this.elements,this.elements),this.fire("update"),this},min:function(e,t){return t||(t=e,e=this),r.vec3.min(this.elements,e.elements,t.elements),this.fire("update"),this},max:function(e,t){return t||(t=e,e=this),r.vec3.max(this.elements,e.elements,t.elements),this.fire("update"),this},round:function(){return r.vec3.round(this.elements,this.elements),this.fire("update"),this},scale:function(e){return r.vec3.scale(this.elements,this.elements,e),this.fire("update"),this},scaleAndAdd:function(e,t,n){return n||(n=t,t=this),r.vec3.scaleAndAdd(this.elements,t.elements,n.elements,e),this.fire("update"),this},distance:function(e,t){return t||(t=e,e=this),r.vec3.distance(e.elements,t.elements)},squaredDistance:function(e,t){return t||(t=e,e=this),r.vec3.squaredDistance(e.elements,t.elements)},length:function(){return r.vec3.length(this.elements)},squaredLength:function(){return r.vec3.squaredLength(this.elements)},negate:function(){return r.vec3.negate(this.elements,this.elements),this.fire("update"),this},inverse:function(e){return e||(e=this),r.vec3.inverse(this.elements,e.elements),this.fire("update"),this},normalize:function(){return r.vec3.normalize(this.elements,this.elements),this.fire("update"),this},dot:function(e,t){return t||(t=e,e=this),r.vec3.dot(e.elements,t.elements)},cross:function(e,t){return t||(t=e,e=this),r.vec3.cross(this.elements,e.elements,t.elements),this.fire("update"),this},lerp:function(e,t){return r.vec3.lerp(this.elements,this.elements,e.elements,t),this.fire("update"),this},hermite:function(e,t,n,i,a){return r.vec3.hermite(this.elements,e.elements,t.elements,n.elements,i.elements,a),this.fire("update"),this},bezier:function(e,t,n,i,a){return r.vec3.bezier(this.elements,e.elements,t.elements,n.elements,i.elements,a),this.fire("update"),this},random:function(e){return r.vec3.random(this.elements,e),this.fire("update"),this},transformMat3:function(e){return r.vec3.transformMat3(this.elements,this.elements,e.elements),this.fire("update"),this},transformMat4:function(e){return r.vec3.transformMat4(this.elements,this.elements,e.elements),this.fire("update"),this},transformDirection:function(e){var t=this.elements,n=e.elements,r=t[0],i=t[1],a=t[2];return t[0]=r*n[0]+i*n[4]+a*n[8],t[1]=r*n[1]+i*n[5]+a*n[9],t[2]=r*n[2]+i*n[6]+a*n[10],this.fire("update"),this},transformQuat:function(e){return r.vec3.transformQuat(this.elements,this.elements,e.elements),this.fire("update"),this},rotateX:function(e,t){return r.vec3.rotateX(this.elements,this.elements,e.elements,t),this.fire("update"),this},rotateY:function(e,t){return r.vec3.rotateY(this.elements,this.elements,e.elements,t),this.fire("update"),this},rotateZ:function(e,t){return r.vec3.rotateZ(this.elements,this.elements,e.elements,t),this.fire("update"),this},exactEquals:function(e,t){return t||(t=e,e=this),r.vec3.exactEquals(e.elements,t.elements)},equals:function(e,t){return t||(t=e,e=this),r.vec3.equals(e.elements,t.elements)},x:{get:function(){return this.elements[0]},set:function(e){this.elements[0]=e,this.fire("update")}},y:{get:function(){return this.elements[1]},set:function(e){this.elements[1]=e,this.fire("update")}},z:{get:function(){return this.elements[2]},set:function(e){this.elements[2]=e,this.fire("update")}}});t.a=s},function(e,t){e.exports="#define GLSLIFY 1\n#define HILO_FRONT_SIDE 1028\n#define HILO_BACK_SIDE 1029\n#define HILO_FRONT_AND_BACK_SIDE 1032\n#define HILO_PI 3.141592653589793\n#define HILO_INVERSE_PI 0.3183098861837907"},function(e,t,n){"use strict";var r=n(1),i=n(5),a=r.a.create({className:"Plane",isPlane:!0,constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.a,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.normal=e,this.distance=t},copy:function(e){return this.normal.copy(e.normal),this.distance=e.distance,this},clone:function(){return new this.constructor(this.normal.clone(),this.distance)},set:function(e,t,n,r){return this.normal.set(e,t,n),this.distance=r,this},normalize:function(){var e=1/this.normal.length();return this.normal.scale(e),this.distance*=e,this},distanceToPoint:function(e){return this.normal.dot(e)+this.distance},projectPoint:function(e){return(new i.a).copy(this.normal).scale(-this.distanceToPoint(e)).add(e)}});t.a=a},function(e,t,n){"use strict";var r=n(1),i=n(5),a=new i.a,o=r.a.create({className:"Sphere",isSphere:!0,radius:0,constructor:function(e){Object.assign(this,e),this.center||(this.center=new i.a(0,0,0))},clone:function(){var e=new this.constructor;return e.copy(this),e},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},fromPoints:function(e){for(var t=this.center,n=0,r=0;r<e.length;r+=3){var i=e[r]-t.x,a=e[r+1]-t.y,o=e[r+2]-t.z;n=Math.max(i*i+a*a+o*o,n)}return this.radius=Math.sqrt(n),this},fromGeometryData:function(e){var t=this.center,n=0;return e.traverse((function(e){var r=e.x-t.x,i=e.y-t.y,a=e.z-t.z;n=Math.max(r*r+i*i+a*a,n)})),this.radius=Math.sqrt(n),this},transformMat4:function(e){this.center.transformMat4(e);var t=e.getScaling(a);return this.radius*=Math.max(t.x,t.y,t.z),this}});t.a=o},function(e,t,n){"use strict";var r,i=n(0),a=n(1),o=n(9),s=n(5),u=n(7),c=n(10),l=new s.a,f=new s.a,h=a.a.create({Mixes:o.a,Extends:u.a,className:"Matrix4Notifier",isMatrix4Notifier:!0,constructor:function(){this.elements=i.mat4.create()},copy:function(e){return i.mat4.copy(this.elements,e.elements),this.fire("update"),this},fromArray:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,r=0;r<16;r++)n[r]=e[t+r];return this.fire("update"),this},set:function(e,t,n,r,a,o,s,u,c,l,f,h,d,_,m,p){return i.mat4.set(this.elements,e,t,n,r,a,o,s,u,c,l,f,h,d,_,m,p),this.fire("update"),this},identity:function(){return i.mat4.identity(this.elements),this.fire("update"),this},transpose:function(){return i.mat4.transpose(this.elements,this.elements),this.fire("update"),this},invert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return i.mat4.invert(this.elements,e.elements),this.fire("update"),this},adjoint:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return i.mat4.adjoint(this.elements,e.elements),this.fire("update"),this},determinant:function(){return i.mat4.determinant(this.elements)},multiply:function(e,t){return t||(t=e,e=this),i.mat4.multiply(this.elements,e.elements,t.elements),this.fire("update"),this},premultiply:function(e){return this.multiply(e,this),this.fire("update"),this},translate:function(e){return i.mat4.translate(this.elements,this.elements,e.elements),this.fire("update"),this},scale:function(e){return i.mat4.scale(this.elements,this.elements,e.elements),this.fire("update"),this},rotate:function(e,t){return i.mat4.rotate(this.elements,this.elements,e,t.elements),this.fire("update"),this},rotateX:function(e){return i.mat4.rotateX(this.elements,this.elements,e),this.fire("update"),this},rotateY:function(e){return i.mat4.rotateY(this.elements,this.elements,e),this.fire("update"),this},rotateZ:function(e){return i.mat4.rotateZ(this.elements,this.elements,e),this.fire("update"),this},fromTranslation:function(e){return i.mat4.fromTranslation(this.elements,e.elements),this.fire("update"),this},fromScaling:function(e){return i.mat4.fromScaling(this.elements,e.elements),this.fire("update"),this},fromRotation:function(e,t){return i.mat4.fromRotation(this.elements,e,t.elements),this.fire("update"),this},fromXRotation:function(e){return i.mat4.fromXRotation(this.elements,e),this.fire("update"),this},fromYRotation:function(e){return i.mat4.fromYRotation(this.elements,e),this.fire("update"),this},fromZRotation:function(e){return i.mat4.fromZRotation(this.elements,e),this.fire("update"),this},fromRotationTranslation:function(e,t){return i.mat4.fromRotationTranslation(this.elements,e.elements,t.elements),this.fire("update"),this},getTranslation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.a;return i.mat4.getTranslation(e.elements,this.elements),e},getScaling:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.a;return i.mat4.getScaling(e.elements,this.elements),e},getRotation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new c.a;return i.mat4.getRotation(e.elements,this.elements),e},fromRotationTranslationScale:function(e,t,n){return i.mat4.fromRotationTranslationScale(this.elements,e.elements,t.elements,n.elements),this.fire("update"),this},fromRotationTranslationScaleOrigin:function(e,t,n,r,a){return i.mat4.fromRotationTranslationScaleOrigin(this.elements,e.elements,t.elements,n.elements,r.elements),a||this.fire("update"),this},fromQuat:function(e){return i.mat4.fromQuat(this.elements,e.elements),this.fire("update"),this},frustum:function(e,t,n,r,a,o){return i.mat4.frustum(this.elements,e,t,n,r,a,o),this.fire("update"),this},perspective:function(e,t,n,r){return i.mat4.perspective(this.elements,e,t,n,r),this.fire("update"),this},perspectiveFromFieldOfView:function(e,t,n){return i.mat4.perspectiveFromFieldOfView(this.elements,e,t,n),this.fire("update"),this},ortho:function(e,t,n,r,a,o){return i.mat4.ortho(this.elements,e,t,n,r,a,o),this.fire("update"),this},lookAt:function(e,t,n){return e.isVector3||(e=l.set(e.x,e.y,e.z)),t.isVector3||(t=f.set(t.x,t.y,t.z)),i.mat4.lookAt(this.elements,e.elements,t.elements,n.elements),this.fire("update"),this},targetTo:function(e,t,n){e.isVector3||(e=l.set(e.x,e.y,e.z)),t.isVector3||(t=f.set(t.x,t.y,t.z)),e=e.elements,t=t.elements,n=n.elements;var r=this.elements,i=e[0],a=e[1],o=e[2],s=n[0],u=n[1],c=n[2],h=i-t[0],d=a-t[1],_=o-t[2],m=h*h+d*d+_*_;m>0?(h*=m=1/Math.sqrt(m),d*=m,_*=m):_=1;var p=u*_-c*d,v=c*h-s*_,g=s*d-u*h;return(m=p*p+v*v+g*g)>0?(p*=m=1/Math.sqrt(m),v*=m,g*=m):(m=(p=u*_-c*d)*p+(v=c*h-(s+=1e-7)*_)*v+(g=s*d-u*h)*g,p*=m=1/Math.sqrt(m),v*=m,g*=m),r[0]=p,r[1]=v,r[2]=g,r[3]=0,r[4]=d*g-_*v,r[5]=_*p-h*g,r[6]=h*v-d*p,r[7]=0,r[8]=h,r[9]=d,r[10]=_,r[11]=0,r[12]=i,r[13]=a,r[14]=o,r[15]=1,this.fire("update"),this},frob:function(){return i.mat4.frob(this.elements)},add:function(e,t){return t||(t=e,e=this),i.mat4.add(this.elements,e.elements,t.elements),this.fire("update"),this},subtract:function(e,t){return t||(t=e,e=this),i.mat4.subtract(this.elements,e.elements,t.elements),this.fire("update"),this},exactEquals:function(e,t){return t||(t=e,e=this),i.mat4.exactEquals(e.elements,t.elements)},equals:function(e,t){return t||(t=e,e=this),i.mat4.equals(e.elements,t.elements)},compose:function(e,t,n,r){return r?this.fromRotationTranslationScaleOrigin(e,t,n,r):this.fromRotationTranslationScale(e,t,n),this},decompose:function(e,t,n,i){return this.getScaling(n),this.getTranslation(t),r||(r=new u.a),this.determinant()<0&&(n.x*=-1),r.copy(this),l.inverse(n),r.scale(l),e.fromMat4(r),i&&i.set(0,0,0),this}});t.a=h},function(e,t,n){"use strict";var r=n(1),i=n(9),a=n(6),o=n(13),s=a.a.DEG2RAD,u=a.a.RAD2DEG,c=r.a.create({Mixes:i.a,Extends:o.a,className:"EulerNotifier",isEulerNotifier:!0,constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o.a.call(this,e,t,n)},updateDegrees:function(){return c.superclass.updateDegrees.call(this),this.fire("update"),this},updateRadians:function(){return c.superclass.updateRadians.call(this),this.fire("update"),this},degX:{get:function(){return this._degX},set:function(e){this._degX=e,this.elements[0]=e*s,this.fire("update")}},degY:{get:function(){return this._degY},set:function(e){this._degY=e,this.elements[1]=e*s,this.fire("update")}},degZ:{get:function(){return this._degZ},set:function(e){this._degZ=e,this.elements[2]=e*s,this.fire("update")}},x:{get:function(){return this.elements[0]},set:function(e){this.elements[0]=e,this._degX=e*u,this.fire("update")}},y:{get:function(){return this.elements[1]},set:function(e){this.elements[1]=e,this._degY=e*u,this.fire("update")}},z:{get:function(){return this.elements[2]},set:function(e){this.elements[2]=e,this._degZ=e*u,this.fire("update")}}});t.a=c},function(e,t,n){"use strict";var r=n(1),i=n(19),a=r.a.create({className:"Frustum",isFrustum:!0,constructor:function(){this.planes=[];for(var e=6;e--;)this.planes.push(new i.a)},copy:function(e){var t=e.planes;return this.planes.forEach((function(e,n){e.copy(t[n])})),this},clone:function(){var e=new this.constructor;return e.copy(this),e},fromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=n[6],l=n[7],f=n[8],h=n[9],d=n[10],_=n[11],m=n[12],p=n[13],v=n[14],g=n[15];return t[0].set(o-r,l-s,_-f,g-m).normalize(),t[1].set(o+r,l+s,_+f,g+m).normalize(),t[2].set(o+i,l+u,_+h,g+p).normalize(),t[3].set(o-i,l-u,_-h,g-p).normalize(),t[4].set(o-a,l-c,_-d,g-v).normalize(),t[5].set(o+a,l+c,_+d,g+v).normalize(),this},intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++)if(t[i].distanceToPoint(n)<r)return!1;return!0}});t.a=a},function(e,t){e.exports="#ifdef HILO_USE_SHADER_TEXTURE_LOD\n    #extension GL_EXT_shader_texture_lod: enable\n#endif\n\n#ifdef HILO_USE_EXT_FRAG_DEPTH\n    #extension GL_EXT_frag_depth: enable\n#define GLSLIFY 1\n#endif"},function(e,t){e.exports="#ifdef GL_ES\nprecision HILO_MAX_FRAGMENT_PRECISION float;\n#define GLSLIFY 1\n#endif"},function(e,t){e.exports=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}},function(e,t,n){"use strict";n.r(t),n.d(t,"Color",(function(){return r.a})),n.d(t,"Euler",(function(){return i.a})),n.d(t,"EulerNotifier",(function(){return a.a})),n.d(t,"Frustum",(function(){return o.a})),n.d(t,"math",(function(){return s.a})),n.d(t,"Matrix3",(function(){return u.a})),n.d(t,"Matrix4",(function(){return c.a})),n.d(t,"Matrix4Notifier",(function(){return l.a})),n.d(t,"Plane",(function(){return f.a})),n.d(t,"Quaternion",(function(){return h.a})),n.d(t,"Ray",(function(){return d.a})),n.d(t,"Sphere",(function(){return _.a})),n.d(t,"SphericalHarmonics3",(function(){return y})),n.d(t,"Vector2",(function(){return E.a})),n.d(t,"Vector3",(function(){return p.a})),n.d(t,"Vector3Notifier",(function(){return T.a})),n.d(t,"Vector4",(function(){return x.a}));var r=n(8),i=n(13),a=n(22),o=n(23),s=n(6),u=n(11),c=n(7),l=n(21),f=n(19),h=n(10),d=n(16),_=n(20),m=n(1),p=n(5),v=new Float32Array(27),g=m.a.create({className:"SphericalHarmonics3",isSphericalHarmonics3:!0,Statics:{SH3_SCALE:[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))]},constructor:function(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new p.a)},scale:function(e){return this.coefficients.forEach((function(t){t.scale(e)})),this},fromArray:function(e){return 9===e.length?this.coefficients.forEach((function(t,n){t.fromArray(e[n])})):27===e.length&&this.coefficients.forEach((function(t,n){t.fromArray(e,3*n)})),this},scaleForRender:function(){var e=g.SH3_SCALE;return this.coefficients.forEach((function(t,n){t.scale(e[n])})),this.scale(1/Math.PI),this},toArray:function(){return this.coefficients.forEach((function(e,t){e.toArray(v,3*t)})),v},clone:function(){var e=new this.constructor;return e.copy(this),e},copy:function(e){var t=e.coefficients;return this.coefficients.forEach((function(e,n){e.copy(t[n])})),this}}),y=g,E=n(14),T=n(17),x=n(12)},function(e,t){e.exports="#define GLSLIFY 1\n#if defined(HILO_USE_LOG_DEPTH) && defined(HILO_USE_EXT_FRAG_DEPTH)\n    uniform float u_logDepth;\n    varying float v_fragDepth;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#if defined(HILO_USE_LOG_DEPTH) && defined(HILO_USE_EXT_FRAG_DEPTH)\n    gl_FragDepthEXT = log2( v_fragDepth ) * u_logDepth * 0.5;\n#endif"},function(e,t){e.exports=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}},function(e,t){e.exports=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}},function(e,t){e.exports=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}},function(e,t){e.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}},function(e,t,n){var r={_listeners:null,on:function(e,t,n){for(var r=this._listeners=this._listeners||{},i=r[e]=r[e]||[],a=0,o=i.length;a<o;a++)if(i[a].listener===t)return;return i.push({listener:t,once:n}),this},off:function(e,t){if(0==arguments.length)return this._listeners=null,this;var n=this._listeners&&this._listeners[e];if(n){if(1==arguments.length)return delete this._listeners[e],this;for(var r=0,i=n.length;r<i;r++){var a=n[r];if(a.listener===t){n.splice(r,1),0===n.length&&delete this._listeners[e];break}}}return this},fire:function(e,t){var n,r;"string"==typeof e?r=e:(n=e,r=e.type);var a=this._listeners;if(!a)return!1;var o=a[r];if(o){var s=o.slice(0);if((n=n||new i(r,this,t))._stopped)return!1;for(var u=0;u<s.length;u++){var c=s[u];if(c.listener.call(this,n),c.once){var l=o.indexOf(c);l>-1&&o.splice(l,1)}}return 0==o.length&&delete a[r],!0}return!1}},i=n(37).create({constructor:function(e,t,n){this.type=e,this.target=t,this.detail=n,this.timeStamp=+new Date},type:null,target:null,detail:null,timeStamp:0,stopImmediatePropagation:function(){this._stopped=!0}}),a=window.Event;if(a){var o=a.prototype,s=o.stopImmediatePropagation;o.stopImmediatePropagation=function(){s&&s.call(this),this._stopped=!0}}e.exports=r},function(e,t,n){var r=n(91),i=n(93),a=n(94),o=n(97),s=n(33),u=[[0,0,0],[0,0,0],[0,0,0]],c=[0,0,0];function l(e,t){this.origin=e||[0,0,0],this.direction=t||[0,0,-1]}e.exports=l,l.prototype.set=function(e,t){this.origin=e,this.direction=t},l.prototype.copy=function(e){s(this.origin,e.origin),s(this.direction,e.direction)},l.prototype.clone=function(){var e=new l;return e.copy(this),e},l.prototype.intersectsSphere=function(e,t){return a(c,this.origin,this.direction,e,t)},l.prototype.intersectsPlane=function(e,t){return i(c,this.origin,this.direction,e,t)},l.prototype.intersectsTriangle=function(e){return r(c,this.origin,this.direction,e)},l.prototype.intersectsBox=function(e){return o(c,this.origin,this.direction,e)},l.prototype.intersectsTriangleCell=function(e,t){var n=e[0],r=e[1],i=e[2];return u[0]=t[n],u[1]=t[r],u[2]=t[i],this.intersectsTriangle(u)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n=function(){var e,t,n=function(e){var t,n,i={};for(t in e)n=e[t],r.hasOwnProperty(t)?r[t].call(this,n):i[t]=n;a(this.prototype,i)},r={Extends:function(e){var t=this.prototype,n=i(e.prototype);a(this,e),a(n,t),n.constructor=this,this.prototype=n,this.superclass=e.prototype},Mixes:function(e){e instanceof Array||(e=[e]);for(var t,n=this.prototype;t=e.shift();)a(n,t.prototype||t)},Statics:function(e){a(this,e)}},i=function(){if(Object.__proto__)return function(e){return{__proto__:e}};var e=function(){};return function(t){return e.prototype=t,new e}}(),a=function(e){for(var n=1,r=arguments.length;n<r;n++){var i,a=arguments[n];for(var o in a){var s=a[o];!s||"object"!=typeof s||void 0===s.value&&"function"!=typeof s.get&&"function"!=typeof s.set?e[o]=s:(i=i||{})[o]=s}i&&t(e,i)}return e};try{e=Object.defineProperty,t=Object.defineProperties,e({},"$",{value:0})}catch(n){"__defineGetter__"in Object&&(e=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e},t=function(t,n){for(var r in n)n.hasOwnProperty(r)&&e(t,r,n[r]);return t})}return{create:function(e){var t=(e=e||{}).hasOwnProperty("constructor")?e.constructor:function(){};return n.call(t,e),t},mix:a}}();e.exports=n},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_COLOR\n    varying vec4 v_color;\n#endif\n\n#ifdef HILO_USE_HDR\n    uniform float u_exposure;\n#endif\n\n#ifdef HILO_GAMMA_CORRECTION\n    uniform float u_gammaFactor;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_TEXCOORD0\n    varying vec2 v_texcoord0;\n#endif\n\n#ifdef HILO_HAS_TEXCOORD1\n    varying vec2 v_texcoord1;\n#endif\n\n#if defined(HILO_HAS_TEXCOORD0) || defined(HILO_HAS_TEXCOORD1)\n    #if defined(HILO_HAS_TEXCOORD0) && defined(HILO_HAS_TEXCOORD1)\n        #define HILO_SAMPLER_2D hiloSampler2D\n        // https://www.khronos.org/opengl/wiki/Data_Type_(GLSL)#Opaque_types\n        #define HILO_TEXTURE_2D(HILO_SAMPLER_2D)  hiloTexture2D(HILO_SAMPLER_2D.texture, HILO_SAMPLER_2D.uv)\n        struct hiloSampler2D{\n            sampler2D texture;\n            int uv; \n        };\n        \n        vec4 hiloTexture2D(sampler2D texture, int uv){\n            if(uv == 0){\n                return texture2D(texture, v_texcoord0);\n            }\n            else{\n                return texture2D(texture, v_texcoord1);\n            }\n        }\n    #else\n        #ifdef HILO_HAS_TEXCOORD1\n            #define HILO_V_TEXCOORD v_texcoord1\n        #else\n            #define HILO_V_TEXCOORD v_texcoord0\n        #endif\n        #define HILO_SAMPLER_2D sampler2D\n        #define HILO_TEXTURE_2D(HILO_SAMPLER_2D)  texture2D(HILO_SAMPLER_2D, HILO_V_TEXCOORD)\n    #endif\n#endif\n\n\n#ifdef HILO_DIFFUSE_CUBE_MAP\n    varying vec3 v_position;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_NORMAL\n    varying vec3 v_normal;\n    #if defined(HILO_NORMAL_MAP) || defined(HILO_CLEARCOAT_NORMAL_MAP)\n        varying mat3 v_TBN;\n        #ifdef HILO_NORMAL_MAP\n            uniform HILO_SAMPLER_2D u_normalMap;\n            \n            #ifdef HILO_NORMAL_MAP_SCALE\n            uniform float u_normalMapScale;\n            #endif\n        #endif\n\n        #ifdef HILO_CLEARCOAT_NORMAL_MAP\n            uniform HILO_SAMPLER_2D u_clearcoatNormalMap;\n        #endif\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#if defined(HILO_HAS_LIGHT) || defined(HILO_HAS_FRAG_POS)\n    varying vec3 v_fragPos;\n#endif"},function(e,t,n){e.exports="#define GLSLIFY 1\n#ifdef HILO_DIRECTIONAL_LIGHTS\n    uniform vec3 u_directionalLightsColor[HILO_DIRECTIONAL_LIGHTS];\n    uniform vec3 u_directionalLightsInfo[HILO_DIRECTIONAL_LIGHTS];\n    #ifdef HILO_DIRECTIONAL_LIGHTS_SMC\n        uniform sampler2D u_directionalLightsShadowMap[HILO_DIRECTIONAL_LIGHTS_SMC];\n        uniform vec2 u_directionalLightsShadowMapSize[HILO_DIRECTIONAL_LIGHTS_SMC];\n        uniform mat4 u_directionalLightSpaceMatrix[HILO_DIRECTIONAL_LIGHTS_SMC];\n        uniform vec2 u_directionalLightsShadowBias[HILO_DIRECTIONAL_LIGHTS_SMC];\n    #endif\n#endif\n\n#ifdef HILO_SPOT_LIGHTS\n    uniform vec3 u_spotLightsPos[HILO_SPOT_LIGHTS];\n    uniform vec3 u_spotLightsDir[HILO_SPOT_LIGHTS];\n    uniform vec3 u_spotLightsColor[HILO_SPOT_LIGHTS];\n    uniform vec2 u_spotLightsCutoffs[HILO_SPOT_LIGHTS];\n    uniform vec3 u_spotLightsInfo[HILO_SPOT_LIGHTS];\n    uniform float u_spotLightsRange[HILO_SPOT_LIGHTS];\n    #ifdef HILO_SPOT_LIGHTS_SMC\n        uniform sampler2D u_spotLightsShadowMap[HILO_SPOT_LIGHTS_SMC];\n        uniform vec2 u_spotLightsShadowMapSize[HILO_SPOT_LIGHTS_SMC];\n        uniform mat4 u_spotLightSpaceMatrix[HILO_SPOT_LIGHTS_SMC];\n        uniform vec2 u_spotLightsShadowBias[HILO_SPOT_LIGHTS_SMC];\n    #endif\n#endif\n\n#ifdef HILO_POINT_LIGHTS\n    uniform vec3 u_pointLightsPos[HILO_POINT_LIGHTS];\n    uniform vec3 u_pointLightsColor[HILO_POINT_LIGHTS];\n    uniform vec3 u_pointLightsInfo[HILO_POINT_LIGHTS];\n    uniform float u_pointLightsRange[HILO_POINT_LIGHTS];\n    #ifdef HILO_POINT_LIGHTS_SMC\n        uniform samplerCube u_pointLightsShadowMap[HILO_POINT_LIGHTS_SMC];\n        uniform mat4 u_pointLightSpaceMatrix[HILO_POINT_LIGHTS_SMC];\n        uniform vec2 u_pointLightsShadowBias[HILO_POINT_LIGHTS_SMC];\n        uniform vec2 u_pointLightCamera[HILO_POINT_LIGHTS_SMC];\n    #endif\n#endif\n\n#ifdef HILO_AREA_LIGHTS\n    uniform vec3 u_areaLightsPos[HILO_AREA_LIGHTS];\n    uniform vec3 u_areaLightsColor[HILO_AREA_LIGHTS];\n    uniform vec3 u_areaLightsWidth[HILO_AREA_LIGHTS];\n    uniform vec3 u_areaLightsHeight[HILO_AREA_LIGHTS];\n    uniform sampler2D u_areaLightsLtcTexture1;\n    uniform sampler2D u_areaLightsLtcTexture2;\n\n    "+n(109)+"\n#endif\n\n#ifdef HILO_AMBIENT_LIGHTS\n    uniform vec3 u_ambientLightsColor;\n#endif\n\n"+n(61)+"\n"+n(62)+"\n"+n(63)+"\n"+n(64)+"\n"+n(65)},function(e,t){e.exports="#define GLSLIFY 1\nvec4 textureEnvMap(sampler2D texture, vec3 position){\n    return texture2D(texture, vec2(atan(position.x, position.z) * HILO_INVERSE_PI * 0.5+0.5,  acos(position.y) * HILO_INVERSE_PI));\n}\n\nvec4 textureEnvMap(samplerCube texture, vec3 position){\n    return textureCube(texture, position);\n}\n\nvec4 textureEnvMapIncludeMipmapsLod(sampler2D texture, vec3 position, float lod){\n    lod = floor(lod);\n    vec2 uv = vec2(atan(position.x, position.z) * HILO_INVERSE_PI * 0.5+0.5,  acos(position.y) * HILO_INVERSE_PI);\n\n    float scale = pow(2.0, lod);\n\n    return texture2D(texture, vec2(uv.x / scale, (uv.y / scale / 2.0) + 1.0 - 1.0/pow(2.0, lod)));\n}\n\n#ifdef HILO_USE_SHADER_TEXTURE_LOD\n    vec4 textureEnvMapLod(sampler2D texture, vec3 position, float lod){\n        return texture2DLodEXT(texture, vec2(atan(position.x, position.z) * HILO_INVERSE_PI * 0.5+0.5,  acos(position.y) * HILO_INVERSE_PI), lod);\n    }\n\n    vec4 textureEnvMapLod(samplerCube texture, vec3 position, float lod){\n        return textureCubeLodEXT(texture, position, lod);\n    }\n#endif\n\n"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_TRANSPARENCY_MAP\n    uniform HILO_SAMPLER_2D u_transparency;\n#else\n    uniform float u_transparency;\n#endif\n\n#ifdef HILO_ALPHA_CUTOFF\n    uniform float u_alphaCutoff;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_FOG\n    varying float v_dist;\n    uniform vec4 u_fogColor;\n    \n    #ifdef HILO_FOG_LINEAR\n        uniform vec2 u_fogInfo;\n    #else\n        uniform float u_fogInfo;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_NORMAL_MAP\n    vec3 normal = HILO_TEXTURE_2D(u_normalMap).rgb * 2.0 - 1.0;\n    #ifdef HILO_NORMAL_MAP_SCALE\n        normal.xy *= u_normalMapScale;\n    #endif\n    normal = normalize(v_TBN * normal);\n#elif defined(HILO_HAS_NORMAL)\n    vec3 normal = normalize(v_normal);\n#else\n    vec3 normal = vec3(0, 0, 1);\n#endif\n\n#ifdef HILO_HAS_CLEARCOAT\n    #ifdef HILO_CLEARCOAT_NORMAL_MAP\n        vec3 clearcoatNormal = HILO_TEXTURE_2D(u_clearcoatNormalMap).rgb * 2.0 - 1.0;\n        clearcoatNormal = normalize(v_TBN * clearcoatNormal);\n    #elif defined(HILO_HAS_NORMAL)\n        vec3 clearcoatNormal = normalize(v_normal);\n    #else\n        vec3 clearcoatNormal = vec3(0, 0, 1);\n    #endif\n#endif\n\n#if HILO_SIDE == HILO_BACK_SIDE\n    normal = -normal;\n    #ifdef HILO_HAS_CLEARCOAT\n        clearcoatNormal = -clearcoatNormal;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_LIGHT\n    #if HILO_SIDE == HILO_FRONT_AND_BACK_SIDE\n        normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\nfloat transparency = 1.0;\n#ifdef HILO_TRANSPARENCY_MAP\n    transparency = HILO_TEXTURE_2D(u_transparency).r;\n#else\n    transparency = u_transparency;\n#endif\ncolor.a *= transparency;\n#ifdef HILO_ALPHA_CUTOFF\n    if (color.a < u_alphaCutoff) {\n        discard;\n    } else {\n        color.a = 1.0;\n    }\n#endif"},function(e,t,n){e.exports="#define GLSLIFY 1\n#ifdef HILO_IGNORE_TRANSPARENT\ncolor.a = 1.0;\n#endif\n\n#ifdef HILO_USE_HDR\n    color.rgb = vec3(1.0) - exp(-color.rgb * u_exposure);\n#endif\n\n#ifdef HILO_GAMMA_CORRECTION\n    color.rgb = pow(color.rgb, vec3(1.0 / u_gammaFactor));\n#endif\n\n"+n(70)+"\n\n#ifdef HILO_PREMULTIPLY_ALPHA\n    color.rgb *= color.a;\n#endif\n\ngl_FragColor = color;"},function(e,t){e.exports="#define GLSLIFY 1\n"},function(e,t){e.exports="#ifdef GL_ES\nprecision HILO_MAX_VERTEX_PRECISION float;\n#define GLSLIFY 1\n#endif"},function(e,t,n){e.exports="#define GLSLIFY 1\n"+n(24)+"\n"+n(18)+"\n"+n(25)+"\n\n"+n(38)+"\n"+n(39)+"\n"+n(40)+"\n"+n(41)+"\n"+n(59)+"\n"+n(42)+"\n"+n(66)+"\n"+n(44)+"\n"+n(45)+"\n"+n(28)+"\n\nvoid main(void) {\n    vec4 diffuse = vec4(0., 0., 0., 1.);\n    vec4 color = vec4(0., 0., 0., 1.);\n\n    "+n(46)+"\n    "+n(47)+"\n    "+n(68)+"\n    "+n(69)+"\n    "+n(48)+"\n    "+n(49)+"\n    "+n(29)+"\n}"},function(e,t,n){e.exports="#define GLSLIFY 1\n"+n(50)+"\n"+n(18)+"\n"+n(51)+"\n\nattribute vec3 a_position;\nuniform mat4 u_modelViewProjectionMatrix;\n\n"+n(71)+"\n"+n(72)+"\n"+n(73)+"\n"+n(74)+"\n"+n(75)+"\n"+n(76)+"\n"+n(77)+"\n"+n(78)+"\nvoid main(void) {\n    vec4 pos = vec4(a_position, 1.0);\n    #ifdef HILO_HAS_TEXCOORD0\n        vec2 uv = a_texcoord0;\n    #endif\n    #ifdef HILO_HAS_TEXCOORD1\n        vec2 uv1 = a_texcoord1;\n    #endif\n    #ifdef HILO_HAS_NORMAL\n        vec3 normal = a_normal;\n    #endif\n\n    #if defined(HILO_NORMAL_MAP) || defined(HILO_CLEARCOAT_NORMAL_MAP)\n        vec4 tangent = a_tangent;\n    #endif\n\n    "+n(79)+"\n    "+n(80)+"\n    "+n(81)+"\n    "+n(82)+"\n    "+n(83)+"\n    "+n(84)+"\n    "+n(85)+"\n\n    gl_Position = u_modelViewProjectionMatrix * pos;\n\n    "+n(86)+"\n}"},function(e,t,n){e.exports="#define GLSLIFY 1\n"+n(24)+"\n"+n(18)+"\n"+n(25)+"\n\n#if defined(HILO_VERTEX_TYPE_POSITION)\n    varying vec3 v_fragPos;\n#elif defined(HILO_VERTEX_TYPE_NORMAL)\n    varying vec3 v_normal;\n#elif defined(HILO_VERTEX_TYPE_DEPTH)\n    uniform float u_cameraFar;\n    uniform float u_cameraNear;\n    uniform float u_cameraType;\n#elif defined(HILO_VERTEX_TYPE_DISTANCE)\n    "+n(87)+"\n\n    uniform float u_cameraFar;\n    uniform float u_cameraNear;\n    varying vec3 v_fragPos;\n#endif\n\nvec4 transformDataToColor(vec3 data){\n    #ifdef HILO_WRITE_ORIGIN_DATA\n        return vec4(data, 1.0);\n    #else\n        return vec4(data * 0.5 + 0.5, 1.0);\n    #endif\n}\n\n"+n(28)+"\n\nvoid main(void) {\n    #if defined(HILO_VERTEX_TYPE_POSITION)\n        gl_FragColor = transformDataToColor(v_fragPos);\n    #elif defined(HILO_VERTEX_TYPE_NORMAL)\n        gl_FragColor = transformDataToColor(v_normal);\n    #elif defined(HILO_VERTEX_TYPE_DEPTH)\n        float z;\n        #ifdef HILO_WRITE_ORIGIN_DATA\n            z = gl_FragCoord.z;\n        #else\n            // OrthographicCamera\n            if(u_cameraType < 1.0){\n                z = gl_FragCoord.z;\n            }\n            // PerspectiveCamera\n            else{\n                z = gl_FragCoord.z * 2.0 - 1.0;\n                z = (2.0 * u_cameraNear * u_cameraFar) / (u_cameraFar + u_cameraNear - z * (u_cameraFar - u_cameraNear));\n            }\n        #endif\n        gl_FragColor = vec4(z, z, z, 1.0);\n    #elif defined(HILO_VERTEX_TYPE_DISTANCE)\n        float distance = length(v_fragPos);\n        #ifdef HILO_WRITE_ORIGIN_DATA\n            gl_FragColor = vec4(distance, distance, distance, 1.0);\n        #else\n            gl_FragColor = packFloat((distance - u_cameraNear)/(u_cameraFar - u_cameraNear));\n        #endif\n    #endif\n    "+n(29)+"\n}"},function(e,t,n){e.exports="#define GLSLIFY 1\n"+n(24)+"\n"+n(18)+"\n"+n(25)+"\n\n"+n(38)+"\n"+n(39)+"\n"+n(40)+"\n"+n(41)+"\n"+n(88)+"\n"+n(42)+"\n"+n(44)+"\n"+n(45)+"\n"+n(28)+"\n\nvoid main(void) {\n    vec4 color = vec4(0., 0., 0., 1.);\n\n    "+n(46)+"\n    "+n(47)+"\n    "+n(90)+"\n    "+n(49)+"\n    "+n(29)+"\n}"},function(e,t,n){e.exports="#define GLSLIFY 1\n"+n(24)+"\n"+n(18)+"\n"+n(25)+"\n\nvarying vec2 v_texcoord0;\nuniform sampler2D u_diffuse;\n\nvoid main(void) {  \n    gl_FragColor = texture2D(u_diffuse, v_texcoord0);\n}"},function(e,t,n){e.exports="#define GLSLIFY 1\n"+n(50)+"\n"+n(18)+"\n"+n(51)+"\n\nattribute vec2 a_position;\nattribute vec2 a_texcoord0;\nvarying vec2 v_texcoord0;\n\n\nvoid main(void) {\n    vec4 pos = vec4(a_position, 0.0, 1.0);\n    gl_Position = pos;\n    v_texcoord0 = a_texcoord0;\n}"},function(e,t,n){var r=n(37),i=function(){function e(){return+new Date}return r.create({constructor:function(e,t,n,r){var i=this;for(var a in i.target=e,i._startTime=0,i._seekTime=0,i._pausedTime=0,i._pausedStartTime=0,i._reverseFlag=1,i._repeatCount=0,3==arguments.length&&(r=n,n=t,t=null),r)i[a]=r[a];i._fromProps=t,i._toProps=n,!r.duration&&r.time&&(i.duration=r.time||0,i.time=0)},target:null,duration:1e3,delay:0,paused:!1,loop:!1,reverse:!1,repeat:0,repeatDelay:0,ease:null,time:0,isStart:!1,isComplete:!1,onStart:null,onUpdate:null,onComplete:null,setProps:function(e,t){var n=this.target,r=e||t,i=this._fromProps={},a=this._toProps={};for(var o in e=e||n,t=t||n,r)a[o]=t[o]||0,n[o]=i[o]=e[o]||0;return this},start:function(){var t=this;return t._startTime=e()+t.delay,t._seekTime=0,t._pausedTime=0,t._reverseFlag=1,t._repeatCount=0,t.paused=!1,t.isStart=!1,t.isComplete=!1,i.add(t),t},stop:function(){return i.remove(this),this},pause:function(){return this.paused=!0,this._pausedStartTime=e(),this},resume:function(){var t=this;return t.paused=!1,t._pausedStartTime&&(t._pausedTime+=e()-t._pausedStartTime),t._pausedStartTime=0,t},seek:function(t,n){var r=this,a=e();return r._startTime=a,r._seekTime=t,r._pausedTime=0,void 0!==n&&(r.paused=n),r._update(a,!0),i.add(r),r},link:function(e){var t,n,r=e.delay,a=this._startTime;return"string"==typeof r&&(t=0==r.indexOf("+"),n=0==r.indexOf("-"),r=t||n?Number(r.substr(1))*(t?1:-1):Number(r)),e.delay=r,e._startTime=t||n?a+this.duration+r:a+r,this._next=e,i.remove(e),e},_render:function(e){var t,n=this.target,r=this._fromProps;for(t in r)n[t]=r[t]+(this._toProps[t]-r[t])*e},_update:function(t,n){var r=this;if(!r.paused||n){if(r.isComplete)return!0;var a=t-r._startTime-r._pausedTime+r._seekTime;if(!(a<0)){var o,s=a/r.duration;s=s<=0?0:s>=1?1:s;var u=r.ease?r.ease(s):s;r.reverse&&r.isStart&&(r._reverseFlag<0&&(s=1-s,u=1-u),s<1e-7&&(r.repeat>0&&r._repeatCount++>=r.repeat||0==r.repeat&&!r.loop?r.isComplete=!0:(r._startTime=e(),r._pausedTime=0,r._reverseFlag*=-1))),r.isStart||(r.setProps(r._fromProps,r._toProps),r.isStart=!0,r.onStart&&r.onStart.call(r,r)),r.time=a,r._render(u),(o=r.onUpdate)&&o.call(r,u,r),s>=1&&(r.reverse?(r._startTime=e(),r._pausedTime=0,r._reverseFlag*=-1):r.loop||r.repeat>0&&r._repeatCount++<r.repeat?(r._startTime=e()+r.repeatDelay,r._pausedTime=0):r.isComplete=!0);var c=r._next;if(c&&c.time<=0){var l=c._startTime;l>0&&l<=t?(c._render(s),c.time=a,i.add(c)):r.isComplete&&(l<0||l>t)&&c.start()}return r.isComplete?((o=r.onComplete)&&o.call(r,r),!0):void 0}}},Statics:{_tweens:[],tick:function(){var t,n,r=i._tweens,a=r.length;for(n=0;n<a;n++)(t=r[n])&&t._update(e())&&(r.splice(n,1),n--);return i},add:function(e){var t=i._tweens;return-1==t.indexOf(e)&&t.push(e),i},remove:function(e){var t,n;if(e instanceof Array){for(t=0,n=e.length;t<n;t++)i.remove(e[t]);return i}var r=i._tweens;if(e instanceof i)(t=r.indexOf(e))>-1&&r.splice(t,1);else for(t=0;t<r.length;t++)r[t].target===e&&(r.splice(t,1),t--);return i},removeAll:function(){return i._tweens.length=0,i},fromTo:function(e,t,n,r){r=r||{};var a=e instanceof Array;e=a?e:[e];var o,s,u=r.stagger,c=[];for(s=0;s<e.length;s++)o=new i(e[s],t,n,r),u&&(o.delay=(r.delay||0)+(s*u||0)),o.start(),c.push(o);return a?c:o},to:function(e,t,n){return i.fromTo(e,null,t,n)},from:function(e,t,n){return i.fromTo(e,t,null,n)}}})}();e.exports=i},function(e,t){e.exports="#define GLSLIFY 1\n#if defined(HILO_DIFFUSE_MAP)\n    uniform HILO_SAMPLER_2D u_diffuse;\n#elif defined(HILO_DIFFUSE_CUBE_MAP)\n    uniform samplerCube u_diffuse;\n#else\n    uniform vec4 u_diffuse;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}"},function(e,t){e.exports="#define GLSLIFY 1\nfloat getDiffuse(vec3 normal, vec3 lightDir){\n    return max(dot(normal, lightDir), 0.0);\n}\n\n"},function(e,t){e.exports="#define GLSLIFY 1\nfloat getSpecular(vec3 cameraPos, vec3 fragPos, vec3 lightDir, vec3 normal, float shininess){\n    vec3 viewDir = normalize(cameraPos - fragPos);\n    #ifdef LIGHT_TYPE_PHONG\n        return pow(max(dot(viewDir, reflect(-lightDir, normal), 0.0), shininess);\n    #else\n        return pow(max(dot(normal, normalize(lightDir + viewDir)), 0.0), shininess);\n    #endif\n}\n\n"},function(e,t){e.exports="#define GLSLIFY 1\nfloat getLightAttenuation(vec3 distanceVec, vec3 info, float range){\n    float distance = length(distanceVec);\n    float attenuation = 1.0;\n    #ifdef HILO_USE_PHYSICS_LIGHT\n        attenuation = max(1.0 / (distance * distance), 0.001);\n        if (range > 0.0) {\n            attenuation *= max(min(1.0 - pow( distance / range, 4.0 ), 1.0), 0.0);\n        }\n    #else\n        attenuation = 1.0/(info.x + info.y * distance + info.z * distance * distance);\n    #endif\n\n    return attenuation;\n}\n\n"},function(e,t){e.exports="#define GLSLIFY 1\nfloat unpackFloat(vec4 rgbaDepth) {\n    const vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n    float depth = dot(rgbaDepth, bitShift);\n    return depth;\n}\n\n"},function(e,t){e.exports="#define GLSLIFY 1\nbool isOutOfRange(vec2 pos) {\n    if (pos.x < 0.0 || pos.x > 1.0 || pos.y < 0.0 || pos.y > 1.0) {\n        return true;\n    }\n    return false;\n}\n\nfloat getShadow(sampler2D shadowMap, vec2 shadowMapSize, float bias, vec3 fragPos, mat4 lightSpaceMatrix) {\n    vec4 fragPosLightSpace = lightSpaceMatrix * vec4(fragPos, 1.0);\n    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;\n    projCoords = projCoords * 0.5 + 0.5;\n    if (isOutOfRange(projCoords.xy)) {\n        return 1.0;\n    }\n    float currentDepth = projCoords.z;\n    float shadow = 0.0;\n    vec2 texelSize = 1.0 / shadowMapSize;\n    for (int x = -1; x <= 1; ++x) {\n        for (int y = -1; y <= 1; ++y) {\n            vec2 pos = projCoords.xy + vec2(x, y) * texelSize;\n            if (isOutOfRange(pos)) {\n                shadow += 1.0;\n            } else {\n                float pcfDepth = texture2D(shadowMap, pos).r;\n                shadow += currentDepth - bias > pcfDepth ? 1.0 : 0.0;\n            }\n        }\n    }\n    return 1.0 - shadow / 9.0;\n}\n\nfloat getShadow(samplerCube shadowMap, float bias, vec3 lightPos, vec3 position, vec2 camera, mat4 lightSpaceMatrix) {\n    vec4 distanceVec = lightSpaceMatrix * vec4(position, 1.0) - lightSpaceMatrix * vec4(lightPos, 1.0);\n    float currentDistance = length(distanceVec);\n    vec3 direction = normalize(distanceVec).xyz;\n\n    float shadow = 0.0;\n    const float samples = 2.0;\n    const float offset = 0.01;\n    const float step = offset / (samples * 0.5);\n    for(float x = -offset; x < offset; x +=step)\n    {\n        for(float y = -offset; y < offset; y +=step)\n        {\n            for(float z = -offset; z < offset; z +=step)\n            {\n                float closestDistance = camera[0] + (camera[1] - camera[0]) * unpackFloat(textureCube(shadowMap, direction + vec3(x, y, z)));\n                if (closestDistance == camera[0]) {\n                    continue;\n                }\n                else if(currentDistance - bias > closestDistance)\n                    shadow += 1.0;\n            }\n        }\n    }\n    shadow /= (samples * samples * samples);\n\n    return 1.0 - shadow;\n}\n\n"},function(e,t,n){e.exports="#define GLSLIFY 1\n"+n(43)+"\n"+n(67)+"\n\n#ifdef HILO_HAS_LIGHT\n    #ifdef HILO_HAS_SPECULAR\n        uniform float u_shininess;\n        #ifdef HILO_SPECULAR_MAP\n            uniform HILO_SAMPLER_2D u_specular;\n        #else\n            uniform vec4 u_specular;\n        #endif\n    #endif\n    #ifdef HILO_EMISSION_MAP\n        uniform HILO_SAMPLER_2D u_emission;\n    #else\n        uniform vec4 u_emission;\n    #endif\n    #ifdef HILO_AMBIENT_MAP\n        uniform HILO_SAMPLER_2D u_ambient;\n    #endif\n    #ifdef HILO_SPECULAR_ENV_MAP\n        #ifdef HILO_SPECULAR_ENV_MAP_CUBE\n            uniform samplerCube u_specularEnvMap;\n        #else\n            uniform sampler2D u_specularEnvMap;\n        #endif\n        uniform mat4 u_specularEnvMatrix;\n        uniform float u_reflectivity;\n        uniform float u_refractRatio;\n        uniform float u_refractivity;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_FIX_MAX_BUG\n    float hilo_max(float a, float b){\n        if (a > b) {\n            return a;\n        }\n        return b;\n    }\n    #define HILO_MAX(a, b) hilo_max(a, b);\n#else\n    #define HILO_MAX(a, b) max(a, b);\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#if defined(HILO_DIFFUSE_MAP)\n    diffuse = HILO_TEXTURE_2D(u_diffuse);\n#elif defined(HILO_DIFFUSE_CUBE_MAP)\n    diffuse = textureCube(u_diffuse, v_position);\n#elif defined(HILO_HAS_COLOR)\n    diffuse = v_color;\n#else\n    diffuse = u_diffuse;\n#endif\ncolor.a = diffuse.a;"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_LIGHT\n    vec3 lightDiffuse = vec3(0, 0, 0);\n    vec3 lightAmbient = vec3(0, 0, 0);\n    vec3 viewPos = vec3(0, 0, 0);\n\n    #ifdef HILO_AMBIENT_MAP\n        lightAmbient = HILO_TEXTURE_2D(u_ambient).rgb;\n    #else\n        lightAmbient = diffuse.rgb;\n    #endif\n\n    #ifdef HILO_HAS_SPECULAR\n        vec3 lightSpecular = vec3(0, 0, 0);\n        #ifdef HILO_SPECULAR_MAP\n            vec4 specular = HILO_TEXTURE_2D(u_specular);\n        #else\n            vec4 specular = u_specular;\n        #endif\n    #endif\n    \n    #ifdef HILO_EMISSION_MAP\n        vec4 emission = HILO_TEXTURE_2D(u_emission);\n    #else\n        vec4 emission = u_emission;\n    #endif\n\n    #ifdef HILO_DIRECTIONAL_LIGHTS\n        for(int i = 0;i < HILO_DIRECTIONAL_LIGHTS;i++){\n            vec3 lightDir = -u_directionalLightsInfo[i];\n\n            float shadow = 1.0;\n            #ifdef HILO_DIRECTIONAL_LIGHTS_SMC\n                if (i < HILO_DIRECTIONAL_LIGHTS_SMC) {\n                    float bias = HILO_MAX(u_directionalLightsShadowBias[i][1] * (1.0 - dot(normal, lightDir)), u_directionalLightsShadowBias[i][0]);\n                    shadow = getShadow(u_directionalLightsShadowMap[i], u_directionalLightsShadowMapSize[i], bias, v_fragPos, u_directionalLightSpaceMatrix[i]);\n                }\n            #endif\n\n            float diff = getDiffuse(normal, lightDir);\n            lightDiffuse += diff * u_directionalLightsColor[i] * shadow;\n\n            #ifdef HILO_HAS_SPECULAR\n                float spec = getSpecular(viewPos, v_fragPos, lightDir, normal, u_shininess);\n                lightSpecular += spec * u_directionalLightsColor[i] * shadow;\n            #endif\n        }\n    #endif\n\n    #ifdef HILO_SPOT_LIGHTS\n        for(int i = 0; i < HILO_SPOT_LIGHTS; i++){\n            vec3 lightDir = -u_spotLightsDir[i];\n            vec3 distanceVec = u_spotLightsPos[i] - v_fragPos;\n\n            float shadow = 1.0;\n            #ifdef HILO_SPOT_LIGHTS_SMC\n                if (i < HILO_SPOT_LIGHTS_SMC) {\n                    float bias = HILO_MAX(u_spotLightsShadowBias[i][1] * (1.0 - dot(normal, lightDir)), u_spotLightsShadowBias[i][0]);\n                    shadow = getShadow(u_spotLightsShadowMap[i], u_spotLightsShadowMapSize[i], bias, v_fragPos, u_spotLightSpaceMatrix[i]);\n                }\n            #endif\n            \n            float diff = getDiffuse(normal, normalize(distanceVec));\n            float theta = dot(normalize(distanceVec), lightDir);\n            float epsilon = u_spotLightsCutoffs[i][0] - u_spotLightsCutoffs[i][1];\n            float intensity = clamp((theta - u_spotLightsCutoffs[i][1]) / epsilon, 0.0, 1.0);\n            float attenuation = getLightAttenuation(distanceVec, u_spotLightsInfo[i], u_spotLightsRange[i]);\n\n            lightDiffuse += intensity * attenuation * shadow * diff * u_spotLightsColor[i];\n\n            #ifdef HILO_HAS_SPECULAR\n                float spec = getSpecular(viewPos, v_fragPos, lightDir, normal, u_shininess);\n                lightSpecular += intensity * attenuation * shadow * spec * u_spotLightsColor[i];\n            #endif\n        }\n    #endif\n\n    #ifdef HILO_POINT_LIGHTS\n        for(int i = 0;i < HILO_POINT_LIGHTS;i++){\n            vec3 distanceVec = u_pointLightsPos[i] - v_fragPos;\n            vec3 lightDir = normalize(distanceVec);\n\n            float shadow = 1.0;\n            #ifdef HILO_POINT_LIGHTS_SMC\n                if (i < HILO_POINT_LIGHTS_SMC) {\n                    float bias = HILO_MAX(u_pointLightsShadowBias[i][1] * (1.0 - dot(normal, lightDir)), u_pointLightsShadowBias[i][0]);\n                    shadow = getShadow(u_pointLightsShadowMap[i], bias, u_pointLightsPos[i], v_fragPos, u_pointLightCamera[i], u_pointLightSpaceMatrix[i]);\n                }\n            #endif\n            \n            float diff = getDiffuse(normal, lightDir);\n            float attenuation = getLightAttenuation(distanceVec, u_pointLightsInfo[i], u_pointLightsRange[i]);\n            lightDiffuse += diff * attenuation * u_pointLightsColor[i] * shadow;\n\n            #ifdef HILO_HAS_SPECULAR\n                float spec = getSpecular(viewPos, v_fragPos, lightDir, normal, u_shininess);\n                lightSpecular += spec * attenuation * u_pointLightsColor[i] * shadow;\n            #endif\n        }\n    #endif\n\n    #ifdef HILO_AREA_LIGHTS\n        #ifndef HILO_HAS_SPECULAR\n            vec4 specular = vec4(0.0, 0.0, 0.0, 0.0);\n        #endif\n        vec3 viewDir = normalize(vec3(0, 0, 0) - v_fragPos);\n        for(int i = 0; i < HILO_AREA_LIGHTS; i++){\n            color.rgb += getAreaLight(diffuse.rgb, specular.rgb, sqrt(2.0/(u_shininess+2.0)), normal, viewDir, v_fragPos, u_areaLightsPos[i], u_areaLightsColor[i], u_areaLightsWidth[i], u_areaLightsHeight[i], u_areaLightsLtcTexture1, u_areaLightsLtcTexture2);\n        }\n    #endif\n\n    #ifdef HILO_AMBIENT_LIGHTS\n        color.rgb += u_ambientLightsColor * lightAmbient;\n    #endif\n\n    #if defined(HILO_SPECULAR_ENV_MAP) && defined(HILO_HAS_SPECULAR)\n        vec3 I = normalize(v_fragPos - viewPos);\n        if (u_reflectivity > 0.0) {\n            vec3 R = reflect(I, normal);\n            R = normalize(vec3(u_specularEnvMatrix * vec4(R, 1.0)));\n            lightSpecular += textureEnvMap(u_specularEnvMap, R).rgb * u_reflectivity;\n        }\n        if (u_refractivity > 0.0) {\n            vec3 R = refract(I, normal, u_refractRatio);\n            R = normalize(vec3(u_specularEnvMatrix * vec4(R, 1.0)));\n            lightSpecular += textureEnvMap(u_specularEnvMap, R).rgb * u_refractivity;\n        }\n    #endif\n\n    color.rgb += lightDiffuse * diffuse.rgb;\n    #ifdef HILO_HAS_SPECULAR\n        color.rgb += lightSpecular * specular.rgb;\n    #endif\n\n    color.rgb += emission.rgb;\n#else\n    color = diffuse;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_FOG\n    float fogFactor = 1.0;\n\n    #ifdef HILO_FOG_LINEAR\n        fogFactor = (u_fogInfo.y - v_dist)/(u_fogInfo.y - u_fogInfo.x);\n    #elif defined(HILO_FOG_EXP)\n        fogFactor = exp(-abs(u_fogInfo * v_dist));\n    #elif defined(HILO_FOG_EXP2)\n        fogFactor = exp(-(u_fogInfo * v_dist) * (u_fogInfo * v_dist)); \n    #endif\n    \n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    color = mix(u_fogColor, color, fogFactor);\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_QUANTIZED\n    #ifdef HILO_POSITION_QUANTIZED\n        uniform mat4 u_positionDecodeMat;\n    #endif\n    #ifdef HILO_NORMAL_QUANTIZED\n        uniform mat4 u_normalDecodeMat;\n    #endif\n    #ifdef HILO_UV_QUANTIZED\n        uniform mat3 u_uvDecodeMat;\n    #endif\n    #ifdef HILO_UV1_QUANTIZED\n        uniform mat3 u_uv1DecodeMat;\n    #endif\n\n    vec2 unQuantize(vec2 data, mat3 decodeMat) {\n        vec3 result = vec3(data, 1.0);\n        result = decodeMat * result;\n        return result.xy;\n    }\n\n    vec3 unQuantize(vec3 data, mat4 decodeMat) {\n        vec4 result = vec4(data, 1.0);\n        result = decodeMat * result;\n        return result.xyz;\n    }\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_JOINT_COUNT\n    attribute vec4 a_skinIndices;\n    attribute vec4 a_skinWeights;\n    #ifdef HILO_JOINT_MAT_MAP\n        uniform sampler2D u_jointMatTexture;\n        uniform vec2 u_jointMatTextureSize;\n        mat4 getJointMat(float index) {\n            index *= 4.0;\n            float x = float(mod(index, u_jointMatTextureSize.x));\n            float y = float(floor(index / u_jointMatTextureSize.x));\n            float dx = 1.0 / float(u_jointMatTextureSize.x);\n            float dy = 1.0 / float(u_jointMatTextureSize.y);\n            y = dy * (y + 0.5);\n            vec4 v1 = texture2D(u_jointMatTexture, vec2(dx * (x + 0.5), y));\n            vec4 v2 = texture2D(u_jointMatTexture, vec2(dx * (x + 1.5), y));\n            vec4 v3 = texture2D(u_jointMatTexture, vec2(dx * (x + 2.5), y));\n            vec4 v4 = texture2D(u_jointMatTexture, vec2(dx * (x + 3.5), y));\n            mat4 mat = mat4(v1, v2, v3, v4);\n            return mat;\n        }\n\n        mat4 getJointMat(vec4 weights, vec4 indices) {\n            mat4 mat = weights.x * getJointMat(indices.x);\n            mat += weights.y * getJointMat(indices.y);\n            mat += weights.z * getJointMat(indices.z);\n            mat += weights.w * getJointMat(indices.w);\n            return mat;\n        }\n    #else\n        uniform mat4 u_jointMat[HILO_JOINT_COUNT];\n       \n        mat4 getJointMat(vec4 weights, vec4 indices) {\n            mat4 mat = weights.x * u_jointMat[int(indices.x)];\n            mat += weights.y * u_jointMat[int(indices.y)];\n            mat += weights.z * u_jointMat[int(indices.z)];\n            mat += weights.w * u_jointMat[int(indices.w)];\n            return mat;\n        }\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_TEXCOORD0\n    attribute vec2 a_texcoord0;\n    varying vec2 v_texcoord0;\n    #ifdef HILO_UV_MATRIX\n        uniform mat3 u_uvMatrix;\n    #endif\n#endif\n\n#ifdef HILO_HAS_TEXCOORD1\n    attribute vec2 a_texcoord1;\n    varying vec2 v_texcoord1;\n    #ifdef HILO_UV_MATRIX1\n        uniform mat3 u_uvMatrix1;\n    #endif\n#endif\n\n#ifdef HILO_DIFFUSE_CUBE_MAP\n    varying vec3 v_position;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_NORMAL\n    attribute vec3 a_normal;\n    uniform mat3 u_normalMatrix;\n    varying vec3 v_normal;\n\n    #if defined(HILO_NORMAL_MAP) || defined(HILO_CLEARCOAT_NORMAL_MAP)\n        attribute vec4 a_tangent;\n        varying mat3 v_TBN;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#if defined(HILO_HAS_LIGHT) || defined(HILO_HAS_FOG) || defined(HILO_HAS_FRAG_POS)\n    uniform mat4 u_modelViewMatrix;\n    #ifdef HILO_HAS_FOG\n        varying float v_dist;\n    #endif\n\n    #if defined(HILO_HAS_LIGHT) || defined(HILO_HAS_FRAG_POS) \n        varying vec3 v_fragPos;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_MORPH_TARGET_COUNT\n    uniform float u_morphWeights[HILO_MORPH_TARGET_COUNT];\n\n    #if HILO_MORPH_TARGET_COUNT > 0\n        #ifdef HILO_MORPH_HAS_POSITION\n            attribute vec3 a_morphPosition0;\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            attribute vec3 a_morphNormal0;\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            attribute vec3 a_morphTangent0;\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 1\n        #ifdef HILO_MORPH_HAS_POSITION\n            attribute vec3 a_morphPosition1;\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            attribute vec3 a_morphNormal1;\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            attribute vec3 a_morphTangent1;\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 2\n        #ifdef HILO_MORPH_HAS_POSITION\n            attribute vec3 a_morphPosition2;\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            attribute vec3 a_morphNormal2;\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            attribute vec3 a_morphTangent2;\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 3\n        #ifdef HILO_MORPH_HAS_POSITION\n            attribute vec3 a_morphPosition3;\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            attribute vec3 a_morphNormal3;\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            attribute vec3 a_morphTangent3;\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 4\n        #ifdef HILO_MORPH_HAS_POSITION\n            attribute vec3 a_morphPosition4;\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            attribute vec3 a_morphNormal4;\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            attribute vec3 a_morphTangent4;\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 5\n        #ifdef HILO_MORPH_HAS_POSITION\n            attribute vec3 a_morphPosition5;\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            attribute vec3 a_morphNormal5;\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            attribute vec3 a_morphTangent5;\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 6\n        #ifdef HILO_MORPH_HAS_POSITION\n            attribute vec3 a_morphPosition6;\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            attribute vec3 a_morphNormal6;\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            attribute vec3 a_morphTangent6;\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 7\n        #ifdef HILO_MORPH_HAS_POSITION\n            attribute vec3 a_morphPosition7;\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            attribute vec3 a_morphNormal7;\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            attribute vec3 a_morphTangent7;\n        #endif\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_COLOR\n    #if HILO_COLOR_SIZE == 3\n        attribute vec3 a_color;\n    #elif HILO_COLOR_SIZE == 4\n        attribute vec4 a_color;\n    #endif\n    varying vec4 v_color;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_USE_LOG_DEPTH\n    #ifdef HILO_USE_EXT_FRAG_DEPTH\n        varying float v_fragDepth;\n    #else\n        uniform float u_logDepth;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_COLOR\n    #if HILO_COLOR_SIZE == 3\n        v_color = vec4(a_color, 1.0);\n    #elif HILO_COLOR_SIZE == 4\n        v_color = a_color;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_QUANTIZED\n    #ifdef HILO_POSITION_QUANTIZED\n        pos.xyz = unQuantize(pos.xyz, u_positionDecodeMat);\n    #endif\n    #if defined(HILO_HAS_TEXCOORD0) && defined(HILO_UV_QUANTIZED)\n        uv = unQuantize(uv, u_uvDecodeMat);\n    #endif\n    #if defined(HILO_HAS_TEXCOORD1) && defined(HILO_UV1_QUANTIZED)\n        uv1 = unQuantize(uv1, u_uv1DecodeMat);\n    #endif\n    #if defined(HILO_HAS_NORMAL) && defined(HILO_NORMAL_QUANTIZED)\n        normal = unQuantize(normal, u_normalDecodeMat);\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_MORPH_TARGET_COUNT\n    #if HILO_MORPH_TARGET_COUNT > 0\n        #ifdef HILO_MORPH_HAS_POSITION\n            pos.xyz += a_morphPosition0 * u_morphWeights[0];\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            normal += a_morphNormal0 * u_morphWeights[0];\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            tangent.xyz += a_morphTangent0 * u_morphWeights[0];\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 1\n        #ifdef HILO_MORPH_HAS_POSITION\n            pos.xyz += a_morphPosition1 * u_morphWeights[1];\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            normal += a_morphNormal1 * u_morphWeights[1];\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            tangent.xyz += a_morphTangent1 * u_morphWeights[1];\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 2\n        #ifdef HILO_MORPH_HAS_POSITION\n            pos.xyz += a_morphPosition2 * u_morphWeights[2];\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            normal += a_morphNormal2 * u_morphWeights[2];\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            tangent.xyz += a_morphTangent2 * u_morphWeights[2];\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 3\n        #ifdef HILO_MORPH_HAS_POSITION\n            pos.xyz += a_morphPosition3 * u_morphWeights[3];\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            normal += a_morphNormal3 * u_morphWeights[3];\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            tangent.xyz += a_morphTangent3 * u_morphWeights[3];\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 4\n        #ifdef HILO_MORPH_HAS_POSITION\n            pos.xyz += a_morphPosition4 * u_morphWeights[4];\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            normal += a_morphNormal4 * u_morphWeights[4];\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            tangent.xyz += a_morphTangent4 * u_morphWeights[4];\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 5\n        #ifdef HILO_MORPH_HAS_POSITION\n            pos.xyz += a_morphPosition5 * u_morphWeights[5];\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            normal += a_morphNormal5 * u_morphWeights[5];\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            tangent.xyz += a_morphTangent5 * u_morphWeights[5];\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 6\n        #ifdef HILO_MORPH_HAS_POSITION\n            pos.xyz += a_morphPosition6 * u_morphWeights[6];\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            normal += a_morphNormal6 * u_morphWeights[6];\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            tangent.xyz += a_morphTangent6 * u_morphWeights[6];\n        #endif\n    #endif\n\n    #if HILO_MORPH_TARGET_COUNT > 7\n        #ifdef HILO_MORPH_HAS_POSITION\n            pos.xyz += a_morphPosition7 * u_morphWeights[7];\n        #endif\n        #if defined(HILO_MORPH_HAS_NORMAL) && defined(HILO_HAS_NORMAL)\n            normal += a_morphNormal7 * u_morphWeights[7];\n        #endif\n        #if defined(HILO_MORPH_HAS_TANGENT) && defined(HILO_HAS_TANGENT)\n            tangent.xyz += a_morphTangent7 * u_morphWeights[7];\n        #endif\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_JOINT_COUNT\n    mat4 skinMat = getJointMat(a_skinWeights, a_skinIndices);\n    pos = skinMat * pos;\n\n    #ifdef HILO_HAS_NORMAL\n        normal = mat3(skinMat) * normal;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_TEXCOORD0\n    #ifdef HILO_UV_MATRIX\n        v_texcoord0 = (u_uvMatrix * vec3(uv, 1.0)).xy;\n    #else\n        v_texcoord0 = uv;\n    #endif\n#endif\n#ifdef HILO_HAS_TEXCOORD1\n    #ifdef HILO_UV_MATRIX1\n        v_texcoord1 = (u_uvMatrix1 * vec3(uv1, 1.0)).xy;\n    #else\n        v_texcoord1 = uv1;\n    #endif\n#endif\n#ifdef HILO_DIFFUSE_CUBE_MAP\n    v_position = pos.xyz;\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_HAS_NORMAL\n    #if defined(HILO_NORMAL_MAP) || defined(HILO_CLEARCOAT_NORMAL_MAP)\n        vec3 T = normalize(u_normalMatrix * tangent.xyz);\n        vec3 N = normalize(u_normalMatrix * normal);\n        T = normalize(T - dot(T, N) * N);\n        vec3 B = cross(N, T) * tangent.w;\n        v_TBN = mat3(T, B, N);\n    #endif\n    v_normal = normalize(u_normalMatrix * normal);\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#if defined(HILO_HAS_LIGHT) || defined(HILO_HAS_FOG) || defined(HILO_HAS_FRAG_POS)\n    vec3 fragPos = (u_modelViewMatrix * pos).xyz;\n\n    #if defined(HILO_HAS_LIGHT) || defined(HILO_HAS_FRAG_POS)\n        v_fragPos = fragPos;\n    #endif\n\n    #ifdef HILO_HAS_FOG\n        v_dist = length(fragPos);\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n#ifdef HILO_USE_LOG_DEPTH\n    #ifdef HILO_USE_EXT_FRAG_DEPTH\n        v_fragDepth = 1.0 + gl_Position.w;\n    #else\n        gl_Position.z = log2( max( 1e-6, gl_Position.w + 1.0 ) ) * u_logDepth - 1.0;\n        gl_Position.z *= gl_Position.w;\n    #endif\n#endif"},function(e,t){e.exports="#define GLSLIFY 1\n// https://github.com/playcanvas/engine/blob/master/src/graphics/program-lib/chunks/packDepth.frag\n// Packing a float in GLSL with multiplication and mod\n// http://blog.gradientstudios.com/2012/08/23/shadow-map-improvement\nvec4 packFloat(float depth) {\n    const vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n\n    // combination of mod and multiplication and division works better\n    vec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n    res -= res.xxyz * bit_mask;\n    return res;\n}\n\n\n\n"},function(e,t,n){e.exports="#define GLSLIFY 1\n"+n(43)+"\n"+n(89)+"\n"+n(67)+'\n\nuniform vec4 u_baseColor;\nuniform vec4 u_emissionFactor;\n\n#ifdef HILO_BASE_COLOR_MAP\n    uniform HILO_SAMPLER_2D u_baseColorMap;\n#endif\n\n#ifdef HILO_NEED_WORLD_NORMAL\n    uniform mat3 u_viewInverseNormalMatrix;\n#endif\n\n#ifdef HILO_HAS_LIGHT\n    uniform float u_metallic;\n    #ifdef HILO_METALLIC_MAP\n        uniform HILO_SAMPLER_2D u_metallicMap;\n    #endif\n        uniform float u_roughness;\n    #ifdef HILO_ROUGHNESS_MAP\n        uniform HILO_SAMPLER_2D u_roughnessMap;\n    #endif\n    #ifdef HILO_METALLIC_ROUGHNESS_MAP\n        uniform HILO_SAMPLER_2D u_metallicRoughnessMap;\n    #endif\n    #ifdef HILO_OCCLUSION_MAP\n        uniform HILO_SAMPLER_2D u_occlusionMap;\n    #endif\n\n    #ifdef HILO_OCCLUSION_STRENGTH\n        uniform float u_occlusionStrength;\n    #endif\n\n    #ifdef HILO_DIFFUSE_ENV_MAP\n        #ifdef HILO_DIFFUSE_ENV_MAP_CUBE\n            uniform samplerCube u_diffuseEnvMap;\n        #else\n            uniform sampler2D u_diffuseEnvMap;\n        #endif\n        uniform float u_diffuseEnvIntensity;\n    #elif defined(HILO_DIFFUSE_ENV_SPHERE_HARMONICS3)\n        uniform vec3 u_diffuseEnvSphereHarmonics3[9];\n        uniform float u_diffuseEnvIntensity;\n    #endif\n    #ifdef HILO_SPECULAR_ENV_MAP\n        uniform sampler2D u_brdfLUT;\n        #ifdef HILO_SPECULAR_ENV_MAP_CUBE\n            uniform samplerCube u_specularEnvMap;\n        #else\n            uniform sampler2D u_specularEnvMap;\n        #endif\n        uniform float u_specularEnvIntensity;\n\n        uniform float u_specularEnvMapMipCount;\n    #endif\n\n    #ifdef HILO_EMISSION_MAP\n        uniform HILO_SAMPLER_2D u_emission;\n    #endif\n\n    #ifdef HILO_PBR_SPECULAR_GLOSSINESS\n        uniform vec4 u_specular;\n        uniform float u_glossiness;\n        #ifdef HILO_SPECULAR_GLOSSINESS_MAP\n            uniform HILO_SAMPLER_2D u_specularGlossinessMap;\n        #endif\n    #endif\n\n    #ifdef HILO_LIGHT_MAP\n        uniform HILO_SAMPLER_2D u_lightMap;\n    #endif\n\n    #ifdef HILO_HAS_CLEARCOAT\n        uniform float u_clearcoatFactor;\n        #ifdef HILO_CLEARCOAT_MAP\n            uniform HILO_SAMPLER_2D u_clearcoatMap;\n        #endif\n\n        uniform float u_clearcoatRoughnessFactor;\n        #ifdef HILO_CLEARCOAT_ROUGHNESS_MAP\n            uniform HILO_SAMPLER_2D u_clearcoatRoughnessMap;\n        #endif\n    #endif\n\n\n    // PBR Based on https://github.com/KhronosGroup/glTF-WebGL-PBR\n\n    // Basic Lambertian diffuse\n    // Implementation from Lambert\'s Photometria https://archive.org/details/lambertsphotome00lambgoog\n    // See also [1], Equation 1\n    vec3 diffuse(vec3 diffuseColor) {\n        return diffuseColor * HILO_INVERSE_PI;\n    }\n\n    // The following equation models the Fresnel reflectance term of the spec equation (aka F())\n    // Implementation of fresnel from [4], Equation 15\n    vec3 specularReflection(vec3 reflectance0, vec3 reflectance90, float VdotH) {\n        return reflectance0 + (reflectance90 - reflectance0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n    }\n\n    // This calculates the specular geometric attenuation (aka G()),\n    // where rougher material will reflect less light back to the viewer.\n    // This implementation is based on [1] Equation 4, and we adopt their modifications to\n    // alphaRoughness as input as originally proposed in [2].\n    float geometricOcclusion(float NdotL, float NdotV, float alphaRoughness) {\n        float r = alphaRoughness * alphaRoughness;\n\n        float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r + (1.0 - r) * (NdotL * NdotL)));\n        float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r + (1.0 - r) * (NdotV * NdotV)));\n        return attenuationL * attenuationV;\n    }\n\n    // The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n    // Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz\n    // Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\n    float microfacetDistribution(float alphaRoughness, float NdotH) {\n        float roughnessSq = alphaRoughness * alphaRoughness;\n        float f = (NdotH * roughnessSq - NdotH) * NdotH + 1.0;\n        return roughnessSq * HILO_INVERSE_PI / (f * f);\n    }\n\n    vec3 computeDiffuseSHLight(vec3 normal, in vec3 sh[9]) {\n        return sh[0] +\n            sh[1] * (normal.y) +\n            sh[2] * (normal.z) +\n            sh[3] * (normal.x) +\n            sh[4] * (normal.y * normal.x) +\n            sh[5] * (normal.y * normal.z) +\n            sh[6] * ((3.0 * normal.z * normal.z) - 1.0) +\n            sh[7] * (normal.z * normal.x) +\n            sh[8] * (normal.x * normal.x - (normal.y * normal.y));\n    }\n\n    // https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Vendor/EXT_lights_image_based/README.md#rgbd\n    vec3 decodeRGBD(in vec4 color){\n        return color.rgb / color.a;\n    }\n\n    vec3 getIBLClearCoatContribution(in vec3 N, in vec3 V, vec3 diffuseColor, vec3 specularColor, float ao, float NdotV, float perceptualRoughness) {\n        vec3 color = vec3(.0, .0, .0);\n        #ifdef HILO_SPECULAR_ENV_MAP\n            vec3 R = -normalize(reflect(V, N));\n            vec3 brdf = texture2D(u_brdfLUT, vec2(NdotV, 1.0 - perceptualRoughness)).rgb;\n            #ifdef HILO_IS_SPECULAR_ENV_MAP_INCLUDE_MIPMAPS\n                float lod = clamp(perceptualRoughness * u_specularEnvMapMipCount, 0.0, u_specularEnvMapMipCount);\n                vec4 specularEnvMap = textureEnvMapIncludeMipmapsLod(u_specularEnvMap, R, lod);\n            #elif HILO_USE_SHADER_TEXTURE_LOD\n                float lod = clamp(perceptualRoughness * u_specularEnvMapMipCount, 0.0, u_specularEnvMapMipCount);\n                vec4 specularEnvMap = textureEnvMapLod(u_specularEnvMap, R, lod);\n            #else\n                vec4 specularEnvMap = textureEnvMap(u_specularEnvMap, R);\n            #endif\n\n            vec3 specularLight = decodeRGBD(specularEnvMap);\n\n            #ifdef HILO_GAMMA_CORRECTION\n                specularLight = sRGBToLinear(specularLight);\n            #endif\n            color.rgb += specularLight * (specularColor * brdf.x + brdf.y) * u_specularEnvIntensity;\n        #endif\n        return color;\n    }\n\n    vec3 getIBLContribution(in vec3 N, in vec3 V, vec3 diffuseColor, vec3 specularColor, float ao, float NdotV, float perceptualRoughness) {\n        vec3 color = vec3(.0, .0, .0);\n        #ifdef HILO_NEED_WORLD_NORMAL\n        N = u_viewInverseNormalMatrix * N;\n        V = u_viewInverseNormalMatrix * V;\n        #endif\n        #if defined(HILO_DIFFUSE_ENV_MAP) || defined(HILO_DIFFUSE_ENV_SPHERE_HARMONICS3)\n            #ifdef HILO_DIFFUSE_ENV_MAP\n                #ifdef HILO_GAMMA_CORRECTION\n                    vec3 diffuseLight = sRGBToLinear(textureEnvMap(u_diffuseEnvMap, N)).rgb;\n                #else\n                    vec3 diffuseLight = textureEnvMap(u_diffuseEnvMap, N).rgb;\n                #endif\n            #elif defined(HILO_DIFFUSE_ENV_SPHERE_HARMONICS3)\n                vec3 diffuseLight = computeDiffuseSHLight(N, u_diffuseEnvSphereHarmonics3);\n            #endif\n            color.rgb += diffuseLight * diffuseColor * ao * u_diffuseEnvIntensity;\n        #endif\n\n        #ifdef HILO_SPECULAR_ENV_MAP\n            vec3 R = -normalize(reflect(V, N));\n            vec3 brdf = texture2D(u_brdfLUT, vec2(NdotV, 1.0 - perceptualRoughness)).rgb;\n            #ifdef HILO_IS_SPECULAR_ENV_MAP_INCLUDE_MIPMAPS\n                float lod = clamp(perceptualRoughness * u_specularEnvMapMipCount, 0.0, u_specularEnvMapMipCount);\n                vec4 specularEnvMap = textureEnvMapIncludeMipmapsLod(u_specularEnvMap, R, lod);\n            #elif HILO_USE_SHADER_TEXTURE_LOD\n                float lod = clamp(perceptualRoughness * u_specularEnvMapMipCount, 0.0, u_specularEnvMapMipCount);\n                vec4 specularEnvMap = textureEnvMapLod(u_specularEnvMap, R, lod);\n            #else\n                vec4 specularEnvMap = textureEnvMap(u_specularEnvMap, R);\n            #endif\n\n            vec3 specularLight = decodeRGBD(specularEnvMap);\n\n            #ifdef HILO_GAMMA_CORRECTION\n                specularLight = sRGBToLinear(specularLight);\n            #endif\n            color.rgb += specularLight * (specularColor * brdf.x + brdf.y) * u_specularEnvIntensity;\n        #endif\n        return color;\n    }\n\n    vec3 calculateLo(vec3 N, vec3 V, vec3 L, vec3 reflectance0, vec3 reflectance90, float alphaRoughness, vec3 diffuseColor, float NdotV) {\n        vec3 H = normalize(L + V);\n        float NdotL = clamp(dot(N, L), 0.001, 1.0);\n        float NdotH = clamp(dot(N, H), 0.0, 1.0);\n        float LdotH = clamp(dot(L, H), 0.0, 1.0);\n        float VdotH = clamp(dot(V, H), 0.0, 1.0);\n        // Calculate the shading terms for the microfacet specular shading model\n        vec3 F = specularReflection(reflectance0, reflectance90, VdotH);\n        float G = geometricOcclusion(NdotL, NdotV, alphaRoughness);\n        float D = microfacetDistribution(alphaRoughness, NdotH);\n\n        vec3 diffuseContrib;\n\n        #ifdef HILO_LIGHT_MAP\n            diffuseContrib = vec3(0.0);\n        #else\n            diffuseContrib = (1.0 - F) * diffuse(diffuseColor);\n        #endif\n        vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);\n        // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\n        return NdotL * (diffuseContrib + specContrib);\n    }\n\n    #ifdef HILO_HAS_CLEARCOAT\n        float calculateClearcoatBRDF(vec3 N, vec3 V, vec3 L, float clearcoatAlphaRoughness, float NdotV) {\n            vec3 H = normalize(L + V);\n            float NdotL = clamp(dot(N, L), 0.001, 1.0);\n            float NdotH = clamp(dot(N, H), 0.0, 1.0);\n            float VdotH = clamp(dot(V, H), 0.0, 1.0);\n\n            float G = geometricOcclusion(NdotL, NdotV, clearcoatAlphaRoughness);\n            float D = microfacetDistribution(clearcoatAlphaRoughness, NdotH);\n\n            float clearcoatLayer = G * D / (4.0 * NdotV);\n\n            return clearcoatLayer;\n        }\n    #endif\n#endif'},function(e,t){e.exports="#define GLSLIFY 1\nvec4 sRGBToLinear( in vec4 value ) {\n    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\n\nvec3 sRGBToLinear( in vec3 value ) {\n    return vec3( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ));\n}\n\n"},function(e,t,n){e.exports="#define GLSLIFY 1\nvec4 baseColor = u_baseColor;\nvec3 emissionColor = u_emissionFactor.rgb;\n\n#ifdef HILO_BASE_COLOR_MAP\n    #ifdef HILO_GAMMA_CORRECTION\n        baseColor *= sRGBToLinear(HILO_TEXTURE_2D(u_baseColorMap));\n    #else\n        baseColor *= HILO_TEXTURE_2D(u_baseColorMap);\n    #endif\n#endif\n\n#if defined(HILO_HAS_COLOR)\n    baseColor *= v_color;\n#endif\n\ncolor.a = baseColor.a;\n\n"+n(48)+"\n\n#ifdef HILO_HAS_LIGHT\n    vec3 viewPos = vec3(0, 0, 0);\n    vec3 N = normal;\n    vec3 V = normalize(viewPos - v_fragPos);\n\n    #ifdef HILO_OCCLUSION_MAP\n        float ao  = HILO_TEXTURE_2D(u_occlusionMap).r;\n    #else\n        float ao = 1.0;\n    #endif\n\n    #ifdef HILO_PBR_SPECULAR_GLOSSINESS\n        vec3 specular = u_specular.rgb;\n        float glossiness = u_glossiness;\n        #ifdef HILO_SPECULAR_GLOSSINESS_MAP\n            vec4 specularGlossiness = sRGBToLinear(HILO_TEXTURE_2D(u_specularGlossinessMap));\n            specular = specularGlossiness.rgb * specular;\n            glossiness = specularGlossiness.a * glossiness;\n        #endif\n        float roughness = 1.0 - glossiness;\n        float metallic = 0.0;\n        vec3 diffuseColor = baseColor.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));\n        vec3 specularColor = specular;\n    #else\n        float metallic = u_metallic;\n        float roughness = u_roughness;\n        #ifdef HILO_METALLIC_MAP\n            metallic = HILO_TEXTURE_2D(u_metallicMap).r * u_metallic;\n        #endif\n        #ifdef HILO_ROUGHNESS_MAP\n            roughness  = HILO_TEXTURE_2D(u_roughnessMap).r * u_roughness;\n        #endif\n        #ifdef HILO_METALLIC_ROUGHNESS_MAP\n            vec4 metallicRoughnessMap = HILO_TEXTURE_2D(u_metallicRoughnessMap);\n            #ifdef HILO_IS_OCCLUSION_MAP_IN_METALLIC_ROUGHNESS_MAP\n                ao = metallicRoughnessMap.r;\n            #endif\n            roughness = metallicRoughnessMap.g * u_roughness;\n            metallic = metallicRoughnessMap.b * u_metallic;\n        #endif\n        roughness = clamp(roughness, 0.04, 1.0);\n        metallic = clamp(metallic, 0.0, 1.0);\n        vec3 f0 = vec3(0.04);\n        vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n        diffuseColor *= 1.0 - metallic;\n        vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n    #endif\n\n    #ifdef HILO_OCCLUSION_STRENGTH\n        ao = mix(1.0, ao, u_occlusionStrength);\n    #endif\n\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n    // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\n    // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n    float NdotV = clamp(abs(dot(N, V)), 0.001, 1.0);\n    float alphaRoughness = roughness * roughness;\n\n    #ifdef HILO_HAS_CLEARCOAT\n        float clearcoatFactor = u_clearcoatFactor;\n        #ifdef HILO_CLEARCOAT_MAP\n            clearcoatFactor *= HILO_TEXTURE_2D(u_clearcoatMap).r;\n        #endif\n        float clearcoatRoughnessFactor = u_clearcoatRoughnessFactor;\n        #ifdef HILO_CLEARCOAT_ROUGHNESS_MAP\n            clearcoatRoughnessFactor *= HILO_TEXTURE_2D(u_clearcoatRoughnessMap).g;\n        #endif\n\n        float clearcoatAlphaRoughnessFactor = clearcoatRoughnessFactor * clearcoatRoughnessFactor;\n        vec3 NC = clearcoatNormal;\n        float NCdotV = clamp(abs(dot(NC, V)), 0.001, 1.0);\n        float clearCoatFresnel = 0.04 + (1.0 - 0.04) * pow((1.0 - abs(NCdotV)),5.0);\n        vec3 clearCoatLayer = vec3(0.0);\n    #endif\n\n    #ifdef HILO_DIRECTIONAL_LIGHTS\n        for(int i = 0;i < HILO_DIRECTIONAL_LIGHTS;i++){\n            vec3 lightDir = normalize(-u_directionalLightsInfo[i]);\n            vec3 radiance = u_directionalLightsColor[i];\n            float shadow = 1.0;\n            #ifdef HILO_DIRECTIONAL_LIGHTS_SMC\n                if (i < HILO_DIRECTIONAL_LIGHTS_SMC) {\n                    float bias = HILO_MAX(u_directionalLightsShadowBias[i][1] * (1.0 - dot(N, lightDir)), u_directionalLightsShadowBias[i][0]);\n                    shadow = getShadow(u_directionalLightsShadowMap[i], u_directionalLightsShadowMapSize[i], bias, v_fragPos, u_directionalLightSpaceMatrix[i]);\n                }\n            #endif\n            #ifdef HILO_HAS_CLEARCOAT\n                clearCoatLayer += shadow * radiance * calculateClearcoatBRDF(NC, V, lightDir, clearcoatAlphaRoughnessFactor, NCdotV);\n            #endif\n            color.rgb += shadow * radiance * calculateLo(N, V, lightDir, specularEnvironmentR0, specularEnvironmentR90, alphaRoughness, diffuseColor, NdotV);\n        }\n    #endif\n\n    #ifdef HILO_SPOT_LIGHTS\n        for(int i = 0; i < HILO_SPOT_LIGHTS; i++){\n            vec3 lightDir = normalize(-u_spotLightsDir[i]);\n            vec3 distanceVec = u_spotLightsPos[i] - v_fragPos;\n\n            float theta = dot(normalize(distanceVec), lightDir);\n            float epsilon = u_spotLightsCutoffs[i][0] - u_spotLightsCutoffs[i][1];\n            float intensity = clamp((theta - u_spotLightsCutoffs[i][1]) / epsilon, 0.0, 1.0);\n            float attenuation = getLightAttenuation(distanceVec, u_spotLightsInfo[i], u_spotLightsRange[i]);\n            vec3 radiance = intensity * attenuation * u_spotLightsColor[i];\n\n            float shadow = 1.0;\n            #ifdef HILO_SPOT_LIGHTS_SMC\n                if (i < HILO_SPOT_LIGHTS_SMC) {\n                    float bias = HILO_MAX(u_spotLightsShadowBias[i][1] * (1.0 - dot(N, lightDir)), u_spotLightsShadowBias[i][0]);\n                    shadow = getShadow(u_spotLightsShadowMap[i], u_spotLightsShadowMapSize[i], bias, v_fragPos, u_spotLightSpaceMatrix[i]);\n                }\n            #endif\n            #ifdef HILO_HAS_CLEARCOAT\n                clearCoatLayer += shadow * radiance * calculateClearcoatBRDF(NC, V, lightDir, clearcoatAlphaRoughnessFactor, NCdotV);\n            #endif\n            color.rgb += shadow * radiance * calculateLo(N, V, lightDir, specularEnvironmentR0, specularEnvironmentR90, alphaRoughness, diffuseColor, NdotV);\n        }\n    #endif\n\n    #ifdef HILO_POINT_LIGHTS\n        for(int i = 0; i < HILO_POINT_LIGHTS; i++){\n            vec3 distanceVec = u_pointLightsPos[i] - v_fragPos;\n            vec3 lightDir = normalize(distanceVec);\n\n            float shadow = 1.0;\n            #ifdef HILO_POINT_LIGHTS_SMC\n                if (i < HILO_POINT_LIGHTS_SMC) {\n                    float bias = HILO_MAX(u_pointLightsShadowBias[i][1] * (1.0 - dot(normal, lightDir)), u_pointLightsShadowBias[i][0]);\n                    shadow = getShadow(u_pointLightsShadowMap[i], bias, u_pointLightsPos[i], v_fragPos, u_pointLightCamera[i], u_pointLightSpaceMatrix[i]);\n                }\n            #endif\n\n            float attenuation = getLightAttenuation(distanceVec, u_pointLightsInfo[i], u_pointLightsRange[i]);\n            vec3 radiance = attenuation * u_pointLightsColor[i];\n\n            #ifdef HILO_HAS_CLEARCOAT\n                clearCoatLayer += shadow * radiance * calculateClearcoatBRDF(NC, V, lightDir, clearcoatAlphaRoughnessFactor, NCdotV);\n            #endif\n            color.rgb += shadow * radiance * calculateLo(N, V, lightDir, specularEnvironmentR0, specularEnvironmentR90, alphaRoughness, diffuseColor, NdotV);\n        }\n    #endif\n\n    #ifdef HILO_AREA_LIGHTS\n        for(int i = 0; i < HILO_AREA_LIGHTS; i++){\n            color.rgb += getAreaLight(diffuseColor, specularColor, roughness, N, V, v_fragPos, u_areaLightsPos[i], u_areaLightsColor[i], u_areaLightsWidth[i], u_areaLightsHeight[i], u_areaLightsLtcTexture1, u_areaLightsLtcTexture2);\n        }\n    #endif\n\n    #ifdef HILO_LIGHT_MAP\n        vec4 lightMapColor = HILO_TEXTURE_2D(u_lightMap);\n        // https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_lights_image_based#rgbd\n        color.rgb += baseColor.rgb * decodeRGBD(lightMapColor);\n    #endif\n\n    // IBL\n    #ifdef HILO_HAS_CLEARCOAT\n        clearCoatLayer += getIBLClearCoatContribution(NC, V, diffuseColor, vec3(.04), ao, NCdotV, clearcoatRoughnessFactor)/clearCoatFresnel;\n    #endif\n    color.rgb += getIBLContribution(N, V, diffuseColor, specularColor, ao, NdotV, roughness);\n\n    #if defined(HILO_AMBIENT_LIGHTS) && (defined(HILO_IS_DIFFUESENV_AND_AMBIENTLIGHT_WORK_TOGETHER) || (!defined(HILO_DIFFUSE_ENV_MAP) && !defined(HILO_DIFFUSE_ENV_SPHERE_HARMONICS3)))\n        color.rgb += u_ambientLightsColor * baseColor.rgb * ao;\n    #endif\n\n    #ifdef HILO_EMISSION_MAP\n        #ifdef HILO_GAMMA_CORRECTION\n            emissionColor *= sRGBToLinear(HILO_TEXTURE_2D(u_emission)).rgb;\n        #else\n            emissionColor *= HILO_TEXTURE_2D(u_emission).rgb;\n        #endif\n    #endif\n\n    color.rgb += emissionColor;\n\n    #ifdef HILO_HAS_CLEARCOAT\n        float t = clearcoatFactor * clearCoatFresnel;\n        color.rgb = color.rgb * (1.0 - t) + clearCoatLayer * t;\n    #endif\n#else\n    color = baseColor;\n    color.rgb += emissionColor;\n#endif"},function(e,t,n){var r=n(92),i=n(26),a=n(30),o=[0,0,0],s=[0,0,0],u=[0,0,0],c=[0,0,0],l=[0,0,0];e.exports=function(e,t,n,f){a(o,f[1],f[0]),a(s,f[2],f[0]),r(c,n,s);var h=i(o,c);if(h<1e-6)return null;a(u,t,f[0]);var d=i(u,c);if(d<0||d>h)return null;r(l,u,o);var _=i(n,l);if(_<0||d+_>h)return null;var m=i(s,l)/h;return e[0]=t[0]+m*n[0],e[1]=t[1]+m*n[1],e[2]=t[2]+m*n[2],e}},function(e,t){e.exports=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e}},function(e,t,n){var r=n(26),i=n(31),a=n(32),o=n(33);e.exports=function(e,t,n,u,c){var l=r(n,u);if(0!==l){var f=-(r(t,u)+c)/l;return f<0?null:(a(s,n,f),i(e,t,s))}return r(u,t)+c===0?o(e,t):null};var s=[0,0,0]},function(e,t,n){var r=n(95),i=n(26),a=n(30),o=n(96),s=n(32),u=n(31),c=[0,0,0];e.exports=function(e,t,n,l,f){a(c,l,t);var h=i(n,c);if(h<0)return null;o(c,t,n,h);var d=r(l,c),_=f*f;return d>_?null:(s(e,n,h-Math.sqrt(_-d)),u(e,e,t))}},function(e,t){e.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}},function(e,t){e.exports=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}},function(e,t){function n(e,t,n){for(var r=e.length,i=-1/0,a=1/0,o=0;o<r;o++){var s=(n[0][o]-e[o])/t[o],u=(n[1][o]-e[o])/t[o];if(s>u){var c=s;s=u,u=c}if(u<i||s>a)return 1/0;s>i&&(i=s),u<a&&(a=u)}return i>a?1/0:i}e.exports=function(e,t,r,i){var a=n(t,r,i);if(a===1/0)e=null;else{e=e||[];for(var o=0;o<t.length;o++)e[o]=t[o]+r[o]*a}return e},e.exports.distance=n},function(e,t,n){"use strict";
/*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  */var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,u=o(e),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))i.call(n,l)&&(u[l]=n[l]);if(r){s=r(n);for(var f=0;f<s.length;f++)a.call(n,s[f])&&(u[s[f]]=n[s[f]])}}return u}},function(e,t,n){"use strict";var r,i,a,o;Object.keys||(Object.keys=(r=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),o=(a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var t,n,s=[];for(t in e)r.call(e,t)&&s.push(t);if(i)for(n=0;n<o;n++)r.call(e,a[n])&&s.push(a[n]);return s}))},function(e,t,n){"use strict";e.exports=function(e){return Object.keys(e).map((function(t){return e[t]}))}},function(e,t,n){"use strict";e.exports="function"==typeof Promise?Promise:n(105)},function(e,t){var n=function(){function e(e,t,n,r,i){return e=e||{},t&&(e.EaseIn=t),n&&(e.EaseOut=n),r&&(e.EaseInOut=r),i&&(e.EaseNone=i),e}var t=e(null,null,null,null,(function(e){return e})),n=e(null,(function(e){return e*e}),(function(e){return-e*(e-2)}),(function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)})),r=e(null,(function(e){return e*e*e}),(function(e){return--e*e*e+1}),(function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)})),i=e(null,(function(e){return e*e*e*e}),(function(e){return-(--e*e*e*e-1)}),(function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)})),a=e(null,(function(e){return e*e*e*e*e}),(function(e){return(e-=1)*e*e*e*e+1}),(function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)})),o=Math,s=o.PI,u=.5*s,c=o.sin,l=o.cos,f=o.pow,h=o.sqrt,d=e(null,(function(e){return 1-l(e*u)}),(function(e){return c(e*u)}),(function(e){return-.5*(l(s*e)-1)})),_=e(null,(function(e){return 0==e?0:f(2,10*(e-1))}),(function(e){return 1==e?1:1-f(2,-10*e)}),(function(e){return 0==e||1==e?e:(e*=2)<1?.5*f(2,10*(e-1)):.5*(2-f(2,-10*(e-1)))})),m=e(null,(function(e){return-(h(1-e*e)-1)}),(function(e){return h(1- --e*e)}),(function(e){return(e/=.5)<1?-.5*(h(1-e*e)-1):.5*(h(1-(e-=2)*e)+1)})),p=e({a:1,p:.4,s:.1,config:function(e,t){p.a=e,p.p=t,p.s=t/(2*s)*Math.asin(1/e)||0}},(function(e){return-p.a*f(2,10*(e-=1))*c((e-p.s)*(2*s)/p.p)}),(function(e){return p.a*f(2,-10*e)*c((e-p.s)*(2*s)/p.p)+1}),(function(e){return(e*=2)<1?p.a*f(2,10*(e-=1))*c((e-p.s)*(2*s)/p.p)*-.5:p.a*f(2,-10*(e-=1))*c((e-p.s)*(2*s)/p.p)*.5+1})),v=e({o:1.70158,s:2.59491,config:function(e){v.o=e,v.s=1.525*e}},(function(e){return e*e*((v.o+1)*e-v.o)}),(function(e){return(e-=1)*e*((v.o+1)*e+v.o)+1}),(function(e){return(e*=2)<1?e*e*((v.s+1)*e-v.s)*.5:.5*((e-=2)*e*((v.s+1)*e+v.s)+2)})),g=e(null,(function(e){return 1-g.EaseOut(1-e)}),(function(e){return(e/=1)<.36364?7.5625*e*e:e<.72727?7.5625*(e-=.54545)*e+.75:e<.90909?7.5625*(e-=.81818)*e+.9375:7.5625*(e-=.95455)*e+.984375}),(function(e){return e<.5?.5*g.EaseIn(2*e):.5*g.EaseOut(2*e-1)+.5}));return{Linear:t,Quad:n,Cubic:r,Quart:i,Quint:a,Sine:d,Expo:_,Circ:m,Elastic:p,Back:v,Bounce:g}}();e.exports=n},function(e,t){e.exports=function(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var t=0,n=e.length;function r(){var r="";do{var i=e[t];if(10==i){++t;break}r+=String.fromCharCode(i)}while(++t<n);return r}for(var i=0,a=0,o=1,s=!1,u=0;u<20;u++){var c,l=r();if(c=l.match("#\\?RADIANCE"));else if(c=l.match("FORMAT=32-bit_rle_rgbe"))s=!0;else if(c=l.match("EXPOSURE=\\s*([0-9]*[.][0-9]*)"))o=Number(c[1]);else if(c=l.match("#.*"));else if(c=l.match("-Y ([0-9]+) \\+X ([0-9]+)")){a=Number(c[1]),i=Number(c[2]);break}}if(!s)throw new Error("File is not run length encoded!");var f=new Uint8Array(i*a*4);!function(e,t,n,r,i,a){var o,s,u,c=new Array(4),l=null,f=new Array(2),h=e.length;function d(t){var n=0;do{t[n++]=e[r]}while(++r<h&&n<t.length);return n}function _(t,n,i){var a=0;do{t[n+a++]=e[r]}while(++r<h&&a<i);return a}function m(e,t,n,r){var i=4*r,a=_(t,n,i);if(a<i)throw new Error("Error reading raw pixels: got "+a+" bytes, expected "+i)}for(;a>0;){if(d(c)<c.length)throw new Error("Error reading bytes: expected "+c.length);if(2!=c[0]||2!=c[1]||0!=(128&c[2]))return t[n++]=c[0],t[n++]=c[1],t[n++]=c[2],t[n++]=c[3],void m(0,t,n,i*a-1);if(((255&c[2])<<8|255&c[3])!=i)throw new Error("Wrong scanline width "+((255&c[2])<<8|255&c[3])+", expected "+i);null==l&&(l=new Array(4*i)),o=0;for(var p=0;p<4;p++)for(s=(p+1)*i;o<s;){if(d(f)<f.length)throw new Error("Error reading 2-byte buffer");if((255&f[0])>128){if(0==(u=(255&f[0])-128)||u>s-o)throw new Error("Bad scanline data");for(;u-- >0;)l[o++]=f[1]}else{if(0==(u=255&f[0])||u>s-o)throw new Error("Bad scanline data");if(l[o++]=f[1],--u>0){if(_(l,o,u)<u)throw new Error("Error reading non-run data");o+=u}}}for(p=0;p<i;p++)t[n+0]=l[p],t[n+1]=l[p+i],t[n+2]=l[p+2*i],t[n+3]=l[p+3*i],n+=4;a--}}(e,f,0,t,i,a);for(var h=new Float32Array(i*a*4),d=0;d<f.length;d+=4){var _=f[d+0]/255,m=f[d+1]/255,p=f[d+2]/255,v=f[d+3],g=Math.pow(2,v-128);_*=g,m*=g,p*=g;var y=d;h[y+0]=_,h[y+1]=m,h[y+2]=p,h[y+3]=1}return{shape:[i,a],exposure:o,gamma:1,data:h}}},function(e,t,n){"use strict";n.r(t);var r=n(98),i=n.n(r),a=n(99),o=n.n(a),s=n(100),u=n.n(s),c=n(101),l=n.n(c);Object.assign||(Object.assign=i.a),Object.keys||(Object.keys=o.a),Object.values||(Object.values=u.a),"undefined"==typeof Promise&&(window.Promise=l.a),[Int8Array,Uint8Array,Int16Array,Uint16Array,Uint32Array,Float32Array].forEach((function(e){e.prototype.slice||Object.defineProperty(e.prototype,"slice",{value:function(t,n){return new e(Array.prototype.slice.call(this,t,n))}})}))},function(e,t,n){"use strict";(function(t,n){var r,i=function(){},a=void 0!==t&&void 0!==t.process&&"function"==typeof t.process.emit,o=void 0===n?setTimeout:n,s=[];function u(){for(var e=0;e<s.length;e++)s[e][0](s[e][1]);s=[],r=!1}function c(e,t){s.push([e,t]),r||(r=!0,o(u,0))}function l(e){var t=e.owner,n=t._state,r=t._data,i=e[n],a=e.then;if("function"==typeof i){n="fulfilled";try{r=i(r)}catch(e){_(a,e)}}f(a,r)||("fulfilled"===n&&h(a,r),"rejected"===n&&_(a,r))}function f(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"==typeof t)){var r=t.then;if("function"==typeof r)return r.call(t,(function(r){n||(n=!0,t===r?d(e,r):h(e,r))}),(function(t){n||(n=!0,_(e,t))})),!0}}catch(t){return n||_(e,t),!0}return!1}function h(e,t){e!==t&&f(e,t)||d(e,t)}function d(e,t){"pending"===e._state&&(e._state="settled",e._data=t,c(p,e))}function _(e,t){"pending"===e._state&&(e._state="settled",e._data=t,c(v,e))}function m(e){e._then=e._then.forEach(l)}function p(e){e._state="fulfilled",m(e)}function v(e){e._state="rejected",m(e),!e._handled&&a&&t.process.emit("unhandledRejection",e._data,e)}function g(e){t.process.emit("rejectionHandled",e)}function y(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(this instanceof y==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){_(t,e)}try{e((function(e){h(t,e)}),n)}catch(e){n(e)}}(e,this)}y.prototype={constructor:y,_state:"pending",_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(i),fulfilled:e,rejected:t};return!t&&!e||this._handled||(this._handled=!0,"rejected"===this._state&&a&&c(g,this)),"fulfilled"===this._state||"rejected"===this._state?c(l,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},y.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new y((function(t,n){var r=[],i=0;function a(e){return i++,function(n){r[e]=n,--i||t(r)}}for(var o,s=0;s<e.length;s++)(o=e[s])&&"function"==typeof o.then?o.then(a(s),n):r[s]=o;i||t(r)}))},y.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new y((function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)}))},y.resolve=function(e){return e&&"object"==typeof e&&e.constructor===y?e:new y((function(t){t(e)}))},y.reject=function(e){return new y((function(t,n){n(e)}))},e.exports=y}).call(this,n(36),n(106).setImmediate)},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new a(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new a(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(107),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(36))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,a,o,s,u=1,c={},l=!1,f=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){_(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&_(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){_(e.data)},r=function(e){a.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(e){var t=f.createElement("script");t.onreadystatechange=function(){_(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(_,0,e)},h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[u]=i,r(u),u++},h.clearImmediate=d}function d(e){delete c[e]}function _(e){if(l)setTimeout(_,0,e);else{var t=c[e];if(t){l=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{d(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(36),n(108))},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!l){var e=s(h);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function _(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new _(e,t)),1!==c.length||l||s(d)},_.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){e.exports="#define GLSLIFY 1\n// modified from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/lights_physical_pars_fragment.glsl#L26\n\n"+n(60)+"\n\nvec2 LTC_Uv(const in vec3 N, const in vec3 V, const in float roughness) {\n    const float LUT_SIZE = 64.0;\n    const float LUT_SCALE = (LUT_SIZE - 1.0) / LUT_SIZE;\n    const float LUT_BIAS = 0.5 / LUT_SIZE;\n    float dotNV = clamp(dot(N, V), 0.0, 1.0);\n    vec2 uv = vec2(roughness, sqrt(1.0 - dotNV));\n    uv = (uv * LUT_SCALE) + LUT_BIAS;\n    return uv;\n}\n\nfloat LTC_ClippedSphereFormFactor(const in vec3 f) {\n    float l = length(f);\n    return max(((l * l) + f.z) / (l + 1.0), 0.0);\n}\n\nvec3 LTC_EdgeVectorFormFactor(const in vec3 v1, const in vec3 v2) {\n    float x = dot(v1, v2);\n    float y = abs(x);\n    float a = 0.8543985 + ((0.4965155 + (0.0145206 * y)) * y);\n    float b = 3.4175940 + ((4.1616724 + y) * y);\n    float v = a / b;\n    float theta_sintheta = x > 0.0 ? v : (0.5 * inversesqrt(max(1.0 - (x * x), 1e-7))) - v;\n    return cross(v1, v2) * theta_sintheta;\n}\n\nvec3 LTC_Evaluate(const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[4]) {\n    vec3 v1 = rectCoords[1] - rectCoords[0];\n    vec3 v2 = rectCoords[3] - rectCoords[0];\n    vec3 lightNormal = cross(v1, v2);\n    if (dot(lightNormal, P - rectCoords[0]) < 0.0)\n        return vec3(0.0);\n    vec3 T1, T2;\n    T1 = normalize(V - (N * dot(V, N)));\n    T2 = -cross(N, T1);\n    mat3 mat = mInv * transpose(mat3(T1, T2, N));\n    vec3 coords[4];\n    coords[0] = mat * (rectCoords[0] - P);\n    coords[1] = mat * (rectCoords[1] - P);\n    coords[2] = mat * (rectCoords[2] - P);\n    coords[3] = mat * (rectCoords[3] - P);\n    coords[0] = normalize(coords[0]);\n    coords[1] = normalize(coords[1]);\n    coords[2] = normalize(coords[2]);\n    coords[3] = normalize(coords[3]);\n    vec3 vectorFormFactor = vec3(0.0);\n    vectorFormFactor += LTC_EdgeVectorFormFactor(coords[0], coords[1]);\n    vectorFormFactor += LTC_EdgeVectorFormFactor(coords[1], coords[2]);\n    vectorFormFactor += LTC_EdgeVectorFormFactor(coords[2], coords[3]);\n    vectorFormFactor += LTC_EdgeVectorFormFactor(coords[3], coords[0]);\n    float result = LTC_ClippedSphereFormFactor(vectorFormFactor);\n    return vec3(result);\n}\n\nvec3 getAreaLight(const in vec3 diffuseColor, const in vec3 specularColor, const in float roughness, const in vec3 normal, const in vec3 viewDir, const in vec3 position, const in vec3 lightPos, const in vec3 lightColor, const in vec3 halfWidth, const in vec3 halfHeight, const in sampler2D areaLightsLtcTexture1, const in sampler2D areaLightsLtcTexture2){\n    vec3 rectCoords[4];\n    rectCoords[0] = (lightPos - halfWidth) - halfHeight;\n    rectCoords[1] = (lightPos + halfWidth) - halfHeight;\n    rectCoords[2] = (lightPos + halfWidth) + halfHeight;\n    rectCoords[3] = (lightPos - halfWidth) + halfHeight;\n    \n    vec2 uv = LTC_Uv(normal, viewDir, roughness);\n    vec4 t1 = texture2D(areaLightsLtcTexture1, uv);\n    vec4 t2 = texture2D(areaLightsLtcTexture2, uv);\n\n    mat3 mInv = mat3(vec3(t1.x, 0, t1.y), vec3(0, 1, 0), vec3(t1.z, 0, t1.w));\n    vec3 fresnel = (specularColor * t2.x) + ((vec3(1.0) - specularColor) * t2.y);\n    \n    vec3 color = vec3(0.0, 0.0, 0.0);\n    color += ((lightColor * fresnel) * LTC_Evaluate(normal, viewDir, position, mInv, rectCoords));\n    color += ((lightColor * diffuseColor) * LTC_Evaluate(normal, viewDir, position, mat3(1.0), rectCoords));\n    return color;\n}\n\n"},function(e,t,n){"use strict";n.r(t),n.d(t,"util",(function(){return i})),n.d(t,"GLTFExtensions",(function(){return r})),n.d(t,"Class",(function(){return a.a})),n.d(t,"EventMixin",(function(){return o.a})),n.d(t,"Fog",(function(){return cr})),n.d(t,"Mesh",(function(){return _r})),n.d(t,"Node",(function(){return v})),n.d(t,"SkinedMesh",(function(){return gr})),n.d(t,"Skeleton",(function(){return Er})),n.d(t,"Stage",(function(){return Xr})),n.d(t,"Tween",(function(){return Qr})),n.d(t,"version",(function(){return Tr})),n.d(t,"BoxGeometry",(function(){return Jr})),n.d(t,"Geometry",(function(){return K})),n.d(t,"GeometryData",(function(){return w})),n.d(t,"MorphGeometry",(function(){return Yn})),n.d(t,"PlaneGeometry",(function(){return ri})),n.d(t,"SphereGeometry",(function(){return ai})),n.d(t,"Camera",(function(){return b})),n.d(t,"PerspectiveCamera",(function(){return Z})),n.d(t,"OrthographicCamera",(function(){return ln})),n.d(t,"Buffer",(function(){return Le})),n.d(t,"capabilities",(function(){return te})),n.d(t,"extensions",(function(){return ee})),n.d(t,"Framebuffer",(function(){return ct})),n.d(t,"glType",(function(){return Ee})),n.d(t,"logGLResource",(function(){return si})),n.d(t,"Program",(function(){return Ae})),n.d(t,"RenderInfo",(function(){return xr})),n.d(t,"RenderList",(function(){return Mr})),n.d(t,"VertexArrayObject",(function(){return Ue})),n.d(t,"WebGLRenderer",(function(){return Gr})),n.d(t,"WebGLResourceManager",(function(){return Rr})),n.d(t,"WebGLState",(function(){return Sr})),n.d(t,"BasicLoader",(function(){return hi})),n.d(t,"CubeTextureLoader",(function(){return pi})),n.d(t,"GLTFLoader",(function(){return Qi})),n.d(t,"GLTFParser",(function(){return Yi})),n.d(t,"AliAMCExtension",(function(){return Jn})),n.d(t,"HDRLoader",(function(){return ia})),n.d(t,"KTXLoader",(function(){return sa})),n.d(t,"LoadCache",(function(){return ci})),n.d(t,"LoadQueue",(function(){return ua})),n.d(t,"ShaderMaterialLoader",(function(){return la})),n.d(t,"TextureLoader",(function(){return ha})),n.d(t,"Loader",(function(){return _i})),n.d(t,"Texture",(function(){return Ze})),n.d(t,"LazyTexture",(function(){return Ti})),n.d(t,"CubeTexture",(function(){return pt})),n.d(t,"DataTexture",(function(){return At})),n.d(t,"Shader",(function(){return de})),n.d(t,"BasicMaterial",(function(){return en})),n.d(t,"GeometryMaterial",(function(){return un})),n.d(t,"Material",(function(){return Jt})),n.d(t,"PBRMaterial",(function(){return gi})),n.d(t,"semantic",(function(){return Vt})),n.d(t,"ShaderMaterial",(function(){return jn})),n.d(t,"AxisHelper",(function(){return pa})),n.d(t,"AxisNetHelper",(function(){return ya})),n.d(t,"CameraHelper",(function(){return Aa})),n.d(t,"AmbientLight",(function(){return ba})),n.d(t,"AreaLight",(function(){return Sa})),n.d(t,"DirectionalLight",(function(){return Vn})),n.d(t,"CubeLightShadow",(function(){return wn})),n.d(t,"Light",(function(){return T})),n.d(t,"LightManager",(function(){return wr})),n.d(t,"LightShadow",(function(){return vn})),n.d(t,"PointLight",(function(){return Nn})),n.d(t,"SpotLight",(function(){return Gn})),n.d(t,"Animation",(function(){return Di})),n.d(t,"AnimationStates",(function(){return Ni})),n.d(t,"MeshPicker",(function(){return Ia})),n.d(t,"Ticker",(function(){return wa})),n.d(t,"log",(function(){return _.a})),n.d(t,"Cache",(function(){return J})),n.d(t,"browser",(function(){return kr})),n.d(t,"WebGLSupport",(function(){return Pa})),n.d(t,"constants",(function(){return P.a})),n.d(t,"Color",(function(){return Na.Color})),n.d(t,"Euler",(function(){return Na.Euler})),n.d(t,"EulerNotifier",(function(){return Na.EulerNotifier})),n.d(t,"Frustum",(function(){return Na.Frustum})),n.d(t,"math",(function(){return Na.math})),n.d(t,"Matrix3",(function(){return Na.Matrix3})),n.d(t,"Matrix4",(function(){return Na.Matrix4})),n.d(t,"Matrix4Notifier",(function(){return Na.Matrix4Notifier})),n.d(t,"Plane",(function(){return Na.Plane})),n.d(t,"Quaternion",(function(){return Na.Quaternion})),n.d(t,"Ray",(function(){return Na.Ray})),n.d(t,"Sphere",(function(){return Na.Sphere})),n.d(t,"SphericalHarmonics3",(function(){return Na.SphericalHarmonics3})),n.d(t,"Vector2",(function(){return Na.Vector2})),n.d(t,"Vector3",(function(){return Na.Vector3})),n.d(t,"Vector3Notifier",(function(){return Na.Vector3Notifier})),n.d(t,"Vector4",(function(){return Na.Vector4}));var r={};n.r(r),n.d(r,"ALI_amc_mesh_compression",(function(){return Jn})),n.d(r,"WEB3D_quantized_attributes",(function(){return er})),n.d(r,"HILO_animation_clips",(function(){return tr})),n.d(r,"ALI_animation_clips",(function(){return nr})),n.d(r,"ALI_bounding_box",(function(){return rr})),n.d(r,"KHR_materials_pbrSpecularGlossiness",(function(){return ir})),n.d(r,"KHR_materials_clearcoat",(function(){return ar})),n.d(r,"KHR_lights_punctual",(function(){return or})),n.d(r,"KHR_techniques_webgl",(function(){return sr}));var i=n(4),a=n(1),o=n(9),s=n(7),u=n(21),c=n(5),l=n(17),f=n(22),h=n(10),d=n(6),_=n(3),m=new c.a(0,1,0),p=new s.a,v=a.a.create({Statics:{TRAVERSE_STOP_NONE:!1,TRAVERSE_STOP_CHILDREN:1,TRAVERSE_STOP_ALL:!0},Mixes:o.a,isNode:!0,className:"Node",name:"",anim:null,animationId:"",jointName:"",autoUpdateWorldMatrix:!0,autoUpdateChildWorldMatrix:!0,parent:null,_quatDirty:!1,_matrixDirty:!1,needCallChildUpdate:!0,visible:!0,pointerEnabled:!0,pointerChildren:!0,useHandCursor:!1,userData:null,onUpdate:null,__forceUseParentWorldMatrix:!1,constructor:function(e){var t=this;this.id=d.a.generateUUID(this.className),this.up=m.clone(),this.children=[],this.worldMatrix=new s.a,this._matrix=new u.a,this._position=new l.a(0,0,0),this._scale=new l.a(1,1,1),this._pivot=new l.a(0,0,0),this._rotation=new f.a,this._quaternion=new h.a,this._matrix.on("update",(function(){t._onMatrixUpdate()})),this._position.on("update",(function(){t._onPositionUpdate()})),this._scale.on("update",(function(){t._onScaleUpdate()})),this._pivot.on("update",(function(){t._onPivotUpdate()})),this._rotation.on("update",(function(){t._onRotationUpdate()})),this._quaternion.on("update",(function(){t._onQuaternionUpdate()})),Object.assign(this,e)},clone:function(e){var t=new this.constructor;return t.name=this.name,t.jointName=this.jointName,t.animationId=this.animationId,t.setPosition(this.x,this.y,this.z),t.setScale(this.scaleX,this.scaleY,this.scaleZ),t.setRotation(this.rotationX,this.rotationY,this.rotationZ),this.children.forEach((function(e){t.addChild(e.clone(!0))})),e||(this.anim&&(t.anim=this.anim.clone(t)),t.resetSkinedMeshRootNode()),t},setAnim:function(e){return this.anim=e,e.rootNode=this,this},resetSkinedMeshRootNode:function(){var e=this;this.traverse((function(t){t.isSkinedMesh&&t.skeleton&&(t.skeleton.rootNode=e)}),!0)},getChildrenNameMap:function(){var e={};return this.traverse((function(t){e[t.name]=t;var n=t._originName;void 0===n||e[n]||(e[n]=t)}),!0),e},addChild:function(e){return e.parent&&e.removeFromParent(),e.parent=this,this.children.push(e),this},removeChild:function(e){var t=this.children.indexOf(e);return t>-1&&(this.children.splice(t,1),e.parent=null),this},addTo:function(e){return e.addChild(this),this},removeFromParent:function(){return this.parent&&this.parent.removeChild(this),this},updateMatrix:function(){return this._matrixDirty&&(this._matrixDirty=!1,this.matrixVersion++,this._matrix.fromRotationTranslationScaleOrigin(this.quaternion,this._position,this._scale,this._pivot,!0)),this},updateQuaternion:function(){return this._quatDirty&&(this._quatDirty=!1,this._quaternion.fromEuler(this._rotation,!0)),this},updateTransform:function(){return this._matrix.decompose(this._quaternion,this._position,this._scale,this._pivot),this._onQuaternionUpdate(),this._matrixDirty=!1,this},updateMatrixWorld:function(e){return this.traverse((function(t){return(t.autoUpdateWorldMatrix||e)&&(t.parent?t.__forceUseParentWorldMatrix?t.worldMatrix.copy(t.parent.worldMatrix):t.worldMatrix.multiply(t.parent.worldMatrix,t.matrix):t.worldMatrix.copy(t.matrix)),!t.autoUpdateChildWorldMatrix&&!e&&1})),this},getConcatenatedMatrix:function(e){for(var t=new s.a,n=this;n&&n!==e;n=n.parent)t.multiply(n.matrix,t);return t},_traverse:function(e,t){if(!t){var n=e(this);if(n)return n}for(var r=this.children,i=0,a=r.length;i<a;i++){var o=r[i]._traverse(e,!1);if(!0===o)return o}return!1},traverse:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._traverse(e,t),this},traverseBFS:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(n=r?this.children:[this];n.length;){t=n,n=[];for(var i=0,a=t.length;i<a;i++){var o=t[i],s=e(o);if(s){if(!0===s)return this}else n=n.concat(o.children)}}return this},getChildByFnBFS:function(e){var t=null;return this.traverseBFS((function(n){return!!e(n)&&(t=n,!0)}),!0),t},getChildByNamePath:function(e){for(var t=this,n=function(n,r){var i=e[n],a=t.getChildByFnBFS((function(e){return e.name===i}));if(!a)return{v:null};t=a},r=0,i=e.length;r<i;r++){var a=n(r);if("object"==typeof a)return a.v}return t},traverseUpdate:function(e){return this.traverse((function(t){return t.onUpdate&&t.onUpdate(e),!t.needCallChildUpdate&&1})),this},getChildByFn:function(e){var t=null;return this.traverse((function(n){return!!e(n)&&(t=n,!0)}),!0),t},getChildrenByFn:function(e){var t=[];return this.traverse((function(n){e(n)&&t.push(n)}),!0),t},getChildByName:function(e){return this.getChildByFn((function(t){return t.name===e}))},getChildrenByName:function(e){return this.getChildrenByFn((function(t){return t.name===e}))},getChildById:function(e){return this.getChildByFn((function(t){return t.id===e}))},getChildrenByClassName:function(e){return this.getChildrenByFn((function(t){return t.className===e}))},getChildrenByBaseClassName:function(e){return this.getChildrenByFn((function(t){return t["is"+e]}))},setScale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return this._scale.set(e,t,n),this},setPosition:function(e,t,n){return this._position.set(e,t,n),this},setRotation:function(e,t,n){return this._rotation.setDegree(e,t,n),this},setPivot:function(e,t,n){return this._pivot.set(e,t,n),this},lookAt:function(e){return this.isCamera?p.targetTo(this,e,this.up):p.targetTo(e,this,this.up),this._quaternion.fromMat4(p),this},raycast:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.visible)return null;var i=[];return this.traverse((function(n){if(r&&!n.pointerEnabled)return 1;if(n.isMesh){var a=n.raycast(e,!1);a&&(i=i.concat(a.map((function(e){return{mesh:n,point:e}}))))}return!(!r||t.pointerChildren)&&1})),i.length?(n&&e.sortPoints(i,"point"),i):null},matrix:{get:function(){return this.updateMatrix(),this._matrix},set:function(e){_.a.warnOnce("Node.matrix.set","node.matrix is readOnly.Use node.matrix.copy instead."),this._matrix.copy(e)}},position:{get:function(){return this._position},set:function(e){_.a.warnOnce("Node.position.set","node.position is readOnly.Use node.position.copy instead."),this._position.copy(e)}},x:{get:function(){return this._position.elements[0]},set:function(e){this._position.elements[0]=e,this._matrixDirty=!0}},y:{get:function(){return this._position.elements[1]},set:function(e){this._position.elements[1]=e,this._matrixDirty=!0}},z:{get:function(){return this._position.elements[2]},set:function(e){this._position.elements[2]=e,this._matrixDirty=!0}},scale:{get:function(){return this._scale},set:function(e){_.a.warnOnce("Node.scale.set","node.scale is readOnly.Use node.scale.copy instead."),this._scale.copy(e)}},scaleX:{get:function(){return this._scale.elements[0]},set:function(e){this._scale.elements[0]=e,this._matrixDirty=!0}},scaleY:{get:function(){return this._scale.elements[1]},set:function(e){this._scale.elements[1]=e,this._matrixDirty=!0}},scaleZ:{get:function(){return this._scale.elements[2]},set:function(e){this._scale.elements[2]=e,this._matrixDirty=!0}},pivot:{get:function(){return this._pivot},set:function(e){_.a.warnOnce("Node.pivot.set","node.pivot is readOnly.Use node.pivot.copy instead."),this._pivot.copy(e)}},pivotX:{get:function(){return this._pivot.elements[0]},set:function(e){this._pivot.elements[0]=e,this._matrixDirty=!0}},pivotY:{get:function(){return this._pivot.elements[1]},set:function(e){this._pivot.elements[1]=e,this._matrixDirty=!0}},pivotZ:{get:function(){return this._pivot.elements[2]},set:function(e){this._pivot.elements[2]=e,this._matrixDirty=!0}},rotation:{get:function(){return this._rotation},set:function(e){_.a.warnOnce("Node.rotation.set","node.rotation is readOnly.Use node.rotation.copy instead."),this._rotation.copy(e)}},rotationX:{get:function(){return this._rotation.degX},set:function(e){this._rotation.degX=e}},rotationY:{get:function(){return this._rotation.degY},set:function(e){this._rotation.degY=e}},rotationZ:{get:function(){return this._rotation.degZ},set:function(e){this._rotation.degZ=e}},quaternion:{get:function(){return this.updateQuaternion(),this._quaternion},set:function(e){_.a.warnOnce("Node.quaternion.set","node.quaternion is readOnly.Use node.quaternion.copy instead."),this._quaternion.copy(e)}},matrixVersion:0,getBounds:function(e,t,n){return t?t.multiply(this.matrix):t=this.getConcatenatedMatrix(e),this.children.forEach((function(e){n=e.getBounds(null,t.clone(),n)})),this.isMesh&&(n=this.geometry.getBounds(t,n)),n},_fireMouseEvent:function(e){if(e.eventCurrentTarget=this,this.fire(e),"mousemove"===e.type){if(!this.__mouseOver){this.__mouseOver=!0;var t=Object.assign({},e);t.type="mouseover",this.fire(t)}}else"mouseout"===e.type&&(this.__mouseOver=!1);var n=this.parent;e._stopped||e._stopPropagationed||!n||n._fireMouseEvent(e)},destroy:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getChildrenByBaseClassName("Node");return this.off(),n.forEach((function(n){n.isMesh?n.destroy(e,t):(n.off(),n.removeFromParent())})),this.removeFromParent(),this},_onMatrixUpdate:function(){this.matrixVersion++,this.updateTransform()},_onPositionUpdate:function(){this._matrixDirty=!0},_onScaleUpdate:function(){this._matrixDirty=!0},_onPivotUpdate:function(){this._matrixDirty=!0},_onRotationUpdate:function(){this._quatDirty=!0,this._matrixDirty=!0},_onQuaternionUpdate:function(){this._rotation.fromQuat(this._quaternion),this._quatDirty=!1}}),g=n(8),y=new g.a,E=a.a.create({Extends:v,isLight:!0,className:"Light",amount:1,enabled:!0,constantAttenuation:1,linearAttenuation:0,quadraticAttenuation:0,_range:0,range:{get:function(){return this._range},set:function(e){this.constantAttenuation=1,e<=0?(this.linearAttenuation=0,this.quadraticAttenuation=0):(this.linearAttenuation=4.5/e,this.quadraticAttenuation=75/(e*e)),this._range=e}},shadow:null,isDirty:!1,constructor:function(e){this.color=new g.a(1,1,1),E.superclass.constructor.call(this,e)},toInfoArray:function(e,t){return e[t+0]=this.constantAttenuation,e[t+1]=this.linearAttenuation,e[t+2]=this.quadraticAttenuation,this},getRealColor:function(){return y.copy(this.color).scale(this.amount)},createShadowMap:function(e,t){}}),T=E,x=n(23),A=new s.a,O=a.a.create({Extends:v,isCamera:!0,className:"Camera",_needUpdateProjectionMatrix:!0,_isGeometryDirty:!1,constructor:function(e){this.viewMatrix=new s.a,this.projectionMatrix=new s.a,this.viewProjectionMatrix=new s.a,this._frustum=new x.a,O.superclass.constructor.call(this,e)},updateViewMatrix:function(){return this.updateMatrixWorld(!0),this.viewMatrix.invert(this.worldMatrix),this},updateProjectionMatrix:function(){},getGeometry:function(e){},updateViewProjectionMatrix:function(){return this._needUpdateProjectionMatrix&&(this.updateProjectionMatrix(),this._needUpdateProjectionMatrix=!1),this.updateViewMatrix(),this.viewProjectionMatrix.multiply(this.projectionMatrix,this.viewMatrix),this.updateFrustum(this.viewProjectionMatrix),this},getModelViewMatrix:function(e,t){return(t=t||new s.a).multiply(this.viewMatrix,e.worldMatrix),t},getModelProjectionMatrix:function(e,t){return(t=t||new s.a).multiply(this.viewProjectionMatrix,e.worldMatrix),t},projectVector:function(e,t,n){var r=e.clone();return r.transformMat4(this.viewProjectionMatrix),t&&n&&(r.x=(r.x+1)/2*t,r.y=n-(r.y+1)/2*n),r},unprojectVector:function(e,t,n){var r=e.clone();return t&&n&&(r.x=r.x/t*2-1,r.y=1-r.y/n*2),A.invert(this.viewProjectionMatrix),r.transformMat4(A),r},isPointVisible:function(e){return!!this._frustum.intersectsSphere({center:e,radius:0})},isMeshVisible:function(e){var t=e.geometry;if(t){var n=t.getSphereBounds(e.worldMatrix);if(this._frustum.intersectsSphere(n))return!0}return!1},updateFrustum:function(e){return this._frustum.fromMatrix(e),this}}),b=O,M=n(14),S=n(12),R=n(11),L=n(20),C={2:new M.a,3:new c.a,4:new S.a,16:new s.a},I=a.a.create({className:"GeometryData",isGeometryData:!0,size:void 0,normalized:!1,type:void 0,_isSubDirty:!1,_isAllDirty:!1,isDirty:{get:function(){return this._isSubDirty||this._isAllDirty},set:function(e){this._isAllDirty=e,!1===e&&this.clearSubData()}},bufferViewId:void 0,glBuffer:null,constructor:function(e,t,n){this.id=d.a.generateUUID(this.className),this.data=e,this.size=t,Object.assign(this,n),this.bufferViewId||(this.bufferViewId=this.id),this.size||_.a.warn("GeometryData.constructor: geometryData must set size!",this)},_stride:0,stride:{get:function(){return this._stride},set:function(e){this._stride=e,this.strideSize=0===e?0:e/this.data.BYTES_PER_ELEMENT}},strideSize:0,_offset:0,offset:{get:function(){return this._offset},set:function(e){this._offset=e,this.offsetSize=e/this.data.BYTES_PER_ELEMENT}},offsetSize:0,data:{set:function(e){e&&(this._data=e,this.type=Object(i.getTypedArrayGLType)(e),this.stride=this._stride,this.offset=this._offset,this._isAllDirty=!0)},get:function(){return this._data}},length:{get:function(){return this._data.length}},realLength:{get:function(){return 0===this.strideSize?this._data.length:this._data.length/this.strideSize*this.size}},getByteLength:function(){return this._data.BYTES_PER_ELEMENT*this.realLength},count:{get:function(){return 0===this.strideSize?this._data.length/this.size:this._data.length/this.strideSize}},setSubData:function(e,t){this._isSubDirty=!0,this.data.set(t,e),this.subDataList||(this.subDataList=[]);var n=t.BYTES_PER_ELEMENT*e;this.subDataList.push({byteOffset:n,data:t})},clearSubData:function(){this.subDataList&&(this.subDataList.length=0),this._isSubDirty=!1},clone:function(){var e=new I(null,1);return e.copy(this),e},copy:function(e){var t=e.data;this.data=new t.constructor(t),this.size=e.size,this.stride=e.stride,this.normalized=e.normalized,this.type=e.type,this.offset=e.offset},getOffset:function(e){var t=this.strideSize;return 0===t?e*this.size:e*t+this.offsetSize},get:function(e){var t=this.getOffset(e);return this.getByOffset(t)},getCopy:function(e){return this.get(e).clone()},set:function(e,t){var n=this.getOffset(e);return this.setByOffset(n,t),n},getByOffset:function(e){var t=this.size;return t>1?C[t].fromArray(this._data,e):this._data[e]},setByOffset:function(e,t){var n=this.size,r=this._data;n>1?t.toArray(r,e):r[e]=t,this._isAllDirty=!0},traverse:function(e){for(var t=this.count,n=0;n<t;n++){var r=this.getOffset(n);if(e(this.getByOffset(r),n,r))return!0}return!1},traverseByComponent:function(e){for(var t=this.count,n=this.size,r=this._data,i=0;i<t;i++)for(var a=this.getOffset(i),o=i*n,s=0;s<n;s++){var u=a+s;if(e(r[u],o+s,u))return!0}return!1},merge:function(e,t){if(e.type!==this.type||e.size!==this.size)return _.a.warn("geometryData type or size not same, cannot merge!",this,e),this;var n=Object(i.getTypedArrayClass)(this.type),r=this.realLength,a=e.realLength,o=new n(r+a);return this.traverseByComponent((function(e,t){o[t]=e})),e.traverseByComponent((function(e,n){t&&(e=t(e,n)),o[r+n]=e})),this.stride=0,this.offset=0,this.data=o,this}}),w=I,P=n(2),N=P.a.TRIANGLES,F=P.a.LINES,D=P.a.FRONT,U=P.a.BACK,V=P.a.FRONT_AND_BACK,B=new c.a,H=new c.a,z=new c.a,G=new S.a,k=new M.a,j=new M.a,X=new M.a,W=new R.a,q=new s.a,Y=new h.a,K=a.a.create({isGeometry:!0,className:"Geometry",vertices:null,uvs:null,uvs1:null,colors:null,indices:null,skinIndices:null,skinWeights:null,mode:N,isStatic:!0,isDirty:!0,useAABBRaycast:!1,userData:null,constructor:function(e){this.id=d.a.generateUUID(this.className),Object.assign(this,e),this.currentVerticesCount=0,this.currentIndicesCount=0},_needUpdateNormals:!1,normals:{get:function(){return!this._needUpdateNormals&&this._normals||this.calculateNormals(),this._normals},set:function(e){this._normals=e,this._needUpdateNormals=!1}},calculateNormals:function(){var e=this.vertices;if(e){this._normals||(this._normals=new w(new Float32Array(e.realLength),3));var t,n=this._normals;if(this.indices)t=this.indices.data;else{var r=e.length/3;t=new Array(r);for(var i=0;i<r;i++)t[i]=i}for(var a=0,o=new Uint8Array(e.count),s=0;s<t.length;s+=3){a=t[s],B.copy(e.get(a)),a=t[s+1],H.copy(e.get(a)),a=t[s+2],z.copy(e.get(a)),H.sub(B),z.sub(B),H.cross(z);for(var u=0;u<3;u++){if(o[a=t[s+u]]){var c=n.get(a);c.scale(o[a]),c.add(H),c.scale(1/(o[a]+1)),n.set(a,c)}else n.set(a,H);o[a]++}}this.isDirty=!0,this._needUpdateNormals=!1}else _.a.warnOnce("geometry.calculateNormals","geometry.calculateNormals error:no vertices data.")},tangents:{get:function(){return this._tangents||this.calculateTangents(this.uvs,"_tangents"),this._tangents},set:function(e){this._tangents=e}},tangents1:{get:function(){return this._tangents1||this.calculateTangents(this.uvs1,"_tangents1"),this._tangents1},set:function(e){this._tangents1=e}},calculateTangents:function(e,t){var n=this.vertices;if(n){this[t]||(this[t]=new w(new Float32Array(4*n.count),4));var r,i=this[t];if(this.indices)r=this.indices.data;else{var a=n.length/3;r=new Array(a);for(var o=0;o<a;o++)r[o]=o}for(var s=0,u=0;u<r.length;u+=3){s=r[u],B.copy(n.get(s)),k.copy(e.get(s)),s=r[u+1],H.copy(n.get(s)),j.copy(e.get(s)),s=r[u+2],z.copy(n.get(s)),X.copy(e.get(s)),H.sub(B),z.sub(B),j.sub(k),X.sub(k);var c=1/(j.x*X.y-X.x*j.y);Number.isFinite(c)?(B.x=c*(X.y*H.x-j.y*z.x),B.y=c*(X.y*H.y-j.y*z.y),B.z=c*(X.y*H.z-j.y*z.z)):(B.x=0,B.y=0,B.z=1),G.set(B.x,B.y,B.z,1),i.set(r[u],G),i.set(r[u+1],G),i.set(r[u+2],G)}this.isDirty=!0}else _.a.warnOnce("geometry.calculateTangents","geometry.calculateTangents error:no vertices data.")},convertToLinesMode:function(){if(this.mode===N)if(this.indices){for(var e=new Uint16Array(2*this.indices.length),t=this.indices.data,n=0;n<t.length;n+=3)e[2*n]=t[n],e[2*n+1]=t[n+1],e[2*n+2]=t[n+1],e[2*n+3]=t[n+2],e[2*n+4]=t[n+2],e[2*n+5]=t[n];this.indices.data=e,this.mode=F}else _.a.warn("Has no indices!");else _.a.warn("Only support convert triangles to lines mode!")},translate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.transformMat4(q.fromTranslation(B.set(e,t,n))),this},scale:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.transformMat4(q.fromScaling(B.set(e,t,n))),this},rotate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.transformMat4(q.fromQuat(Y.fromEuler({x:e*d.a.DEG2RAD,y:t*d.a.DEG2RAD,z:n*d.a.DEG2RAD}))),this},transformMat4:function(e){var t=this.vertices;if(t&&t.traverse((function(n,r,i){t.setByOffset(i,n.transformMat4(e))})),W.normalFromMat4(e),this._normals){var n=this.normals;n.traverse((function(e,t,r){n.setByOffset(r,e.transformMat3(W).normalize())}))}if(this._tangents){var r=this.tangents;r.traverse((function(e,t,n){r.setByOffset(n,e.transformMat3(W).normalize())}))}return this.isDirty=!0,this},merge:function(e,t){var n=e.vertices;if(n&&this.vertices){var r=this.vertices.count;t&&(n=e.vertices.clone()).traverse((function(e,r,i){n.setByOffset(i,e.transformMat4(t))})),this.vertices.merge(n),this.indices&&e.indices?this.indices.merge(e.indices,(function(e){return e+r})):this.indices=null}return this.uvs&&e.uvs?this.uvs.merge(e.uvs):this.uvs=null,this.uvs1&&e.uvs1?this.uvs1.merge(e.uvs1):this.uvs1=null,this.colors&&e.colors?this.colors.merge(e.colors):this.colors=null,this._normals&&(this._normals=null),this._tangents&&(this._tangents=null),this._tangents1&&(this._tangents1=null),this.isDirty=!0,this},ensureData:function(e,t,n,r){var i=this[e];if(!i||n>i.length){var a=new r(n);i?(a.set(i.data),i.data=a):this[e]=new w(a,t)}},addPoints:function(){var e=this,t=[].slice.call(arguments),n=3*(this.currentVerticesCount+t.length);this.ensureData("vertices",3,n,Float32Array);var r=this.vertices.data;return t.forEach((function(t){var n=3*e.currentVerticesCount++;r[n]=t[0],r[n+1]=t[1],r[n+2]=t[2]})),this.currentVerticesCount-t.length},addIndices:function(){var e=this,t=[].slice.call(arguments),n=this.currentIndicesCount+t.length;this.ensureData("indices",1,n,Uint16Array);var r=this.indices.data;t.forEach((function(t){r[e.currentIndicesCount++]=t})),this._needUpdateNormals=!0},addLine:function(e,t){var n=this.addPoints(e,t);this.addIndices(n,n+1)},addFace:function(e,t,n){var r=this.addPoints(e,t,n);this.addIndices(r,r+1,r+2)},addRect:function(e,t,n,r){var i=this.addPoints(e,t,n,r);this.addIndices(i,i+1,i+2,i,i+2,i+3)},setVertexUV:function(e,t){this.ensureData("uvs",2,this.vertices.length/3*2,Float32Array);for(var n=this.uvs.data,r=0;r<t.length;r++)n[e+2*r]=t[r][0],n[e+2*r+1]=t[r][1]},setFaceUV:function(e,t,n,r){this.setVertexUV(e,[t,n,r])},setRectUV:function(e,t,n,r,i){this.setVertexUV(e,[t,n,r,i])},getBounds:function(e,t){t||(t={xMin:1/0,xMax:-1/0,yMin:1/0,yMax:-1/0,zMin:1/0,zMax:-1/0});var n=this.vertices;return n?(n.traverse((function(n){e&&n.transformMat4(e),t.xMax=Math.max(t.xMax,n.x),t.yMax=Math.max(t.yMax,n.y),t.zMax=Math.max(t.zMax,n.z),t.xMin=Math.min(t.xMin,n.x),t.yMin=Math.min(t.yMin,n.y),t.zMin=Math.min(t.zMin,n.z)})),t.width=t.xMax-t.xMin,t.height=t.yMax-t.yMin,t.depth=t.zMax-t.zMin,t.x=(t.xMin+t.xMax)/2,t.y=(t.yMin+t.yMax)/2,t.z=(t.zMin+t.zMax)/2,t):(_.a.warnOnce("geometry.getBounds","geometry has no vertices data, geometry.getBounds will return Infinity bounds."),t)},getLocalBounds:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._localBounds&&!e||(this._localBounds=this.getBounds()),this._localBounds},getSphereBounds:function(e){this._sphereBounds||(this._sphereBounds=new L.a);var t=this._sphereBounds;return t.copy(this.getLocalSphereBounds()),e&&t.transformMat4(e),t},getLocalSphereBounds:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._localSphereBounds||e){var t=this.getLocalBounds(e),n=new L.a({center:new c.a(t.x,t.y,t.z)}),r=this.vertices;r?n.fromGeometryData(r):(_.a.warnOnce("geometry.getLocalSphereBounds","geometry has no vertices data, geometry.getLocalSphereBounds will return Infinity bounds."),n.radius=1/0),this._localSphereBounds=n}return this._localSphereBounds},convertToNoIndices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;if(this.mode===N)if(this.indices){for(var t=this.indices.data,n=t.length,r=new Float32Array(n*e),a=this.uvs?new Float32Array(2*n):null,o=new Float32Array(3*n),s=this.colors?new Float32Array(this.colors.size*n):null,u=this.skinIndices?new Float32Array(4*n):null,c=this.skinWeights?new Float32Array(4*n):null,l=0;l<n;l++){var f=t[l];Object(i.copyArrayData)(r,this.vertices,l*e,3*f,3),4===e&&(r[4*l+3]=1),Object(i.copyArrayData)(a,this.uvs,2*l,2*f,2),Object(i.copyArrayData)(o,this.normals,3*l,3*f,3),Object(i.copyArrayData)(u,this.skinIndices,4*l,4*f,4),Object(i.copyArrayData)(c,this.skinWeights,4*l,4*f,4),this.colors&&Object(i.copyArrayData)(s,this.colors,l*this.colors.size,f*this.colors.size,this.colors.size)}delete this.indices,this.vertices.data=r,this.uvs&&(this.uvs.data=a),this.normals&&(this.normals.data=o),this.colors&&(this.colors.data=s),this.skinIndices&&(this.skinIndices.data=u),this.skinWeights&&(this.skinWeights.data=c)}else _.a.warn("Has no indices!");else _.a.warn("Only support convert triangles to lines mode!")},clone:function(){var e=new this.constructor({mode:this.mode});return this.vertices&&(e.vertices=this.vertices.clone()),this.uvs&&(e.uvs=this.uvs.clone()),this.uvs1&&(e.uvs1=this.uvs1.clone()),this.colors&&(e.colors=this.colors.clone()),this.indices&&(e.indices=this.indices.clone()),this.skinWeights&&(e.skinWeights=this.skinWeights.clone()),this.skinIndices&&(e.skinIndices=this.skinIndices.clone()),this._normals&&(e._normals=this._normals.clone()),this._tangents&&(e._tangents=this._tangents.clone()),this._tangents1&&(e._tangents1=this._tangents1.clone()),this.positionDecodeMat&&(e.positionDecodeMat=this.positionDecodeMat),this.uvDecodeMat&&(e.uvDecodeMat=this.uvDecodeMat),this.uv1DecodeMat&&(e.uv1DecodeMat=this.uv1DecodeMat),this.normalDecodeMat&&(e.normalDecodeMat=this.normalDecodeMat),e},_aabbRaycast:function(e){var t=this.getLocalBounds(),n=e.intersectsBox([[t.xMin,t.yMin,t.zMin],[t.xMax,t.yMax,t.zMax]]);return n?[n]:null},_raycast:function(e,t){var n=this.vertices;if(!n)return null;var r,i=this.indices,a=[],o=[];r=i?i.realLength:n.realLength/3;for(var s=0;s<r;s+=3){var u=i?i.get(s):s;B.copy(n.get(u)),u=i?i.get(s+1):s+1,H.copy(n.get(u)),u=i?i.get(s+2):s+2,z.copy(n.get(u));var c=void 0;t===D?(a[0]=B.elements,a[1]=H.elements,a[2]=z.elements,c=e.intersectsTriangle(a)):t===U?(a[1]=B.elements,a[0]=H.elements,a[2]=z.elements,c=e.intersectsTriangle(a)):t===V&&(a[0]=B.elements,a[1]=H.elements,a[2]=z.elements,(c=e.intersectsTriangle(a))||(a[1]=B.elements,a[0]=H.elements,a[2]=z.elements,c=e.intersectsTriangle(a))),c&&o.push(c)}return o.length?o:null},raycast:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(n=this.useAABBRaycast?this._aabbRaycast(e):this._raycast(e,t))&&r&&e.sortPoints(n),n},getRenderOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.positionDecodeMat&&(e.QUANTIZED=1,e.POSITION_QUANTIZED=1),this.normalDecodeMat&&(e.QUANTIZED=1,e.NORMAL_QUANTIZED=1),this.uvDecodeMat&&(e.QUANTIZED=1,e.UV_QUANTIZED=1),this.uv1DecodeMat&&(e.QUANTIZED=1,e.UV1_QUANTIZED=1),this.colors&&(e.HAS_COLOR=1,e.COLOR_SIZE=this.colors.size),e},getShaderKey:function(){return void 0===this._shaderKey&&(this._shaderKey="geometry",this.isMorphGeometry?this._shaderKey+="_id_".concat(this.id):(this.colors&&(this._shaderKey+="_colors"),this.positionDecodeMat&&(this._shaderKey+="positionDecodeMat"))),this._shaderKey},getSize:function(){var e=0;for(var t in this)Object(i.hasOwnProperty)(this,t)&&this[t]&&this[t].isGeometryData&&(e+=this[t].getByteLength());return e},destroy:function(){_.a.warn("Geometry.destroy has been deprecated, use mesh.destroy(renderer) instead.")}}),Q=a.a.create({Extends:b,isPerspectiveCamera:!0,className:"PerspectiveCamera",_near:.1,near:{get:function(){return this._near},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._near=e}},_far:null,far:{get:function(){return this._far},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._far=e}},_fov:50,fov:{get:function(){return this._fov},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._fov=e}},_aspect:1,aspect:{get:function(){return this._aspect},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._aspect=e}},constructor:function(e){Q.superclass.constructor.call(this,e),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.projectionMatrix.elements,t=this.near,n=this.far,r=this.aspect,i=this.fov,a=1/Math.tan(.5*d.a.degToRad(i));if(e[0]=a/r,e[5]=a,e[11]=-1,e[15]=0,n){var o=1/(t-n);e[10]=(t+n)*o,e[14]=2*n*t*o}else e[10]=-1,e[14]=-2*t},getGeometry:function(e){if(e||!this._geometry||this._isGeometryDirty){this._isGeometryDirty=!1;var t=new K,n=Math.tan(this.fov/2*Math.PI/180),r=this.near,i=this.far,a=r*n,o=i*n,s=this.aspect*a,u=this.aspect*o,c=[-s,-a,-r],l=[s,-a,-r],f=[s,a,-r],h=[-s,a,-r],d=[-u,-o,-i],_=[u,-o,-i],m=[u,o,-i],p=[-u,o,-i];t.addRect(d,_,m,p),t.addRect(_,l,f,m),t.addRect(l,c,h,f),t.addRect(c,d,p,h),t.addRect(p,m,f,h),t.addRect(c,l,_,d),this._geometry=t}return this._geometry}}),Z=Q,J=a.a.create({constructor:function(){this._cache={}},get:function(e){return this._cache[e]},getObject:function(e){return this._cache[e.__cacheId]},add:function(e,t){"object"==typeof t&&(t.__cacheId=e),this._cache[e]=t},remove:function(e){delete this._cache[e]},removeObject:function(e){delete this._cache[e.__cacheId]},removeAll:function(){this._cache={}},each:function(e){var t=this._cache;for(var n in t)e(t[n],n)}}),$={instanced:void 0,vao:void 0,texFloat:void 0,loseContext:void 0,textureFilterAnisotropic:void 0,_usedExtensions:{},_disabledExtensions:{},init:function(e){this.reset(e)},reset:function(e){this.gl=e;var t=this._usedExtensions;for(var n in t){var r=t[n];this[r]=void 0,this.get(n,r)}},use:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;this.gl?this.get(e,t):this._usedExtensions[e]=t},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(this._disabledExtensions[e])return null;var n=this[t];return void 0===n&&(n=this._getExtension(e),this[t]=n),n},disable:function(e){this._disabledExtensions[e]=!0},enable:function(e){this._disabledExtensions[e]=!1},_getExtension:function(e){var t=this.gl;return t&&t.getExtension&&(t.getExtension(e)||t.getExtension("WEBKIT_"+e)||t.getExtension("MOZ_"+e))||null}};$.use("ANGLE_instanced_arrays","instanced"),$.use("OES_vertex_array_object","vao"),$.use("OES_texture_float","texFloat"),$.use("WEBGL_lose_context","loseContext"),$.use("OES_element_index_uint","uintIndices"),$.use("EXT_shader_texture_lod","shaderTextureLod"),$.use("EXT_texture_filter_anisotropic","textureFilterAnisotropic");var ee=$,te={MAX_TEXTURE_INDEX:null,MAX_PRECISION:null,MAX_VERTEX_PRECISION:null,MAX_FRAGMENT_PRECISION:null,VERTEX_TEXTURE_FLOAT:null,FRAGMENT_TEXTURE_FLOAT:null,MAX_TEXTURE_MAX_ANISOTROPY:1,MAX_RENDERBUFFER_SIZE:void 0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:void 0,MAX_CUBE_MAP_TEXTURE_SIZE:void 0,MAX_FRAGMENT_UNIFORM_VECTORS:void 0,MAX_TEXTURE_IMAGE_UNITS:void 0,MAX_TEXTURE_SIZE:void 0,MAX_VARYING_VECTORS:void 0,MAX_VERTEX_ATTRIBS:void 0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:void 0,MAX_VERTEX_UNIFORM_VECTORS:void 0,init:function(e){var t=this;this.gl=e,["MAX_RENDERBUFFER_SIZE","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS"].forEach((function(e){t.get(e)})),this.MAX_TEXTURE_INDEX=this.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,this.MAX_VERTEX_PRECISION=this._getMaxSupportPrecision(e.VERTEX_SHADER),this.MAX_FRAGMENT_PRECISION=this._getMaxSupportPrecision(e.FRAGMENT_SHADER),this.MAX_PRECISION=this.getMaxPrecision(this.MAX_FRAGMENT_PRECISION,this.MAX_VERTEX_PRECISION),this.VERTEX_TEXTURE_FLOAT=!!ee.texFloat&&this.MAX_VERTEX_TEXTURE_IMAGE_UNITS>0,this.FRAGMENT_TEXTURE_FLOAT=!!ee.texFloat,this.EXT_FRAG_DEPTH=ee.get("EXT_frag_depth"),this.SHADER_TEXTURE_LOD=!!ee.shaderTextureLod,ee.textureFilterAnisotropic&&(this.MAX_TEXTURE_MAX_ANISOTROPY=e.getParameter(ee.textureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))},get:function(e){var t=this.gl,n=this[e];return void 0===n&&(n=this[e]=t.getParameter(t[e])),n},_getMaxSupportPrecision:function(e){var t=this.gl,n="lowp";if(t.getShaderPrecisionFormat)for(var r=[{name:"highp",type:t.HIGH_FLOAT},{name:"mediump",type:t.MEDIUM_FLOAT}],i=0;i<r.length;i++){var a=r[i];if((t.getShaderPrecisionFormat(e,a.type)||{}).precision>0){n=a.name;break}}else n="mediump";return n},getMaxPrecision:function(e,t){return"highp"===e||"mediump"===e&&"lowp"===t?t:e}},ne=n(52),re=n.n(ne),ie=n(53),ae=n.n(ie),oe=n(54),se=n.n(oe),ue=n(55),ce=n.n(ue),le=new J,fe=new J,he=a.a.create({isShader:!0,className:"Shader",vs:"",fs:"",Statics:{commonOptions:{},shaders:{"chunk/baseDefine.glsl":n(18),"chunk/color.frag":n(38),"chunk/color.vert":n(77),"chunk/color_main.vert":n(79),"chunk/diffuse.frag":n(59),"chunk/diffuse_main.frag":n(68),"chunk/extensions.frag":n(24),"chunk/extensions.vert":n(50),"chunk/fog.frag":n(45),"chunk/fog_main.frag":n(70),"chunk/frag_color.frag":n(49),"chunk/joint.vert":n(72),"chunk/joint_main.vert":n(82),"chunk/light.frag":n(42),"chunk/lightFog.frag":n(41),"chunk/lightFog.vert":n(75),"chunk/lightFog_main.frag":n(47),"chunk/lightFog_main.vert":n(85),"chunk/logDepth.frag":n(28),"chunk/logDepth_main.frag":n(29),"chunk/logDepth.vert":n(78),"chunk/logDepth_main.vert":n(86),"chunk/morph.vert":n(76),"chunk/morph_main.vert":n(81),"chunk/normal.frag":n(40),"chunk/normal.vert":n(74),"chunk/normal_main.frag":n(46),"chunk/normal_main.vert":n(84),"chunk/pbr.frag":n(88),"chunk/pbr_main.frag":n(90),"chunk/phong.frag":n(66),"chunk/phong_main.frag":n(69),"chunk/precision.frag":n(25),"chunk/precision.vert":n(51),"chunk/transparency.frag":n(44),"chunk/transparency_main.frag":n(48),"chunk/unQuantize.vert":n(71),"chunk/unQuantize_main.vert":n(80),"chunk/uv.frag":n(39),"chunk/uv.vert":n(73),"chunk/uv_main.vert":n(83),"method/encoding.glsl":n(89),"method/getDiffuse.glsl":n(61),"method/getLightAttenuation.glsl":n(63),"method/getShadow.glsl":n(65),"method/getSpecular.glsl":n(62),"method/packFloat.glsl":n(87),"method/textureEnvMap.glsl":n(43),"method/transpose.glsl":n(60),"method/unpackFloat.glsl":n(64),"basic.frag":n(52),"basic.vert":n(53),"geometry.frag":n(54),"pbr.frag":n(55),"screen.frag":n(56),"screen.vert":n(57)},init:function(e){this.renderer=e,this.commonHeader=this._getCommonHeader(this.renderer)},cache:{get:function(){return le}},headerCache:{get:function(){return fe}},reset:function(e){le.removeAll()},getHeaderKey:function(e,t,n,r,i){var a="header_"+t.id+"_"+n.lightInfo.uid;return e.isSkinedMesh&&(a+="_joint"+e.skeleton.jointCount),r&&(a+="_fog_"+r.mode),a+="_"+e.geometry.getShaderKey(),i&&(a+="_fogDepth"),a},getHeader:function(e,t,n,r,i){var a=this.getHeaderKey(e,t,n,r),o=fe.get(a);if(!o||t.isDirty){var s={};Object.assign(s,this.commonOptions);var u=t.lightType;u&&"NONE"!==u&&n.getRenderOption(s),t.getRenderOption(s),e.getRenderOption(s),r&&(s.HAS_FOG=1,r.getRenderOption(s)),i&&(s.USE_LOG_DEPTH=1,te.EXT_FRAG_DEPTH&&(s.USE_EXT_FRAG_DEPTH=1)),s.HAS_NORMAL&&s.NORMAL_MAP&&(s.HAS_TANGENT=1),s.RECEIVE_SHADOWS||(delete s.DIRECTIONAL_LIGHTS_SMC,delete s.SPOT_LIGHTS_SMC,delete s.POINT_LIGHTS_SMC),o="#define SHADER_NAME ".concat(t.className,"\n"),o+=Object.keys(s).map((function(e){return e.indexOf("HILO_CUSTUM_OPTION_")>-1?"#define ".concat(e.replace("HILO_CUSTUM_OPTION_","")," ").concat(s[e]):"#define HILO_".concat(e," ").concat(s[e])})).join("\n")+"\n",fe.add(a,o)}return o},_getCommonHeader:function(e){var t=te.getMaxPrecision(te.MAX_VERTEX_PRECISION,e.vertexPrecision),n=te.getMaxPrecision(te.MAX_FRAGMENT_PRECISION,e.fragmentPrecision),r=te.getMaxPrecision(t,n);return"\n#define HILO_MAX_PRECISION ".concat(r,"\n#define HILO_MAX_VERTEX_PRECISION ").concat(t,"\n#define HILO_MAX_FRAGMENT_PRECISION ").concat(n,"\n")},getShader:function(e,t,n,r,i,a){var o=this.getHeader(e,t,r,i,a);return t.isBasicMaterial||t.isPBRMaterial?this.getBasicShader(t,n,o):t.isShaderMaterial?this.getCustomShader(t.vs,t.fs,o,t.shaderCacheId||t.id,t.useHeaderCache):null},getBasicShader:function(e,t,n){var r="";t&&(r=(r=e.getInstancedUniforms().map((function(e){return e.name}))).join("|"));var i=e.className+":"+r;e.onBeforeCompile&&(i+=":"+(e.shaderCacheId||e.id));var a=le.get(i);if(!a){var o="",s=ae.a;if(e.isBasicMaterial?e.isGeometryMaterial?o+=se.a:o+=re.a:e.isPBRMaterial&&(o+=ce.a),e.onBeforeCompile){var u=e.onBeforeCompile(s,o);o=u.fs,s=u.vs}if(r){var c=new RegExp("^\\s*uniform\\s+(\\w+)\\s+(".concat(r,");"),"gm");s=s.replace(c,"attribute $1 $2;")}a=this.getCustomShader(s,o,n,i,!0)}if(a){var l=this._getNumId(a);null!==l&&(e._shaderNumId=l)}return a},_getNumId:function(e){var t=e.id.match(/_(\d+)/);return t&&t[1]?parseInt(t[1],10):null},getCustomShader:function(e,t,n,r,i){var a,o=this.commonHeader;return r&&(i&&(r+=":"+n),a=le.get(r)),a||(a=new he({vs:o+n+e,fs:o+n+t}),r&&le.add(r,a)),a}},alwaysUse:!1,constructor:function(e){this.id=d.a.generateUUID(this.className),Object.assign(this,e)},destroyIfNoRef:function(e){return e.resourceManager.destroyIfNoRef(this),this},destroy:function(){return this._isDestroyed||(le.removeObject(this),this._isDestroyed=!0),this}}),de=he,_e=n(57),me=n.n(_e),pe=n(56),ve=n.n(pe),ge=[{name:"FLOAT",byteSize:4,uniformFuncName:"uniform1f",type:"Scalar",size:1},{name:"FLOAT_VEC2",byteSize:8,uniformFuncName:"uniform2f",type:"Vector",size:2},{name:"FLOAT_VEC3",byteSize:12,uniformFuncName:"uniform3f",type:"Vector",size:3},{name:"FLOAT_VEC4",byteSize:16,uniformFuncName:"uniform4f",type:"Vector",size:4},{name:"FLOAT_MAT2",byteSize:16,uniformFuncName:"uniformMatrix2fv",type:"Matrix",size:4},{name:"FLOAT_MAT3",byteSize:36,uniformFuncName:"uniformMatrix3fv",type:"Matrix",size:9},{name:"FLOAT_MAT4",byteSize:64,uniformFuncName:"uniformMatrix4fv",type:"Matrix",size:16},{name:"INT",byteSize:4,uniformFuncName:"uniform1i",type:"Scalar",size:1},{name:"INT_VEC2",byteSize:8,uniformFuncName:"uniform2i",type:"Vector",size:2},{name:"INT_VEC3",byteSize:12,uniformFuncName:"uniform3i",type:"Vector",size:3},{name:"INT_VEC4",byteSize:16,uniformFuncName:"uniform4i",type:"Vector",size:4},{name:"BOOL",byteSize:4,uniformFuncName:"uniform1i",type:"Scalar",size:1},{name:"BOOL_VEC2",byteSize:8,uniformFuncName:"uniform2i",type:"Vector",size:2},{name:"BOOL_VEC3",byteSize:12,uniformFuncName:"uniform3i",type:"Vector",size:3},{name:"BOOL_VEC4",byteSize:16,uniformFuncName:"uniform4i",type:"Vector",size:4},{name:"SAMPLER_2D",byteSize:4,uniformFuncName:"uniform1i",type:"Scalar",size:1},{name:"SAMPLER_CUBE",byteSize:4,uniformFuncName:"uniform1i",type:"Scalar",size:1}],ye={},Ee={dict:ye,init:function(e){ge.forEach((function(t){var n,r,i=t.name,a=t.uniformFuncName,o=a+"v";"Matrix"===t.type?n=r=function(t,n){void 0!==n&&e[a](t,!1,n)}:(n=function(t,n){void 0!==n&&e[a](t,n)},r=function(t,n){e[o](t,n)}),ye[e[i]]=Object.assign(t,{glValue:e[i],uniform:n,uniformArray:r})}))},get:function(e){return ye[e]}},Te=new J,xe=a.a.create({Statics:{cache:{get:function(){return Te}},reset:function(e){Te.each((function(e){e.destroy()}))},getProgram:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.id,i=Te.get(r);return i||(i=new xe({state:t,vertexShader:e.vs,fragShader:e.fs,ignoreError:n}),Te.add(r,i)),i},getBlankProgram:function(e){var t=de.getCustomShader("void main(){}","precision HILO_MAX_FRAGMENT_PRECISION float;void main(){gl_FragColor = vec4(0.0);}","","__hiloBlankShader");return this.getProgram(t,e,!0)}},className:"Program",isProgram:!0,fragShader:"",vertexShader:"",attributes:null,uniforms:null,program:null,gl:null,state:null,alwaysUse:!1,constructor:function(e){return this.id=d.a.generateUUID(this.className),Object.assign(this,e),this._dict={},this.attributes={},this.uniforms={},this.gl=this.state.gl,this.program=this.createProgram(),this.program?(this.initAttributes(),this.initUniforms(),this):this.ignoreError?this:xe.getBlankProgram(e.state)},createProgram:function(){var e=this.gl,t=e.createProgram(),n=this.createShader(e.VERTEX_SHADER,this.vertexShader),r=this.createShader(e.FRAGMENT_SHADER,this.fragShader);if(n&&r){if(e.attachShader(t,n),e.attachShader(t,r),e.linkProgram(t),e.deleteShader(n),e.deleteShader(r),!e.getProgramParameter(t,e.LINK_STATUS)){var i=e.getProgramInfoLog(t);return _.a.error("compileProgramError: "+i,this),e.deleteProgram(t),null}return t}return null},useProgram:function(){this.state.useProgram(this.program)},createShader:function(e,t){var n=this.gl,r=n.createShader(e);if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS)){var i=n.getShaderInfoLog(r);return _.a.error("compileShaderError: "+i,t.split("\n").map((function(e,t){return"".concat(t+1," ").concat(e)})).join("\n")),null}return r},initAttributes:function(){for(var e=this,t=this.gl,n=this.program,r=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES),i=ee.instanced,a=function(r){var a=t.getActiveAttrib(n,r),o=a.name,s=a.type,u=a.size,c=t.getAttribLocation(n,o),l=Ee.get(s),f=function(e){var n=e.type,r=void 0===n?t.FLOAT:n,i=e.normalized,a=void 0!==i&&i,o=e.stride,s=void 0===o?0:o,u=e.offset,f=void 0===u?0:u,h=e.size,d=void 0===h?l.size:h;t.vertexAttribPointer(c,d,r,a,s,f)},h=function(){t.enableVertexAttribArray(c)},d=function(){},_=function(e,t){e[c]=t};if(i&&(d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;i.vertexAttribDivisorANGLE(c,e)}),"Matrix"===l.type){var m=l.byteSize,p=l.size,v=Math.sqrt(p),g=4*v,y=function(e){for(var t=0;t<v;t++)e(c+t,t)};f=function(e){var n,r=e.type,i=void 0===r?t.FLOAT:r,a=e.normalized,o=void 0!==a&&a,s=e.stride,u=void 0===s?0:s,c=e.offset,l=void 0===c?0:c;n=0===u?m:u,y((function(e,r){t.vertexAttribPointer(e,v,i,o,n,l+g*r)}))},h=function(){y((function(e){t.enableVertexAttribArray(e)}))},_=function(e,t){y((function(n){e[n]=t}))},i&&(d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;y((function(t){i.vertexAttribDivisorANGLE(t,e)}))})}e.attributes[o]={name:o,location:c,type:s,size:u,glTypeInfo:l,pointer:f,enable:h,divisor:d,addTo:_}},o=0;o<r;o++)a(o)},initUniforms:function(){for(var e=this,t=this.gl,n=this.program,r=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),i=0,a=function(r){var a=t.getActiveUniform(n,r),o=a.name,s=a.size,u=a.type;o=o.replace(/\[0\]$/,"");var c=t.getUniformLocation(n,o),l=Ee.get(u),f=l.uniformArray,h=l.uniform;e.uniforms[o]={name:o,location:c,type:u,size:s,glTypeInfo:l},u!==t.SAMPLER_2D&&u!==t.SAMPLER_CUBE||(e.uniforms[o].textureIndex=i,i+=s),Object.defineProperty(e,o,{set:l.size>1||s>1?function(e){f(c,e)}:function(t){e._dict[o]!==t&&(e._dict[o]=t,h(c,t))}})},o=0;o<r;o++)a(o)},destroyIfNoRef:function(e){return e.resourceManager.destroyIfNoRef(this),this},destroy:function(){return this._isDestroyed||(this.gl.deleteProgram(this.program),this.uniforms=null,this.attributes=null,this.program=null,this.gl=null,this.state=null,this._dict=null,Te.removeObject(this),this._isDestroyed=!0),this}}),Ae=xe,Oe=P.a.ARRAY_BUFFER,be=P.a.ELEMENT_ARRAY_BUFFER,Me=P.a.STATIC_DRAW,Se=new J,Re=a.a.create({Statics:{cache:{get:function(){return Se}},reset:function(e){Se.each((function(e){e.destroy()}))},createVertexBuffer:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Me;return this.createBuffer(e,Oe,t,n)},createBuffer:function(e,t,n,r){var i=n.bufferViewId,a=Se.get(i);return a||(n.isDirty=!1,a=new Re(e,t,n.data,r),Se.add(i,a),a)},createIndexBuffer:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Me;return this.createBuffer(e,be,t,n)}},className:"Buffer",isBuffer:!0,constructor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oe,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Me;this.id=d.a.generateUUID(this.className),this.gl=e,this.target=t,this.usage=r,this.buffer=e.createBuffer(),n&&this.bufferData(n)},bind:function(){return this.gl.bindBuffer(this.target,this.buffer),this},bufferData:function(e){var t=this.gl,n=this.target,r=this.usage;return this.bind(),t.bufferData(n,e,r),this.data=e,this},bufferSubData:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.gl,i=this.target;return n||this.bind(),r.bufferSubData(i,e,t),this},uploadGeometryData:function(e){var t=this,n=e.subDataList;return!this.data||this.data.byteLength<e.data.byteLength||!0===e._isAllDirty?this.bufferData(e.data):n&&n.length?(this.bind(),n.forEach((function(e){t.bufferSubData(e.byteOffset,e.data,!0)}))):this.bufferData(e.data),e.isDirty=!1,this},destroyIfNoRef:function(e){return e.resourceManager.destroyIfNoRef(this),this},destroy:function(){return this._isDestroyed||(this.gl.deleteBuffer(this.buffer),this.data=null,Se.removeObject(this),this._isDestroyed=!0),this}}),Le=Re,Ce=new ArrayBuffer(1),Ie={getTypedArray:function(e,t){return this._updateBuffer(t*e.BYTES_PER_ELEMENT),new e(Ce,0,t)},fillArrayData:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=0,i=t.length;r<i;r++)e[n+r]=t[r]},_updateBuffer:function(e){Ce.byteLength<e&&(Ce=new ArrayBuffer(2*e))}},we=P.a.TRIANGLES,Pe=[],Ne=null,Fe=new J,De=a.a.create({Statics:{cache:{get:function(){return Fe}},getVao:function(e,t,n){var r=Fe.get(t);return r?n.mode&&n.mode!==r.mode&&(r.mode=n.mode):(r=new De(e,t,n),Fe.add(t,r)),r},reset:function(e){Ne=null,Pe=[],this.bindSystemVao(),Fe.each((function(t){t.destroy(e)}))},bindSystemVao:function(){ee.vao&&ee.vao.bindVertexArrayOES(null),Ne=null}},className:"VertexArrayObject",isVertexArrayObject:!0,vertexCount:null,useVao:!1,useInstanced:!1,mode:we,isDirty:!0,constructor:function(e,t,n){this.gl=e,this.id=t,this.vaoExtension=ee.vao,this.instancedExtension=ee.instanced,Object.assign(this,n),this.vaoExtension||(this.useVao=!1),this.instancedExtension||(this.useInstanced=!1),this.useVao&&(this.vao=this.vaoExtension.createVertexArrayOES()),this.attributes=[],this.activeStates=[],this.indexBuffer=null},bind:function(){Ne!==this&&(this.useVao?this.vaoExtension.bindVertexArrayOES(this.vao):this.bindSystemVao(),Ne=this)},bindSystemVao:function(){var e=this.gl;Ne&&Ne.useVao&&Ne.unbind();var t,n=this.activeStates;this.attributes.forEach((function(e){var n=e.buffer,r=e.attribute,i=e.geometryData;t!==n&&(t=n,n.bind()),r.enable(),r.pointer(i),e.useInstanced?r.divisor(1):r.divisor(0)})),Pe.forEach((function(t,r){var i=n[r];t&&!i&&(t.attribute.divisor(0),e.disableVertexAttribArray(r))})),this.indexBuffer&&this.indexBuffer.bind(),Pe=n},unbind:function(){this.useVao&&this.vaoExtension.bindVertexArrayOES(null),Ne=null},draw:function(){this.bind();var e=this.gl,t=this.mode;this.indexBuffer?e.drawElements(t,this.vertexCount,this.indexType,0):e.drawArrays(t,0,this.getVertexCount())},getVertexCount:function(){if(null===this.vertexCount){var e=this.attributes[0];this.vertexCount=e?e.geometryData.count:0}return this.vertexCount},drawInstance:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.bind();var t=this.gl,n=this.mode;this.useInstanced&&(this.indexBuffer?this.instancedExtension.drawElementsInstancedANGLE(n,this.vertexCount,t.UNSIGNED_SHORT,0,e):this.instancedExtension.drawArraysInstancedANGLE(n,0,this.getVertexCount(),e))},addIndexBuffer:function(e,t){this.bind();var n=this.gl,r=this.indexBuffer;return this.indexType=e.type,r?e.isDirty&&(r.uploadGeometryData(e),this.vertexCount=e.length):((r=Le.createIndexBuffer(n,e,t)).bind(),this.indexBuffer=r,this.vertexCount=e.length),r},addAttribute:function(e,t,n,r){this.bind();var i=this.gl,a=t.name,o=this[a];if(!o){var s=Le.createVertexBuffer(i,e,n);s.bind(),t.enable(),t.pointer(e),o={attribute:t,buffer:s,geometryData:e},this.attributes.push(o),this[a]=o,t.addTo(this.activeStates,o),r&&r(o)}if(e.isDirty){var u=o.buffer;u.bind(),t.enable(),t.pointer(e),u.uploadGeometryData(e)}return o},addInstancedAttribute:function(e,t,n){this.bind();var r=this.gl,i=e.name,a=e.glTypeInfo,o=Ie.getTypedArray(Float32Array,t.length*a.size);t.forEach((function(e,t){void 0!==n(e)?Ie.fillArrayData(o,n(e),t*a.size):_.a.warn("no attributeData:"+i+"-"+e.name)}));var s,u=this[i];return u?(s=u.geometryData).data=o:s=new w(o,1),this.addAttribute(s,e,r.DYNAMIC_DRAW,(function(t){e.divisor(1),t.useInstanced=!0}))},getResources:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.attributes&&this.attributes.forEach((function(t){e.push(t.buffer)})),this.indexBuffer&&e.push(this.indexBuffer),e},destroyIfNoRef:function(e){return e.resourceManager.destroyIfNoRef(this),this},destroy:function(){var e=this;return this._isDestroyed||(this.instancedExtension=null,this.useVao&&(this.vaoExtension.deleteVertexArrayOES(this.vao),this.vao=null,this.vaoExtension=null),this.gl=null,this.indexBuffer=null,this.attributes.forEach((function(t){var n=t.attribute||{};e[n.name]=null})),this.attributes=null,this.activeStates=null,Fe.removeObject(this),this._isDestroyed=!0),this}}),Ue=De,Ve=P.a.TEXTURE_2D,Be=P.a.RGBA,He=P.a.LINEAR,ze=P.a.NEAREST,Ge=P.a.REPEAT,ke=P.a.CLAMP_TO_EDGE,je=P.a.UNSIGNED_BYTE,Xe=P.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,We=P.a.UNPACK_FLIP_Y_WEBGL,qe=P.a.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ye=P.a.BROWSER_DEFAULT_WEBGL,Ke=P.a.NONE,Qe=new J,Ze=a.a.create({Statics:{cache:{get:function(){return Qe}},reset:function(e){Qe.each((function(t,n){e.deleteTexture(t),Qe.remove(n)}))}},isTexture:!0,className:"Texture",isImageCanRelease:!1,_isImageReleased:!1,_image:null,image:{get:function(){return this._isImageReleased&&_.a.errorOnce("Read Texture.image(".concat(this.id,")"),"Read Texture.image after image released!"),this._image},set:function(e){this._image=e,this._isImageReleased=!1}},_releaseImage:function(){this._canvasImage=null,this._canvasCtx=null,this._originImage=null,this._image=null,this.mipmaps=null,this._isImageReleased=!0},mipmaps:null,target:Ve,internalFormat:Be,format:Be,type:je,width:0,height:0,border:0,magFilter:He,minFilter:He,wrapS:Ge,wrapT:Ge,name:"",premultiplyAlpha:!1,flipY:!1,colorSpaceConversion:!0,compressed:!1,needUpdate:!0,needDestroy:!1,autoUpdate:!1,uv:0,anisotropic:1,origWidth:{get:function(){return this._originImage?this._originImage.width||this.width:this.image&&this.image.width||this.width}},origHeight:{get:function(){return this.originImage?this._originImage.height||this.height:this.image&&this.image.height||this.height}},useMipmap:{get:function(){return this.minFilter!==He&&this.minFilter!==ze},set:function(){_.a.warn("texture.useMipmap is readOnly!")}},useRepeat:{get:function(){return this.wrapS!==ke||this.wrapT!==ke},set:function(){_.a.warn("texture.useRepeat is readOnly!")}},mipmapCount:{get:function(){return Math.floor(Math.log2(Math.max(this.width,this.height))+1)},set:function(){_.a.warn("texture.mipmapCount is readOnly!")}},constructor:function(e){this.id=d.a.generateUUID(this.className),Object.assign(this,e)},isImgPowerOfTwo:function(e){return d.a.isPowerOfTwo(e.width)&&d.a.isPowerOfTwo(e.height)},getSupportSize:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.width,r=e.height;t&&!this.isImgPowerOfTwo(e)&&(n=d.a.nextPowerOfTwo(n),r=d.a.nextPowerOfTwo(r));var i=te.MAX_TEXTURE_SIZE;return i&&(n>i&&(n=i),r>i&&(r=i)),{width:n,height:r}},resizeImgToPowerOfTwo:function(e){var t=this.getSupportSize(e,!0);return this.resizeImg(e,t.width,t.height)},resizeImg:function(e,t,n){if(e.width===t&&e.height===n)return e;var r=this._canvasImage;return r?(r.width=t,r.height=n,this._canvasCtx=r.getContext("2d")):((r=document.createElement("canvas")).width=t,r.height=n,this._canvasImage=r,this._canvasCtx=r.getContext("2d")),this._canvasCtx.drawImage(e,0,0,e.width,e.height,0,0,t,n),_.a.warnOnce("Texture.resizeImg(".concat(this.id,")"),"image size(".concat(e.width,"x").concat(e.height,") is not support. Resized to ").concat(r.width,"x").concat(r.height),e.src),this._originImage=e,r},_glUploadTexture:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.width,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.height,o=e.gl;return this.compressed?o.compressedTexImage2D(t,r,this.internalFormat,i,a,this.border,n):n&&void 0!==n.width?o.texImage2D(t,r,this.internalFormat,this.format,this.type,n):o.texImage2D(t,r,this.internalFormat,i,a,this.border,this.format,this.type,n),this},_uploadTexture:function(e){var t=this;return this.useMipmap&&this.mipmaps?this.mipmaps.forEach((function(n,r){t._glUploadTexture(e,t.target,n.data,r,n.width,n.height)})):this._glUploadTexture(e,this.target,this.image,0),this},_updatePixelStorei:function(){var e=this.state;e.pixelStorei(Xe,this.premultiplyAlpha),e.pixelStorei(We,!!this.flipY),e.pixelStorei(qe,this.colorSpaceConversion?Ye:Ke)},updateTexture:function(e,t){var n=e.gl;if(this.needUpdate||this.autoUpdate){this._originImage&&this.image===this._canvasImage&&(this.image=this._originImage);var r=this.useMipmap,i=this.useRepeat;if(this.image&&!this.image.length){var a=i||r,o=this.getSupportSize(this.image,a);this.image=this.resizeImg(this.image,o.width,o.height),this.width=this.image.width,this.height=this.image.height}e.activeTexture(n.TEXTURE0+te.MAX_TEXTURE_INDEX),e.bindTexture(this.target,t),this._updatePixelStorei(),this._uploadTexture(e),r&&(this.compressed?this.mipmaps||(_.a.warn("Compressed texture has no mipmips, changed the minFilter from ".concat(this.minFilter," to Linear!"),this),this.minFilter=He):n.generateMipmap(this.target)),n.texParameterf(this.target,n.TEXTURE_MAG_FILTER,this.magFilter),n.texParameterf(this.target,n.TEXTURE_MIN_FILTER,this.minFilter),n.texParameterf(this.target,n.TEXTURE_WRAP_S,this.wrapS),n.texParameterf(this.target,n.TEXTURE_WRAP_T,this.wrapT);var s=ee.textureFilterAnisotropic;s&&this.anisotropic>1&&n.texParameterf(this.target,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this.anisotropic,te.MAX_TEXTURE_MAX_ANISOTROPY)),this.needUpdate=!1}return this._needUpdateSubTexture&&(this._uploadSubTextures(e,t),this._needUpdateSubTexture=!1),this},_uploadSubTextures:function(e,t){var n=this;if(this._subTextureList&&this._subTextureList.length>0){var r=e.gl;e.activeTexture(r.TEXTURE0+te.MAX_TEXTURE_INDEX),e.bindTexture(this.target,t),this._updatePixelStorei(),this._subTextureList.forEach((function(e){var t=e[0],i=e[1],a=e[2];r.texSubImage2D(n.target,0,t,i,n.format,n.type,a)})),this._subTextureList.length=0}},_needUpdateSubTexture:!1,_subTextureList:null,updateSubTexture:function(e,t,n){this._subTextureList||(this._subTextureList=[]),this._subTextureList.push([e,t,n]),this._needUpdateSubTexture=!0},getGLTexture:function(e){this.state=e;var t=this.gl=e.gl,n=this.id;this.needDestroy&&(this.destroy(),this.needDestroy=!1);var r=Qe.get(n);return r||(r=t.createTexture(),Qe.add(n,r),this.needUpdate=!0),this.updateTexture(e,r),this.isImageCanRelease&&this._releaseImage(),r},setGLTexture:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t&&this.destroy(),Qe.add(this.id,e),this},destroy:function(){var e=this.id,t=Qe.get(e);return t&&this.gl&&(this.gl.deleteTexture(t),Qe.remove(e)),this},clone:function(){var e=Object.assign({},this);return delete e.id,new this.constructor(e)}}),Je=P.a.TEXTURE_2D,$e=P.a.RGBA,et=P.a.UNSIGNED_BYTE,tt=P.a.COLOR_ATTACHMENT0,nt=P.a.DEPTH_STENCIL,rt=P.a.DEPTH_TEST,it=P.a.CULL_FACE,at=P.a.TRIANGLE_STRIP,ot=P.a.NEAREST,st=P.a.CLAMP_TO_EDGE,ut=new J,ct=a.a.create({Statics:{cache:{get:function(){return ut}},reset:function(e){ut.each((function(e){e.reset()}))},destroy:function(e){ut.each((function(e){e.destroy()}))}},className:"Framebuffer",isFramebuffer:!0,bufferInternalFormat:nt,target:Je,format:$e,internalFormat:$e,type:et,minFilter:ot,magFilter:ot,data:null,attachment:tt,needRenderbuffer:!0,useVao:!0,renderer:null,texture:null,renderbuffer:null,framebuffer:null,_isInit:!1,constructor:function(e,t){this.id=d.a.generateUUID(this.className),this.renderer=e,Object.assign(this,t),this.width||(this.width=e.width),this.height||(this.height=e.height),ut.add(this.id,this)},init:function(){if(!this._isInit&&this.renderer.isInit){this._isInit=!0;var e=this.renderer;this.gl=e.gl,this.state=e.state,this.reset()}},reset:function(){this.destroyResource();var e=this.gl;this.framebuffer=e.createFramebuffer(),this.bind(),this.needRenderbuffer&&(this.renderbuffer=this.createRenderbuffer()),this.texture=this.createTexture(),this.isComplete()||_.a.warn("Framebuffer is not complete => "+e.checkFramebufferStatus(e.FRAMEBUFFER)),this.unbind()},isComplete:function(){var e=this.gl;return!(!e||e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)},bind:function(){this.init(),this._isInit&&this.state.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer)},unbind:function(){if(this.init(),this._isInit){var e=this.state;e.bindFramebuffer(this.gl.FRAMEBUFFER,e.preFramebuffer)}},clear:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g.a(0,0,0,0);if(this._isInit){var t=this.gl;t.clearColor(e.r,e.g,e.b,e.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}},render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4?arguments[4]:void 0;if(this._isInit){var a=this.gl,o=this.state;o.disable(rt),o.disable(it),i&&this.clear(i);var s=de.getCustomShader(me.a,ve.a,"","FramebufferTextureShader"),u=Ae.getProgram(s,o);u.useProgram();var c="".concat(e,"_").concat(t,"_").concat(n,"_").concat(r,"_").concat(u.id),l=Ue.getVao(a,c,{useVao:this.useVao,useInstanced:!1,mode:at});if(l.isDirty){l.isDirty=!1;var f=[e=2*e-1,t=1-2*t,e+(n*=2),t,e,t-(r*=2),e+n,t-r];l.addAttribute(new w(new Float32Array(f),2),u.attributes.a_position),l.addAttribute(new w(new Float32Array([0,1,1,1,0,0,1,0]),2),u.attributes.a_texcoord0)}o.activeTexture(a.TEXTURE0),o.bindTexture(a.TEXTURE_2D,this.texture.getGLTexture(o)),l.draw()}},createRenderbuffer:function(){var e=this.gl,t=this.width,n=this.height,r=e.createRenderbuffer();return e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t,n),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,r),r},createTexture:function(){var e=this.state,t=e.gl,n=new Ze({minFilter:this.minFilter,magFilter:this.magFilter,internalFormat:this.internalFormat,format:this.format,type:this.type,width:this.width,height:this.height,image:this.data,wrapS:st,wrapT:st}),r=n.getGLTexture(e);return t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment,this.target,r,0),n},resize:function(e,t,n){(n||this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this._isInit&&this.reset())},readPixels:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Object(i.getTypedArrayClass)(this.type),o=new a(n*r*4);if(this._isInit){var s=this.gl;t=this.height-t-r,this.bind(),s.readPixels(e,t,n,r,this.format,this.type,o),this.unbind()}return o},destroy:function(){return this._isDestroyed||(this.destroyResource(),this.gl=null,ut.removeObject(this),this._isDestroyed=!0),this},destroyResource:function(){var e=this.gl;e&&(this.framebuffer&&(e.deleteFramebuffer(this.framebuffer),this.framebuffer=null),this.renderbuffer&&(e.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null),this.texture&&(this.texture.destroy(),this.texture=null))}}),lt=P.a.TEXTURE_CUBE_MAP,ft=P.a.RGB,ht=P.a.LINEAR,dt=P.a.CLAMP_TO_EDGE,_t=P.a.TEXTURE_CUBE_MAP_POSITIVE_X,mt=a.a.create({Extends:Ze,isCubeTexture:!0,className:"CubeTexture",target:lt,internalFormat:ft,format:ft,magFilter:ht,minFilter:ht,wrapS:dt,wrapT:dt,constructor:function(e){mt.superclass.constructor.call(this,e),this.image=this.image||[]},_uploadTexture:function(e){var t=this,n=this.image;Array.isArray(n)&&6===n.length?(n[0]&&n[0].width&&(this.width=n[0].width,this.height=n[0].height),n.forEach((function(n,r){t._glUploadTexture(e,_t+r,n,0)}))):_.a.error("CubeTexture image must be an Array of length 6",n)},right:{get:function(){return this.image[0]},set:function(e){this.image[0]=e}},left:{get:function(){return this.image[1]},set:function(e){this.image[1]=e}},top:{get:function(){return this.image[2]},set:function(e){this.image[2]=e}},bottom:{get:function(){return this.image[3]},set:function(e){this.image[3]=e}},front:{get:function(){return this.image[4]},set:function(e){this.image[4]=e}},back:{get:function(){return this.image[5]},set:function(e){this.image[5]=e}}}),pt=mt,vt=P.a.TEXTURE_2D,gt=P.a.RGBA,yt=P.a.NEAREST,Et=P.a.CLAMP_TO_EDGE,Tt=P.a.FLOAT,xt=a.a.create({Extends:Ze,isDataTexture:!0,className:"DataTexture",target:vt,internalFormat:gt,format:gt,type:Tt,magFilter:yt,minFilter:yt,wrapS:Et,wrapT:Et,dataLength:0,resetSize:function(e){if(e!==this.dataLength){this.dataLength=e;var t=d.a.nextPowerOfTwo(e/4),n=Math.max(Math.log2(t),4),r=Math.floor(n/2),a=n-r;this.width=Math.pow(2,r),this.height=Math.pow(2,a),this.DataClass=Object(i.getTypedArrayClass)(this.type)}},data:{get:function(){return this.image},set:function(e){if(this.image!==e){this.resetSize(e.length);var t=this.width*this.height*4;t===e.length&&e instanceof this.DataClass?this.image=e:(this.image&&this.image.length===t||(this.image=new this.DataClass(t)),this.image.set(e,0)),this.needUpdate=!0}}},constructor:function(e){xt.superclass.constructor.call(this,e)}}),At=xt;function Ot(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return bt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Mt,St,Rt,Lt,Ct,It,wt=new c.a,Pt=new R.a,Nt=new s.a,Ft=new Float32Array([.5,.5,.5,1]),Dt=new Float32Array([0,0]),Ut={state:null,camera:null,lightManager:null,fog:null,gl:null,renderer:null,blankInfo:{get:function(){}},init:function(e,t,n,r,i){It=this._renderer=e,Lt=this.state=t,Mt=this.camera=n,Rt=this.lightManager=r,Ct=this.fog=i,St=this.gl=Lt.gl},setCamera:function(e){Mt=this.camera=e},handlerColorOrTexture:function(e,t){return e&&e.isTexture?this.handlerTexture(e,t):(e&&e.isColor?e.toArray(Ft):Ft[0]=Ft[1]=Ft[2]=.5,Ft)},handlerTexture:function(e,t){if(e&&e.isTexture)return this.handlerGLTexture(e.target,e.getGLTexture(Lt),t)},handlerGLTexture:function(e,t,n){if(t)return Lt.activeTexture(St.TEXTURE0+n),Lt.bindTexture(e,t),n},handlerUV:function(e){return e&&e.isTexture&&e.uv||0},POSITION:{get:function(e,t,n){return e.geometry.vertices}},NORMAL:{get:function(e,t,n){return e.geometry.normals}},TANGENT:{get:function(e,t,n){var r=t.normalMap||t.clearcoatNormalMap;return r&&r.isTexture&&1===Number(r.uv)?e.geometry.tangents1:e.geometry.tangents}},TEXCOORD_0:{get:function(e,t,n){if(e.geometry.uvs)return e.geometry.uvs}},TEXCOORD_1:{get:function(e,t,n){if(e.geometry.uvs1)return e.geometry.uvs1}},UVMATRIX_0:{get:function(e,t,n){if(t.uvMatrix)return t.uvMatrix.elements}},UVMATRIX_1:{get:function(e,t,n){if(t.uvMatrix1)return t.uvMatrix1.elements}},CAMERAFAR:{get:function(e,t,n){if(Mt.isPerspectiveCamera)return Mt.far}},CAMERANEAR:{get:function(e,t,n){if(Mt.isPerspectiveCamera)return Mt.near}},CAMERATYPE:{get:function(e,t,n){return Mt.isPerspectiveCamera?1:0}},CAMERAPOSITION:{get:function(e,t,n){return Mt.worldMatrix.getTranslation(wt).elements}},COLOR_0:{get:function(e,t,n){if(e.geometry.colors)return e.geometry.colors}},SKININDICES:{get:function(e,t,n){return e.geometry.skinIndices}},SKINWEIGHTS:{get:function(e,t,n){return e.geometry.skinWeights}},RENDERERSIZE:{get:function(e,t,n){return Dt[0]=It.width,Dt[1]=It.height,Dt}},LOCAL:{get:function(e,t,n){return e.matrix.elements},isDependMesh:!0},MODEL:{get:function(e,t,n){return e.worldMatrix.elements},isDependMesh:!0},VIEW:{get:function(e,t,n){return Mt.viewMatrix.elements}},PROJECTION:{get:function(e,t,n){return Mt.projectionMatrix.elements}},VIEWPROJECTION:{get:function(e,t,n){return Mt.viewProjectionMatrix.elements}},MODELVIEW:{get:function(e,t,n){return Mt.getModelViewMatrix(e,Nt).elements},isDependMesh:!0},MODELVIEWPROJECTION:{get:function(e,t,n){return Mt.getModelProjectionMatrix(e,Nt).elements},isDependMesh:!0},MODELINVERSE:{get:function(e,t,n){return Nt.invert(e.worldMatrix).elements},isDependMesh:!0},VIEWINVERSE:{get:function(e,t,n){return Mt.worldMatrix.elements}},VIEWINVERSEINVERSETRANSPOSE:{get:function(e,t,n){return Pt.normalFromMat4(Mt.worldMatrix).elements}},PROJECTIONINVERSE:{get:function(e,t,n){return Nt.invert(Mt.projectionMatrix).elements}},MODELVIEWINVERSE:{get:function(e,t,n){return Nt.invert(Mt.getModelViewMatrix(e,Nt)).elements},isDependMesh:!0},MODELVIEWPROJECTIONINVERSE:{get:function(e,t,n){return Nt.invert(Mt.getModelProjectionMatrix(e,Nt)).elements},isDependMesh:!0},MODELINVERSETRANSPOSE:{get:function(e,t,n){return Pt.normalFromMat4(e.worldMatrix).elements},isDependMesh:!0},MODELVIEWINVERSETRANSPOSE:{get:function(e,t,n){return Pt.normalFromMat4(Mt.getModelViewMatrix(e,Nt)).elements},isDependMesh:!0},VIEWPORT:void 0,JOINTMATRIX:{get:function(e,t,n){if(e.isSkinedMesh)return e.getJointMat();_.a.warnOnce("semantic.JOINTMATRIX(".concat(e.id,")"),"Current mesh is not SkinedMesh!",e.id)},isDependMesh:!0,notSupportInstanced:!0},JOINTMATRIXTEXTURE:{get:function(e,t,n){if(e.isSkinedMesh)return e.updateJointMatTexture(),Ut.handlerTexture(e.jointMatTexture,n.textureIndex);_.a.warnOnce("semantic.JOINTMATRIXTEXTURE(".concat(e.id,")"),"Current mesh is not SkinedMesh!",e.id)},isDependMesh:!0,notSupportInstanced:!0},JOINTMATRIXTEXTURESIZE:{get:function(e,t,n){if(e.isSkinedMesh)return e.initJointMatTexture(),[e.jointMatTexture.width,e.jointMatTexture.height];_.a.warnOnce("semantic.JOINTMATRIXTEXTURESIZE(".concat(e.id,")"),"Current mesh is not SkinedMesh!",e.id)},isDependMesh:!0,notSupportInstanced:!0},NORMALMAPSCALE:{get:function(e,t,n){return t.normalMapScale}},OCCLUSIONSTRENGTH:{get:function(e,t,n){return t.occlusionStrength}},SHININESS:{get:function(e,t,n){return t.shininess}},SPECULARENVMATRIX:{get:function(e,t,n){return t.specularEnvMatrix&&t.specularEnvMap?t.specularEnvMatrix.elements:(Nt.identity(),Nt.elements)}},REFLECTIVITY:{get:function(e,t,n){return t.reflectivity}},REFRACTRATIO:{get:function(e,t,n){return t.refractRatio}},REFRACTIVITY:{get:function(e,t,n){return t.refractivity}},LOGDEPTH:{get:function(e,t,n){return 2/(Math.log(Mt.far+1)/Math.LN2)}},AMBIENTLIGHTSCOLOR:{get:function(e,t,n){return Rt.ambientInfo}},DIRECTIONALLIGHTSCOLOR:{get:function(e,t,n){return Rt.directionalInfo.colors}},DIRECTIONALLIGHTSINFO:{get:function(e,t,n){return Rt.directionalInfo.infos}},DIRECTIONALLIGHTSSHADOWMAP:{get:function(e,t,n){return Rt.directionalInfo.shadowMap.map((function(e,t){return Ut.handlerTexture(e,n.textureIndex+t)}))}},DIRECTIONALLIGHTSSHADOWMAPSIZE:{get:function(e,t,n){return Rt.directionalInfo.shadowMapSize}},DIRECTIONALLIGHTSSHADOWBIAS:{get:function(e,t,n){return Rt.directionalInfo.shadowBias}},DIRECTIONALLIGHTSPACEMATRIX:{get:function(e,t,n){return Rt.directionalInfo.lightSpaceMatrix}},POINTLIGHTSPOS:{get:function(e,t,n){return Rt.pointInfo.poses}},POINTLIGHTSCOLOR:{get:function(e,t,n){return Rt.pointInfo.colors}},POINTLIGHTSINFO:{get:function(e,t,n){return Rt.pointInfo.infos}},POINTLIGHTSRANGE:{get:function(e,t,n){return Rt.pointInfo.ranges}},POINTLIGHTSSHADOWMAP:{get:function(e,t,n){return Rt.pointInfo.shadowMap.map((function(e,t){return Ut.handlerTexture(e,n.textureIndex+t)}))}},POINTLIGHTSSHADOWBIAS:{get:function(e,t,n){return Rt.pointInfo.shadowBias}},POINTLIGHTSPACEMATRIX:{get:function(e,t,n){return Rt.pointInfo.lightSpaceMatrix}},POINTLIGHTCAMERA:{get:function(e,t,n){return Rt.pointInfo.cameras}},SPOTLIGHTSPOS:{get:function(e,t,n){return Rt.spotInfo.poses}},SPOTLIGHTSDIR:{get:function(e,t,n){return Rt.spotInfo.dirs}},SPOTLIGHTSCOLOR:{get:function(e,t,n){return Rt.spotInfo.colors}},SPOTLIGHTSCUTOFFS:{get:function(e,t,n){return Rt.spotInfo.cutoffs}},SPOTLIGHTSINFO:{get:function(e,t,n){return Rt.spotInfo.infos}},SPOTLIGHTSRANGE:{get:function(e,t,n){return Rt.spotInfo.ranges}},SPOTLIGHTSSHADOWMAP:{get:function(e,t,n){return Rt.spotInfo.shadowMap.map((function(e,t){return Ut.handlerTexture(e,n.textureIndex+t)}))}},SPOTLIGHTSSHADOWMAPSIZE:{get:function(e,t,n){return Rt.spotInfo.shadowMapSize}},SPOTLIGHTSSHADOWBIAS:{get:function(e,t,n){return Rt.spotInfo.shadowBias}},SPOTLIGHTSPACEMATRIX:{get:function(e,t,n){return Rt.spotInfo.lightSpaceMatrix}},AREALIGHTSCOLOR:{get:function(e,t,n){return Rt.areaInfo.colors}},AREALIGHTSPOS:{get:function(e,t,n){return Rt.areaInfo.poses}},AREALIGHTSWIDTH:{get:function(e,t,n){return Rt.areaInfo.width}},AREALIGHTSHEIGHT:{get:function(e,t,n){return Rt.areaInfo.height}},AREALIGHTSLTCTEXTURE1:{get:function(e,t,n){return Ut.handlerTexture(Rt.areaInfo.ltcTexture1,n.textureIndex)}},AREALIGHTSLTCTEXTURE2:{get:function(e,t,n){return Ut.handlerTexture(Rt.areaInfo.ltcTexture2,n.textureIndex)}},FOGCOLOR:{get:function(e,t,n){if(Ct)return Ct.color.elements}},FOGINFO:{get:function(e,t,n){if(Ct)return Ct.getInfo()}},POSITIONDECODEMAT:{get:function(e,t,n){return e.geometry.positionDecodeMat},isDependMesh:!0},NORMALDECODEMAT:{get:function(e,t,n){return e.geometry.normalDecodeMat},isDependMesh:!0},UVDECODEMAT:{get:function(e,t,n){return e.geometry.uvDecodeMat},isDependMesh:!0},UV1DECODEMAT:{get:function(e,t,n){return e.geometry.uv1DecodeMat},isDependMesh:!0},BASECOLOR:{get:function(e,t,n){return t.baseColor.elements}},EMISSIONFACTOR:{get:function(e,t,n){return t.emissionFactor.elements}},METALLIC:{get:function(e,t,n){return t.metallic}},ROUGHNESS:{get:function(e,t,n){return t.roughness}},DIFFUSEENVMAP:{get:function(e,t,n){return Ut.handlerTexture(t.diffuseEnvMap,n.textureIndex)}},DIFFUSEENVINTENSITY:{get:function(e,t,n){return t.diffuseEnvIntensity}},DIFFUSEENVSPHEREHARMONICS3:{get:function(e,t,n){var r=t.diffuseEnvSphereHarmonics3;if(r)return r.toArray()}},BRDFLUT:{get:function(e,t,n){return Ut.handlerTexture(t.brdfLUT,n.textureIndex)}},SPECULARENVMAP:{get:function(e,t,n){return Ut.handlerTexture(t.specularEnvMap,n.textureIndex)}},SPECULARENVINTENSITY:{get:function(e,t,n){return t.specularEnvIntensity}},SPECULARENVMAPMIPCOUNT:{get:function(e,t,n){var r=t.specularEnvMap;return r?r.mipmapCount:1}},GLOSSINESS:{get:function(e,t,n){return t.glossiness}},ALPHACUTOFF:{get:function(e,t,n){return t.alphaCutoff}},EXPOSURE:{get:function(e,t,n){return t.exposure}},GAMMAFACTOR:{get:function(e,t,n){return t.gammaFactor}},MORPHWEIGHTS:{isDependMesh:!0,notSupportInstanced:!0,get:function(e,t,n){var r=e.geometry;if(r.isMorphGeometry&&r.weights)return r.weights}},CLEARCOATFACTOR:{isDependMesh:!1,notSupportInstanced:!1,get:function(e,t,n){return t.clearcoatFactor}},CLEARCOATROUGHNESSFACTOR:{isDependMesh:!1,notSupportInstanced:!1,get:function(e,t,n){return t.clearcoatRoughnessFactor}}};[["POSITION","vertices"],["NORMAL","normals"],["TANGENT","tangents"]].forEach((function(e){for(var t=0;t<8;t++)Ut["MORPH"+e[0]+t]={get:function(e,t){return function(n,r,i){var a=n.geometry;if(a.isMorphGeometry&&a.targets&&a.targets[e]){var o=a._originalMorphIndices?a._originalMorphIndices[t]:t,s=a.targets[e][o],u="_target_".concat(e,"_").concat(t);return a[u]!==o&&s&&(s.isDirty=!0,a[u]=o),s}}}(e[1],t)}})),[["DIFFUSE","diffuse"],["SPECULAR","specular"],["EMISSION","emission"],["AMBIENT","ambient"]].forEach((function(e){var t=Ot(e,2),n=t[0],r=t[1];Ut[n]={get:function(e,t,n){return Ut.handlerColorOrTexture(t[r],n.textureIndex)}},Ut["".concat(n,"UV")]={get:function(e,t,n){return Ut.handlerUV(t[r])}}})),[["NORMALMAP","normalMap"],["PARALLAXMAP","parallaxMap"],["BASECOLORMAP","baseColorMap"],["METALLICMAP","metallicMap"],["ROUGHNESSMAP","roughnessMap"],["METALLICROUGHNESSMAP","metallicRoughnessMap"],["OCCLUSIONMAP","occlusionMap"],["SPECULARGLOSSINESSMAP","specularGlossinessMap"],["LIGHTMAP","lightMap"],["CLEARCOATMAP","clearcoatMap"],["CLEARCOATROUGHNESSMAP","clearcoatRoughnessMap"],["CLEARCOATNORMALMAP","clearcoatNormalMap"]].forEach((function(e){var t=Ot(e,2),n=t[0],r=t[1];Ut[n]={get:function(e,t,n){return Ut.handlerTexture(t[r],n.textureIndex)}},Ut["".concat(n,"UV")]={get:function(e,t,n){return Ut.handlerUV(t[r])}}})),[["TRANSPARENCY","transparency"]].forEach((function(e){var t=Ot(e,2),n=t[0],r=t[1];Ut[n]={get:function(e,t,n){var i=t[r];return i&&i.isTexture?Ut.handlerTexture(i,n.textureIndex):null!=i?i:1}},Ut["".concat(n,"UV")]={get:function(e,t,n){return Ut.handlerUV(t[r])}}}));var Vt=Ut,Bt=P.a.LEQUAL,Ht=P.a.BACK,zt=P.a.FRONT,Gt=P.a.FRONT_AND_BACK,kt=P.a.ZERO,jt=P.a.FUNC_ADD,Xt=P.a.ONE,Wt=P.a.SRC_ALPHA,qt=P.a.ONE_MINUS_SRC_ALPHA,Yt=P.a.CCW,Kt=P.a.ALWAYS,Qt=P.a.KEEP,Zt={isBlankInfo:!0,get:function(){}},Jt=a.a.create({isMaterial:!0,className:"Material",name:null,shaderCacheId:null,lightType:"NONE",wireframe:!1,frontFace:Yt,depthTest:!0,sampleAlphaToCoverage:!1,depthMask:!0,depthRange:[0,1],depthFunc:Bt,_cullFace:!0,normalMap:null,parallaxMap:null,normalMapScale:1,ignoreTranparent:!1,gammaCorrection:!1,usePhysicsLight:!1,isDiffuesEnvAndAmbientLightWorkTogether:!1,userData:null,renderOrder:0,_premultiplyAlpha:!0,premultiplyAlpha:{get:function(){return this._premultiplyAlpha},set:function(e){this._premultiplyAlpha=e,this.transparent&&this.setDefaultTransparentBlend()}},gammaOutput:{get:function(){return _.a.warnOnce("Matrial.gammaOutput","material.gammaOutput has deprecated. Use material.gammaCorrection instead."),this.gammaCorrection},set:function(e){_.a.warnOnce("Matrial.gammaOutput","material.gammaOutput has deprecated. Use material.gammaCorrection instead."),this.gammaCorrection=e}},gammaFactor:2.2,castShadows:!0,receiveShadows:!0,uvMatrix:null,uvMatrix1:null,cullFace:{get:function(){return this._cullFace},set:function(e){this._cullFace=e,e?this.cullFaceType=this._cullFaceType:this._side=Gt}},_cullFaceType:Ht,cullFaceType:{get:function(){return this._cullFaceType},set:function(e){this._cullFaceType=e,this._cullFace&&(e===Ht?this._side=zt:e===zt&&(this._side=Ht))}},_side:zt,side:{get:function(){return this._side},set:function(e){this._side!==e&&(this._side=e,e===Gt?this._cullFace=!1:(this._cullFace=!0,e===zt?this._cullFaceType=Ht:e===Ht&&(this._cullFaceType=zt)))}},blend:!1,blendEquation:jt,blendEquationAlpha:jt,blendSrc:Xt,blendDst:kt,blendSrcAlpha:Xt,blendDstAlpha:kt,stencilTest:!1,stencilMask:255,stencilFunc:Kt,stencilFuncRef:1,stencilFuncMask:255,stencilOpFail:Qt,stencilOpZFail:Qt,stencilOpZPass:Qt,isDirty:!1,transparency:1,_transparent:!1,transparent:{get:function(){return this._transparent},set:function(e){this._transparent!==e&&(this._transparent=e,e?this.setDefaultTransparentBlend():(this.blend=!1,this.depthMask=!0))}},setDefaultTransparentBlend:function(){this.blend=!0,this.depthMask=!1,this.premultiplyAlpha?(this.blendSrc=Xt,this.blendDst=qt,this.blendSrcAlpha=Xt,this.blendDstAlpha=qt):(this.blendSrc=Wt,this.blendDst=qt,this.blendSrcAlpha=Wt,this.blendDstAlpha=qt)},alphaCutoff:0,useHDR:!1,exposure:1,needBasicUnifroms:!0,needBasicAttributes:!0,constructor:function(e){this.id=d.a.generateUUID(this.className),this.uniforms={},this.attributes={},Object.assign(this,e),this.needBasicAttributes&&this.addBasicAttributes(),this.needBasicUnifroms&&this.addBasicUniforms()},addBasicAttributes:function(){var e=this.attributes;this._copyProps(e,{a_position:"POSITION",a_normal:"NORMAL",a_tangent:"TANGENT",a_texcoord0:"TEXCOORD_0",a_texcoord1:"TEXCOORD_1",a_color:"COLOR_0",a_skinIndices:"SKININDICES",a_skinWeights:"SKINWEIGHTS"}),["POSITION","NORMAL","TANGENT"].forEach((function(t){for(var n=t.slice(0,1)+t.slice(1).toLowerCase(),r=0;r<8;r++){var i="a_morph"+n+r;void 0===e[i]&&(e[i]="MORPH"+t+r)}}))},addBasicUniforms:function(){this._copyProps(this.uniforms,{u_modelMatrix:"MODEL",u_viewMatrix:"VIEW",u_projectionMatrix:"PROJECTION",u_modelViewMatrix:"MODELVIEW",u_modelViewProjectionMatrix:"MODELVIEWPROJECTION",u_viewInverseNormalMatrix:"VIEWINVERSEINVERSETRANSPOSE",u_normalMatrix:"MODELVIEWINVERSETRANSPOSE",u_normalWorldMatrix:"MODELINVERSETRANSPOSE",u_cameraPosition:"CAMERAPOSITION",u_rendererSize:"RENDERERSIZE",u_logDepth:"LOGDEPTH",u_ambientLightsColor:"AMBIENTLIGHTSCOLOR",u_directionalLightsColor:"DIRECTIONALLIGHTSCOLOR",u_directionalLightsInfo:"DIRECTIONALLIGHTSINFO",u_directionalLightsShadowMap:"DIRECTIONALLIGHTSSHADOWMAP",u_directionalLightsShadowMapSize:"DIRECTIONALLIGHTSSHADOWMAPSIZE",u_directionalLightsShadowBias:"DIRECTIONALLIGHTSSHADOWBIAS",u_directionalLightSpaceMatrix:"DIRECTIONALLIGHTSPACEMATRIX",u_pointLightsPos:"POINTLIGHTSPOS",u_pointLightsColor:"POINTLIGHTSCOLOR",u_pointLightsInfo:"POINTLIGHTSINFO",u_pointLightsRange:"POINTLIGHTSRANGE",u_pointLightsShadowBias:"POINTLIGHTSSHADOWBIAS",u_pointLightsShadowMap:"POINTLIGHTSSHADOWMAP",u_pointLightSpaceMatrix:"POINTLIGHTSPACEMATRIX",u_pointLightCamera:"POINTLIGHTCAMERA",u_spotLightsPos:"SPOTLIGHTSPOS",u_spotLightsDir:"SPOTLIGHTSDIR",u_spotLightsColor:"SPOTLIGHTSCOLOR",u_spotLightsCutoffs:"SPOTLIGHTSCUTOFFS",u_spotLightsInfo:"SPOTLIGHTSINFO",u_spotLightsRange:"SPOTLIGHTSRANGE",u_spotLightsShadowMap:"SPOTLIGHTSSHADOWMAP",u_spotLightsShadowMapSize:"SPOTLIGHTSSHADOWMAPSIZE",u_spotLightsShadowBias:"SPOTLIGHTSSHADOWBIAS",u_spotLightSpaceMatrix:"SPOTLIGHTSPACEMATRIX",u_areaLightsPos:"AREALIGHTSPOS",u_areaLightsColor:"AREALIGHTSCOLOR",u_areaLightsWidth:"AREALIGHTSWIDTH",u_areaLightsHeight:"AREALIGHTSHEIGHT",u_areaLightsLtcTexture1:"AREALIGHTSLTCTEXTURE1",u_areaLightsLtcTexture2:"AREALIGHTSLTCTEXTURE2",u_jointMat:"JOINTMATRIX",u_jointMatTexture:"JOINTMATRIXTEXTURE",u_jointMatTextureSize:"JOINTMATRIXTEXTURESIZE",u_positionDecodeMat:"POSITIONDECODEMAT",u_normalDecodeMat:"NORMALDECODEMAT",u_uvDecodeMat:"UVDECODEMAT",u_uv1DecodeMat:"UV1DECODEMAT",u_morphWeights:"MORPHWEIGHTS",u_normalMapScale:"NORMALMAPSCALE",u_emission:"EMISSION",u_transparency:"TRANSPARENCY",u_uvMatrix:"UVMATRIX_0",u_uvMatrix1:"UVMATRIX_1",u_fogColor:"FOGCOLOR",u_fogInfo:"FOGINFO",u_alphaCutoff:"ALPHACUTOFF",u_exposure:"EXPOSURE",u_gammaFactor:"GAMMAFACTOR"}),this.addTextureUniforms({u_normalMap:"NORMALMAP",u_parallaxMap:"PARALLAXMAP",u_emission:"EMISSION",u_transparency:"TRANSPARENCY"})},addTextureUniforms:function(e){var t={};for(var n in e){var r=e[n];t[n]=r,t["".concat(n,".texture")]=r,t["".concat(n,".uv")]="".concat(r,"UV")}this._copyProps(this.uniforms,t)},getRenderOption:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.lightType;t["LIGHT_TYPE_".concat(n)]=1,t.SIDE=this.side,"NONE"!==n&&(t.HAS_LIGHT=1),this.premultiplyAlpha&&(t.PREMULTIPLY_ALPHA=1);var r=this._textureOption.reset(t);return t.HAS_LIGHT&&(t.HAS_NORMAL=1,r.add(this.normalMap,"NORMAL_MAP",(function(){1!==e.normalMapScale&&(t.NORMAL_MAP_SCALE=1)}))),r.add(this.parallaxMap,"PARALLAX_MAP"),r.add(this.emission,"EMISSION_MAP"),r.add(this.transparency,"TRANSPARENCY_MAP"),this.ignoreTranparent&&(t.IGNORE_TRANSPARENT=1),this.alphaCutoff>0&&(t.ALPHA_CUTOFF=1),this.useHDR&&(t.USE_HDR=1),this.gammaCorrection&&(t.GAMMA_CORRECTION=1),this.receiveShadows&&(t.RECEIVE_SHADOWS=1),this.castShadows&&(t.CAST_SHADOWS=1),this.uvMatrix&&(t.UV_MATRIX=1),this.uvMatrix1&&(t.UV_MATRIX1=1),this.usePhysicsLight&&(t.USE_PHYSICS_LIGHT=1),this.isDiffuesEnvAndAmbientLightWorkTogether&&(t.IS_DIFFUESENV_AND_AMBIENTLIGHT_WORK_TOGETHER=1),r.update(),t},_textureOption:{uvTypes:null,option:null,reset:function(e){return this.option=e,this.uvTypes={},this},add:function(e,t,n){if(e&&e.isTexture){var r=this.uvTypes,i=this.option,a=e.uv||0;r[a]=1,i[t]=a,e.isCubeTexture&&(i["".concat(t,"_CUBE")]=1),n&&n(e)}return this},update:function(){var e=[0,1],t=this.uvTypes,n=this.option;for(var r in t)-1!==e.indexOf(Number(r))?n["HAS_TEXCOORD".concat(r)]=1:(_.a.warnOnce("Material._textureOption.update(".concat(r,")"),"uv_".concat(r," not support!")),n.HAS_TEXCOORD0=1);return this}},getInstancedUniforms:function(){var e=this._instancedUniforms;if(!this._instancedUniforms){var t=this.uniforms;for(var n in e=this._instancedUniforms=[],t){var r=this.getUniformInfo(n);r.isDependMesh&&!r.notSupportInstanced&&e.push({name:n,info:r})}}return e},getUniformData:function(e,t,n){return this.getUniformInfo(e).get(t,this,n)},getAttributeData:function(e,t,n){return this.getAttributeInfo(e).get(t,this,n)},getUniformInfo:function(e){return this.getInfo("uniforms",e)},getAttributeInfo:function(e){return this.getInfo("attributes",e)},getInfo:function(e,t){var n=this[e][t];return"string"==typeof n&&(n=Vt[n]),n&&n.get||(_.a.warnOnce("material.getInfo-"+t,"Material.getInfo: no this semantic:"+t),n=Zt),n},clone:function(){var e=new this.constructor;for(var t in this)"id"!==t&&(e[t]=this[t]);return e},destroyTextures:function(){this.getTextures().forEach((function(e){e.destroy()}))},getTextures:function(){var e=[];for(var t in this){var n=this[t];n&&n.isTexture&&e.push(n)}return e},_copyProps:function(e,t){for(var n in t)void 0===e[n]&&(e[n]=t[n])}}),$t=a.a.create({Extends:Jt,isBasicMaterial:!0,className:"BasicMaterial",lightType:"BLINN-PHONG",diffuse:null,ambient:null,specular:null,emission:null,specularEnvMap:null,specularEnvMatrix:null,reflectivity:0,refractRatio:0,refractivity:0,shininess:32,usedUniformVectors:11,constructor:function(e){this.diffuse=new g.a(.5,.5,.5),this.specular=new g.a(1,1,1),this.emission=new g.a(0,0,0),$t.superclass.constructor.call(this,e),Object.assign(this.uniforms,{u_diffuse:"DIFFUSE",u_specular:"SPECULAR",u_ambient:"AMBIENT",u_shininess:"SHININESS",u_reflectivity:"REFLECTIVITY",u_refractRatio:"REFRACTRATIO",u_refractivity:"REFRACTIVITY",u_specularEnvMap:"SPECULARENVMAP",u_specularEnvMatrix:"SPECULARENVMATRIX"}),this.addTextureUniforms({u_diffuse:"DIFFUSE",u_specular:"SPECULAR",u_ambient:"AMBIENT"})},getRenderOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$t.superclass.getRenderOption.call(this,e);var t=this._textureOption.reset(e),n=this.lightType;"PHONG"!==n&&"BLINN-PHONG"!==n||(e.HAS_SPECULAR=1);var r=this.diffuse;return r&&r.isTexture&&(r.isCubeTexture?e.DIFFUSE_CUBE_MAP=1:t.add(this.diffuse,"DIFFUSE_MAP")),e.HAS_LIGHT&&(t.add(this.specular,"SPECULAR_MAP"),t.add(this.ambient,"AMBIENT_MAP"),t.add(this.specularEnvMap,"SPECULAR_ENV_MAP")),t.update(),e}}),en=$t,tn=P.a.POSITION,nn=P.a.NORMAL,rn=P.a.DEPTH,an=P.a.DISTANCE,on=P.a.NONE,sn=a.a.create({Extends:en,isGeometryMaterial:!0,className:"GeometryMaterial",vertexType:tn,lightType:on,writeOriginData:!1,constructor:function(e){sn.superclass.constructor.call(this,e),Object.assign(this.uniforms,{u_cameraFar:"CAMERAFAR",u_cameraNear:"CAMERANEAR",u_cameraType:"CAMERATYPE"})},getRenderOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(sn.superclass.getRenderOption.call(this,e),e["VERTEX_TYPE_".concat(this.vertexType)]=1,this.vertexType){case tn:e.HAS_FRAG_POS=1;break;case nn:e.HAS_NORMAL=1;break;case rn:break;case an:e.HAS_FRAG_POS=1}return this.writeOriginData&&(e.WRITE_ORIGIN_DATA=1),e}}),un=sn,cn=a.a.create({Extends:b,isOrthographicCamera:!0,className:"OrthographicCamera",_left:-1,left:{get:function(){return this._left},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._left=e}},_right:1,right:{get:function(){return this._right},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._right=e}},_bottom:-1,bottom:{get:function(){return this._bottom},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._bottom=e}},_top:1,top:{get:function(){return this._top},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._top=e}},_near:.1,near:{get:function(){return this._near},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._near=e}},_far:1,far:{get:function(){return this._far},set:function(e){this._needUpdateProjectionMatrix=!0,this._isGeometryDirty=!0,this._far=e}},constructor:function(e){cn.superclass.constructor.call(this,e),this.updateProjectionMatrix()},updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},getGeometry:function(e){if(e||!this._geometry||this._isGeometryDirty){this._isGeometryDirty=!1;var t=new K,n=[this.left,this.bottom,-this.near],r=[this.right,this.bottom,-this.near],i=[this.right,this.top,-this.near],a=[this.left,this.top,-this.near],o=[this.left,this.bottom,-this.far],s=[this.right,this.bottom,-this.far],u=[this.right,this.top,-this.far],c=[this.left,this.top,-this.far];t.addRect(o,s,u,c),t.addRect(s,r,i,u),t.addRect(r,n,a,i),t.addRect(n,o,c,a),t.addRect(c,u,i,a),t.addRect(n,r,s,o),this._geometry=t}return this._geometry}}),ln=cn,fn=P.a.DEPTH,hn=P.a.BACK,dn=null,_n=new g.a(1,1,1),mn=new s.a,pn=function(e){return e.material.castShadows},vn=a.a.create({isLightShadow:!0,className:"LightShadow",light:null,renderer:null,framebuffer:null,camera:null,width:1024,height:1024,maxBias:.05,minBias:.005,cameraInfo:null,debug:!1,constructor:function(e){this.id=d.a.generateUUID(this.className),Object.assign(this,e)},createFramebuffer:function(){this.framebuffer||(this.framebuffer=new ct(this.renderer,{width:this.width,height:this.height}),this.debug&&this.showShadowMap())},updateLightCamera:function(e){this.light.isDirectionalLight?this.updateDirectionalLightCamera(e):this.light.isSpotLight&&this.updateSpotLightCamera(e)},updateDirectionalLightCamera:function(e){var t=this.light;if(this.camera.lookAt(t.direction),this.cameraInfo)this.updateCustumCamera(this.cameraInfo);else{var n=e.getGeometry();if(n){this.camera.updateViewMatrix(),mn.multiply(this.camera.viewMatrix,e.worldMatrix);var r=n.getBounds(mn);this.camera.near=-r.zMax,this.camera.far=-r.zMin,this.camera.left=r.xMin,this.camera.right=r.xMax,this.camera.bottom=r.yMin,this.camera.top=r.yMax}}this.camera.updateViewMatrix()},updateCustumCamera:function(e){for(var t in e)this.camera[t]=e[t]},updateSpotLightCamera:function(e){var t=this.light;this.camera.lookAt(t.direction),this.cameraInfo?this.updateCustumCamera(this.cameraInfo):(this.camera.fov=2*t.outerCutoff,this.camera.near=.01,this.camera.far=e.far,this.camera.aspect=1),this.camera.updateViewMatrix()},createCamera:function(e){this.camera||(this.light.isDirectionalLight?this.camera=new ln:this.light.isSpotLight&&(this.camera=new Z),this.camera.addTo(this.light)),(this.light.isDirty||this._cameraMatrixVersion!==e.matrixVersion)&&(this.updateLightCamera(e),this._cameraMatrixVersion=e.matrixVersion,this.light.isDirty=!1)},createShadowMap:function(e){this.createFramebuffer(),this.createCamera(e);var t=this.renderer,n=this.framebuffer,r=this.camera;dn||(dn=new un({vertexType:fn,side:hn,writeOriginData:!0})),n.bind(),t.state.viewport(0,0,this.width,this.height),t.clear(_n),r.updateViewProjectionMatrix(),Vt.setCamera(r),t.forceMaterial=dn,this.renderShadowScene(t),delete t.forceMaterial,n.unbind(),Vt.setCamera(e),t.viewport()},renderShadowScene:function(e){e.renderList.traverse((function(t){pn(t)&&e.renderMesh(t)}),(function(t){e.renderInstancedMeshes(t.filter((function(e){return pn(e)})))}))},showShadowMap:function(){var e=this;this.renderer.on("afterRender",(function(){e.framebuffer.render(0,.7,.3,.3)}))}}),gn=P.a.DISTANCE,yn=P.a.BACK,En=P.a.TEXTURE_CUBE_MAP,Tn=P.a.TEXTURE0,xn=P.a.TEXTURE_CUBE_MAP_POSITIVE_X,An=P.a.NEAREST,On=P.a.FRAMEBUFFER,bn=P.a.FRAMEBUFFER_COMPLETE,Mn=null,Sn=new g.a(0,0,0,0),Rn=new c.a,Ln=[[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,-1,0,0,-1,0,0,0,1,0,0,-1,0,-1,0,0,-1,0]],Cn=function(e,t){if(e.material.castShadows){if(!e.frustumTest)return!0;if(t.isMeshVisible(e))return!0}return!1},In=a.a.create({isLightShadow:!0,className:"CubeLightShadow",Extends:vn,light:null,renderer:null,framebuffer:null,camera:null,width:1024,height:1024,maxBias:.05,minBias:.005,debug:!1,constructor:function(e){In.superclass.constructor.call(this,e)},createFramebuffer:function(){this.framebuffer||(this.framebuffer=new ct(this.renderer,{target:En,width:1024,height:1024,createTexture:function(){var e=this.state.gl,t=new pt({image:[null,null,null,null,null,null],type:this.type,format:this.format,internalFormat:this.internalFormat,magFilter:An,minFilter:An,width:1024,height:1024});return e.checkFramebufferStatus(On)!==bn&&_.a.warn("Framebuffer is not complete",e.checkFramebufferStatus(On)),t},bindTexture:function(e){e=e||0;var t=this.state,n=t.gl,r=this.texture.getGLTexture(t);t.activeTexture(Tn+te.MAX_TEXTURE_INDEX),t.bindTexture(this.target,r),n.framebufferTexture2D(On,this.attachment,xn+e,r,0)}}))},updateLightCamera:function(e){this.camera.fov=90,this.camera.near=e.near,this.camera.far=e.far,this.camera.aspect=1,this.camera.updateViewMatrix()},createCamera:function(e){this.camera||(this.camera=new Z,this.updateLightCamera(e))},createShadowMap:function(e){this.createFramebuffer(),this.createCamera(e);var t=this.renderer,n=this.framebuffer,r=this.camera;Mn||(Mn=new un({vertexType:gn,side:yn,writeOriginData:!1})),n.bind(),t.state.viewport(0,0,n.width,n.height),this.light.worldMatrix.getTranslation(r.position);for(var i=0;i<6;i++)n.bindTexture(i),Rn.fromArray(Ln[0],3*i).add(r.position),r.up.fromArray(Ln[1],3*i),r.lookAt(Rn),r.updateViewProjectionMatrix(),t.clear(Sn),Vt.setCamera(r),t.forceMaterial=Mn,this.renderShadowScene(t);r.matrix.identity(),r.updateViewProjectionMatrix(),delete t.forceMaterial,n.unbind(),Vt.setCamera(e),t.viewport()},renderShadowScene:function(e){var t=e.renderList,n=this.camera;t.traverse((function(t){Cn(t,n)&&e.renderMesh(t)}),(function(t){var r=t.filter((function(e){return Cn(e,n)}));e.renderInstancedMeshes(r)}))}}),wn=In,Pn=a.a.create({Extends:T,isPointLight:!0,className:"PointLight",constructor:function(e){Pn.superclass.constructor.call(this,e)},createShadowMap:function(e,t){this.shadow&&(this.lightShadow||(this.lightShadow=new wn({light:this,renderer:e}),"minBias"in this.shadow&&(this.lightShadow.minBias=this.shadow.minBias),"maxBias"in this.shadow&&(this.lightShadow.maxBias=this.shadow.maxBias)),this.lightShadow.createShadowMap(t))}}),Nn=Pn,Fn=new s.a,Dn=new c.a,Un=a.a.create({Extends:T,isDirectionalLight:!0,className:"DirectionalLight",constructor:function(e){this.direction=new c.a(0,0,1),Un.superclass.constructor.call(this,e)},createShadowMap:function(e,t){this.shadow&&(this.lightShadow||(this.lightShadow=new vn({light:this,renderer:e,width:this.shadow.width||e.width,height:this.shadow.height||e.height,debug:this.shadow.debug,cameraInfo:this.shadow.cameraInfo}),"minBias"in this.shadow&&(this.lightShadow.minBias=this.shadow.minBias),"maxBias"in this.shadow&&(this.lightShadow.maxBias=this.shadow.maxBias)),this.lightShadow.createShadowMap(t))},getWorldDirection:function(){return Dn.copy(this.direction).transformDirection(this.worldMatrix).normalize(),Dn},getViewDirection:function(e){var t=e.getModelViewMatrix(this,Fn);return Dn.copy(this.direction).transformDirection(t).normalize(),Dn}}),Vn=Un,Bn=new s.a,Hn=new c.a,zn=a.a.create({Extends:T,isSpotLight:!0,className:"SpotLight",_cutoffCos:.9763,_cutoff:12.5,cutoff:{get:function(){return this._cutoff},set:function(e){this._cutoff=e,this._cutoffCos=Math.cos(d.a.degToRad(e))}},_outerCutoffCos:.9537,_outerCutoff:17.5,outerCutoff:{get:function(){return this._outerCutoff},set:function(e){this._outerCutoff=e,this._outerCutoffCos=Math.cos(d.a.degToRad(e))}},constructor:function(e){this.direction=new c.a(0,0,1),zn.superclass.constructor.call(this,e)},createShadowMap:function(e,t){this.shadow&&(this.lightShadow||(this.lightShadow=new vn({light:this,renderer:e,width:this.shadow.width||e.width,height:this.shadow.height||e.height,debug:this.shadow.debug,cameraInfo:this.shadow.cameraInfo}),"minBias"in this.shadow&&(this.lightShadow.minBias=this.shadow.minBias),"maxBias"in this.shadow&&(this.lightShadow.maxBias=this.shadow.maxBias)),this.lightShadow.createShadowMap(t))},getWorldDirection:function(){return Hn.copy(this.direction).transformDirection(this.worldMatrix).normalize(),Hn},getViewDirection:function(e){var t=e.getModelViewMatrix(this,Bn);return Hn.copy(this.direction).transformDirection(t).normalize(),Hn}}),Gn=zn,kn=a.a.create({Extends:Jt,isShaderMaterial:!0,className:"ShaderMaterial",vs:"",fs:"",useHeaderCache:!1,constructor:function(e){kn.superclass.constructor.call(this,e)},getRenderOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(kn.superclass.getRenderOption.call(this,e),this.getCustomRenderOption){var t=this.getCustomRenderOption({});for(var n in t)e["HILO_CUSTUM_OPTION_".concat(n)]=t[n]}return e},getCustomRenderOption:null}),jn=kn,Xn=n(15),Wn=n.n(Xn),qn=a.a.create({Extends:K,isMorphGeometry:!0,className:"MorphGeometry",isStatic:!1,weights:[],targets:null,constructor:function(e){qn.superclass.constructor.call(this,e),this.weights=this.weights||[]},update:function(e,t){this.weights=e,this._originalMorphIndices=t},clone:function(){return K.prototype.clone.call(this,{targets:this.targets,weights:this.weights})},getRenderOption:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return qn.superclass.getRenderOption.call(this,t),this.targets&&(this._maxMorphTargetCount||(this._maxMorphTargetCount=Math.floor(8/Object.keys(this.targets).length)),Object(i.each)(this.targets,(function(n,r){t.MORPH_TARGET_COUNT=Math.min(n.length,e._maxMorphTargetCount),"vertices"===r?t.MORPH_HAS_POSITION=1:"normals"===r?t.MORPH_HAS_NORMAL=1:"tangents"===r&&(t.MORPH_HAS_TANGENT=1)}))),t}}),Yn=qn,Kn={POSITION:{name:"vertices",decodeMatName:"positionDecodeMat"},TEXCOORD_0:{name:"uvs",decodeMatName:"uvDecodeMat"},TEXCOORD_1:{name:"uvs1",decodeMatName:"uv1DecodeMat"},NORMAL:{name:"normals",decodeMatName:"normalDecodeMat"},JOINT:{name:"skinIndices"},JOINTS_0:{name:"skinIndices"},WEIGHT:{name:"skinWeights"},WEIGHTS_0:{name:"skinWeights"},TANGENT:{name:"tangents"},COLOR_0:{name:"colors"}},Qn={Geometry:K,GeometryData:w},Zn={_decodeTotalTime:0,wasmURL:"",workerURL:"",useWASM:!0,useWebWorker:!0,useAuto:!0,init:function(){return Zn.useAuto?Wn.a.initWASM(Zn.wasmURL,Zn.memPages):Zn.useWebWorker?Wn.a.initWorker(Zn.workerURL):Zn.useWASM?Wn.a.initWASM(Zn.wasmURL,Zn.memPages):Promise.resolve()},parse:function(e,t,n,r){var i=Date.now(),a=t.bufferViews[e.bufferView],o=Zn.wasmURL,s=Zn.workerURL,u=Zn.useAuto,c=Zn.useWASM,l=Zn.useWebWorker,f=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);function h(t){Zn._decodeTotalTime+=Date.now()-i;var n=t.toHilo3dGeometry(Qn,r.primitive._geometry);return e.targets&&(n=function(e,t,n){if(!n.isMorphGeometry){var r=new Yn;for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&"id"!==i&&(r[i]=n[i]);r.targets={},n=r}for(var a=n.targets,o=0;o<e.targets.length;o++){var s=e.targets[o];for(var u in s)if(u in Kn){var c=s[u],l=Kn[u].name;a[l]||(a[l]=[]);var f=t.attrs[c];a[l].push(new w(f.data,f.itemCount))}}return e.weights?n.weights=e.weights:n.weights=new Float32Array(e.targets.length),n}(e,t,n)),n}return u?Wn.a.decompress(f,o,s).then(h):l?Wn.a.decompressWithWorker(f,c,o,s).then(h):h(c?Wn.a.decompressWithWASM(f,o):Wn.a.decompressWithJS(f))},freeMemory:function(){Wn.a.destory()}},Jn=Zn,$n=P.a.SAMPLER_2D,er={unQuantizeData:function(e,t){if(!t)return e;var n=Math.sqrt(t.length),r=n-1,i=new Float32Array(e.length),a=[];return e.traverse((function(e,o){e.toArray?e.toArray(a):a[0]=e;for(var s=o*r,u=0;u<n;u++){i[s+u]=0;for(var c=0;c<n;c++){var l=c===r?1:a[c];i[s+u]+=t[c*n+u]*l}}})),e.data=i,e.stride=0,e.offset=0,e},parse:function(e,t,n,r){var i=e.decodeMatrix;return r.isDecode?n=er.unQuantizeData(n,i):n.decodeMat=i,n}},tr={parseOnEnd:function(e,t,n){if(!n.anim||t.isMultiAnim)return n;for(var r in e){var i=e[r];n.anim.addClip(r,i[0],i[1])}return n}},nr=tr,rr={parse:function(e,t,n){return e.center=e.max.map((function(t,n){return(t+e.min[n])/2})),e.width=e.max[0]-e.min[0],e.height=e.max[1]-e.min[1],e.depth=e.max[2]-e.min[2],e.size=Math.sqrt(Math.pow(e.width,2)+Math.pow(e.height,2)+Math.pow(e.depth,2)),n.bounds=e,n}},ir={getUsedTextureNameMap:function(e,t){e.diffuseTexture&&(t[e.diffuseTexture.index]=!0),e.specularGlossinessTexture&&(t[e.specularGlossinessTexture.index]=!0)},parse:function(e,t,n){return e.diffuseFactor&&n.baseColor.fromArray(e.diffuseFactor),e.diffuseTexture&&(n.baseColorMap=t.getTexture(e.diffuseTexture)),e.specularFactor&&(n.specular.fromArray(e.specularFactor),n.specular.a=1),"glossinessFactor"in e&&(n.glossiness=e.glossinessFactor),e.specularGlossinessTexture&&(n.specularGlossinessMap=t.getTexture(e.specularGlossinessTexture)),n.isSpecularGlossiness=!0,n}},ar={getUsedTextureNameMap:function(e,t){e.clearcoatTexture&&(t[e.clearcoatTexture.index]=!0),e.clearcoatRoughnessTexture&&(t[e.clearcoatRoughnessTexture.index]=!0),e.clearcoatNormalTexture&&(t[e.clearcoatNormalTexture.index]=!0)},parse:function(e,t,n){return e.clearcoatFactor&&(n.clearcoatFactor=e.clearcoatFactor),e.clearcoatTexture&&(n.clearcoatMap=t.getTexture(e.clearcoatTexture)),e.clearcoatRoughnessFactor&&(n.clearcoatRoughnessFactor=e.clearcoatRoughnessFactor),e.clearcoatRoughnessTexture&&(n.clearcoatRoughnessMap=t.getTexture(e.clearcoatRoughnessTexture)),e.clearcoatNormalTexture&&(n.clearcoatNormalMap=t.getTexture(e.clearcoatNormalTexture)),n}},or={parse:function(e,t,n){if(!t.isUseExtension(t.json,"KHR_lights_punctual")||!t.json.extensions.KHR_lights_punctual.lights)return n;var r,i=t.json.extensions.KHR_lights_punctual.lights[e.light];if(!i)return n;var a=new g.a(1,1,1,1);i.color&&(a.r=i.color[0],a.g=i.color[1],a.b=i.color[2]);var o=void 0!==i.intensity?i.intensity:1,s=i.name||"",u=i.spot||{},c=void 0!==u.innerConeAngle?d.a.radToDeg(u.innerConeAngle):0,l=void 0!==u.outerConeAngle?d.a.radToDeg(u.outerConeAngle):45,f=i.range||0;switch(i.type){case"directional":(r=new Vn({color:a,amount:o,name:s,range:f})).direction.set(0,0,-1);break;case"point":r=new Nn({color:a,amount:o,name:s,range:f});break;case"spot":(r=new Gn({color:a,amount:o,name:s,range:f,cutoff:c,outerCutoff:l})).direction.set(0,0,-1);break;default:return n}return r&&(n.addChild(r),t.lights.push(r)),n}},sr={init:function(e,t){var n=[],r=(t.json.extensions||{}).KHR_techniques_webgl||{},a=r.programs||[],o=r.shaders||[],s=r.techniques||[];return t.shaders={},o.forEach((function(r,a){var o=i.getRelativePath(t.src,r.uri);t.preHandlerShaderURI&&(o=t.preHandlerShaderURI(o,a,r)),n.push(e.loadRes(o).then((function(e){t.shaders[a]=e})))})),t.programs={},a.forEach((function(e,n){t.programs[n]=Object.assign({},e)})),t.techniques={},s.forEach((function(e,n){var r=(t.techniques[n]=Object.assign({},e)).textureInfos={},i=e.uniforms||{};for(var a in i){var o=i[a];o.type===$n&&(r[a]=o.value||{})}})),Promise.all(n)},getUsedTextureNameMap:function(e,t,n){var r=n.techniques[e.technique],i=e.values||{};if(r){var a=r.textureInfos;for(var o in a){var s=void 0;i[o]&&void 0!==i[o].index?s=i[o].index:void 0!==a[o].index&&(s=a[o].index),void 0!==s&&(t[a[o].index]=!0)}}},parse:function(e,t,n){var r=t.textures||[],i=t.techniques[e.technique];if(!i)return n;var a=t.programs[i.program];if(!a)return n;var o=t.shaders[a.fragmentShader],s=t.shaders[a.vertexShader],u=i.uniforms||{},c=i.attributes||{},l=e.values||{},f={},h={},d=function(e){var n=u[e]||{},i=l[e];void 0===i&&(i=n.value);var a=void 0;if(void 0!==i)if(n.type===$n){var o=i.index||0;a={get:function(e,t,n){return Vt.handlerTexture(r[o],n.textureIndex)}}}else a={get:function(){return i}};else if(n.semantic&&Vt[n.semantic]){var s,c=Vt[n.semantic],f=n.node;a=void 0!==f?{get:function(e,n,r){return void 0===s&&(s=t.node.getChildByFn((function(e){return e.animationId===f}))||e),c.get(s,n,r)}}:n.semantic}else _.a.warn("KHR_techniques_webgl: no ".concat(e," value found!")),a=Vt.blankInfo;h[e]=a};for(var m in u)d(m);for(var p in c){var v=c[p]||{};v.semantic&&(f[p]=v.semantic)}return new jn({needBasicUnifroms:!1,needBasicAttributes:!1,vs:s,fs:o,attributes:f,uniforms:h})}},ur=new Float32Array(2),cr=a.a.create({isFog:!0,className:"Fog",mode:"LINEAR",start:5,end:10,density:.1,constructor:function(e){this.id=d.a.generateUUID(this.className),this.color=new g.a(1,1,1,1),Object.assign(this,e)},getInfo:function(){return"LINEAR"===this.mode?(ur[0]=this.start,ur[1]=this.end,ur):this.density},getRenderOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e["FOG_".concat(this.mode)]=1,e}}),lr=n(16),fr=new lr.a,hr=new s.a,dr=a.a.create({Extends:v,isMesh:!0,className:"Mesh",geometry:null,material:null,useInstanced:!1,frustumTest:!0,constructor:function(e){dr.superclass.constructor.call(this,e)},clone:function(e){var t=v.prototype.clone.call(this,e);return Object.assign(t,{geometry:this.geometry,material:this.material}),t},raycast:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.visible)return null;var n=this.geometry,r=this.material,i=this.worldMatrix;if(n&&r){hr.invert(i),fr.copy(e),fr.transformMat4(hr);var a=n.raycast(fr,r.side,t);if(a)return a.forEach((function(e){e.transformMat4(i)})),a}return null},getRenderOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.geometry.getRenderOption(e),e},isDestroyed:{get:function(){return this._isDestroyed}},destroy:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._isDestroyed)return this;this.removeFromParent();var n=e.resourceManager;return n.destroyMesh(this),this.material&&t&&this.material.destroyTextures(),this.off(),this.geometry=null,this.material=null,this._isDestroyed=!0,this}}),_r=dr,mr=new s.a,pr=new s.a,vr=a.a.create({Extends:_r,isSkinedMesh:!0,className:"SkinedMesh",useInstanced:!1,jointMatTexture:null,frustumTest:!1,skeleton:null,constructor:function(e){vr.superclass.constructor.call(this,e)},getJointMat:function(){var e=this;if(this.skeleton&&!(this.skeleton.jointCount<=0)){var t=this.skeleton.jointNodeList,n=this.skeleton.inverseBindMatrices,r=16*this.skeleton.jointCount;return this.jointMat&&this.jointMat.length===r||(this.jointMat=new Float32Array(r)),this.clonedFrom?pr.invert(this.clonedFrom.worldMatrix):pr.invert(this.worldMatrix),t.forEach((function(t,r){mr.copy(pr),mr.multiply(t.worldMatrix),mr.multiply(n[r]),mr.toArray(e.jointMat,16*r)})),this.jointMat}},resetJointNamesByNodeName:function(e){this.skeleton.resetJointNamesByNodeName(e)},resetSkinIndices:function(e){var t=this.skeleton;if(t){var n=this.geometry,r=n.skinIndices;if(r){this.material.isDirty=!0,n.isDirty=!0,r.isDirty=!0;var i=new S.a;r.traverse((function(n,a,o){n.elements.forEach((function(n,r){var a=t.jointNames[n],o=e.jointNames.indexOf(a);o>=0?i.elements[r]=o:_.a.warnOnce("SkinedMesh.resetSkinIndices","SkinedMesh.resetSkinIndices: no jointName found!",a)})),r.setByOffset(o,i)}))}}},initJointMatTexture:function(){if(!this.jointMatTexture){var e=this.getJointMat();this.jointMatTexture=new At({data:e})}return this.jointMatTexture},updateJointMatTexture:function(){if(this.jointMatTexture){var e=this.getJointMat();this.jointMatTexture.data.set(e,0),this.jointMatTexture.needUpdate=!0}else this.initJointMatTexture()},clone:function(e){var t=_r.prototype.clone.call(this,e);return Object.assign(t,{useInstanced:this.useInstanced,skeleton:this.skeleton.clone()}),t.clonedFrom=this,t},getRenderOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};vr.superclass.getRenderOption.call(this,e);var t=this.skeleton.jointCount;if(t&&(e.JOINT_COUNT=t,te.VERTEX_TEXTURE_FLOAT)){var n=(te.MAX_VERTEX_UNIFORM_VECTORS-22)/4;t>n&&(e.JOINT_MAT_MAP=1)}return e}}),gr=vr,yr=a.a.create({isSkeleton:!0,className:"Skeleton",userData:null,constructor:function(e){this.id=d.a.generateUUID(this.className),this.jointNodeList=[],this.jointNames=[],this.inverseBindMatrices=[],Object.assign(this,e)},jointCount:{get:function(){return this.jointNodeList.length}},_rootNode:null,rootNode:{get:function(){return this._rootNode},set:function(e){this._rootNode=e,e&&this._initJointNodeList()}},_initJointNodeList:function(){var e={};this.rootNode.traverse((function(t){e[t.jointName]=t})),this.jointNodeList=this.jointNames.map((function(t){return e[t]}))},resetJointNamesByNodeName:function(e){var t=this.jointNames;this.jointNodeList.forEach((function(n,r){var i=e.rootNode.getChildByName(n.name);i&&(t[r]=i.jointName)}))},clone:function(e){var t=new yr;return t.copy(this,e),t},copy:function(e,t){return this.inverseBindMatrices=e.inverseBindMatrices,this.jointNames=e.jointNames.slice(),void 0===t&&(t=e.rootNode),this.rootNode=t,this}}),Er=yr,Tr="1.15.18",xr=a.a.create({className:"RenderInfo",isRenderInfo:!0,constructor:function(){this.reset()},addFaceCount:function(e){this._currentFaceCount+=e},addDrawCount:function(e){this._currentDrawCount+=e},reset:function(){this.faceCount=Math.floor(this._currentFaceCount),this.drawCount=Math.floor(this._currentDrawCount),this._currentFaceCount=0,this._currentDrawCount=0}}),Ar=new c.a,Or=function(e,t){var n=e.material.renderOrder,r=t.material.renderOrder;if(n!==r)return n-r;var i=e.material._shaderNumId||0,a=t.material._shaderNumId||0;return i!==a?i-a:e._sortRenderZ-t._sortRenderZ},br=function(e,t){var n=e.material.renderOrder,r=t.material.renderOrder;return n!==r?n-r:t._sortRenderZ-e._sortRenderZ},Mr=a.a.create({className:"RenderList",isRenderList:!0,useInstanced:!1,constructor:function(){this.opaqueList=[],this.transparentList=[],this.instancedDict={}},reset:function(){this.opaqueList.length=0,this.transparentList.length=0,this.instancedDict={}},traverse:function(e,t){this.opaqueList.forEach((function(t){e(t)}));var n=this.instancedDict;for(var r in n){var i=n[r];i.length>2&&t?t(i):i.forEach((function(t){e(t)}))}this.transparentList.forEach((function(t){e(t)}))},sort:function(){this.transparentList.sort(br),this.opaqueList.sort(Or)},addMesh:function(e,t){var n=e.material,r=e.geometry;if(n&&r){if(e.frustumTest&&!t.isMeshVisible(e))return;if(this.useInstanced&&e.useInstanced){var i=this.instancedDict,a=n.id+"_"+r.id,o=i[a];i[a]||(o=i[a]=[]),o.push(e)}else e.worldMatrix.getTranslation(Ar),Ar.transformMat4(t.viewProjectionMatrix),e._sortRenderZ=Ar.z,n.transparent?this.transparentList.push(e):this.opaqueList.push(e)}else _.a.warnOnce("RenderList.addMesh(".concat(e.id,")"),"Mesh must have material and geometry",e)}}),Sr=a.a.create({className:"WebGLState",isWebGLState:!0,systemFramebuffer:null,constructor:function(e){this.gl=e,this.reset()},reset:function(){this._dict={},this.activeTextureIndex=null,this.textureUnitDict={},this.currentFramebuffer=null,this.preFramebuffer=null,this._pixelStorei={}},enable:function(e){!0!==this._dict[e]&&(this._dict[e]=!0,this.gl.enable(e))},disable:function(e){!1!==this._dict[e]&&(this._dict[e]=!1,this.gl.disable(e))},bindFramebuffer:function(e,t){this.currentFramebuffer!==t&&(this.preFramebuffer=this.currentFramebuffer,this.currentFramebuffer=t,this.gl.bindFramebuffer(e,t))},bindSystemFramebuffer:function(){this.bindFramebuffer(this.gl.FRAMEBUFFER,this.systemFramebuffer)},useProgram:function(e){this.set1("useProgram",e)},depthFunc:function(e){this.set1("depthFunc",e)},depthMask:function(e){this.set1("depthMask",e)},clear:function(e){this.gl.clear(e)},depthRange:function(e,t){this.set2("depthRange",e,t)},stencilFunc:function(e,t,n){this.set3("stencilFunc",e,t,n)},stencilMask:function(e){this.set1("stencilMask",e)},stencilOp:function(e,t,n){this.set3("stencilOp",e,t,n)},colorMask:function(e,t,n,r){this.set4("colorMask",e,t,n,r)},cullFace:function(e){this.set1("cullFace",e)},frontFace:function(e){this.set1("frontFace",e)},blendFuncSeparate:function(e,t,n,r){this.set4("blendFuncSeparate",e,t,n,r)},blendEquationSeparate:function(e,t){this.set2("blendEquationSeparate",e,t)},pixelStorei:function(e,t){this._pixelStorei[e]!==t&&(this._pixelStorei[e]=t,this.gl.pixelStorei(e,t))},viewport:function(e,t,n,r){this.set4("viewport",e,t,n,r)},activeTexture:function(e){this.activeTextureIndex!==e&&(this.activeTextureIndex=e,this.gl.activeTexture(e))},bindTexture:function(e,t){var n=this.getActiveTextureUnit();n[e]!==t&&(n[e]=t,this.gl.bindTexture(e,t))},getActiveTextureUnit:function(){var e=this.textureUnitDict[this.activeTextureIndex];return e||(e=this.textureUnitDict[this.activeTextureIndex]={}),e},set1:function(e,t){this._dict[e]!==t&&(this._dict[e]=t,this.gl[e](t))},set2:function(e,t,n){var r=this._dict[e];r||(r=this._dict[e]=[]),r[0]===t&&r[1]===n||(r[0]=t,r[1]=n,this.gl[e](t,n))},set3:function(e,t,n,r){var i=this._dict[e];i||(i=this._dict[e]=[]),i[0]===t&&i[1]===n&&i[2]===r||(i[0]=t,i[1]=n,i[2]=r,this.gl[e](t,n,r))},set4:function(e,t,n,r,i){var a=this._dict[e];a||(a=this._dict[e]=[]),a[0]===t&&a[1]===n&&a[2]===r&&a[3]===i||(a[0]=t,a[1]=n,a[2]=r,a[3]=i,this.gl[e](t,n,r,i))},get:function(e){return this._dict[e]}}),Rr=a.a.create({Mixes:o.a,className:"WebGLResourceManager",isWebGLResourceManager:!0,hasNeedDestroyResource:!1,constructor:function(e){this._needDestroyResources=[],Object.assign(this,e)},destroyMesh:function(e){var t=this;this.getMeshResources(e).forEach((function(e){t.destroyIfNoRef(e)})),e._vao=e._program=e._shader=null},getMeshResources:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e._shader&&t.push(e._shader),e._vao&&(t.push(e._vao),e._vao.getResources(t)),e._program&&t.push(e._program),t},destroyIfNoRef:function(e){var t=this._needDestroyResources;return e&&t.indexOf(e)<0&&t.push(e),this},getUsedResources:function(e){var t=this,n=[];return e&&e.traverse((function(e){e.isMesh&&!e.isDestroyed&&t.getMeshResources(e,n)})),n},destroyUnsuedResource:function(e){var t=this,n=this._needDestroyResources;if(0===n.length)return this;var r=this.getUsedResources(e);return n.forEach((function(e){r.indexOf(e)<0&&e&&e.destroy&&!e.alwaysUse&&(t.fire("destroyResource",e.id),e.destroy())})),this.reset(),this},reset:function(){return this._needDestroyResources.length=0,this}}),Lr=new s.a,Cr=new c.a,Ir=new Float32Array([0,0,0]),wr=a.a.create({isLightManager:!0,className:"LightManager",constructor:function(e){this.ambientLights=[],this.directionalLights=[],this.pointLights=[],this.spotLights=[],this.areaLights=[],this.lightInfo={AMBIENT_LIGHTS:0,POINT_LIGHTS:0,DIRECTIONAL_LIGHTS:0,SPOT_LIGHTS:0,AREA_LIGHTS:0,uid:0},Object.assign(this,e)},getRenderOption:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.each)(this.lightInfo,(function(n,r){if("uid"!==r&&n){t[r]=n;var i=e.getShadowMapCount(r);i&&(t[r+"_SMC"]=i)}})),t},addLight:function(e){var t=null;return e.enabled?(e.isAmbientLight?t=this.ambientLights:e.isDirectionalLight?t=this.directionalLights:e.isPointLight?t=this.pointLights:e.isSpotLight?t=this.spotLights:e.isAreaLight?t=this.areaLights:_.a.warnOnce("LightManager.addLight(".concat(e.id,")"),"Not support this light:",e),t&&(e.shadow?t.unshift(e):t.push(e)),this):this},getDirectionalInfo:function(e){var t=[],n=[],r=[],i=[],a=[],o=[];this.directionalLights.forEach((function(s,u){var c=3*u;s.getRealColor().toRGBArray(t,c),s.getViewDirection(e).toArray(n,c),s.shadow&&s.lightShadow&&(r.push(s.lightShadow.framebuffer.texture),i.push(s.lightShadow.width),i.push(s.lightShadow.height),o.push(s.lightShadow.minBias,s.lightShadow.maxBias),Lr.copy(e.worldMatrix),Lr.premultiply(s.lightShadow.camera.viewProjectionMatrix),Lr.toArray(a,16*u))}));var s={colors:new Float32Array(t),infos:new Float32Array(n)};return r.length&&(s.shadowMap=r,s.shadowMapSize=new Float32Array(i),s.shadowBias=new Float32Array(o),s.lightSpaceMatrix=new Float32Array(a)),s},getSpotInfo:function(e){var t=[],n=[],r=[],i=[],a=[],o=[],s=[],u=[],c=[],l=[];this.spotLights.forEach((function(f,h){var d=3*h;f.getRealColor().toRGBArray(t,d),f.toInfoArray(n,d),f.getViewDirection(e).toArray(i,d),l.push(f.range),a.push(f._cutoffCos,f._outerCutoffCos),e.getModelViewMatrix(f,Lr),Lr.getTranslation(Cr),Cr.toArray(r,d),f.shadow&&f.lightShadow&&(o.push(f.lightShadow.framebuffer.texture),s.push(f.lightShadow.width),s.push(f.lightShadow.height),c.push(f.lightShadow.minBias,f.lightShadow.maxBias),Lr.multiply(f.lightShadow.camera.viewProjectionMatrix,e.worldMatrix),Lr.toArray(u,16*h))}));var f={colors:new Float32Array(t),infos:new Float32Array(n),poses:new Float32Array(r),dirs:new Float32Array(i),cutoffs:new Float32Array(a),ranges:new Float32Array(l)};return o.length&&(f.shadowMap=o,f.shadowMapSize=new Float32Array(s),f.shadowBias=new Float32Array(c),f.lightSpaceMatrix=new Float32Array(u)),f},getPointInfo:function(e){var t=[],n=[],r=[],i=[],a=[],o=[],s=[],u=[];this.pointLights.forEach((function(c,l){var f=3*l;c.getRealColor().toRGBArray(t,f),c.toInfoArray(n,f),u.push(c.range),e.getModelViewMatrix(c,Lr),Lr.getTranslation(Cr),Cr.toArray(r,f),c.shadow&&c.lightShadow&&(i.push(c.lightShadow.framebuffer.texture),o.push(c.lightShadow.minBias,c.lightShadow.maxBias),e.worldMatrix.toArray(a,16*l),s[2*l]=c.lightShadow.camera.near,s[2*l+1]=c.lightShadow.camera.far)}));var c={colors:new Float32Array(t),infos:new Float32Array(n),poses:new Float32Array(r),ranges:new Float32Array(u)};return i.length&&(c.shadowMap=i,c.shadowBias=new Float32Array(o),c.lightSpaceMatrix=new Float32Array(a),c.cameras=new Float32Array(s)),c},getAreaInfo:function(e){var t,n,r=[],i=[],a=[],o=[];return this.areaLights.forEach((function(s,u){var c=3*u;s.getRealColor().toRGBArray(r,c),e.getModelViewMatrix(s,Lr),Lr.getTranslation(Cr),Cr.toArray(i,c);var l=Lr.getRotation();Lr.fromQuat(l),Cr.set(.5*s.width,0,0),Cr.transformMat4(Lr),Cr.toArray(a,c),Cr.set(0,.5*s.height,0),Cr.transformMat4(Lr),Cr.toArray(o,c),t=s.ltcTexture1,n=s.ltcTexture2})),{colors:new Float32Array(r),poses:new Float32Array(i),width:new Float32Array(a),height:new Float32Array(o),ltcTexture1:t,ltcTexture2:n}},getAmbientInfo:function(){return Ir[0]=Ir[1]=Ir[2]=0,this.ambientLights.forEach((function(e){var t=e.getRealColor();Ir[0]+=t.r,Ir[1]+=t.g,Ir[2]+=t.b})),Ir[0]=Math.min(1,Ir[0]),Ir[1]=Math.min(1,Ir[1]),Ir[2]=Math.min(1,Ir[2]),Ir},updateInfo:function(e){var t=this.lightInfo,n=this.ambientLights,r=this.directionalLights,i=this.pointLights,a=this.spotLights,o=this.areaLights;t.AMBIENT_LIGHTS=n.length,t.POINT_LIGHTS=i.length,t.DIRECTIONAL_LIGHTS=r.length,t.SPOT_LIGHTS=a.length,t.AREA_LIGHTS=o.length;var s=function(e){return!!e.shadow};t.SHADOW_POINT_LIGHTS=i.filter(s).length,t.SHADOW_SPOT_LIGHTS=a.filter(s).length,t.SHADOW_DIRECTIONAL_LIGHTS=r.filter(s).length,t.uid=[t.AMBIENT_LIGHTS,t.POINT_LIGHTS,t.SHADOW_POINT_LIGHTS,t.DIRECTIONAL_LIGHTS,t.SHADOW_DIRECTIONAL_LIGHTS,t.SPOT_LIGHTS,t.SHADOW_SPOT_LIGHTS,t.AREA_LIGHTS].join("_"),this.directionalInfo=this.getDirectionalInfo(e),this.pointInfo=this.getPointInfo(e),this.spotInfo=this.getSpotInfo(e),this.areaInfo=this.getAreaInfo(e),this.ambientInfo=this.getAmbientInfo()},getInfo:function(){return this.lightInfo},reset:function(){this.ambientLights.length=0,this.directionalLights.length=0,this.pointLights.length=0,this.spotLights.length=0,this.areaLights.length=0},getShadowMapCount:function(e){var t=[];"POINT_LIGHTS"===e?t=this.pointLights:"DIRECTIONAL_LIGHTS"===e?t=this.directionalLights:("SPOT_LIGHTS"===e||"AREA_LIGHTS"===e)&&(t=this.spotLights);var n=0;return t.forEach((function(e){n+=e.shadow?1:0})),n},createShadowMap:function(e,t){this.directionalLights.forEach((function(n){n.createShadowMap(e,t)})),this.spotLights.forEach((function(n){n.createShadowMap(e,t)})),this.pointLights.forEach((function(n){n.createShadowMap(e,t)})),this.areaLights.forEach((function(n){n.createShadowMap(e,t)}))}}),Pr=P.a.DEPTH_TEST,Nr=P.a.STENCIL_TEST,Fr=P.a.SAMPLE_ALPHA_TO_COVERAGE,Dr=P.a.CULL_FACE,Ur=P.a.FRONT_AND_BACK,Vr=P.a.BLEND,Br=P.a.LINES,Hr=P.a.STATIC_DRAW,zr=P.a.DYNAMIC_DRAW,Gr=a.a.create({Mixes:o.a,className:"WebGLRenderer",isWebGLRenderer:!0,gl:null,width:0,height:0,pixelRatio:1,domElement:null,useInstanced:!1,useVao:!0,alpha:!1,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,failIfMajorPerformanceCaveat:!1,gameMode:!1,useFramebuffer:!1,framebufferOption:{},useLogDepth:!1,vertexPrecision:"highp",fragmentPrecision:"highp",fog:null,offsetX:0,offsetY:0,isInitFailed:!1,_isInit:!1,_isContextLost:!1,constructor:function(e){this.clearColor=new g.a(1,1,1),Object.assign(this,e),this.renderInfo=new xr,this.renderList=new Mr,this.lightManager=new wr,this.resourceManager=new Rr},resize:function(e,t,n){if(n||this.width!==e||this.height!==t){var r=this.domElement;this.width=e,this.height=t,r.width=e,r.height=t,this.framebuffer&&this.framebuffer.resize(this.width,this.height,n),this.viewport()}},setOffset:function(e,t){this.offsetX===e&&this.offsetY===t||(this.offsetX=e,this.offsetY=t,this.viewport())},viewport:function(e,t,n,r){var i=this.state,a=this.gl;i&&(void 0===e?e=this.offsetX:this.offsetX=e,void 0===t?t=this.offsetY:this.offsetY=t,void 0===n&&(n=a.drawingBufferWidth),void 0===r&&(r=a.drawingBufferHeight),i.viewport(e,t,n,r))},isInit:{get:function(){return this._isInit&&!this.isInitFailed}},onInit:function(e){var t=this;this._isInit?e(this):this.on("init",(function(){e(t)}),!0)},initContext:function(){if(!this._isInit){this._isInit=!0;try{this._initContext(),this.fire("init")}catch(e){this.isInitFailed=!0,this.fire("initFailed",e)}}},_initContext:function(){var e=this,t={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat};!0===this.preserveDrawingBuffer&&(t.preserveDrawingBuffer=!0),!0===this.gameMode&&(t.gameMode=!0);var n=this.gl=this.domElement.getContext("webgl",t);n.viewport(0,0,this.width,this.height),Ee.init(n),ee.init(n),te.init(n),de.init(this),this.state=new Sr(n),ee.instanced||(this.useInstanced=!1),this.renderList.useInstanced=this.useInstanced,ee.vao||(this.useVao=!1),this.useFramebuffer&&(this.framebuffer=new ct(this,Object.assign({useVao:this.useVao,width:this.width,height:this.height},this.framebufferOption))),this.domElement.addEventListener("webglcontextlost",(function(t){e._onContextLost(t)}),!1),this.domElement.addEventListener("webglcontextrestored",(function(t){e._onContextRestore(t)}),!1)},_onContextLost:function(e){this.fire("webglContextLost");var t=this.gl;this._isContextLost=!0,e.preventDefault(),Ae.reset(t),de.reset(t),Ze.reset(t),Le.reset(t),Ue.reset(t),this.state.reset(t),this._lastMaterial=null,this._lastProgram=null},_onContextRestore:function(e){this.fire("webglContextRestored");var t=this.gl;this._isContextLost=!1,ee.reset(t),ct.reset(t)},setupDepthTest:function(e){var t=this.state;e.depthTest?(t.enable(Pr),t.depthFunc(e.depthFunc),t.depthMask(e.depthMask),t.depthRange(e.depthRange[0],e.depthRange[1])):t.disable(Pr)},setupSampleAlphaToCoverage:function(e){var t=this.state;e.sampleAlphaToCoverage?t.enable(Fr):t.disable(Fr)},setupCullFace:function(e){var t=this.state;e.cullFace&&e.cullFaceType!==Ur?(t.enable(Dr),t.cullFace(e.cullFaceType),t.frontFace(e.frontFace)):t.disable(Dr)},setupBlend:function(e){var t=this.state;e.blend?(t.enable(Vr),t.blendFuncSeparate(e.blendSrc,e.blendDst,e.blendSrcAlpha,e.blendDstAlpha),t.blendEquationSeparate(e.blendEquation,e.blendEquationAlpha)):t.disable(Vr)},setupStencil:function(e){if(this.stencil){var t=this.state;e.stencilTest?(t.enable(Nr),t.stencilMask(e.stencilMask),t.stencilFunc(e.stencilFunc,e.stencilFuncRef,e.stencilFuncMask),t.stencilOp(e.stencilOpFail,e.stencilOpZFail,e.stencilOpZPass)):t.disable(Nr)}},setupUniforms:function(e,t,n,r){var i=this.forceMaterial||t.material;for(var a in e.uniforms){var o=i.getUniformInfo(a),s=e.uniforms[a];if(!o.isBlankInfo&&(r||o.isDependMesh&&!n)){var u=o.get(t,i,s);null!=u&&(e[a]=u)}}},setupVao:function(e,t,n){var r=n.geometry,i=r.isStatic;if(e.isDirty||!i||r.isDirty){e.isDirty=!1;var a=this.forceMaterial||n.material,o=a.attributes,s=i?Hr:zr;for(var u in o){var c=t.attributes[u];if(c){var l=a.getAttributeData(u,n,c);null!=l&&e.addAttribute(l,c,s)}}r.indices&&e.addIndexBuffer(r.indices,s),r.isDirty=!1}r.vertexCount&&(e.vertexCount=r.vertexCount)},setupMaterial:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.forceMaterial||t.material;(i.isDirty||this._lastMaterial!==i)&&(this.setupDepthTest(i),this.setupSampleAlphaToCoverage(i),this.setupCullFace(i),this.setupBlend(i),this.setupStencil(i),r=!0),this.setupUniforms(e,t,n,r),i.isDirty=!1,this._lastMaterial=i},setupMesh:function(e,t){var n=this.gl,r=this.state,i=this.lightManager,a=e.geometry,o=this.forceMaterial||e.material,s=de.getShader(e,o,t,i,this.fog,this.useLogDepth),u=Ae.getProgram(s,r);u.useProgram(),this.setupMaterial(u,e,t,this._lastProgram!==u),this._lastProgram=u,e.material.wireframe&&a.mode!==Br&&a.convertToLinesMode();var c=a.id+u.id,l=Ue.getVao(n,c,{useInstanced:t,useVao:this.useVao,mode:a.mode});return this.setupVao(l,u,e),e._vao=l,e._shader=s,e._program=u,{vao:l,program:u,geometry:a}},addRenderInfo:function(e,t){var n=this.renderInfo;n.addFaceCount(e),n.addDrawCount(t)},render:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.initContext(),!this.isInitFailed&&!this._isContextLost){var r=this.renderList,i=this.renderInfo,a=this.lightManager,o=this.resourceManager,s=this.state;this.fog=e.fog,a.reset(),i.reset(),r.reset(),Vt.init(this,s,t,a,this.fog),e.updateMatrixWorld(),t.updateViewProjectionMatrix(),e.traverse((function(e){return e.visible?(e.isMesh?r.addMesh(e,t):e.isLight&&a.addLight(e),v.TRAVERSE_STOP_NONE):v.TRAVERSE_STOP_CHILDREN})),r.sort(),a.createShadowMap(this,t),a.updateInfo(t),n&&this.fire("beforeRender"),this.useFramebuffer&&this.framebuffer.bind(),this.clear(),n&&this.fire("beforeRenderScene"),this.renderScene(),this.useFramebuffer&&this.renderToScreen(this.framebuffer),n&&this.fire("afterRender"),o.destroyUnsuedResource(e)}},renderScene:function(){var e=this;this.renderList.traverse((function(t){e.renderMesh(t)}),(function(t){e.renderInstancedMeshes(t)})),this._gameModeSumbit()},_gameModeSumbit:function(){var e=this.gl;this.gameMode&&e&&e.submit&&e.submit()},clear:function(e){var t=this.gl,n=this.state;e=e||this.clearColor,this._lastMaterial=null,this._lastProgram=null,t.clearColor(e.r,e.g,e.b,e.a),n.depthMask(!0);var r=t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT;this.stencil&&(n.stencilMask(!0),r|=t.STENCIL_BUFFER_BIT),t.clear(r)},clearDepth:function(){var e=this.gl;this.state.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT)},clearStencil:function(){var e=this.gl;this.state.stencilMask(!0),e.clear(e.STENCIL_BUFFER_BIT)},renderToScreen:function(e){this.state.bindSystemFramebuffer(),e.render(0,0,1,1,this.clearColor)},renderMesh:function(e){var t=this.setupMesh(e,!1).vao;t.draw(),this.addRenderInfo(t.vertexCount/3,1)},renderInstancedMeshes:function(e){var t=e[0];if(t){var n=this.forceMaterial||t.material,r=this.setupMesh(t,!0),i=r.vao,a=r.program;n.getInstancedUniforms().forEach((function(t){var n=t.name,r=t.info,o=a.attributes[n];o&&i.addInstancedAttribute(o,e,(function(e){return r.get(e)}))})),i.drawInstance(e.length),this.addRenderInfo(i.vertexCount/3*e.length,1)}},renderMultipleMeshes:function(e){var t=this;e.forEach((function(e){t.renderMesh(e)}))},releaseGLResource:function(){var e=this.gl;e&&(Ae.reset(e),de.reset(e),Le.reset(e),Ue.reset(e),this.state.reset(e),Ze.reset(e),ct.destroy(e))}}),kr=function(){var e,t=navigator.userAgent,n=document,r=window,i=n.documentElement,a={iphone:/iphone/i.test(t),ipad:/ipad/i.test(t),ipod:/ipod/i.test(t),ios:/iphone|ipad|ipod/i.test(t),android:/android/i.test(t),webkit:/webkit/i.test(t),chrome:/chrome/i.test(t),safari:/safari/i.test(t),firefox:/firefox/i.test(t),ie:/msie/i.test(t),opera:/opera/i.test(t),supportTouch:"ontouchstart"in r,supportCanvas:!!n.createElement("canvas").getContext,supportStorage:void 0,supportOrientation:"orientation"in r||"orientation"in r.screen,supportDeviceMotion:"ondevicemotion"in r};try{localStorage.setItem("hilo","hilo"),localStorage.removeItem("hilo"),a.supportStorage=!0}catch(e){a.supportStorage=!1,_.a.warn("LocalStorage disabled")}e=a.webkit||a.firefox?"webkit":a.opera?"o":a.ie?"ms":"",a.jsVendor=e;var o=a.cssVendor="-"+e+"-",s=n.createElement("div"),u=s.style,c=void 0!==u[e+"Transform"],l=void 0!==u[e+"Perspective"];l&&(s.id="test3d",(u=n.createElement("style")).textContent="@media ("+o+"transform-3d){#test3d{height:3px}}",n.head.appendChild(u),i.appendChild(s),l=3===s.offsetHeight,n.head.removeChild(u),i.removeChild(s)),a.supportTransform=c,a.supportTransform3D=l;var f=a.supportTouch,h=f?"touchstart":"mousedown",d=f?"touchmove":"mousemove",m=f?"touchend":"mouseup";return a.POINTER_START=h,a.POINTER_MOVE=d,a.POINTER_END=m,a}(),jr=a.a.create({Extends:v,isStage:!0,className:"Stage",renderer:null,camera:null,pixelRatio:null,offsetX:0,offsetY:0,width:0,height:0,canvas:null,constructor:function(e){if(e.width||(e.width=window.innerWidth),e.height||(e.height=window.innerHeight),!e.pixelRatio){var t=window.devicePixelRatio||1;t=Math.min(t,1024/Math.max(e.width,e.height),2),t=Math.max(t,1),e.pixelRatio=t}jr.superclass.constructor.call(this,e),this.initRenderer(e),_.a.log("Hilo3d version: ".concat(Tr))},initRenderer:function(e){var t=this.canvas=this.createCanvas(e);this.renderer=new Gr(Object.assign(e,{domElement:t})),this.resize(this.width,this.height,this.pixelRatio,!0)},createCanvas:function(e){var t;return t=e.canvas?e.canvas:document.createElement("canvas"),e.container&&e.container.appendChild(t),t},resize:function(e,t,n,r){if(void 0===n&&(n=this.pixelRatio),r||this.width!==e||this.height!==t||this.pixelRatio!==n){this.width=e,this.height=t,this.pixelRatio=n,this.rendererWidth=e*n,this.rendererHeight=t*n;var i=this.canvas;this.renderer.resize(this.rendererWidth,this.rendererHeight,r),i.style.width=this.width+"px",i.style.height=this.height+"px",this.updateDomViewport()}return this},setOffset:function(e,t){if(this.offsetX!==e||this.offsetY!==t){this.offsetX=e,this.offsetY=t;var n=this.pixelRatio;this.renderer.setOffset(e*n,t*n)}return this},viewport:function(e,t,n,r){return this.resize(n,r,this.pixelRatio,!0),this.setOffset(e,t),this},tick:function(e){return this.traverseUpdate(e),this.camera&&this.renderer.render(this,this.camera,!0),this},enableDOMEvent:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.canvas,i=this._domListener||(this._domListener=function(e){t._onDOMEvent(e)});return(e="string"==typeof e?[e]:e).forEach((function(e){n?r.addEventListener(e,i,!1):r.removeEventListener(e,i)})),this},_onDOMEvent:function(e){var t=this.canvas,n=this._eventTarget,r=e.type,i=0===r.indexOf("touch"),a=e;if(i){var o=e.touches,s=e.changedTouches;o&&o.length?a=o[0]:s&&s.length&&(a=s[0])}var u=this.domViewport||this.updateDomViewport(),c=(a.pageX||a.clientX)-u.left,l=(a.pageY||a.clientY)-u.top;e.stageX=c,e.stageY=l,e.stopPropagation=function(){this._stopPropagationed=!0};var f=this.getMeshResultAtPoint(c,l,!0),h=f.mesh;e.hitPoint=f.point;var d="mouseout"===r;if(n&&(n!==h&&(!n.contains||!n.contains(h))||d)){var _=!1;if("touchmove"===r?_="touchout":"mousemove"!==r&&!d&&h||(_="mouseout"),_){var m=Object.assign({},e);m.type=_,m.eventTarget=n,n._fireMouseEvent(m)}e.lastEventTarget=n,this._eventTarget=null}if(h&&h.pointerEnabled&&"mouseout"!==r&&(e.eventTarget=this._eventTarget=h,h._fireMouseEvent(e)),!i){var p=h&&h.pointerEnabled&&h.useHandCursor?"pointer":"";t.style.cursor=p}kr.android&&"touchmove"===r&&e.preventDefault()},updateDomViewport:function(){var e=this.canvas,t=null;return e.parentNode&&(t=this.domViewport=Object(i.getElementRect)(e)),t},getMeshResultAtPoint:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.camera,i=this._ray;i||(i=this._ray=new lr.a),i.fromCamera(r,e,t,this.width,this.height);var a=this.raycast(i,!0,n);if(a)return a[0];this._stageResultAtPoint||(this._stageResultAtPoint={mesh:this,point:new c.a});var o=this._stageResultAtPoint.point;return o.copy(r.unprojectVector(o.set(e,t,0),this.width,this.height)),this._stageResultAtPoint},releaseGLResource:function(){return this.renderer.releaseGLResource(),this},destroy:function(){return jr.superclass.destroy.call(this,this.renderer),this.releaseGLResource(),this.traverse((function(e){e.off(),e.parent=null})),this.children.length=0,this.renderer.off(),this}}),Xr=jr,Wr=n(58),qr=n.n(Wr),Yr=n(102),Kr=n.n(Yr);qr.a.Ease=Kr.a;var Qr=qr.a,Zr=a.a.create({Extends:K,isBoxGeometry:!0,className:"BoxGeometry",width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1,constructor:function(e){Zr.superclass.constructor.call(this,e),this.isSegments()?this.buildWithSegments():this.build()},buildWithSegments:function(){var e=this.width,t=this.height,n=this.depth,r=this.widthSegments,i=this.heightSegments,a=this.depthSegments,o=i*a*6,s=r*a*6,u=r*i*6,c=2*((i+1)*(a+1)+(r+1)*(a+1)+(r+1)*(i+1)),l=new Float32Array(3*c),f=new Float32Array(3*c),h=new Float32Array(2*c),d=new Uint16Array(2*(o+s+u));this.vertices=new w(l,3),this.normals=new w(f,3),this.uvs=new w(h,2),this.indices=new w(d,1);var _=[0,0];this.buildPlane(_,2,1,0,-1,1,n,t,e/2,a,i),this.buildPlane(_,2,1,0,1,1,n,t,-e/2,a,i),this.buildPlane(_,0,2,1,1,-1,e,n,t/2,r,a),this.buildPlane(_,0,2,1,1,1,e,n,-t/2,r,a),this.buildPlane(_,0,1,2,1,1,e,t,n/2,r,i),this.buildPlane(_,0,1,2,-1,1,e,t,-n/2,r,i)},buildPlane:function(e,t,n,r,i,a,o,s,u,c,l){for(var f=o/c,h=s/l,d=o/2,_=s/2,m=e[0],p=e[1],v=this.vertices.data,g=this.normals.data,y=this.uvs.data,E=this.indices.data,T=0;T<=l;T++)for(var x=(T*h-_)*a,A=0;A<=c;A++){if(v[3*m+t]=(A*f-d)*i,v[3*m+n]=x,v[3*m+r]=u,g[3*m+t]=0,g[3*m+n]=0,g[3*m+r]=u<0?-1:1,y[2*m]=A/c,y[2*m+1]=1-T/l,A<c&&T<l){var O=e[0]+(T+1)*(c+1)+A;E[p++]=O,E[p++]=m,E[p++]=O+1,E[p++]=O+1,E[p++]=m,E[p++]=m+1}m++}e[0]=m,e[1]=p},build:function(){var e=new Float32Array(72),t=new Uint16Array(36);this.vertices=new w(e,3),this.indices=new w(t,1);var n=this.width/2,r=this.height/2,i=this.depth/2,a=[-n,-r,-i],o=[n,-r,-i],s=[n,r,-i],u=[-n,r,-i],c=[-n,-r,i],l=[n,-r,i],f=[n,r,i],h=[-n,r,i];this.addRect(l,o,s,f),this.addRect(a,c,h,u),this.addRect(h,f,s,u),this.addRect(a,o,l,c),this.addRect(c,l,f,h),this.addRect(o,a,u,s)},isSegments:function(){return this.widthSegments>1||this.heightSegments>1||this.depthSegments>1},setFrontUV:function(e){this.isSegments()?_.a.warn("segmented BoxGeometry dont support setFrontUV!"):this.setVertexUV(32,e)},setRightUV:function(e){this.isSegments()?_.a.warn("segmented BoxGeometry dont support setRightUV!"):this.setVertexUV(0,e)},setBackUV:function(e){this.isSegments()?_.a.warn("segmented BoxGeometry dont support setBackUV!"):this.setVertexUV(40,e)},setLeftUV:function(e){this.isSegments()?_.a.warn("segmented BoxGeometry dont support setLeftUV!"):this.setVertexUV(8,e)},setTopUV:function(e){this.isSegments()?_.a.warn("segmented BoxGeometry dont support setTopUV!"):this.setVertexUV(16,e)},setBottomUV:function(e){this.isSegments()?_.a.warn("segmented BoxGeometry dont support setBottomUV!"):this.setVertexUV(24,e)},setAllRectUV:function(e){if(this.isSegments())return _.a.warn("segmented BoxGeometry dont support setAllRectUV!"),null;for(var t=0;t<6;t++)this.setVertexUV(8*t,e);return this},_raycast:function(e,t){return Zr.superclass._raycast.call(this,e,t)}}),Jr=Zr,$r=P.a.FRONT,ei=P.a.BACK,ti=[0,0,1],ni=a.a.create({Extends:K,isPlaneGeometry:!0,className:"PlaneGeometry",width:1,height:1,widthSegments:1,heightSegments:1,constructor:function(e){ni.superclass.constructor.call(this,e),this.build()},build:function(){for(var e=this.widthSegments,t=this.heightSegments,n=(e+1)*(t+1),r=this.width/e,i=this.height/t,a=new Float32Array(3*n),o=new Float32Array(3*n),s=new Float32Array(2*n),u=new Uint16Array(e*t*6),c=0,l=0;l<=t;l++)for(var f=0;f<=e;f++){var h=l*(e+1)+f;if(a[3*h]=f*r-this.width/2,a[3*h+1]=this.height/2-l*i,o[3*h]=0,o[3*h+1]=0,o[3*h+2]=1,s[2*h]=f/e,s[2*h+1]=1-l/t,l<t&&f<e){var d=(l+1)*(e+1)+f;u[c++]=h,u[c++]=d,u[c++]=d+1,u[c++]=h,u[c++]=d+1,u[c++]=h+1}}this.vertices=new w(a,3),this.indices=new w(u,1),this.normals=new w(o,3),this.uvs=new w(s,2)},_raycast:function(e,t){var n=e.origin.z,r=e.direction.z;if(t===$r&&(r>0||n<0))return null;if(t===ei&&(r<0||n>0))return null;var i=e.intersectsPlane(ti,0);if(i){var a=i.x,o=i.y,s=.5*this.width,u=.5*this.height;if(a>=-s&&a<=s&&o>=-u&&o<=u)return[i]}return null}}),ri=ni,ii=a.a.create({Extends:K,isSphereGeometry:!0,className:"SphereGeometry",radius:1,heightSegments:16,widthSegments:32,constructor:function(e){ii.superclass.constructor.call(this,e),this.build()},build:function(){for(var e=this.radius,t=this.heightSegments,n=this.widthSegments,r=(n+1)*(t+1),i=n*t,a=new Float32Array(3*r),o=new Float32Array(4*r),s=new Float32Array(2*r),u=new Uint16Array(6*i),c=0,l=0,f=0,h=0,d=0,_=2*Math.PI,m=Math.PI,p=0;p<=t;p++)for(var v=p/t,g=m*v,y=Math.cos(g)*e,E=Math.sin(g)*e,T=0;T<=n;T++){var x=T/n,A=_*x,O=Math.cos(A),b=Math.sin(A),M=O*E,S=b*E,R=b,L=-O;if(o[f++]=R,o[f++]=0,o[f++]=L,o[f++]=1,a[l++]=M,a[l++]=y,a[l++]=S,s[h++]=x,s[h++]=v,p>0&&T>0){var C=d,I=C-1,P=I-n-1,N=C-n-1;u[c++]=P,u[c++]=N,u[c++]=C,u[c++]=P,u[c++]=C,u[c++]=I}d++}this.vertices=new w(a,3),this.indices=new w(u,1),this.uvs=new w(s,2),this.tangents=new w(o,4),this.normals=new w(new Float32Array(a),3)},_raycast:function(e,t){return ii.superclass._raycast.call(this,e,t)}}),ai=ii,oi=[de,Ae,Le,Ue,Ze,ct],si=function(){var e="";return oi.forEach((function(t){e+="".concat(t.prototype.className,":").concat(Object.keys(t.cache._cache).length," ")})),_.a.log(e),e},ui=a.a.create({Mixes:o.a,isLoadCache:!0,className:"LoadCache",Statics:{PENDING:1,LOADED:2,FAILED:3},enabled:!0,constructor:function(){this._files={}},update:function(e,t,n){if(this.enabled){var r={key:e,state:t,data:n};this._files[e]=r,this.fire("update",r),this.fire("update:".concat(r.key),r)}},get:function(e){return this.enabled?this._files[e]:null},getLoaded:function(e){var t=this.get(e);return t&&t.state===ui.LOADED?t.data:null},remove:function(e){delete this._files[e]},clear:function(){this._files={}},wait:function(e){var t=this;return e?e.state===ui.LOADED?Promise.resolve(e.data):e.state===ui.FAILED?Promise.reject():new Promise((function(n,r){t.on("update:".concat(e.key),(function(e){var t=e.detail;t.state===ui.LOADED?n(t.data):t.state===ui.FAILED&&r(t.data)}),!0)})):Promise.reject()}}),ci=ui,li=new ci,fi=a.a.create({Mixes:o.a,isBasicLoader:!0,className:"BasicLoader",Statics:{_cache:li,enalbeCache:function(){li.enabled=!0},disableCache:function(){li.enabled=!1},deleteCache:function(e){li.remove(e)},clearCache:function(){li.clear()},cache:{get:function(){return li},set:function(){_.a.warn("BasicLoader.cache is readonly!")}},TYPE_IMAGE:"img",TYPE_JSON:"json",TYPE_BUFFER:"buffer",TYPE_TEXT:"text"},load:function(e){var t=e.src,n=e.type;if(!n){var r=Object(i.getExtension)(t);/^(?:png|jpe?g|gif|webp|bmp)$/i.test(r)&&(n="img"),n||(n=e.defaultType)}return n===fi.TYPE_IMAGE?this.loadImg(t,e.crossOrigin):this.loadRes(t,n)},isCrossOrigin:function(e){var t=window.location,n=document.createElement("a");return n.href=e,n.hostname!==t.hostname||n.port!==t.port||n.protocol!==t.protocol},isBase64:function(e){return/^data:(.+?);base64,/.test(e)},Uint8ArrayFrom:function(e,t){if(Uint8Array.from)return Uint8Array.from(e,t);for(var n=e.length,r=new Uint8Array(n),i=0;i<n;i++)r[i]=t(e[i]);return r},loadImg:function(e,t){var n=this,r=li.get(e);return r?li.wait(r):new Promise((function(r,i){var a=new Image;li.update(e,ci.PENDING),a.onload=function(){a.onerror=null,a.onabort=null,a.onload=null,li.update(e,ci.LOADED,a),r(a)},a.onerror=function(){a.onerror=null,a.onabort=null,a.onload=null;var t=new Error("Image load failed for ".concat(e.slice(0,100)));li.update(e,ci.FAILED,t),i(t)},a.onabort=a.onerror,(t||n.isCrossOrigin(e))&&(n.isBase64(e)||(a.crossOrigin="anonymous")),a.src=e}))},loadRes:function(e,t){var n=this;if(this.isBase64(e)){var r=RegExp.$1,i=e.slice(13+r.length),a=atob(i);return t===fi.TYPE_JSON?a=JSON.parse(a):t===fi.TYPE_BUFFER&&(a=this.Uint8ArrayFrom(a,(function(e){return e.charCodeAt(0)})).buffer),Promise.resolve(a)}var o=li.get(e);return o?li.wait(o):(li.update(e,ci.PENDING),this.fire("beforeload"),this.request({url:e,type:t}).then((function(t){return n.fire("loaded"),li.update(e,ci.LOADED,t),t}),(function(t){throw n.fire("failed",t),li.update(e,ci.FAILED),new Error("Resource load failed for ".concat(e,", ").concat(t))})))},request:function(e){var t=this;return new Promise((function(n,r){var a=new XMLHttpRequest;a.onload=function(){if(a.status<200||a.status>=300)r(new TypeError("Network request failed for ".concat(a.status)));else{var t="response"in a?a.response:a.responseText;if(e.type===fi.TYPE_JSON)try{t=JSON.parse(t)}catch(e){return void r(new TypeError("JSON.parse error"+e))}n(t)}},a.onprogress=function(n){t.fire("progress",{url:e.url,loaded:n.loaded,total:n.total})},a.onerror=function(){r(new TypeError("Network request failed"))},a.ontimeout=function(){r(new TypeError("Network request timed out"))},a.open(e.method||"GET",e.url,!0),"include"===e.credentials&&(a.withCredentials=!0),e.type===fi.TYPE_BUFFER&&(a.responseType="arraybuffer"),Object(i.each)(e.headers,(function(e,t){a.setRequestHeader(t,e)})),a.send(e.body||null)}))}}),hi=fi,di=a.a.create({isLoader:!0,className:"Loader",maxConnections:2,Statics:{_loaderClassMap:{},_loaders:{},addLoader:function(e,t){di._loaderClassMap[e]=t},getLoader:function(e){if(!di._loaders[e]){var t=di._loaderClassMap[e]?di._loaderClassMap[e]:hi;di._loaders[e]=new t}return di._loaders[e]}},preHandlerUrl:null,load:function(e){var t=this;if(e instanceof Array)return Promise.all(e.map((function(e){return t.load(e)})));var n=e.type||Object(i.getExtension)(e.src),r=di.getLoader(n),a=e;return this.preHandlerUrl&&((a=Object.assign({},e)).src=this.preHandlerUrl(e.src)),r.load(a)}}),_i=di,mi=a.a.create({Extends:hi,isCubeTextureLoader:!0,className:"CubeTextureLoader",constructor:function(){mi.superclass.constructor.call(this)},load:function(e){var t,n=this;return t=e.images&&Array.isArray(e.images)?e.images:[e.right,e.left,e.top,e.bottom,e.front,e.back],Promise.all(t.map((function(t){return n.loadImg(t,e.crossOrigin)}))).then((function(t){var n=Object.assign({},e);return delete n.images,delete n.type,delete n.right,delete n.left,delete n.top,delete n.bottom,delete n.front,delete n.back,n.image=t,new pt(n)})).catch((function(e){throw _.a.error("load CubeTexture failed",e.message,e.stack),e}))}});_i.addLoader("CubeTexture",mi);var pi=mi,vi=a.a.create({Extends:Jt,isPBRMaterial:!0,className:"PBRMaterial",lightType:"PBR",gammaCorrection:!0,usePhysicsLight:!0,baseColor:null,baseColorMap:null,metallic:1,metallicMap:null,roughness:1,roughnessMap:null,metallicRoughnessMap:null,occlusionMap:null,occlusionStrength:1,isOcclusionInMetallicRoughnessMap:!1,diffuseEnvMap:null,diffuseEnvSphereHarmonics3:null,diffuseEnvIntensity:1,brdfLUT:null,specularEnvIntensity:1,specularEnvMap:null,isSpecularEnvMapIncludeMipmaps:!1,emission:null,emissionFactor:null,isSpecularGlossiness:!1,specular:null,glossiness:1,specularGlossinessMap:null,clearcoatFactor:0,clearcoatMap:null,clearcoatRoughnessFactor:0,clearcoatRoughnessMap:null,clearcoatNormalMap:null,usedUniformVectors:11,constructor:function(e){this.baseColor=new g.a(1,1,1),this.specular=new g.a(1,1,1),this.emissionFactor=new g.a(0,0,0),vi.superclass.constructor.call(this,e),Object.assign(this.uniforms,{u_baseColor:"BASECOLOR",u_metallic:"METALLIC",u_roughness:"ROUGHNESS",u_specular:"SPECULAR",u_emissionFactor:"EMISSIONFACTOR",u_glossiness:"GLOSSINESS",u_brdfLUT:"BRDFLUT",u_diffuseEnvMap:"DIFFUSEENVMAP",u_diffuseEnvIntensity:"DIFFUSEENVINTENSITY",u_occlusionStrength:"OCCLUSIONSTRENGTH",u_specularEnvMap:"SPECULARENVMAP",u_specularEnvIntensity:"SPECULARENVINTENSITY",u_specularEnvMapMipCount:"SPECULARENVMAPMIPCOUNT",u_diffuseEnvSphereHarmonics3:"DIFFUSEENVSPHEREHARMONICS3",u_clearcoatFactor:"CLEARCOATFACTOR",u_clearcoatRoughnessFactor:"CLEARCOATROUGHNESSFACTOR"}),this.addTextureUniforms({u_baseColorMap:"BASECOLORMAP",u_metallicMap:"METALLICMAP",u_roughnessMap:"ROUGHNESSMAP",u_metallicRoughnessMap:"METALLICROUGHNESSMAP",u_occlusionMap:"OCCLUSIONMAP",u_specularGlossinessMap:"SPECULARGLOSSINESSMAP",u_lightMap:"LIGHTMAP",u_clearcoatMap:"CLEARCOATMAP",u_clearcoatRoughnessMap:"CLEARCOATROUGHNESSMAP",u_clearcoatNormalMap:"CLEARCOATNORMALMAP"})},getRenderOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};vi.superclass.getRenderOption.call(this,e);var t=this._textureOption.reset(e);return t.add(this.baseColorMap,"BASE_COLOR_MAP"),t.add(this.metallicMap,"METALLIC_MAP"),t.add(this.roughnessMap,"ROUGHNESS_MAP"),t.add(this.metallicRoughnessMap,"METALLIC_ROUGHNESS_MAP"),t.add(this.diffuseEnvMap,"DIFFUSE_ENV_MAP"),t.add(this.occlusionMap,"OCCLUSION_MAP"),t.add(this.lightMap,"LIGHT_MAP"),this.brdfLUT&&(t.add(this.specularEnvMap,"SPECULAR_ENV_MAP"),te.SHADER_TEXTURE_LOD&&this.specularEnvMap&&(e.USE_SHADER_TEXTURE_LOD=1)),this.isSpecularGlossiness&&(e.PBR_SPECULAR_GLOSSINESS=1,t.add(this.specularGlossinessMap,"SPECULAR_GLOSSINESS_MAP")),this.isOcclusionInMetallicRoughnessMap&&(e.IS_OCCLUSION_MAP_IN_METALLIC_ROUGHNESS_MAP=1),1!==this.occlusionStrength&&(e.OCCLUSION_STRENGTH=1),this.diffuseEnvSphereHarmonics3&&(e.HAS_NORMAL=1,e.DIFFUSE_ENV_SPHERE_HARMONICS3=1),(this.specularEnvMap||this.diffuseEnvSphereHarmonics3||this.specularEnvMap)&&(e.NEED_WORLD_NORMAL=1),this.specularEnvMap&&this.isSpecularEnvMapIncludeMipmaps&&(e.IS_SPECULAR_ENV_MAP_INCLUDE_MIPMAPS=1),this.clearcoatFactor>0&&(e.HAS_CLEARCOAT=1,e.HAS_NORMAL=1,this.clearcoatMap&&t.add(this.clearcoatMap,"CLEARCOAT_MAP"),this.clearcoatNormalMap&&t.add(this.clearcoatNormalMap,"CLEARCOAT_NORMAL_MAP"),this.clearcoatRoughnessMap&&t.add(this.clearcoatRoughnessMap,"CLEARCOAT_ROUGHNESS_MAP")),t.update(),e}}),gi=vi,yi=new Image;yi.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";var Ei=a.a.create({Extends:Ze,Mixes:o.a,isLazyTexture:!0,className:"LazyTexture",_src:"",crossOrigin:!1,autoLoad:!0,resType:"",src:{get:function(){return this._src},set:function(e){this._src!==e&&(this._src=e,this.autoLoad&&this.load())}},constructor:function(e){e&&("crossOrigin"in e&&(this.crossOrigin=e.crossOrigin),"autoLoad"in e&&(this.autoLoad=e.autoLoad)),Ei.superclass.constructor.call(this,e),this.image=this.placeHolder||yi},load:function(e){var t=this;return Ei.loader=Ei.loader||new _i,Ei.loader.load({src:this.src,crossOrigin:this.crossOrigin,type:this.resType,defaultType:"img"}).then((function(e){e.isTexture?(Object.assign(t,e),t.needUpdate=!0,t.needDestroy=!0,t.fire("load")):(t.image=e,t.needUpdate=!0,t.fire("load"))}),(function(n){if(t.fire("error"),e)throw new Error("LazyTexture Failed ".concat(n));_.a.warn("LazyTexture Failed ".concat(n))}))},_releaseImage:function(){this._src&&"string"!=typeof this._src&&(this._src=""),Ei.superclass._releaseImage.call(this)}}),Ti=Ei,xi=n(13);function Ai(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Oi=new h.a,bi=new h.a,Mi=new h.a,Si=new h.a,Ri=new h.a,Li=new h.a,Ci=new xi.a,Ii=[];function wi(e,t){return e-t}var Pi=a.a.create({Statics:{interpolation:{LINEAR:function(e,t,n){if(void 0===t)return e;if(e.slerp)return e.slerp(t,n);if(e.lerp)return e.lerp(t,n);if(Object(i.isArrayLike)(e)){Ii.length=0;for(var r=e.length-1;r>=0;r--)Ii[r]=e[r]+n*(t[r]-e[r]);return Ii}return e+n*(t-e)},STEP:function(e,t,n){return e},CUBICSPLINE:function(e,t,n,r){var a=e.length/3;if(void 0===t)return 1===a?e[1]:e.slice(a,-a);var o=e[1],s=e[2],u=t[1],c=t[0];return a>1&&(o=e.slice(a,-a),s=e.slice(-a),u=t.slice(a,-a),c=t.slice(0,a)),o.hermite?o.hermite(o,s.scale(r),u,c.scale(r),n):o.isQuaternion?(o.fromArray(this._cubicSpline(o.elements,s.elements,u.elements,c.elements,r,n),0,!0),o.normalize(!0)):(Object(i.isArrayLike)(o)||(o=[o],s=[s],u=[u],c=[c]),o=this._cubicSpline(o,s,u,c,r,n)),o},_cubicSpline:function(e,t,n,r,i,a){var o=a*a,s=o*a,u=2*s-3*o+1,c=s-2*o+a,l=-2*s+3*o,f=s-o;Ii.length=0;for(var h=e.length-1;h>=0;h--)Ii[h]=e[h]*u+c*t[h]*i+n[h]*l+f*r[h]*i;return Ii}},StateType:{TRANSLATE:"Translation",POSITION:"Translation",TRANSLATION:"Translation",SCALE:"Scale",ROTATE:"Rotation",ROTATION:"Rotation",QUATERNION:"Quaternion",WEIGHTS:"Weights"},getType:function(e){return e=String(e).toUpperCase(),Pi.StateType[e]||Pi._extraStateHandlers.type[e]},_extraStateHandlers:{type:{},handler:{}},registerStateHandler:function(e,t){Pi._extraStateHandlers.type[String(e).toUpperCase()]=e,Pi._extraStateHandlers.handler[e]=t}},isAnimationStates:!0,className:"AnimationStates",nodeName:"",type:"",interpolationType:"LINEAR",constructor:function(e){this.id=d.a.generateUUID(this.className),this.keyTime=[],this.states=[],Object.assign(this,e)},findIndexByTime:function(e){return Object(i.getIndexFromSortedArray)(this.keyTime,e,wi)},getStateByIndex:function(e){var t=this.states.length/this.keyTime.length;return 1===t?this.states[e]:this.states.slice(e*t,e*t+t)},getState:function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ai(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ai(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.findIndexByTime(e),2),n=t[0],r=t[1];if(n<0||r>=this.keyTime.length)return null;var a=this.keyTime[n],o=this.keyTime[r],s=this.getStateByIndex(n);if("STEP"===this.interpolationType)return s;if(n===r){var u=this.interpolation(s);return this.type===Pi.StateType.ROTATION&&(u=Oi.fromEuler(Ci.fromArray(u))),u.elements||u}var c=this.getStateByIndex(r),l=o-a,f=(e-a)/l;this.type===Pi.StateType.ROTATION?Object(i.isArrayLike)(s[0])?(s[0]=Oi.fromEuler(Ci.fromArray(s[0])),s[1]=bi.fromEuler(Ci.fromArray(s[1])),s[2]=Mi.fromEuler(Ci.fromArray(s[2])),c[0]=Si.fromEuler(Ci.fromArray(c[0])),c[1]=Ri.fromEuler(Ci.fromArray(c[1])),c[2]=Li.fromEuler(Ci.fromArray(c[2]))):(s=Oi.fromEuler(Ci.fromArray(s)),c=bi.fromEuler(Ci.fromArray(c))):this.type===Pi.StateType.QUATERNION&&(Object(i.isArrayLike)(s[0])?(s[0]=Oi.fromArray(s[0]),s[1]=bi.fromArray(s[1]),s[2]=Mi.fromArray(s[2]),c[0]=Si.fromArray(c[0]),c[1]=Ri.fromArray(c[1]),c[2]=Li.fromArray(c[2])):(s=Oi.fromArray(s),c=bi.fromArray(c)));var h=this.interpolation(s,c,f,l);return h.elements||h},interpolation:function(e,t,n,r){return Pi.interpolation[this.interpolationType](e,t,n,r)},updateNodeTranslation:function(e,t){e.x=t[0],e.y=t[1],e.z=t[2]},updateNodeScale:function(e,t){e.scaleX=t[0],e.scaleY=t[1],e.scaleZ=t[2]},updateNodeQuaternion:function(e,t){e.quaternion.fromArray(t)},updateNodeWeights:function(e,t){var n=this._originalWeightIndices=this._originalWeightIndices||[],r=t.length;t=t.slice();for(var i=0;i<r;i++)n[i]=i;for(var a=0;a<r;a++)for(var o=a+1;o<r;o++)if(t[o]>t[a]){var s=t[a];t[a]=t[o],t[o]=s,s=n[a],n[a]=n[o],n[o]=s}e.traverse((function(e){e.isMesh&&e.geometry&&e.geometry.isMorphGeometry&&e.geometry.update(t,n)}))},updateNodeState:function(e,t){if(t){var n=this.type;n===Pi.StateType.ROTATION&&(n=Pi.StateType.QUATERNION);var r=this.getState(e);if(r){var i="updateNode"+n;this[i]?this[i](t,r):Pi._extraStateHandlers.handler[n]?Pi._extraStateHandlers.handler[n].call(this,t,r):_.a.warnOnce(i,"updateNodeState failed unknow type(%s)",n)}}},clone:function(){return new this.constructor({keyTime:this.keyTime,states:this.states,type:this.type,nodeName:this.nodeName})}}),Ni=Pi,Fi=a.a.create({Statics:{_anims:[],tick:function(e){this._anims.forEach((function(t){return t.tick(e)}))}},Mixes:o.a,isAnimation:!0,className:"Animation",paused:!1,currentLoopCount:0,loop:1/0,currentTime:0,timeScale:1,startTime:0,endTime:0,clipStartTime:0,clipEndTime:0,nodeNameMap:null,_rootNode:null,rootNode:{get:function(){return this._rootNode},set:function(e){this._rootNode=e,this._initNodeNameMap()}},_animStatesList:null,animStatesList:{get:function(){return this._animStatesList},set:function(e){this._animStatesList=e,this._initClipTime()}},validAnimationIds:null,constructor:function(e){this.id=d.a.generateUUID(this.className),this.clips={},this._animStatesList=[],Object.assign(this,e)},addClip:function(e,t,n,r){this.clips[e]={start:t,end:n,animStatesList:r}},removeClip:function(e){this.clips[e]=null},getAnimStatesListTimeInfo:function(e){var t=0,n=1/0;return e.forEach((function(e){t=Math.max(e.keyTime[e.keyTime.length-1],t),n=Math.min(e.keyTime[0],n)})),{startTime:n,endTime:t}},_initClipTime:function(){var e=this.getAnimStatesListTimeInfo(this.animStatesList);this.clipStartTime=e.startTime,this.clipEndTime=e.endTime},_initNodeNameMap:function(){if(this._rootNode){var e=this.nodeNameMap={};this._rootNode.traverse((function(t){e[t.animationId]=t;var n=t.name;void 0===n||e[n]||(e[n]=t)}),!1)}},tick:function(e){this.paused||(this.currentTime+=e/1e3*this.timeScale,this.currentTime>=this.endTime?(this.currentLoopCount++,this.currentTime=this.endTime,this.updateAnimStates(),this.fire("loopEnd"),!this.loop||this.currentLoopCount>=this.loop?(this.stop(),this.fire("end")):this.currentTime=this.startTime):this.updateAnimStates())},updateAnimStates:function(){var e=this;return this.animStatesList.forEach((function(t){t.updateNodeState(e.currentTime,e.nodeNameMap[t.nodeName])})),this},play:function(e,t){var n;if("string"==typeof e){var r=this.clips[e];r?(n=r.start,t=r.end,r.animStatesList&&(this.animStatesList=r.animStatesList,this._initClipTime())):_.a.warn("no this animation clip name:"+e)}else n=e;void 0===n&&(n=this.clipStartTime),void 0===t&&(t=this.clipEndTime),this.endTime=Math.min(t,this.clipEndTime),this.startTime=Math.min(n,this.endTime),this.currentTime=this.startTime,this.currentLoopCount=0,this.stop(),this.paused=!1,Fi._anims.push(this)},stop:function(){this.paused=!0;var e=Fi._anims,t=e.indexOf(this);-1!==t&&e.splice(t,1)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},clone:function(e){var t=new this.constructor({rootNode:e,animStatesList:this.animStatesList,timeScale:this.timeScale,loop:this.loop,paused:this.paused,currentTime:this.currentTime,startTime:this.startTime,endTime:this.endTime,clips:this.clips});return this.paused||t.play(),t}}),Di=Fi;function Ui(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Vi=P.a.BLEND,Bi=P.a.DEPTH_TEST,Hi=P.a.CULL_FACE,zi=P.a.FRONT,Gi=P.a.BACK,ki=P.a.FRONT_AND_BACK,ji={5120:[1,Int8Array],5121:[1,Uint8Array],5122:[2,Int16Array],5123:[2,Uint16Array],5125:[4,Uint32Array],5126:[4,Float32Array]},Xi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wi={POSITION:{name:"vertices",decodeMatName:"positionDecodeMat"},TEXCOORD_0:{name:"uvs",decodeMatName:"uvDecodeMat"},TEXCOORD_1:{name:"uvs1",decodeMatName:"uv1DecodeMat"},NORMAL:{name:"normals",decodeMatName:"normalDecodeMat"},JOINT:{name:"skinIndices"},JOINTS_0:{name:"skinIndices"},WEIGHT:{name:"skinWeights"},WEIGHTS_0:{name:"skinWeights"},TANGENT:{name:"tangents"},COLOR_0:{name:"colors"}},qi=a.a.create({isGLTFParser:!0,className:"GLTFParser",Statics:{MAGIC:"glTF",extensionHandlers:r,registerExtensionHandler:function(e,t){this.extensionHandlers[e]=t},unregisterExtensionHandler:function(e){this.extensionHandlers[e]&&delete this.extensionHandlers[e]}},isMultiAnim:!0,isProgressive:!1,isUnQuantizeInShader:!0,isLoadAllTextures:!1,preHandlerImageURI:null,preHandlerBufferURI:null,customMaterialCreator:null,ignoreTextureError:!1,forceCreateNewBuffer:!1,src:"",constructor:function(e,t){Object.assign(this,t),this.content=e},parse:function(e){var t=this;if(this.content instanceof ArrayBuffer){var n=this.content;if(i.convertUint8ArrayToString(new Uint8Array(n,0,4))===qi.MAGIC)this.parseBinary(n);else{var r=i.convertUint8ArrayToString(new Uint8Array(n),!0);this.json=JSON.parse(r)}}else this.json=JSON.parse(this.content);return this.glTFVersion=parseFloat(this.json.asset.version),this.glTFVersion>=2&&(this.isGLTF2=!0),this.parseExtensionUsed(),this.loadResources(e).then((function(){return t.parseExtensions(t.json.extensions,null,{isGlobal:!0,methodName:"parseOnLoad"}),Promise.resolve()})).then((function(){return t.parseGeometries()})).then((function(){return t.parseScene()}))},parseExtensionUsed:function(){var e=this;this.extensionsUsed={},i.each(this.json.extensionsUsed,(function(t){e.extensionsUsed[t]=!0})),this.extensionsUsed.WEB3D_quantized_attributes||(this.isUnQuantizeInShader=!1)},getExtensionHandler:function(e){return this.extensionHandlers&&this.extensionHandlers[e]||qi.extensionHandlers[e]},parseExtension:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=e[t],a=this.getExtensionHandler(t);return a&&a.parse?a.parse(i,this,n,r):n},parseExtensions:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.each(e,(function(e,i){if(!r.ignoreExtensions||!r.ignoreExtensions[i]){var a=n.getExtensionHandler(i),o=r.methodName||"parse";a&&a[o]&&(t=a[o](e,n,t,r))}})),t},isUseExtension:function(e,t){return!!(e&&e.extensions&&e.extensions[t])},parseBinary:function(e){this.isBinary=!0;var t,n=new DataView(e),r=n.getUint32(4,!0),a=n.getUint32(8,!0),o=12;if(r<2){var s=n.getUint32(o,!0);t=new Uint8Array(e,20,s),t=i.convertUint8ArrayToString(t,!0),this.json=JSON.parse(t),this.binaryBody=e.slice(20+s)}else{if(2!==r)throw new Error("Dont support glTF version ".concat(r));for(;o<a;){var u=n.getUint32(o,!0),c=n.getUint32(o+4,!0);1313821514===c?(t=new Uint8Array(e,o+8,u),t=i.convertUint8ArrayToString(t,!0),this.json=JSON.parse(t)):5130562===c&&(this.binaryBody=e.slice(o+8,o+8+u)),o+=8+u}}},loadResources:function(e){var t=this,n=[];for(var r in this.extensionsUsed){var i=this.getExtensionHandler(r);i&&i.init&&n.push(i.init(e,this))}return this.isBinary?n.push(this.loadBuffers(e).then((function(){return t.loadTextures(e)}))):(n.push(this.loadBuffers(e)),n.push(this.loadTextures(e))),Promise.all(n)},getBufferUri:function(e){var t=i.getRelativePath(this.src,this.json.buffers[e].uri);return this.preHandlerBufferURI&&(t=this.preHandlerBufferURI(t,this.json.buffers[e])),t},loadBuffers:function(e){var t=this;return this.buffers={},this.isBinary?(this.isGLTF2?this.buffers[0]=this.binaryBody:this.buffers.binary_glTF=this.binaryBody,this.parseBufferViews(),Promise.resolve()):Promise.all(Object.keys(this.json.buffers||[]).map((function(n){var r=t.getBufferUri(n);return e.loadRes(r,hi.TYPE_BUFFER).then((function(e){t.buffers[n]=e}))}))).then((function(){t.parseBufferViews()}))},getImageUri:function(e){var t=this.json.images[e],n=t.uri;if(this.isUseExtension(t,"KHR_binary_glTF")){var r=t.extensions.KHR_binary_glTF,a=this.bufferViews[r.bufferView],o=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);n=i.getBlobUrl(r.mimeType,o)}else if(n)n=i.getRelativePath(this.src,n);else if("bufferView"in t){var s=this.bufferViews[t.bufferView],u=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n="image/ktx"===t.mimeType?u:i.getBlobUrl(t.mimeType,u)}return this.preHandlerImageURI&&(n=this.preHandlerImageURI(n,t)),n},getImageType:function(e){var t=this.json.images[e],n="";return t&&/^image\/(.*)$/.test(t.mimeType)&&(n=RegExp.$1),["ktx"].indexOf(n)<0&&(n=""),n},getUsedTextureNameMap:function(){var e=this,t={};return i.each(this.json.materials,(function(n){var r=n,a=!1;if(e.isUseExtension(n,"KHR_materials_common")&&(a=!0,r=n.extensions.KHR_materials_common.values),e.isGLTF2&&!a){if(r.normalTexture&&(t[r.normalTexture.index]=!0),r.occlusionTexture&&(t[r.occlusionTexture.index]=!0),r.emissiveTexture&&(t[r.emissiveTexture.index]=!0),r.transparencyTexture&&(t[r.transparencyTexture.index]=!0),r.extensions&&i.each(r.extensions,(function(n,r){var i=e.getExtensionHandler(r);i&&i.getUsedTextureNameMap&&i.getUsedTextureNameMap(n,t,e)})),!e.isUseExtension(r,"KHR_materials_pbrSpecularGlossiness")&&r.pbrMetallicRoughness){var o=r.pbrMetallicRoughness;o.baseColorTexture&&(t[o.baseColorTexture.index]=!0),o.metallicRoughnessTexture&&(t[o.metallicRoughnessTexture.index]=!0)}}else a||(r=n.values),["diffuse","specular","emission","ambient","transparency","normalMap"].forEach((function(n){var a=r[n];a instanceof Object&&"index"in a&&(a=a.index),i.isStrOrNumber(a)&&e.json.textures[a]&&(t[a]=!0)}))})),t},loadTextures:function(){var e=this;if(this.textures={},!this.json.textures)return Promise.resolve();var t=Object.keys(this.json.textures);if(!this.isLoadAllTextures){var n=this.getUsedTextureNameMap();t=t.filter((function(e){return n[e]}))}return Promise.all(t.map((function(t){var n=e.json.textures[t],r=e.getImageUri(n.source),a=new Ti(n);if(a.uv=void 0,a.autoLoad=e.isProgressive,a.crossOrigin=!0,a.resType=e.getImageType(n.source),a.src=r,a.name=n.name||t,a.colorSpaceConversion=!1,i.isBlobUrl(r)){var o=function e(){i.revokeBlobUrl(r),a.off("load",e),a.off("error",e)};a.on("load",o,!0),a.on("error",o,!0)}return e.json.samplers&&Object.assign(a,e.json.samplers[n.sampler]),n.extensions&&(a=e.parseExtensions(n.extensions,a)),e.textures[t]=a,e.isProgressive?Promise.resolve():a.load(!e.ignoreTextureError)})))},parseBufferViews:function(){var e=this;this.bufferViews={},i.each(this.json.bufferViews,(function(t,n){var r=e.buffers[t.buffer],i=t.byteOffset||0,a=t.byteLength;e.bufferViews[n]={id:d.a.generateUUID("bufferView"),byteOffset:i,byteLength:a,buffer:r,byteStride:t.byteStride}})),this.isBinary||delete this.buffers},getTexture:function(e){var t=this.textures[e.index];if(!t)return null;var n=e.texCoord||0,r=e.index+"_"+n;return this.textures[r]?t=this.textures[r]:"number"==typeof t.uv&&t.uv!==n&&(t=t.clone(),this.textures[r]=t),t.uv=n,t.__gltfTextureInfo=e,t},getColorOrTexture:function(e){return Array.isArray(e)?new g.a(e[0],e[1],e[2]):(e instanceof Object&&"index"in e&&(e=e.index),this.textures[e])},parseMaterialCommonProps:function(e,t){switch(t.alphaMode){case"BLEND":e.transparent=!0;break;case"MASK":e.alphaCutoff="alphaCutoff"in t?t.alphaCutoff:.5;break;case"OPAQUE":default:e.ignoreTranparent=!0}t.doubleSided?e.side=ki:e.side=zi,t.transparencyTexture&&(e.transparency=this.getTexture(t.transparencyTexture))},createPBRMaterial:function(e){var t=new gi,n=e,r=!this.isUseExtension(n,"KHR_materials_unlit");if(r){var i=n.normalTexture;i&&(t.normalMap=this.getTexture(i),void 0!==i.scale?t.normalMapScale=i.scale:t.normalMapScale=1);var a=n.occlusionTexture;a&&(t.occlusionMap=this.getTexture(a),void 0!==a.strength?t.occlusionStrength=a.strength:t.occlusionStrength=1);var o=n.emissiveTexture;o&&(t.emission=this.getTexture(o));var s=n.emissiveFactor;s&&(t.emissionFactor.fromArray(s),t.emissionFactor.a=1)}else t.lightType="NONE";if(this.isUseExtension(n,"KHR_materials_pbrSpecularGlossiness"))this.parseExtension(n.extensions,"KHR_materials_pbrSpecularGlossiness",t);else if(n.pbrMetallicRoughness){var u=n.pbrMetallicRoughness;u.baseColorFactor&&t.baseColor.fromArray(u.baseColorFactor),u.baseColorTexture&&(t.baseColorMap=this.getTexture(u.baseColorTexture)),r&&(u.metallicRoughnessTexture&&(t.metallicRoughnessMap=this.getTexture(u.metallicRoughnessTexture),t.occlusionMap===t.metallicRoughnessMap&&(t.occlusionMap=null,t.isOcclusionInMetallicRoughnessMap=!0)),"roughnessFactor"in u&&(t.roughness=u.roughnessFactor),"metallicFactor"in u&&(t.metallic=u.metallicFactor))}return t.baseColorMap&&this._parseTextureTransform(t,t.baseColorMap),t},_parseTextureTransform:function(e,t){var n=t.__gltfTextureInfo;if(this.isUseExtension(n,"KHR_texture_transform")){var r=n.extensions.KHR_texture_transform;if(void 0!==r.texCoord&&(t.uv=r.texCoord),r.offset||r.rotation||r.scale){var i=r.offset||[0,0],a=r.rotation||0,o=r.scale||[1,1],s=(new R.a).fromRotationTranslationScale(a,i[0],i[1],o[0],o[1]);0===t.uv?e.uvMatrix=s:1===t.uv&&(e.uvMatrix1=s)}}},createKMCMaterial:function(e,t){var n,r=new en;return t?(n=t.values,r.lightType=t.technique):n=e.values,r.diffuse=this.getColorOrTexture(n.diffuse)||r.diffuse,r.specular=this.getColorOrTexture(n.specular)||r.specular,r.emission=this.getColorOrTexture(n.emission)||r.emission,r.ambient=this.getColorOrTexture(n.ambient)||r.ambient,n.normalMap&&(r.normalMap=this.getColorOrTexture(n.normalMap)),"number"==typeof n.transparency?(r.transparency=n.transparency,r.transparency<1&&(r.transparent=!0)):"string"==typeof n.transparency&&(r.transparency=this.getColorOrTexture(n.transparency),r.transparent=!0),!0===n.transparent&&(r.transparent=!0),"shininess"in n&&(r.shininess=n.shininess),this._parseTextureTransform(r,r.diffuse),r},parseMaterials:function(){var e=this;this.materials={},i.each(this.json.materials,(function(t,n){if(e.customMaterialCreator){var r=e.customMaterialCreator(n,t,e.json,e);if(r)return void(e.materials[n]=r)}var i,a=null;e.isUseExtension(t,"KHR_materials_common")&&(a=t.extensions.KHR_materials_common),e.isGLTF2&&!a?(i=e.isUseExtension(t,"KHR_techniques_webgl")?e.parseExtension(t.extensions,"KHR_techniques_webgl"):e.createPBRMaterial(t),e.parseMaterialCommonProps(i,t)):i=e.createKMCMaterial(t,a),(i=e.parseExtensions(t.extensions,i,{ignoreExtensions:{KHR_techniques_webgl:1,KHR_materials_common:1,KHR_materials_pbrSpecularGlossiness:1},isMaterial:!0})).name=t.name||n,e.materials[n]=i,e.parseTechnique(t,i)}))},sparseAccessorHandler:function(e,t){if(!t)return e;var n=t.count,r=e.data.constructor,a=new r(e.realLength);a.set(e.data),e.data=a;for(var o=this.bufferViews[t.values.bufferView],s=new r(o.buffer,o.byteOffset+(t.values.byteOffset||0),n*e.size),u=new(r=ji[t.indices.componentType][1])((o=this.bufferViews[t.indices.bufferView]).buffer,o.byteOffset+(t.indices.byteOffset||0),n),c=0;c<n;c++)i.copyArrayData(a,s,u[c]*e.size,c*e.size,e.size);return e},getAccessorData:function(e,t){var n=this.json.accessors[e];if(n.data)return n.data;var r,i=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ui(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ui(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(ji[n.componentType],2)[1],a=Xi[n.type],o=this.bufferViews[n.bufferView],s=n.count*a;if(o)if(o.byteStride&&o.byteStride>a*i.BYTES_PER_ELEMENT)o.array=new i(o.buffer,o.byteOffset,o.byteLength/i.BYTES_PER_ELEMENT),r=new w(o.array,a,{offset:n.byteOffset||0,stride:o.byteStride,bufferViewId:o.id});else{var u,c=(n.byteOffset||0)+o.byteOffset;u=c%i.BYTES_PER_ELEMENT||this.forceCreateNewBuffer?new i(o.buffer.slice(c,c+s*i.BYTES_PER_ELEMENT)):new i(o.buffer,c,s),r=new w(u,a)}return n.sparse&&(r||(r=new w(new i(s),a)),r=this.sparseAccessorHandler(r,n.sparse)),r=this.parseExtensions(n.extensions,r,{isDecode:t,isAccessor:!0}),n.data=r,n.normalized&&(r.normalized=!0),r},getArrayByAccessor:function(e,t){var n=this.json.accessors[e];if(n.array)return n.array;var r=this.getAccessorData(e,t);if(!r.stride&&!r.offset&&1===r.size)return r.data;var i=[];return r.traverse((function(e){i.push(e.toArray?e.toArray():e)})),n.array=i,i},parseTechnique:function(e,t){var n=null;this.json.techniques&&(n=this.json.techniques[e.technique]),n&&n.states&&(n.states.enable.forEach((function(e){switch(e){case Vi:t.blend=!0;break;case Bi:t.depthTest=!0;break;case Hi:t.cullFace=!0}})),i.each(n.states.functions,(function(e,n){switch(n){case"blendEquationSeparate":t.blendEquation=e[0],t.blendEquationAlpha=e[1];break;case"blendFuncSeparate":t.blendSrc=e[0],t.blendDst=e[1],t.blendSrcAlpha=e[2],t.blendDstAlpha=e[3];break;case"depthMask":t.depthMask=e[0];break;case"cullFace":t.cullFaceType=e[0];break;default:t[n]=e}})),t.cullFace?t.side=t.cullFaceType===zi?Gi:zi:t.side=ki)},createMorphGeometry:function(e,t){var n=this,r=new Yn,a=r.targets={};return i.each(e.targets,(function(e){i.each(e,(function(e,t){var r=Wi[t].name;a[r]||(a[r]=[]);var i=n.getAccessorData(e,!0);a[r].push(i)}))})),r.weights=t||new Float32Array(e.targets.length),r},handlerGeometry:function(e,t){var n=void 0===t.mode?4:t.mode;if(t.extensions){var r=this.parseExtensions(t.extensions,null,{primitive:t,isPrimitive:!0});if(r)return r.mode=n,r}e||(e=new K({mode:n})),"indices"in t&&(e.indices=this.getAccessorData(t.indices));var i=t.attributes;for(var a in i){var o=Wi[a];if(o){var s=!(this.isUnQuantizeInShader&&o.decodeMatName);e[o.name]=this.getAccessorData(i[a],s),s||(e[o.decodeMatName]=e[o.name].decodeMat,delete e[o.name].decodeMat)}else _.a.warn("Unknow attribute named ".concat(a,"!"))}return e},handlerSkinedMesh:function(e,t){t&&(e.skeleton=t,this.useInstanced&&(e.useInstanced=!0))},fixProgressiveGeometry:function(e,t){e._geometry=t,this.isProgressive&&e._meshes&&e._meshes.forEach((function(e){e.visible=!0,e.geometry=t}))},parseGeometries:function(){var e=this,t=i.serialRun(this.json.meshes,(function(t){return i.serialRun(t.primitives,(function(n){var r;n.targets&&n.targets.length&&(r=e.createMorphGeometry(n,t.weights)),n._geometry=r;var i=e.handlerGeometry(r,n);return i&&i.then?i.then((function(t){e.fixProgressiveGeometry(n,t)}),(function(e){_.a.error("geometry parse error",e)})):(e.fixProgressiveGeometry(n,i),i)}))}));return this.isProgressive?null:t},parseMesh:function(e,t,n){var r=this,i=this.json.meshes[e];i.primitives.forEach((function(a){var o,s=r.skins&&r.skins[n.skin];if(a.meshNode)o=a.meshNode.clone();else{var u=r.materials[a.material]||new en;o=new(s?gr:_r)({geometry:a._geometry,material:u,name:"mesh-"+(i.name||e)}),a.meshNode=o}r.handlerSkinedMesh(o,s),r.isProgressive&&!o.geometry&&(o.visible=!1,a._meshes=a._meshes||[],a._meshes.push(o)),t.addChild(o),r.meshes.push(o)}))},parseCameras:function(){var e=this;this.cameras={};var t=window.innerWidth/window.innerHeight;i.each(this.json.cameras,(function(n,r){var i;"perspective"===n.type&&n.perspective?((i=new Z).fov=d.a.radToDeg(n.perspective.yfov),i.near=n.perspective.znear,i.far=n.perspective.zfar,n.aspectRatio?i.aspect=n.aspectRatio:i.aspect=t):"orthographic"===n.type&&n.orthographic&&((i=new ln).near=n.orthographic.znear,i.far=n.orthographic.zfar,i.right=n.orthographic.xmag,i.left=-1*i.right,i.top=n.orthographic.ymag,i.bottom=-1*i.top),(i=e.parseExtensions(n.extensions,i,{isCamera:!0}))&&(i.name=n.name||r,e.cameras[r]=i)}))},handlerNodeTransform:function(e,t){t.matrix?e.matrix.fromArray(t.matrix):(t.rotation&&e.quaternion.fromArray(t.rotation),t.scale&&e.setScale(t.scale[0],t.scale[1],t.scale[2]),t.translation&&(e.x=t.translation[0],e.y=t.translation[1],e.z=t.translation[2]))},parseNode:function(e,t){var n,r=this,i=this.json.nodes[e];i||_.a.warn("GLTFParser.parseNode: nodes[".concat(e,"] has nothing.")),n=new v({name:i.name,animationId:e}),n=this.parseExtensions(i.extensions,n,{isNode:!0}),"camera"in i&&this.cameras[i.camera]&&n.addChild(this.cameras[i.camera]),this.handlerNodeTransform(n,i),i.jointName?(n.jointName=i.jointName,this.jointMap[n.jointName]=n):this.isGLTF2&&(n.jointName=e,this.jointMap[e]=n),i.meshes?i.meshes.forEach((function(e){return r.parseMesh(e,n,i)})):"mesh"in i&&this.parseMesh(i.mesh,n,i),i.children&&i.children.forEach((function(e){return r.parseNode(e,n)})),t.addChild(n)},parseAnimations:function(){var e=this;if(!this.json.animations)return null;var t=this.isMultiAnim,n={},r=[],a={};return i.each(this.json.animations,(function(i){i.channels.forEach((function(t){var n=t.target.path,o=t.target.id;e.isGLTF2&&(o=t.target.node);var s=i.samplers[t.sampler],u=e.isGLTF2?s.input:i.parameters[s.input],c=e.isGLTF2?s.output:i.parameters[n],l=e.getArrayByAccessor(u,!0),f=e.getArrayByAccessor(c,!0);"rotation"===n&&(n="quaternion");var h=new Ni({interpolationType:s.interpolation||"LINEAR",nodeName:o,keyTime:l,states:f,type:Ni.getType(n)});r.push(h),a[o]=!0})),t&&r.length&&(n[i.name]={animStatesList:r},r=[])})),t&&Object.keys(n).length>0&&(r=Object.values(n)[0].animStatesList),r.length?new Di({rootNode:this.node,animStatesList:r,validAnimationIds:a,clips:n}):null},parseScene:function(){var e=this;this.parseMaterials(),this.jointMap={},this.meshes=[],this.lights=[],this.node=new v({needCallChildUpdate:!1}),this.parseCameras();var t=this.json.scenes[this.getDefaultSceneName()];if(!t)return _.a.warn("GLTFParser:no scene!"),{node:this.node,meshes:[],cameras:[],lights:[],textures:[],materials:[]};var n=t.nodes;this.parseSkins(),n.forEach((function(t){return e.parseNode(t,e.node)})),this.resetSkinInfo(this.node);var r={node:this.node,scene:this.node,meshes:this.meshes,json:this.json,cameras:Object.values(this.cameras),lights:this.lights,textures:Object.values(this.textures),materials:Object.values(this.materials)},i=this.parseAnimations();return i&&(this.node.setAnim(i),i.play(),r.anim=i),this.parseExtensions(t.extensions,null,{isScene:!0}),this.parseExtensions(this.json.extensions,r,{isGlobal:!0,methodName:"parseOnEnd"}),r},getDefaultSceneName:function(){return void 0!==this.defaultScene?this.defaultScene:this.json.scenes?Object.keys(this.json.scenes)[0]:null},parseSkins:function(){var e=this;this.skins=[];var t=this.json.skins;t&&t.length&&(this.skins=t.map((function(t){for(var n=new Er,r=t.joints.length,i=e.getArrayByAccessor(t.inverseBindMatrices,!0),a=0;a<r;a++){var o=(new s.a).fromArray(i[a]);n.inverseBindMatrices.push(o)}return n.jointNames=t.joints,n})))},resetSkinInfo:function(e){var t={};e.traverse((function(e){var n="".concat(e.id,"_").concat(e.name);t[e.jointName]=n,e.jointName=n})),this.skins.forEach((function(e){e.jointNames=e.jointNames.map((function(e){return t[e]}))})),e.resetSkinedMeshRootNode()}}),Yi=qi,Ki=a.a.create({Extends:hi,isGLTFLoader:!0,className:"GLTFLoader",constructor:function(){Ki.superclass.constructor.call(this)},load:function(e){var t=this;return this.loadRes(e.src,"buffer").then((function(n){return new Yi(n,e).parse(t)})).catch((function(e){throw _.a.error("load gltf failed",e.message,e.stack),e}))}});_i.addLoader("gltf",Ki),_i.addLoader("glb",Ki);var Qi=Ki,Zi=n(103),Ji=n.n(Zi),$i=P.a.RGBA,ea=P.a.NEAREST,ta=P.a.CLAMP_TO_EDGE,na=P.a.FLOAT,ra=a.a.create({Extends:hi,isHDRLoader:!0,className:"HDRLoader",constructor:function(){ra.superclass.constructor.call(this)},load:function(e){return this.loadRes(e.src,"buffer").then((function(t){try{var n=Ji()(t),r=n.shape,i=n.data,a=new Ze({width:r[0],height:r[1],flipY:e.flipY||!1,image:i,type:na,magFilter:ea,minFilter:ea,wrapS:ta,wrapT:ta,internalFormat:$i,format:$i});return Object.assign(a,e),a}catch(e){_.a.error("HDRLoader:parse error => ",e)}return null}))}});_i.addLoader("hdr",ra);var ia=ra,aa=a.a.create({Statics:{HEADER_LEN:64,COMPRESSED_2D:0,COMPRESSED_3D:1,TEX_2D:2,TEX_3D:3},isKhronosTextureContainer:!0,className:"KhronosTextureContainer",constructor:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.arrayBuffer=e,this.baseOffset=n;var r=new Uint8Array(this.arrayBuffer,this.baseOffset,12);if(171===r[0]&&75===r[1]&&84===r[2]&&88===r[3]&&32===r[4]&&49===r[5]&&49===r[6]&&187===r[7]&&13===r[8]&&10===r[9]&&26===r[10]&&10===r[11]){var i=Uint32Array.BYTES_PER_ELEMENT,a=new DataView(this.arrayBuffer,this.baseOffset+12,13*i),o=a.getUint32(0,!0),s=67305985===o;this.glType=a.getUint32(1*i,s),this.glTypeSize=a.getUint32(2*i,s),this.glFormat=a.getUint32(3*i,s),this.glInternalFormat=a.getUint32(4*i,s),this.glBaseInternalFormat=a.getUint32(5*i,s),this.pixelWidth=a.getUint32(6*i,s),this.pixelHeight=a.getUint32(7*i,s),this.pixelDepth=a.getUint32(8*i,s),this.numberOfArrayElements=a.getUint32(9*i,s),this.numberOfFaces=a.getUint32(10*i,s),this.numberOfMipmapLevels=a.getUint32(11*i,s),this.bytesOfKeyValueData=a.getUint32(12*i,s),this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===t?0===this.glType?this.loadType=aa.COMPRESSED_2D:this.loadType=aa.TEX_2D:_.a.warn("number of faces expected"+t+", but found "+this.numberOfFaces):_.a.warn("texture arrays not currently supported"):_.a.warn("only 2D textures currently supported")}else _.a.error("texture missing KTX identifier")},mipmaps:function(e){for(var t=[],n=aa.HEADER_LEN+this.bytesOfKeyValueData,r=this.pixelWidth,i=this.pixelHeight,a=e?this.numberOfMipmapLevels:1,o=0;o<a;o++){for(var s=new Int32Array(this.arrayBuffer,this.baseOffset+n,1)[0],u=0;u<this.numberOfFaces;u++){var c=new Uint8Array(this.arrayBuffer,this.baseOffset+n+4,s);t.push({data:c,width:r,height:i}),n+=s+4,n+=3-(s+3)%4}r=Math.max(1,.5*r),i=Math.max(1,.5*i)}return t}}),oa=a.a.create({Extends:hi,Statics:{astc:"WEBGL_compressed_texture_astc",etc:"WEBGL_compressed_texture_etc",etc1:"WEBGL_compressed_texture_etc1",pvrtc:"WEBGL_compressed_texture_pvrtc",s3tc:"WEBGL_compressed_texture_s3tc"},isKTXLoader:!0,className:"KTXLoader",constructor:function(){ee.use(oa.astc),ee.use(oa.atc),ee.use(oa.etc),ee.use(oa.etc1),ee.use(oa.pvrtc),ee.use(oa.s3tc),ee.use(oa.s3tc_srgb),oa.superclass.constructor.call(this)},load:function(e){var t=this;return e.src instanceof ArrayBuffer?Promise.resolve(this.createTexture(e,e.src)):ArrayBuffer.isView(e.src)?Promise.resolve(this.createTexture(e,e.src.buffer,e.src.byteOffset)):this.loadRes(e.src,"buffer").then((function(n){return t.createTexture(e,n)}))},createTexture:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new aa(t,1,n),i={compressed:0===r.glType,type:r.glType,width:r.pixelWidth,height:r.pixelHeight,internalFormat:r.glInternalFormat,format:r.glFormat,isCubemap:6===r.numberOfFaces};return r.numberOfMipmapLevels>=Math.floor(Math.log2(Math.max(i.width,i.height))+1)?(i.mipmaps=r.mipmaps(!0),i.image=i.mipmaps[0].data):(i.mipmaps=null,i.image=r.mipmaps(!1)[0].data),new Ze(i)}});_i.addLoader("ktx",oa);var sa=oa,ua=a.a.create({Mixes:o.a,isLoadQueue:!0,className:"LoadQueue",Statics:{addLoader:function(e,t){_.a.warn("LoadQueue.addLoader is duplicated, please use Loader.addLoader"),_i.addLoader(e,t)}},constructor:function(e){this._source=[],this.add(e)},maxConnections:2,_source:null,_loaded:0,_connections:0,_currentIndex:-1,add:function(e){return e&&(e=Array.isArray(e)?e:[e],this._source=this._source.concat(e)),this},get:function(e){if(!e)return null;for(var t=this._source,n=0;n<t.length;n++){var r=t[n];if(r.id===e||r.src===e)return r}return null},getContent:function(e){var t=this.get(e);return t&&t.content},start:function(){return this._loader||(this._loader=new _i),this._loadNext(),this},_loadNext:function(){var e=this,t=this._source,n=t.length;if(this._loaded>=n)this.fire("complete");else if(this._currentIndex<n-1&&this._connections<this.maxConnections){var r=++this._currentIndex,i=t[r];this._connections++,this._loader.load(i).then((function(t){e._onItemLoad(r,t)}),(function(t){e._onItemError(r,t)}))}},_onItemLoad:function(e,t){var n=this._source[e];n.loaded=!0,n.content=t,this._connections--,this._loaded++,this.fire("load",n),this._loadNext()},_onItemError:function(e,t){var n=this._source[e];n.error=t,this._connections--,this._loaded++,this.fire("error",n),this._loadNext()},getSize:function(e){for(var t=0,n=this._source,r=0;r<n.length;r++){var i=n[r];t+=(e?i.loaded&&i.size:i.size)||0}return t},getLoaded:function(){return this._loaded},getTotal:function(){return this._source.length},getAllContent:function(){return this._source.map((function(e){return e.content}))}}),ca=a.a.create({Extends:hi,isShaderMaterialLoader:!0,className:"ShaderMaterialLoader",constructor:function(){ca.superclass.constructor.call(this)},load:function(e){var t=[this.loadRes(e.fs),this.loadRes(e.vs)],n=Object.assign({},e);return Promise.all(t).then((function(e){return n.fs=e[0],n.vs=e[1],new jn(n)}),(function(e){_.a.warn("ShaderMaterial Loader Failed for ".concat(e))}))}}),la=ca,fa=a.a.create({Extends:hi,isTextureLoader:!0,className:"TextureLoader",constructor:function(){fa.superclass.constructor.call(this)},load:function(e){return this.loadImg(e.src,e.crossOrigin).then((function(t){var n=Object.assign({},e);return n.image=t,delete n.type,new Ze(n)})).catch((function(e){throw _.a.error("load Texture failed",e.message,e.stack),e}))}});_i.addLoader("Texture",fa);var ha=fa,da=P.a.LINES,_a={x:[0,0,0,1,0,0],y:[0,0,0,0,1,0],z:[0,0,0,0,0,1]},ma=a.a.create({Extends:v,isAxisHelper:!0,className:"AxisHelper",size:1,constructor:function(e){ma.superclass.constructor.call(this,e),this.init()},addAxis:function(e){var t=new _r({name:"AxisHelper_"+e,geometry:new K({mode:da,vertices:new w(new Float32Array(_a[e]),3),indices:new w(new Uint16Array([0,1]),1)}),material:new en({diffuse:new g.a(_a[e][3],_a[e][4],_a[e][5]),lightType:"NONE"})});this.addChild(t)},init:function(){this.setScale(this.size),this.addAxis("x"),this.addAxis("y"),this.addAxis("z")}}),pa=ma,va=P.a.LINES,ga=a.a.create({Extends:_r,isAxisNetHelper:!0,className:"AxisNetHelper",size:5,constructor:function(e){ga.superclass.constructor.call(this,e),this.color=this.color||new g.a(.5,.5,.5);for(var t=new K({mode:va}),n=this.size,r=2*n+1,i=0;i<r;i++){var a=i/n-1;t.addLine([a,0,-1],[a,0,1]),t.addLine([-1,0,a],[1,0,a])}this.geometry=t,this.material=new en({diffuse:this.color,lightType:"NONE"})}}),ya=ga,Ea=P.a.LINES,Ta=new c.a,xa=a.a.create({Extends:_r,isCameraHelper:!0,className:"CameraHelper",camera:null,color:null,constructor:function(e){xa.superclass.constructor.call(this,e),this.color||(this.color=new g.a(.3,.9,.6)),this.material=new en({lightType:"NONE",diffuse:this.color||new g.a(.5,.5,.5,1)}),this.geometry=new K({mode:Ea,isStatic:!1,vertices:new w(new Float32Array(27),3),indices:new w(new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7,8,4,8,5,8,6,8,7]),1)})},onUpdate:function(){this.camera&&(this.camera.updateViewProjectionMatrix(),this._buildGeometry())},_buildGeometry:function(){var e=this.camera,t=this.geometry;t.vertices.set(0,e.unprojectVector(Ta.set(-1,-1,1))),t.vertices.set(1,e.unprojectVector(Ta.set(-1,1,1))),t.vertices.set(2,e.unprojectVector(Ta.set(1,1,1))),t.vertices.set(3,e.unprojectVector(Ta.set(1,-1,1))),t.vertices.set(4,e.unprojectVector(Ta.set(-1,-1,-1))),t.vertices.set(5,e.unprojectVector(Ta.set(-1,1,-1))),t.vertices.set(6,e.unprojectVector(Ta.set(1,1,-1))),t.vertices.set(7,e.unprojectVector(Ta.set(1,-1,-1))),t.vertices.set(8,e.worldMatrix.getTranslation(Ta))}}),Aa=xa,Oa=a.a.create({Extends:T,isAmbientLight:!0,className:"AmbientLight",autoUpdateWorldMatrix:!1,constructor:function(e){Oa.superclass.constructor.call(this,e)}}),ba=Oa,Ma=a.a.create({Statics:{ltcTexture1:null,ltcTexture2:null,ltcTextureReady:!1,ltcTextureUrl:"//g.alicdn.com/tmapp/static/4.0.63/ltcTexture.js",loadLtcTexture:function(){var e=this;this.ltcTextureReady||void 0===this._loader&&(this._loader=new _i,this._loader.load({type:"json",src:this.ltcTextureUrl}).then((function(t){e._loader=null,e.ltcTexture1=new At({data:t.ltcTexture1}),e.ltcTexture2=new At({data:t.ltcTexture2}),e.ltcTextureReady=!0})))}},Extends:T,isAreaLight:!0,className:"AreaLight",width:10,height:10,_enabled:!0,enabled:{get:function(){return this._enabled&&Ma.ltcTextureReady},set:function(e){this._enabled=e}},constructor:function(e){Ma.superclass.constructor.call(this,e),Ma.loadLtcTexture()},ltcTexture1:{get:function(){return Ma.ltcTexture1},set:function(e){Ma.ltcTexture1=e}},ltcTexture2:{get:function(){return Ma.ltcTexture2},set:function(e){Ma.ltcTexture2=e}}}),Sa=Ma,Ra=new en({lightType:"NONE"}),La=new g.a(1,1,1),Ca=new g.a,Ia=a.a.create({isMeshPicker:!0,className:"MeshPicker",debug:!1,renderer:null,colorMeshMap:null,constructor:function(e){Object.assign(this,e),this.colorMeshMap={},this.init()},createFramebuffer:function(){if(!this.framebuffer){var e=this.renderer;this.framebuffer=new ct(e,{useVao:e.useVao,width:e.width,height:e.height})}},renderDebug:function(){this.framebuffer.render(0,.7,.3,.3)},createMeshNumberId:function(e){"numberId"in e||(e.numberId=10*Number(e.id.replace(/^.*_(\d+)$/,"$1")),e.color=Object(i.padLeft)(e.numberId.toString(16),6),this.colorMeshMap[e.color]=e)},renderColoredMeshes:function(){var e=this,t=this.renderer,n=this.framebuffer;n.bind(),t.clear(La);var r=t.forceMaterial;t.forceMaterial=Ra,t.renderList.traverse((function(n){e.createMeshNumberId(n),Ra.diffuse.fromHEX(n.color),Ra.isDirty=!0,t.renderMesh(n)})),t.forceMaterial=r,n.unbind()},getSelection:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=this.renderer.pixelRatio,a=[],o=this.framebuffer.readPixels(e*i,t*i,n*i,r*i),s=0;s<o.length;s+=4){var u=Ca.fromUintArray(o,s).toHEX();this.colorMeshMap[u]&&a.push(this.colorMeshMap[u])}return a},init:function(){var e=this;this.createFramebuffer(),this.renderer.on("afterRender",(function(){e.renderColoredMeshes(),e.debug&&e.renderDebug()}))}}),wa=a.a.create({constructor:function(e){this._targetFPS=e||60,this._interval=1e3/this._targetFPS,this._tickers=[]},_paused:!1,_targetFPS:0,_interval:0,_intervalId:null,_tickers:null,_lastTime:0,_tickCount:0,_tickTime:0,_measuredFPS:0,start:function(e){if(void 0===e&&(e=!0),!this._intervalId){this._lastTime=+new Date;var t,n=this,r=this._interval,i=window.requestAnimationFrame;e&&i&&r<17?(this._useRAF=!0,t=function(){n._intervalId=i(t),n._tick()}):t=function(){n._intervalId=setTimeout(t,r),n._tick()},this._paused=!1,t()}},stop:function(){this._useRAF?(0,window.cancelAnimationFrame)(this._intervalId):clearTimeout(this._intervalId),this._intervalId=null,this._lastTime=0,this._paused=!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1},_tick:function(){if(!this._paused){var e=+new Date,t=e-this._lastTime,n=this._tickers;++this._tickCount>=this._targetFPS?(this._measuredFPS=1e3/(this._tickTime/this._tickCount)+.5>>0,this._tickCount=0,this._tickTime=0):this._tickTime+=e-this._lastTime,this._lastTime=e;for(var r=n.slice(0),i=0,a=r.length;i<a;i++)r[i].tick(t)}},getMeasuredFPS:function(){return Math.min(this._measuredFPS,this._targetFPS)},addTick:function(e){if(!e||"function"!=typeof e.tick)throw new Error("Ticker: The tick object must implement the tick method.");this._tickers.push(e)},removeTick:function(e){var t=this._tickers,n=t.indexOf(e);n>=0&&t.splice(n,1)},nextTick:function(e){var t=this,n={tick:function(){t.removeTick(n),e()}};return t.addTick(n),n},timeout:function(e,t){var n=this,r=(new Date).getTime()+t,i={tick:function(){(new Date).getTime()-r>=0&&(n.removeTick(i),e())}};return n.addTick(i),i},interval:function(e,t){var n=(new Date).getTime()+t,r={tick:function(){var r=(new Date).getTime(),i=r-n;i>=0&&(i<t&&(r-=i),n=r+t,e())}};return this.addTick(r),r}}),Pa={get:function(){if(void 0===this._isWebGLSupport)try{var e=document.createElement("canvas"),t=e.getContext("webgl");t.clearColor(0,1,0,1),t.clear(t.COLOR_BUFFER_BIT);var n=new Uint8Array(4);t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,n),0===n[0]&&255===n[1]&&0===n[2]&&255===n[3]?this._isWebGLSupport=!0:this._isWebGLSupport=!1,e=null,t=null,n=null}catch(e){this._isWebGLSupport=!1}return this._isWebGLSupport}},Na=n(27)},,,function(e,t,n){n(104),e.exports=n(110)}]),"undefined"!=typeof window&&window.Hilo3d&&"object"==typeof t&&"object"==typeof e&&(e.exports=window.Hilo3d)},function(e,t,n){"use strict";var r;if(n.d(t,"a",(function(){return i})),!(r=window.__MarsRI__))throw Error("mars render interface not imported");var i=r},function(e,t,n){"use strict";n.d(t,"h",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"f",(function(){return f})),n.d(t,"g",(function(){return h})),n.d(t,"b",(function(){return d})),n.d(t,"d",(function(){return _})),n.d(t,"c",(function(){return m})),n.d(t,"e",(function(){return p})),n.d(t,"a",(function(){return v}));var r,i=n(9),a=n(13),o=n(0),s=n(5),u=s.a.constants;function c(e,t){if(1===e||4===e)t.blendSrc=u.SRC_ALPHA,t.blendDst=u.ONE,t.blendSrcAlpha=u.ONE,t.blendDstAlpha=u.ONE,4===e&&(t.blendEquationAlpha=t.blendEquation=u.FUNC_REVERSE_SUBTRACT);else if(2===e)t.blendSrc=u.DST_COLOR,t.blendDst=u.ONE_MINUS_SRC_ALPHA;else{if(5===e)return t.blendSrc=u.DST_COLOR,t.blendDst=u.DST_ALPHA,t.blendSrcAlpha=u.ZERO,t.blendDstAlpha=u.ONE,1;if(6===e)return t.blendSrc=u.DST_COLOR,t.blendDst=u.ZERO,t.blendSrcAlpha=u.ZERO,t.blendDstAlpha=u.ONE,1;t.blendSrc=u.SRC_ALPHA,t.blendDst=u.ONE_MINUS_SRC_ALPHA,t.blendSrcAlpha=u.ONE,t.blendDstAlpha=u.ONE_MINUS_SRC_ALPHA}return 0}function l(e,t,n){0!==e&&e?(n.stencilTest=!0,n.stencilOpFail=u.KEEP,n.stencilOpZFail=u.KEEP,n.stencilOpZPass=u.KEEP,n.stencilMask=255,n.stencilFuncMask=255,n.stencilFuncRef=t,1===e?(n.stencilFunc=u.ALWAYS,n.stencilOpZPass=u.REPLACE):3===e?n.stencilFunc=u.NOTEQUAL:2===e&&(n.stencilFunc=u.EQUAL)):n.stencilTest=!1}function f(e,t){Object(o.d)(e.getUniformValues(),(function(e){e&&(t?e.isTexture:e.isDataTexture)&&e.destroy()}))}function h(e,t,n,r){if(void 0===n&&(n=1),e.buffer.byteLength<e.BYTES_PER_ELEMENT*t){var i=t*n;isNaN(r)||(i=Math.min(i,r));var a=new ArrayBuffer(e.BYTES_PER_ELEMENT*i),o=new e.constructor(a);return o.set(e),o}return e}function d(e,t){var n={minFilter:(t=t||{}).minFilter||u.LINEAR_MIPMAP_LINEAR,magFilter:t.magFilter||u.LINEAR,dataReleasable:t.dataReleasable,format:t.format||u.RGBA,type:t.type||u.UNSIGNED_BYTE};if(t.clamp?n.wrapS=n.wrapT=u.MIRRORED_REPEAT:n.wrapS=n.wrapT=u.REPEAT,t.compressed&&(n.type=u.UNSIGNED_SHORT_4_4_4_4),null!=e&&e.isTextureContainer)return e;if("string"==typeof e&&e.length)return"#"===e[0]?m(Object(i.d)(e)):(n.src=e,n.flipY=!0,s.a.createTextureContainer(n));var r=e instanceof ImageData,o=e instanceof HTMLVideoElement;return null!=e&&e.src||e instanceof Image||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||o||r?(n.image=e,n.flipY=!1!==t.flipY,!r&&!o||Object(a.a)(e.width)&&Object(a.a)(e.height)||(n.magFilter=n.minFilter=u.NEAREST,n.wrapS=n.wrapT=u.CLAMP_TO_EDGE,n.autoUpdate=o,n.isVideo=o),s.a.createTextureContainer(n)):e instanceof ArrayBuffer?(n.data=e,n.compressed=!0,s.a.createTextureContainer(n)):e}function _(){return r||(r=new Uint8ClampedArray([255,255,255,255])),m({width:1,height:1,data:r},{format:u.LUMINANCE,internalFormat:u.LUMINANCE})}function m(e,t){t=t||{};var n=e||Object(i.d)("#fff");return s.a.createTextureContainer({data:n,type:t.type||u.UNSIGNED_BYTE,format:t.format||u.RGBA,internalFormat:t.format||u.RGBA,wrapS:t.wrapS||u.MIRRORED_REPEAT,wrapT:t.wrapS||u.MIRRORED_REPEAT,minFilter:t.minFilter||u.NEAREST,magFilter:t.magFilter||u.NEAREST,dataReleasable:!0})}function p(e){return m(Object(i.e)(e))}function v(e,t,n,r){var i={},a=[],s=(r=r||{}).templateScale||1;return n=n||{},Object(o.d)(t.variables,(function(e,t){if(n.hasOwnProperty(t)&&(e=n[t]),/^image_/.test(t)){var r=e instanceof Array,s=r?e[0]:e;a.push(function(e,t){return n(e,(function(r){return t?n(t,(function(){return e})):e}));function n(e,t){return/^(https?:)?\/\//.test(e)?Object(o.n)(e,{responseType:"blob"}).then(g,t):Promise.resolve(e)}}(s,r&&e[1]).then((function(e){return i[t]=e})))}else i[t]=e})),Promise.all(a).then((function(){return Object(o.i)(e).then((function(e){var n=t.content.replace(/\$([\w_]+)\$/g,(function(e,t){return i[t]})).replace('width="'+t.width+'px"','width="'+t.width*s+'px"').replace('height="'+t.height+'px"','height="'+t.height*s+'px"');return Object(o.i)("data:image/svg+xml,"+encodeURIComponent(n)).then((function(n){var i=r.canvas||document.createElement("canvas");return i.width=e.width*s,i.height=e.height*s,new Promise((function(r){setTimeout((function(){var a=i.getContext("2d");a.clearRect(0,0,i.width,i.height),a.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),a.drawImage(n,0,0,n.width,n.height,0,0,t.width*s/t.backgroundWidth*e.width,t.height*s/t.backgroundHeight*e.height),r(i)}),0)}))}))}))}))}function g(e){return new Promise((function(t,n){var r=new FileReader;r.readAsDataURL(e),r.onload=function(){t(r.result)},r.onerror=n}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(26);var r=n(0),i=function(){function e(e,t){Object(r.k)(this,{delay:0},e),this.renderer=t,this.items=e.items||[],this.engine=t.getParticleOptions().engine,this._onCreate(e),this._timeInms=0,this._delayInms=1e3*(this.delay||0),this._durInms=1e3*(this.duration||0),this.looping&&!this.endBehavior&&(this.endBehavior=2)}var t=e.prototype;return t.start=function(){return this._started&&!this.ended||(this._started=!0,this._delaying=!0,this._timeInms=0,this._callEnd=!1,this.ended=!1),this},t.createContent=function(){return this._content||(this._content=this._createContent(this.renderer)),this._content},t.createVFXItem=function(e,t){},t.precompile=function(){return this._items||(this._items=this._createItemsWidthOrder(this.renderer)),this._precompile()},t.stop=function(){this._stop(),this._items&&this._items.forEach((function(e){return e.stop()})),this._started=!1},t.reset=function(){var e=this.renderer;return this.renderer&&(this._content=this._disposeContent(e,this._content),this._items&&(this._items.forEach((function(e){return e.destroy()})),this._items=null)),this._started=!1,this},t.destroy=function(){this.renderer&&(this.reset(),this.onUpdate=function(){return-1},this.renderer=null)},t._onCreate=function(e){},t._stop=function(){this._content&&this._content.stop&&this._content.stop()},t._precompile=function(){return{}},t._disposeContent=function(e){},t._initContent=function(e,t){},t._createContent=function(e){},t._onUpdate=function(e,t){},t.getCurrentPosition=function(){},t.onUpdate=function(e){if(this._started){var t=(this._timeInms+=e)-this._delayInms;if(this._delaying&&t>=0){this._delaying=!1;var n=this.renderer;this.createContent(),this._initContent(n,this._content),this._items||(this._items=this._createItemsWidthOrder(n)),this._items.forEach((function(e){return e.start()}))}if(!this._delaying){var r=this.endBehavior,i=t/this._durInms,a=!0;if(this._isEnded(t))if(a=!1,this._callEnd||(this._callEnd=!0,this.onEnd()),2!==r){if(this.ended=!0,1===r||3===r?this.renderer.pausePlayer(this):4===r&&(a=!0,i=1),!this.reusable){if(0===r||3===r)return this.destroy();1===r&&(this.endBehavior=2)}i=Math.min(i,1)}else a=!0,this.looping&&(i%=1);a&&this._onUpdate(e,i);var o=this._items;if(o){for(var s=!1,u=0;u<o.length;u++){-1===o[u].onUpdate(e)&&(o[u]=null,s=!0)}s&&(this._items=o.filter((function(e){return e})))}}}},t.destroyItem=function(e){var t,n=null==(t=this._items)?void 0:t.findIndex((function(t){return t.id===e}));n>-1&&(this._items[n].destroy(),this._items.splice(n,1));var r=this.items.findIndex((function(t){return t.id===e}));if(r>-1)return this.items.splice(r,1)[0]},t._isEnded=function(e){return e-this._durInms>.001},t.onEnd=function(){},t.createClickRegions=function(e,t){var n=this._items,r=[];if(n)for(var i=0;i<n.length;i++){var a=n[i]._createClickRegion(t);a&&r.push(a)}return r},t._createClickRegion=function(e){},t._createItemsWidthOrder=function(e){for(var t=[],n=this.items,r=0;r<n.length;r++){for(var i=this.createVFXItem(n[r],e),a=!1,o=i._v_priority,s=t.length-1;s>=0&&!a;s--){o<=t[s]._v_priority&&(t.splice(s+1,0,i),a=!0)}a||t.unshift(i)}return t},e}();i.prototype._v_priority=0},function(e,t,n){"use strict";function r(){return!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)}function i(){return/\b[Aa]ndroid\b/.test(navigator.userAgent)}function a(){return document.createElement("canvas").getContext("webgl")}var o;function s(e,t,n){o||(o=document.createElement("canvas")),o.width=t,o.height=n;var r=o.getContext("2d");return r.clearRect(0,0,t,n),r.fillStyle="rgba(255,255,255,0.008)",r.fillRect(0,0,t,n),r.drawImage(e,0,0,t,n,0,0,t,n),r.getImageData(0,0,t,n)}n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return s}))},function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return c})),n.d(t,"b",(function(){return l}));var r=n(0);function i(e){Object(r.h)(e)&&(e=l(e));for(var t=o(1,1),n=t.data,i=0;i<4;i++)n[i]=e[i];return t}function a(e,t){var n=[];if(Object(r.d)(e,(function(e,r){return n.push({color:l(e,t),stop:f(r)})})),(n=n.sort((function(e,t){return e.stop-t.stop}))).length){0!==n[0].stop&&n.unshift({stop:0,color:n[0].color.slice()});var i=n[n.length-1];1!==i.stop&&n.push({stop:1,color:i.color.slice()})}return n}function o(e,t){return{width:e,height:t,data:new Uint8Array(e*t*4)}}function s(e,t,n){if(e.length){for(var r,i=1;i<=e.length-1;i++){var a=e[i-1],o=e[i];if(a.stop<=t&&t<=o.stop){r=c(a.color,o.color,(t-a.stop)/(o.stop-a.stop));break}}return r||(r=e[e.length-1].color),n?r.map((function(e){return e/255})):r}return[0,0,0,0]}function u(e){var t=o(128,1),n=t.data,r=a(e);if(r.length)for(var i=0;i<128;i++){for(var s=i/128,u=void 0,l=void 0,f=0;f<r.length&&(u=r[f],l=r[f+1],!(u.stop<=s&&l.stop>s));f++);var h=c(u.color,l.color,(s-u.stop)/(l.stop-u.stop));n.set(h,4*i)}return t}function c(e,t,n,r){var i=[],a=1-n;if(r)for(var o=0;o<4;o++)i[o]=e[o]*a+t[o]*n;else{for(var s=0;s<3;s++)i[s]=Math.round(Math.sqrt(e[s]*e[s]*a+t[s]*t[s]*n));i[3]=Math.round(e[3]*a+t[3]*n)}return i}function l(e,t){var n;if(Object(r.h)(e)){e=e.replace(/[\s\t\r\n]/g,"");var i=/rgba?\(([.\d]+),([.\d]+),([.\d]+),?([.\d]+)?\)/.exec(e);if(i){var a=+i[4];n=[+i[1],+i[2],+i[3],isNaN(a)?255:255*a]}else/^#[a-f\d]{3}$/i.test(e)?n=[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),255]:(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))&&(n=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),255]||!1)}else e instanceof Array&&(n=[e[0],e[1],e[2],isNaN(e[3])?255:255*e[3]]);if(t)for(var o=0;o<4;o++)n[o]/=255;return n}function f(e){var t=/^(-)?([\d+.]+)%$/.exec(e);return t?+t[2]/100*(t[1]?-1:1):+e}},function(e,t,n){"use strict";n.d(t,"b",(function(){return m})),n.d(t,"c",(function(){return p})),n.d(t,"a",(function(){return v}));var r=n(0),i=n(1),a=(n(19),n(5)),o=n(33),s=n.n(o),u=n(34),c=n.n(u),l=n(6),f=n(16);function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=a.a.constants;function m(e){var t=e.renderer,n=3===t.blending?0:+t.blending,r=e.cachePrefix||0;return{side:t.side,occlusion:t.occlusion,order:t.order,blending:t.blending,cachePrefix:r,mask:t.mask,maskMode:t.maskMode,shaderCacheId:r+"$$mars_sprite_",cacheId:r+"."+ +t.side+"+"+ +t.occlusion+"+"+n+"+"+parseInt(t.order)+"+"+t.maskMode+"."+t.mask}}var p=8;var v=function(e){var t,n;function o(t,n,r){var i,o=[];r&&o.push("#define PREVIEW_BORDER 1"),o.length&&o.push("\n");var u=o.join("\n"),f={fragmentShader:u+c.a,vertexShader:u+s.a,shaderCacheId:t.shaderCacheId,renderOrder:t.order,engine:n,states:{side:t.side,depthMask:t.occlusion},matrix:a.a.createMatrix4(),samplers:[0,1,2,3,4,5,6,7].map((function(e){return"uSampler"+e})),uniforms:{uViewProjection:"VIEWPROJECTION",uView:"VIEWINVERSE",uModel:"MODEL",uParams:0,uPos:[_.FLOAT_VEC4],uRot:[_.FLOAT_VEC4],uColor:[_.FLOAT_VEC4],uTexParams:[_.FLOAT_VEC4]},attributes:["aPoint","aIndex"]},h=Object(l.h)(t.blending,f.states);return Object(l.i)(t.maskMode,t.mask,f.states),(i=e.call(this,{geometry:a.a.createGeometry({attributes:{aPoint:{size:4},aIndex:{size:1}},index:{size:1},mode:r?a.a.constants.LINES:a.a.constants.TRIANGLES},n),material:a.a.createMaterial(f)},n)||this).setUniformValues({uParams:new Float32Array([0,0,+h,0]),uPos:new Float32Array(32),uRot:new Float32Array(32),uColor:new Float32Array(32),uTexParams:new Float32Array(32)}),i.lineMode=r,i.items=[],i.isSpriteMesh=!0,i.renderCacheId=t.cacheId,i._isDirty=!1,i.maxItemCount=p,i}n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,d(t,n),o.fromItems=function(e,t){var n=new o(e[0].renderInfo,t);return n.setItems(e),n};var u,m,v,y=o.prototype;return y.setItems=function(e){var t=this,n=0,i=0,a=0,o=0,s=[];this.items=e.slice();for(var u=0;u<e.length;u++){var c=e[u],l=this.getItemInitData(c,u,o);n+=l.aIndex.length,i+=l.aPoint.length,a+=l.index.length,s.push(l),o+=l.aPoint.length/4,this.updateItem(c,!0)}for(var f={aIndex:new Float32Array(n),aPoint:new Float32Array(i),index:new Uint16Array(a)},h={aIndex:0,aPoint:0,index:0},d=function(e){var t=s[e];Object(r.d)(f,(function(e,n){var r=t[n];e.set(r,h[n]),h[n]+=r.length}))},_=0;_<s.length;_++)d(_);var m=this.geometry,p=f.index;m.setIndexData(p),m.setAttributeData("aIndex",f.aIndex),m.setAttributeData("aPoint",f.aPoint),m.drawCount=a,e.forEach((function(e,n){t.setUniformValue("uSampler"+n,e.renderer.texture)}))},y.getItemInitData=function(e,t,n){e.__geoData||(e.__geoData=this._getItemGeometryData(e,t));for(var i=this.lineMode?this._getItemGeometryData(e,t):e.__geoData,a=i.index,o=a.length,s=new a.constructor(o),u=0;u<o;u++)s[u]=n+a[u];return{aIndex:Object(r.b)(new Float32Array(i.aPoint.length/4),t),aPoint:i.aPoint,index:s}},y._getItemGeometryData=function(e){var t=e.splits,n=e.renderer;if(n.shape)return n.shape;var r=f.c[n.particleOrigin],i=2,a=2,o=0,s=0;if(1===t.length)i=1,a=1;else{var u=f.a[n.particleOrigin];o=u[0],s=u[1]}for(var c=[],l=[],h=0;h<i;h++)for(var d=0;d<a;d++){var _=2*d+h,m=t[2*d+h],p=m[4]?[0,0,1,0,0,1,1,1]:[0,1,0,0,1,1,1,0],v=((h+h+1)/i-1)/2,g=((d+d+1)/a-1)/2,y=m[0],E=m[1],T=m[4]?m[3]:m[2],x=m[4]?m[2]:m[3],A=[(r[0]+o)/i+v,(r[1]+s)/a+g,(r[2]+o)/i+v,(r[3]+s)/a+g,(r[4]+o)/i+v,(r[5]+s)/a+g,(r[6]+o)/i+v,(r[7]+s)/a+g];c.push(A[0],A[1],p[0]*T+y,p[1]*x+E,A[2],A[3],p[2]*T+y,p[3]*x+E,A[4],A[5],p[4]*T+y,p[5]*x+E,A[6],A[7],p[6]*T+y,p[7]*x+E);var O=4*_;this.lineMode?l.push(O,1+O,1+O,3+O,3+O,2+O,2+O,O):l.push(O,1+O,2+O,2+O,1+O,3+O)}return{index:l,aPoint:c}},y.setItemInitData=function(e,t){var n=this.geometry;n.setAttributeSubData("aIndex",4*t,e.aIndex),n.setAttributeSubData("aPoint",16*t,e.aPoint),n.setIndexSubData(6*t,e.index)},y.getItemRenderData=function(e){var t=this.getItemRegionData(e);if(t){var n=4*this.items.indexOf(e),r=this.getUniformValue("uRot"),i=this.getUniformValue("uColor");return t.rotation=[r[n],r[n+1],r[n+2]],t.color=[i[n],i[n+1],i[n+2],i[n+3]],t}},y.getItemRegionData=function(e){var t=this.items.indexOf(e);if(t>-1){var n=this.getUniformValue("uPos"),r=4*t,i=[n[r]||0,n[r+1]||0,n[r+2]||0],a=4*t+3,o=this.getUniformValue("uRot");return{position:i,width:n[a],height:o[a]}}},y.updateItem=function(e,t){var n=this.items.indexOf(e);if(n>-1){var r;this.calculateGroup&&(r=this.calculateGroup.getRenderData(e.parentId));var a=e.getRenderData(e.time,t||r);r=r||g;var o=Object(i.l)(a.pos,a.pos,r.pos);o&&this.getUniformValue("uPos").set(o,4*n);var s=Object(i.l)(a.rot,a.rot,r.rot);s&&this.getUniformValue("uRot").set(s,4*n);var u=Object(i.o)(a.color,a.color,r.color);u&&this.getUniformValue("uColor").set(u,4*n);var c=Object(i.o)(a.size,a.size,r.size);if(c){var l=4*n+3;this.getUniformValue("uPos")[l]=c[0],this.getUniformValue("uRot")[l]=c[1]}var f=this.getUniformValue("uTexParams");if(t){var h=e.renderer,d=4*n;f[d]=+h.transparentOcclusion,f[d+1]=+(3===h.blending),f[d+2]=h.renderMode,f[d+3]=a.life}else f[4*n+3]=a.life}},y.removeItem=function(e){var t=this.items.indexOf(e);t>-1&&(this.items.splice(t,1),e.__geoData=null,this._isDirty=!0)},y.addItem=function(e){if(this.itemCount<this.maxItemCount){for(var t=0,n=this.items,r=0;r<n.length;r++){if(!(n[r].listIndex<=e.listIndex))break;t++}return this._isDirty=!0,n.splice(t,0,e),t}},y.applyChange=function(){this._isDirty&&(this.setItems(this.items),this._isDirty=!1)},u=o,(m=[{key:"itemCount",get:function(){return this.items.length}},{key:"availableItemCount",get:function(){return p-this.itemCount}},{key:"time",get:function(){return this.getUniformValue("uParams")[0]},set:function(e){this.getUniformValue("uParams")[0]=e}},{key:"listIndexStart",get:function(){return this.items.length?this.items[0].listIndex:-1}},{key:"listIndexEnd",get:function(){var e=this.items.length;return e>0?this.items[e-1].listIndex:-1}}])&&h(u.prototype,m),v&&h(u,v),o}(a.a.Mesh),g={}},function(e,t,n){"use strict";n.r(t),n.d(t,"version",(function(){return A}));var r=n(22),i=n(18),a=n(7);n.d(t,"VFXItem",(function(){return a.a}));var o=n(24);n.d(t,"ParticleSystem",(function(){return o.a}));var s=n(23);n.d(t,"TrailMesh",(function(){return s.a})),n.d(t,"registerPlugin",(function(){return i.c}));var u=n(28);for(var c in u)["default","VFXItem","ParticleSystem","TrailMesh","registerPlugin","setGLStatus","setReporter","MarsPlayer","imageDataFromGradient","createValueGetter","SpriteGroup","SpriteItem","rendererInterface","Composition","getVFXItem","getCompositionByName","loadSceneAsync","registerFilters","registerFilter","version"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(c);var l=n(6);n.d(t,"setMtlBlending",(function(){return l.h})),n.d(t,"setMtlStencil",(function(){return l.i})),n.d(t,"destroyMeshTexture",(function(){return l.f})),n.d(t,"enlargeBuffer",(function(){return l.g})),n.d(t,"convertTextureContainer",(function(){return l.b})),n.d(t,"createEmptyTextureContainer",(function(){return l.d})),n.d(t,"createDataTextureContainer",(function(){return l.c})),n.d(t,"createGradientTextureContainer",(function(){return l.e})),n.d(t,"combineImageTemplateAsync",(function(){return l.a}));var f=n(12);n.d(t,"setGLStatus",(function(){return f.d}));var h=n(20);n.d(t,"setReporter",(function(){return h.c}));var d=n(30);n.d(t,"MarsPlayer",(function(){return d.a}));var _=n(9);n.d(t,"imageDataFromGradient",(function(){return _.e}));var m=n(3);n.d(t,"createValueGetter",(function(){return m.d}));var p=n(29);n.d(t,"SpriteGroup",(function(){return p.a}));var v=n(15);n.d(t,"SpriteItem",(function(){return v.a}));var g=n(5);n.d(t,"rendererInterface",(function(){return g.a}));var y=n(21);n.d(t,"Composition",(function(){return y.a}));var E=n(14);n.d(t,"getVFXItem",(function(){return E.b})),n.d(t,"getCompositionByName",(function(){return E.a})),n.d(t,"loadSceneAsync",(function(){return E.c}));var T=n(17);n.d(t,"registerFilters",(function(){return T.d})),n.d(t,"registerFilter",(function(){return T.c}));var x=n(8);n.d(t,"isiOS",(function(){return x.c})),n.d(t,"isAndroid",(function(){return x.b})),n.d(t,"getGL",(function(){return x.a})),n.d(t,"resizeImage",(function(){return x.d})),Object(i.c)("model",r.b,r.a),console.log("Mars Player version: 0.6.4");var A="0.6.4"},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"d",(function(){return c}));var r,i=n(8),a="compressedTexture",o=function(e){e&&(this.floatTexture=!!e.getExtension("OES_texture_float"),this.halfFloatTexture=!!e.getExtension("OES_texture_half_float"),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.supportWebGL=!0,this[a]=s(e))};function s(e){return Object(i.c)()?e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"):Object(i.b)()?e.getExtension("WEBGL_compressed_texture_astc"):void 0}function u(e){return l()[e]}function c(e,t){return l()[e]=t}function l(){return r||(r=new o(Object(i.a)())),r}},function(e,t,n){"use strict";function r(e){return 0==(e&e-1)&&0!==e}function i(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"c",(function(){return H})),n.d(t,"b",(function(){return G})),n.d(t,"a",(function(){return k}));n(13);var r,i=((r={}).S=["S","B+","A+"],r.A=["A","B+","A+"],r.B=["B","B+"],r);var a=n(8),o=n(17),s=n(12),u=n(6),c=n(1),l=0;function f(e,t,n,r){n=n||2,l=r||0;var i,a,o,s,u,c,f,m=t&&t.length,p=m?t[0]*n:e.length,v=h(e,0,p,n,!0),g=[];if(!v||v.next===v.prev)return g;if(m&&(v=function(e,t,n,r){var i,a,o,s,u,c=[];for(i=0,a=t.length;i<a;i++)o=t[i]*r,s=i<a-1?t[i+1]*r:e.length,(u=h(e,o,s,r,!1))===u.next&&(u.steiner=!0),c.push(A(u));for(c.sort(y),i=0;i<c.length;i++)E(c[i],n),n=d(n,n.next);return n}(e,t,v,n)),e.length>80*n){i=o=e[0],a=s=e[1];for(var T=n;T<p;T+=n)(u=e[T])<i&&(i=u),(c=e[T+1])<a&&(a=c),u>o&&(o=u),c>s&&(s=c);f=0!==(f=Math.max(o-i,s-a))?1/f:0}return _(v,g,n,i,a,f),g}function h(e,t,n,r,i){var a,o;if(i===function(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(a=t;a<n;a+=r)o=P(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=P(a,e[a],e[a+1],o);return o&&S(o,o.next)&&(N(o),o=o.next),o}function d(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!S(r,r.next)&&0!==M(r.prev,r,r.next))r=r.next;else{if(N(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function _(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=x(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,u,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,c*=2}while(o>1)}(i)}(e,r,i,a);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?p(e,r,i,a):m(e))t.push(s.i/n+l),t.push(e.i/n+l),t.push(u.i/n+l),N(e),e=u.next,c=u.next;else if((e=u)===c){o?1===o?_(e=v(d(e),t,n),t,n,r,i,a,2):2===o&&g(e,t,n,r,i,a):_(d(e),t,n,r,i,a,1);break}}}function m(e){var t=e.prev,n=e,r=e.next;if(M(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(O(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&M(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function p(e,t,n,r){var i=e.prev,a=e,o=e.next;if(M(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,c=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,l=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,f=x(s,u,t,n,r),h=x(c,l,t,n,r),d=e.prevZ,_=e.nextZ;d&&d.z>=f&&_&&_.z<=h;){if(d!==e.prev&&d!==e.next&&O(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&M(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,_!==e.prev&&_!==e.next&&O(i.x,i.y,a.x,a.y,o.x,o.y,_.x,_.y)&&M(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;d&&d.z>=f;){if(d!==e.prev&&d!==e.next&&O(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&M(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;_&&_.z<=h;){if(_!==e.prev&&_!==e.next&&O(i.x,i.y,a.x,a.y,o.x,o.y,_.x,_.y)&&M(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function v(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!S(i,a)&&R(i,r,r.next,a)&&I(i,a)&&I(a,i)&&(t.push(i.i/n+l),t.push(r.i/n+l),t.push(a.i/n+l),N(r),N(r.next),r=e=a),r=r.next}while(r!==e);return d(r)}function g(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&b(o,s)){var u=w(o,s);return o=d(o,o.next),u=d(u,u.next),_(o,t,n,r,i,a),void _(u,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function y(e,t){return e.x-t.x}function E(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var u,c=n,l=n.x,f=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&O(a<f?i:o,a,l,f,a<f?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),I(r,e)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&T(n,r)))&&(n=r,h=u)),r=r.next}while(r!==c);return n}(e,t)){var n=w(t,e);d(t,t.next),d(n,n.next)}}function T(e,t){return M(e.prev,e,t.prev)<0&&M(t.next,e,e.next)<0}function x(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function A(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function O(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&R(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(I(e,t)&&I(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(M(e.prev,e,t.prev)||M(e,t.prev,t))||S(e,t)&&M(e.prev,e,e.next)>0&&M(t.prev,t,t.next)>0)}function M(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function S(e,t){return e.x===t.x&&e.y===t.y}function R(e,t,n,r){var i=C(M(e,t,n)),a=C(M(e,t,r)),o=C(M(n,r,e)),s=C(M(n,r,t));return i!==a&&o!==s||(!(0!==i||!L(e,n,t))||(!(0!==a||!L(e,r,t))||(!(0!==o||!L(n,e,r))||!(0!==s||!L(n,t,r)))))}function L(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function C(e){return e>0?1:e<0?-1:0}function I(e,t){return M(e.prev,e,e.next)<0?M(e,t,e.next)>=0&&M(e,e.prev,t)>=0:M(e,t,e.prev)<0||M(e,e.next,t)<0}function w(e,t){var n=new F(e.i,e.x,e.y),r=new F(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function P(e,t,n,r){var i=new F(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function N(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function F(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(e,t){for(var n=0,r=e.s,i=0;i<r.length;i++){n+=r[i].length-1}var a,o=new Float32Array(4*n),s=0,u=t.indexBase||0,l=t.uvTransform,h=0,d=0,_=1,m=1;l&&(h=l[0],d=l[1],a=l[4],_=a?l[3]:l[2],m=a?l[2]:l[3]);for(var p=[],v=0===a?0:-Math.PI/2,g=e.p,y=0;y<r.length;y++)for(var E=r[y],T=g[y],x=g[y+1]||g[0],A=E,O=[],b=0;b<A.length-1;b++){U(O,A[b],T,x,T[4],T[5],x[2],x[3]),S(O[0],O[1])}var M=f(o,null,4,u);return{aPoint:o,index:new Uint16Array(M)};function S(e,t){o[s++]=e/2,o[s++]=t/2,l?(p[0]=e,p[1]=t,Object(c.f)(p,p,v),o[s++]=h+(p[0]+1)/2*_,o[s++]=d+(p[1]+1)/2*m):(o[s++]=(e+1)/2,o[s++]=(t+1)/2)}}function U(e,t,n,r,i,a,o,s){var u=1-t,c=u*u*u,l=3*t*u*u,f=3*t*t*u,h=t*t*t;return e[0]=c*n[0]+l*i+f*o+h*r[0],e[1]=c*n[1]+l*a+f*s+h*r[1],e}var V=n(0),B=(n(5).a.constants,0);function H(e,t){if(t=t||{},Object(V.h)(e))return e=new URL(e,location.href).href,Object(V.n)(e).then(r);if(Object(V.g)(e)){var n=e;return e=location.href,r(n)}return Promise.reject("fail to load scene");function r(n){var r,i=[];if(t.compositions)for(var o=0;o<t.compositions.length;o++){var c=t.compositions[o],l=k(n.compositions,c);if(!l)return Promise.reject("composition not found");i.push(l)}else i=n.compositions;if(n._imgs){r={};for(var f=0;f<i.length;f++)for(var h=i[f].id,d=n._imgs[h],_=0;_<d.length;_++)r[d[_]]=!0}var m=t.useCompressedTexture&&Object(s.b)(s.a);return Promise.all((n.images||[]).map((function(n,i){if(!r||r[i]){if(Object(V.h)(n))return Object(V.i)(new URL(n,e).href);if(Object(V.g)(n)){if(n.url){if(n.template){var o=new URL(n.url,e).href;return Object(u.a)(o,n.template,t.variables,t)}return"video"===n.type?function(e){var t=document.createElement("video");Object(a.b)()&&t.setAttribute("renderer","standard");Object(V.g)(e.url)?t.srcObject=e.url:t.src=e.url;return t.crossOrigin="anonymous",t.muted=!0,t.setAttribute("playsinline","playsinline"),t.play(),new Promise((function(e,n){t.addEventListener("loadeddata",(function n(){e(t),t.removeEventListener("loadeddata",n)}),!0),t.addEventListener("error",(function(e){n(e)}))}))}(n):n.compressed&&m&&(Object(a.c)()?s=n.compressed.iOS:Object(a.b)()&&(s=n.compressed.android),s)?Object(V.n)(new URL(s,e).href,{responseType:"arraybuffer"}):Object(V.i)(new URL(n.url,e).href);var s}if("data"===n.type)return Object(u.c)(n.data,n.options)}}return Promise.resolve(n)}))).then((function(e){return Object(V.k)(n,{compositions:i,_images:n.images,images:z(e,m,t.wrapTexture)})}))}}function z(e,t,n){var r=Object(s.b)("maxTextureSize");return e.map((function(e){if(Object(V.g)(e)){if(e instanceof Image){if(e.width>r||e.height>r){var i=Math.min(r/e.width,r/e.height),o=Math.min(Math.round(e.width*i),r),s=Math.min(Math.round(e.height*i),r);e=Object(a.d)(e,o,s)}if(t)return Object(u.b)(e,{compressed:!0})}return n?Object(u.b)(e):e}}))}function G(e,t,n,r,a){return B=0,function e(t,n,r,a,s){var c=function(e,t){return e.find((function(e){return e.id===t}))}(t,n);if(!c)throw Error("invalid composition id:"+n);var l,f=c.endBehavior,h=r.options?r.options:c.options;h&&(f=h.endBehavior,l=h.looping||5===f);var d=a.renderLevel,_=a.reusable,m=["options","mask"];isNaN(r.mask)&&(r.mask=0);var p=[];a.textures||(a.textures=a.images.map((function(e){return e&&Object(u.b)(e,{dataReleasable:!0})})));var v=a.imageUsage={},g=!a.fixRenderOrder;s=s||0;var y=r.baseRenderOrder||0;return c.items.forEach((function(n){if(!1!==n.visible){var u,c=n.particle||n.config||n.model||n.ui||n.sprite||n.cal||n.content,l=c&&c.options;if(function(e,t){if(!e||!t)return!0;var n=i[t];return!!n&&n.indexOf(e)>-1}(l&&l.renderLevel,d)){var f=n.refId;if(Object(V.f)(f))u=e(t,n.refId,j(n.config,r),a,s+n.delay);else if(n.model){u={model:n.model,duration:n.model.options.duration};var h=n.model.model;h&&Object(V.f)(h.gltf)&&(h.gltf=a.gltf[h.gltf])}else{if(u={},n.particle?u.particle=j(n.particle,r,m):n.sprite?u.sprite=j(n.sprite,r,m):n.cal?u.cal=n.cal:n.content&&(u.content=n.content),n.ui){var v=u.ui=j(n.ui,r,m);!v.options.position&&v.transform&&(v.options.position=v.transform.position),u.duration=n.ui.options.duration,n.particle||(u.particle=null)}var x=u.particle||u.sprite||u.content;if(x){if(x.listIndex=B++,x.renderer){if(x.renderer=E(x.renderer),!x.renderer.mask){var A=x.renderer.maskMode;1===A?x.renderer.mask=++r.mask:2!==A&&3!==A||(x.renderer.mask=r.mask)}var O=x.splits&&x.splits[0];Object(V.f)(x.renderer.shape)?x.renderer.shape=X(a.shapes[x.renderer.shape],O):Object(V.g)(x.renderer.shape)&&(x.renderer.shape=X(x.renderer.shape,O))}else x.renderer={order:0};if(x.trails&&(x.trails=E(x.trails)),x.filter){var b=Object(V.k)({},x.filter);Object(o.b)(b,a.textures).forEach(T),x.filter=b}if(g){var M=n.ro;M&&(x.renderer.order=(x.renderer.order||0)+M)}x.renderer.order?x.renderer.order+=y:x.renderer.order=y}}u.name=n.name,u.delay=n.delay||0,u.id=n.id,u.parentId=n.parentId,u.reusable=_,u.refCount=n.refCount,p.push(u)}}})),{id:c.id,duration:c.duration,name:c.name,endBehavior:f,looping:l,items:p,camera:c.camera,startTime:c.st||0};function E(e){var t=e.texture,n=Object(V.k)({},e);return n._texture=n.texture,n.texture=T(t)||t,n}function T(e){if(Object(V.f)(e)){var t=a.textures[e],n=t.id;return v.hasOwnProperty(n)||(v[n]=0),v[n]++,t}}}(e,t,n||{},r,a)}function k(e,t){return e.find((function(e){return e.name===t}))}function j(e,t,n){e=e||{},t=t||{};var r={},i=Object.keys(e),a=Object.keys(t),o=Object(V.g)(t);return n=n||[],i.forEach((function(i){var s=e[i];if(-1===n.indexOf(i))if(o&&t.hasOwnProperty(i)){var u=t[i];Array.isArray(s)?r[i]=s.map((function(e,t){return e+u[t]})):Object(V.g)(s)?r[i]=j(s,u):r[i]=s+u,Object(V.c)(a,i)}else r[i]=s;else r[i]=s})),a.forEach((function(e){return-1===n.indexOf(e)&&(r[e]=t[e])})),r}function X(e,t){for(var n=[],r=e.gs?e.gs:[e.g],i=0,a=0,o=0,s=0;s<r.length;s++){var u=D(r[s],{indexBase:i,uvTransform:t});i+=u.aPoint.length/4,n.push(u),a+=u.aPoint.length,o+=u.index.length}if(1===n.length)return n[0];for(var c=new Float32Array(a),l=new Uint16Array(o),f=0,h=0,d=0;f<n[f];f++){var _=n[f];c.set(_.aPoint,h),h+=_.aPoint.length,l.set(_.index,d),d+=_.index.length}return{aPoint:c,index:l}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(9),i=n(3),a=n(10),o=n(6),s=n(1),u=n(16);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=[[0,0,1,1]],f=function(){function e(e,t){var n=e.options||{};this.options={startSpeed:n.startSpeed||0,startSize:n.startSize||1,sizeAspect:n.sizeAspect||1,startColor:Object(i.d)(n.startColor).getValue(0)||[1,1,1,1],startDelay:n.startDelay||0,duration:n.duration||0,looping:!!n.looping,gravity:Object(s.a)(n.gravity),gravityModifier:n.gravityModifier&&Object(i.d)(n.gravityModifier),direction:n.direction?Object(s.q)(n.direction.slice()):Object(s.a)(),endBehavior:n.endBehavior||0};var u=e.transform||{},c=Object(s.a)(u.rotation);n.startRotation&&(c[2]+=n.startRotation||[0]),this.transform={position:Object(s.a)(u.position),rotation:c,path:u.path&&Object(i.d)(u.path)};var f=e.renderer||{};this.interaction=e.interaction,this.renderer={renderMode:f.renderMode||0,particleOrigin:f.particleOrigin||0,blending:f.blending||0,texture:(f.texture||Object(o.d)()).init(t.engine),order:f.order||0,occlusion:!!f.occlusion,transparentOcclusion:!!f.transparentOcclusion||1===f.maskMode,side:f.side||1032,shape:f.shape,mask:f.mask||0,maskMode:f.maskMode||0};var h=e.colorOverLifetime;h&&(this.opacityOverLifetime=h.hasOwnProperty("opacity")&&Object(i.d)(h.opacity),this.colorOverLifetime=h.color&&Object(r.a)(Object(i.e)(h.color)));var d=e.sizeOverLifetime;d&&(d.separateAxes?(this.sizeSeparateAxes=!0,this.sizeXOverLifetime=Object(i.d)(d.x),this.sizeYOverLifetime=Object(i.d)(d.y)):this.sizeXOverLifetime=Object(i.d)(d.size));var _=e.velocityOverLifetime;_&&(this.linearVelOverLifetime={x:_.linearX&&Object(i.d)(_.linearX),y:_.linearY&&Object(i.d)(_.linearY),z:_.linearZ&&Object(i.d)(_.linearZ),asMovement:_.asMovement,enabled:_.linearX||_.linearY||_.linearZ},this.orbitalVelOverLifetime={x:_.orbitalX&&Object(i.d)(_.orbitalX),y:_.orbitalY&&Object(i.d)(_.orbitalY),z:_.orbitalZ&&Object(i.d)(_.orbitalZ),center:Object(s.a)(_.orbCenter),asRotation:_.asRotation,enabled:_.orbitalX||_.orbitalY||_.orbitalZ},this.speedOverLifetime=_.speedOverLifetime&&Object(i.d)(_.speedOverLifetime));var m=e.rotationOverLifetime;if(m){var p=this.rotationOverLifetime={asRotation:m.asRotation,separateAxes:m.separateAxes,z:Object(i.d)(m.separateAxes?m.z:m.angularVelocity)};m.separateAxes&&(p.x=Object(i.d)(m.x||0),p.y=Object(i.d)(m.y||0))}this._time=0,this._maxTime=this.options.duration+this.options.startDelay,this.gravityModifier=this.options.gravityModifier,this.splits=e.splits||l,this.listIndex=e.listIndex||0,t&&(this.cachePrefix=t.cachePrefix,this.parentId=t.parentId,this.reusable=t.reusable,this.name=t.name),this._renderInfo=Object(a.b)(this),this.delay=t&&t.delay||0}var t,n,f,h=e.prototype;return h.willTranslate=function(){var e="_willTranslate";if(!this.hasOwnProperty(e)){var t=this.linearVelOverLifetime;if(t&&t.enabled)return this[e]=!0;var n=this.orbitalVelOverLifetime;if(n&&n.enabled)return this[e]=!0;var r=this.options;return r.gravityModifier&&!Object(s.c)(r.gravity)||r.startSpeed&&!Object(s.c)(r.direction)?this[e]=!0:this[e]=!1}return this[e]},h.updateTime=function(e){var t=e-this.delay,n=this.options.duration;if(t>=this._maxTime&&this.options.looping){for(var r=t-this._maxTime;r>n;)r-=n;this._time=r}else{var i=4===this.options.endBehavior;this._time=i?Math.min(this._maxTime,t):t}},h.stop=function(){this._time=this._maxTime},h._getTextures=function(){var e=[],t=this.renderer.texture;return t&&e.push(t),e},h.getRenderData=function(e,t){var n,i,a,o=this.options,c=[1,1],l=[0,0,0],f=[1,1,1,1],h=e<0?e:Math.max(e-o.startDelay,0),d=h/o.duration,_={life:d},m=this.transform;d=d<0?0:d>1?1:d,this.sizeXOverLifetime&&(c[0]=this.sizeXOverLifetime.getValue(d),this.sizeSeparateAxes?c[1]=this.sizeYOverLifetime.getValue(d):c[1]=c[0],n=!0),(n||t)&&(_.size=[o.startSize*c[0],o.startSize/o.sizeAspect*c[1]]);var p=this.rotationOverLifetime;if(p){var v=function(e){return p.asRotation?e.getValue(d):e.getIntegrateValue(0,d)},g=v(p.z),y=p.separateAxes;l=[y?v(p.x):0,y?v(p.y):0,g],i=!0}(i||t)&&(_.rot=m.rotation.map((function(e,t){return e+l[t]})));var E=this.opacityOverLifetime,T=this.colorOverLifetime;return T&&(f=Object(r.c)(T,d,!0),a=!0),E&&(f[3]*=E.getValue(d),a=!0),(a||t)&&(_.color=o.startColor.map((function(e,t){return e*f[t]}))),(this.willTranslate()||t)&&(_.pos=Object(u.b)(this,o.gravity,h,o.duration,m.position,this.velocity)),m.path&&(_.pos||(_.pos=m.position.slice()),Object(s.k)(_.pos,_.pos,m.path.getValue(d))),_},t=e,(n=[{key:"renderInfo",get:function(){return this._renderInfo}},{key:"isSpriteItem",get:function(){return!0}},{key:"ended",get:function(){return this._time>this._maxTime&&!this.options.looping&&!this.reusable}},{key:"time",get:function(){return this._time}},{key:"velocity",get:function(){return this._velocity||(this._velocity=Object(s.p)([],this.options.direction,this.options.startSpeed)),this._velocity}}])&&c(t.prototype,n),f&&c(t,f),e}()},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return u}));var r,i,a=n(1);function o(e,t,n,r,i,o,s){var u=[],c=n/r,l=n,f=e.speedOverLifetime;f&&(l=f.getIntegrateValue(0,n,r));var h=e.gravityModifier?e.gravityModifier.getIntegrateByTime(0,n):0;s=s||0;for(var d=0;d<3;d++)u[d]=i[s+d]+o[s+d]*l+t[d]*h;var _=e.linearVelOverLifetime||{},m=e.orbitalVelOverLifetime||{},p=["x","y","z"];if(m.enabled){var v=m.center||[0,0,0],g=[u[0]-v[0],u[1]-v[1],u[2]-v[2]],y=m.asRotation,E=Object(a.h)(g,g,Object(a.d)(p.map((function(e){var t=m[e];return t?.017453292519943295*(y?t.getValue(c):t.getIntegrateValue(0,n,r)):0}))));u=Object(a.k)(u,v,E)}if(_.enabled)for(var T=_.asMovement,x=0;x<3;x++){var A=_[p[x]];A&&(u[x]+=T?A.getValue(c):A.getIntegrateValue(0,n,r))}return u}var s=((r={})[0]=c(0,0),r[5]=c(0,.5),r[4]=c(0,-.5),r[1]=c(.5,-.5),r[2]=c(.5,0),r[3]=c(.5,.5),r[7]=c(-.5,0),r[8]=c(-.5,.5),r[6]=c(-.5,-.5),r),u=((i={})[0]=[0,0],i[5]=[0,.5],i[4]=[0,-.5],i[1]=[.5,-.5],i[2]=[.5,0],i[3]=[.5,.5],i[7]=[-.5,0],i[8]=[-.5,.5],i[6]=[-.5,-.5],i);function c(e,t){for(var n=[-.5,.5,-.5,-.5,.5,.5,.5,-.5],r=0;r<8;r+=2)n[r]+=e,n[r+1]+=t;return n}},function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l}));var r=n(0),i=n(3),a=n(6),o={};function s(e,t){o[e]=t}function u(e){Object(r.d)(e,(function(e,t){return s(t,e)}))}function c(e,t){var n=o[e.name],i=[];return n&&Object(r.d)(n.textures,(function(n){var a=n.src,o=e[a];Object(r.f)(o)&&(e[a]=t[o],Object(r.a)(i,o))})),i}function l(e,t,n,s){var u=o[e.name];if(!u)throw Error("invalid filter name:"+e.name);var c={},l={},f=u.vertex||{program:"void main_filter(float l){}"},h=[],d={vertex:f.program,fragment:u.fragment.program,uniforms:c,data:l,name:e.name,samplers:h};return _(u.fragment.variables,t),_(f.variables,n),Object(r.d)(u.uniforms,(function(t,n){var a;if(Object(r.e)(t))a=t(e);else if(Object(r.g)(t)){var o=e[t.name],s=t.enum;s&&(a=s[o]),void 0===a&&(a=t.default)}else a=Object(i.e)(e[t]);if(a===+a)l[n]=a;else{if(!Object(r.g)(a)||!Object(r.e)(a.slice))throw Error("invalid value for:"+n+"->"+t);l[n]=a.slice()}c[n]=0})),Object(r.d)(u.textures,(function(t,n){var i=e[t.src],o=(i?Object(a.b)(i):Object(a.d)()).init(s);Object(r.e)(t.processTexture)&&t.processTexture(e,o),l[n]=o,h.push(n)})),d;function _(t,n){Object(r.d)(t,(function(t,r){var a=e[t[0]];void 0===a&&(a=t[1]),l[r]=Object(i.d)(a).toUniform(n),c[r]=0}))}}},function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u}));var r=n(7),i={},a={};function o(e,t,n){a[e]=n,i[e]=t}function s(e){var t=i[e];if(!t)throw Error("plugin "+e+" no registered loader");return new t}var u=function(){function e(e){this.loaders=e}var t=e.prototype;return t.initializeComposition=function(e,t){this.loaders.forEach((function(n){return n.onCompositionInitialized(e,t)}))},t.destroyComposition=function(e){this.loaders.forEach((function(t){return t.onCompositionDestroyed(e)}))},t.createPluginItem=function(e,t,n){var i=a[e];if(!i)throw Error("plugin "+e+" no registered constructor");var o=new i(t,n);if(!(o instanceof r.a))throw Error("plugin "+e+" invalid constructor type");return o},t.loadResourcesAsync=function(e,t,n){var r=this;return Promise.all(this.loaders.map((function(r){return r.prepareResourceAsync(e,t,n)}))).catch((function(e){throw r.unloadResources(n),e}))},t.unloadResources=function(e){this.loaders.forEach((function(t){return t.destroy(e)})),this.loaders=[]},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(1),i=(n(27),function(){function e(){this.items=[],this._itemMap={},this.time=0}var t=e.prototype;return t.getRenderData=function(e){var t=this._itemMap[e];return t?t.renderData:null},t.combineRenderData=function(e,t){return{rot:Object(r.l)(e.rot,e.rot,t.rot),pos:Object(r.l)(e.pos,e.pos,t.pos),color:Object(r.o)(e.color,e.color,t.color),size:Object(r.o)(e.size,e.size,t.size)}},t._onUpdate=function(e){var t=this;this.time+=e/1e3,this.items.forEach((function(n){return n._onUpdate(e,t)}))},t.addItem=function(e){if(e.parentId){var t=this._itemMap[e.parentId],n=this.items.indexOf(t);this.items.splice(n+1,0,e)}else this.items.push(e);var r=e.id;this._itemMap[r]=e},t._removeItemRef=function(e){var t=this._itemMap[e];if(t&&0===--t.refCount){delete this._itemMap[e];var n=this.items.indexOf(t);return this.items.splice(n,1),t}},t.removeItemRef=function(e){var t=this._removeItemRef(e);t&&t.parentId&&this._removeItemRef(t.parentId)},e}())},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return o}));var r,i=1;function a(e){r=e}function o(e,t){r&&r(e,t),console.error("report error:"+e+"\n"+JSON.stringify(t||{}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return L}));var r=n(19),i=n(26),a=n(11),o=n(6),s=n(10),u=n(0),c=n(7);function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=Math.round,h=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n);var i=r.prototype;return i._onCreate=function(t){e.prototype._onCreate.call(this,t);var n=this.endBehavior;5!==n&&1!==n&&3!==n||(this._freezeOnEnd=!0),this._startTimeInms=f(1e3*(this.startTime||0))},i.getUpdateTime=function(e){var t=this._startTimeInms,n=this._timeInms;if(e<0&&n+e<t)return t-n;if(this._freezeOnEnd){var r=this._durInms-n;if(r<e)return r}return f(e)},i._isEnded=function(e){return e>=this._durInms},r}(c.a),d=n(27);function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,_(t,n);var i=r.prototype;return i._onCreate=function(e){var t=e.cal.options;this.endBehavior=t.looping?2:t.endBehavior||0,this.duration=t.duration},i._createContent=function(e){var t=e.getParticleOptions();return t.parentId=this.parentId,t.id=this.id,t.refCount=this.refCount,t.reusable=this.reusable,t.delay=this.delay,new d.a(this.cal,t)},i.getCurrentPosition=function(){return this._content.renderData.pos},i._initContent=function(e,t){var n=this.cal;if(n.addition&&n.addition.showPreview){var r=e.getParticleOptions(),i=this._previewContent=new a.SpriteItem(n,r);i.options.startSize=n.addition.startSize||.1,n.addition.borderColor&&(i.options.startColor=n.addition.borderColor),i.parentId=this.parentId,e.addRenderNode(i)}e.calculateGroup.addItem(t)},i._disposeContent=function(e,t){t&&e.calculateGroup.removeItemRef(t.id),this._previewContent&&e.destroyRenderNode(this._previewContent)},r}(c.a);function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}m.prototype._v_priority=1;var v=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,p(t,n);var i=r.prototype;return i._onCreate=function(e){this.endBehavior=this.ui.options.endBehavior||0,this.duration=this.ui.options.duration,this._particleDestroyed=!0},i._initContent=function(e,t){var n=this.ui,r=n.options,i=n.transform?n.transform.position:r.position;if(r.position=i,this._uid=this.renderer.addInteractiveItem(this,r),r.showPreview&&"click"===r.type){var o=e.getParticleOptions();o.parentId=this.parentId,o.name="preview:"+this.name;var s=this._previewContent=new a.SpriteItem({options:{startSize:r.width,sizeAspect:r.width/r.height,startColor:r.previewColor,duration:r.duration},renderer:{order:r.renderOrder||999},transform:{position:i}},o);e.addRenderNode(s),this._previewContent=s}},i._disposeContent=function(e,t){e.removeInteractiveItem(this,this.ui.options.type),this._uid=0,this._previewContent&&e.destroyRenderNode(this._previewContent)},i.getCurrentPosition=function(){},i._createClickRegion=function(e,t){var n=this.ui;if(!this._region){var r=n.options,i=(n.transform?n.transform.position:r.position)||[0,0,0];this._region={name:this.name,id:this.id,parentId:this.parentId,width:r.width,height:r.height,position:i,behavior:r.behavior||0}}return this._region},r}(c.a),g=n(22),y=n(24);function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x=function(e){var t,n;function r(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this)._destroyParticleItem=function(e){t.renderer.destroyRenderNode(e),t._particleDestroyed=!0},t}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,T(t,n);var i,a,o,s=r.prototype;return s._onCreate=function(e){var t=e.particle.options;this.endBehavior=t.looping?2:t.endBehavior||0,this.duration=t.duration,this.parentId=e.parentId},s._initContent=function(e,t){return t&&(t.name=this.name,t.start(),t._onDestroy=this._destroyParticleItem,e.addRenderNode(t),this._region={delegate:this,id:this.id,name:this.name,parentId:this.parentId,behavior:0}),t},s.getCurrentPosition=function(){return this._content.getPosition()},s._createClickRegion=function(e){var t=this.particle,n=this._region;if((t.interaction||e)&&n)return n.mode=e||t.interaction.mode,n},s.hitTest=function(e){var t=e.camera,n=this.particle.interaction||{radius:.4},r=1===this._region.mode;return this._content.raycast({bound:r&&{matrix:e.camera.viewProjection,inRect:e.inRect},multiple:n.multiple,removeParticle:1===n.behavior,ray:!r&&{center:t.position,direction:t.direction,radius:n.radius}})},s.stopParticleEmission=function(){this._content&&(this._content.emissionStopped=!0),this._items&&this._items.forEach((function(e){return e.stopParticleEmission&&e.stopParticleEmission()}))},s.resumeParticleEmission=function(){this._content&&(this._content.emissionStopped=!1),this._items&&this._items.forEach((function(e){return e.resumeParticleEmission&&e.resumeParticleEmission()}))},s._precompile=function(){var e=this.createContent();if(e)return{particleMesh:e.particleMesh,trailMesh:e.trailMesh}},s._createContent=function(e){if(this.particle){var t=e.getParticleOptions();return t.reusable=this.reusable,new y.a(this.particle,t)}},s._disposeContent=function(e,t){t&&e.destroyRenderNode(t),e.calculateGroup.removeItemRef(this.parentId)},s._isEnded=function(t){return e.prototype._isEnded.call(this,t)&&this._particleDestroyed},s._onUpdate=function(e,t){if(this._content){if(this.parentId){var n=this.renderer.calculateGroup.getRenderData(this.parentId);n&&(this._content.parentTransform=n)}this._content._onUpdate(e)}},i=r,(a=[{key:"type",get:function(){return 2}}])&&E(i.prototype,a),o&&E(i,o),r}(c.a),A=n(15);function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var M=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,b(t,n);var i,a,o,u=r.prototype;return u._onCreate=function(e){var t=e.sprite.options;this.endBehavior=t.looping?2:t.endBehavior||0,this.duration=t.duration},u._createContent=function(e){var t=e.getParticleOptions();return t.parentId=this.parentId,t.reusable=this.reusable,t.delay=this.delay,t.name=this.name,new A.a(this.sprite,t)},u._initContent=function(e,t){e.addRenderNode(t)},u._disposeContent=function(e,t){t&&e.destroyRenderNode(t)},u._precompile=function(){this.createContent();var e=this._content.renderInfo;return{spriteItem:e,createMesh:function(t){return new s.a(e,t)}}},u.createSpriteMesh=function(e,t){var n=new s.a(e,this.renderer.getParticleOptions().engine,t);return n.calculateGroup=this.renderer.calculateGroup,n},u.getCurrentRenderData=function(){var e=this._content;if(e){var t=this.renderer._spriteItemGroup;if(t){var n=t.getSpriteMesh(e);if(n)return n.getItemRenderData(e)}}},u.getCurrentPosition=function(){var e=this._content;if(e){var t,n=this.renderer._spriteItemGroup;if(n){var r=n.getSpriteMesh(e);if(r)return r.getItemRegionData(e).position}return(null==(t=e.transform)?void 0:t.position)||[0,0,0]}},u._createClickRegion=function(e){var t=this._content;if(t){var n=this.renderer._spriteItemGroup;if(n&&(e||t.interaction)){var r=n.getSpriteMesh(t);if(r){var i,a=r.getItemRegionData(t);return{id:this.id,name:this.name,position:a.position,behavior:(null==(i=t.interaction)?void 0:i.behavior)||0,width:a.width,height:a.height}}}}},i=r,(a=[{key:"type",get:function(){return 1}}])&&O(i.prototype,a),o&&O(i,o),r}(c.a);function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}c.a.prototype.createVFXItem=function(e,t){if(e.ui)return new v(e,t);if(e.particle)return new x(e,t);if(e.sprite)return new M(e,t);if(e.model)return new g.a(e,t);if(e.cal)return new m(e,t);if(e.content)return t.pluginSystem.createPluginItem(e.content.options.type,e,t);return new c.a(e,t)};var R=1,L=function(){function e(e){this.renderer=e.renderer,this.speed=e.speed||1,this._reset(),this._texInfo=e.imageUsage||{},this._textures=e.textures,this.pluginSystem=e.pluginSystem,this.emissionDelegate=e.emissionDelegate;var t=new h(e.content,this);!1!==e.precompile&&(this._precompiled=this.renderer.precompile(t)),this.keepResource=e.keepResource,Object(u.e)(e.pausePlayer)&&(this.pausePlayer=e.pausePlayer),this.onMessageItem=e.onMessageItem||u.j,this.autoRefTex=!e.keepResource&&e.imageUsage&&5!==t.endBehavior,this._content=t;var n=e.onEnd;if(Object(u.e)(n)){var r=this;t.onEnd=function(){setTimeout((function(){n(r)}),0)}}this.pluginSystem&&this.pluginSystem.initializeComposition(this,e.scene)}var t,n,s,c=e.prototype;return c._reset=function(){var e=this,t=this.renderer.getParticleOptions().engine;this._clickHandler=new i.a((function(){return e.renderer.getViewProjection()})),this._spriteItemGroup&&(this._spriteItemGroup.removeAll(),this.renderer.destroyNode(this._spriteItemGroup));var n=this._spriteItemGroup=new a.SpriteGroup({delegate:this},t);this.calculateGroup=this._clickHandler.calculateGroup=n.calculateGroup=new r.a,this.sceneNode&&this.renderer.setRootNode(null);var o=this.sceneNode=a.rendererInterface.createNode({name:"root"+R++},t);o.addChild(n),this._rootNode=o},c.forwardTime=function(e){var t=parseInt(1e3*e);if(t){for(var n=t<0,r=Math.abs(t),i=n?-15:15;r>15;r-=15)this.tick(i);if(r>0){var a=n?-r:r;this.tick(a)}}},c.restart=function(){this._reset(),this.start(),this._content.reset().start(),this.forwardTime(this.startTime)},c.start=function(){this.renderer.setRootNode(this._rootNode)},c._startContent=function(){this._content.start()},c.tick=function(e){var t,n=this._content,r=n.getUpdateTime(e*this.speed),i=this._textures;(i&&i.forEach((function(e){return e.updateVideo&&e.updateVideo()})),this.calculateGroup._onUpdate(r),n.onUpdate(r),this._spriteItemGroup._onUpdate(r),this._content.ended)||(null==(t=this.renderer.parent)||t.invalid())},c.getParticleOptions=function(){if(!this._particleOptions){var e=this._particleOptions=this.renderer.getParticleOptions();e.renderer=this,e.emptyTextureContainer=Object(o.d)(),e.emissionDelegate=this.emissionDelegate}return this._particleOptions},c.hitTest=function(e,t,n,r){var i=this.renderer;if(i){var a=this._clickHandler,o=this._content.createClickRegions(a,n);return a.findRegions(o,e,t,i.camera.position,i.getViewProjection(),r)}return[]},c.addInteractiveItem=function(e,t){if("message"===t.type)return this.onMessageItem({name:e.name,phrase:2,id:e.id}),e.id},c.removeInteractiveItem=function(e,t){"message"===t&&this.onMessageItem({name:e.name,phrase:1,id:e.id})},c.addRenderNode=function(e){e.isSpriteItem?this._spriteItemGroup.addItem(e):this._rootNode.addChild(e)},c.pausePlayer=function(){},c.onSpriteMeshDestroy=function(e){this.destroyRenderNode(e)},c.destroyTextures=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n){if(n.isDataTexture){this.renderer.destroyTexture(n);continue}if(this.autoRefTex){var r=--this._texInfo[n.id];r||(isNaN(r),this.renderer.destroyTexture(n))}}}},c.onSpriteRemoved=function(e){e&&(e.parentId&&this.calculateGroup.removeItemRef(e.parentId),this.destroyTextures(e._getTextures()))},c.createRenderNode=function(e){return this.renderer.createRenderNode(e)},c.destroyRenderNode=function(e){var t;e&&(e.isSpriteItem?this._spriteItemGroup.removeItem(e):(e.isParticleSystem&&this.destroyTextures(e._getTextures()),this.renderer.destroyNode(e)),null==(t=this.renderer.parent)||t.invalid())},c.destroyItem=function(e,t){var n=this;this._content.destroyItem(e)&&t.children&&this._content.items.filter((function(t){return t.parentId===e})).forEach((function(e){return n.destroyItem(e.id,t)}))},c.destroy=function(){var e=this.renderer;e&&(this._content.destroy(),this._spriteItemGroup.destroy(),this.keepResource||(this._textures&&this._textures.forEach((function(t){return e.destroyTexture(t)})),this._textures=null,e.destroyPrecompiled(this._precompiled)),this._particleOptions&&e.destroyTexture(this._particleOptions.emptyTextureContainer),this.pluginSystem&&this.pluginSystem.destroyComposition(this),e.destroy(),this.tick=C,this.pausePlayer=u.j,this.renderer=null)},t=e,(n=[{key:"camera",get:function(){return this._content.camera},set:function(e){this.renderer.camera=e}},{key:"name",get:function(){return this._content.name}},{key:"time",get:function(){return this._content._timeInms/1e3}},{key:"shouldDestroy",get:function(){var e=this._content;return e.ended&&(!e.endBehavior||3===e.endBehavior)}},{key:"startTime",get:function(){return this._content.startTime||0}},{key:"shouldRestart",get:function(){var e=this._content;return e.ended&&5===e.endBehavior}}])&&S(t.prototype,n),s&&S(t,s),e}();function C(){console.error("update disposed composition")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return h}));var r=function(){function e(e,t){this.item=t,this._onCreate(e)}var t=e.prototype;return t._onCreate=function(e){},t.onItemUpdate=function(e){},e}(),i=n(3),a=n(1);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n);var u,c,l,f=r.prototype;return f._onCreate=function(e){var t=e.transform||{},n=e.options;if(!n.type){var r=e.camera;e.transform||(e.transform={}),r?(n.type=1,["far","near","fov"].forEach((function(t){r[t]&&(n[t]=r[t]),e.transform.position=r.position,e.transform.rotation=r.rotation})),e.velocityOverLifetime={translateX:r.translateX,translateY:r.translateY,translateZ:r.translateZ}):console.error("incompatible model")}if(this.type=n.type,this.options={position:t.position||[0,0,0],rotation:t.rotation||[0,0,0],startSize:n.startSize||1,near:Object(i.d)(n.near),far:Object(i.d)(n.far),fov:Object(i.d)(n.fov)},e.velocityOverLifetime||t.path){var a=e.velocityOverLifetime||{};this.translateOverLifetime={path:t.path&&Object(i.d)(t.path),x:Object(i.d)(a.translateX||0),y:Object(i.d)(a.translateY||0),z:Object(i.d)(a.translateZ||0)}}var o=e.rotationOverLifetime;o&&(this.rotationOverLifetime={separateAxes:o.separateAxes,x:Object(i.d)(o.rotateX||0),y:Object(i.d)(o.rotateY||0),z:Object(i.d)(o.rotateZ||0),rotation:Object(i.d)(o.rotation)});var s=e.sizeOverLifetime;s&&(this.sizeOverLifetime={separateAxes:s.separateAxes,x:Object(i.d)(s.x||1),y:Object(i.d)(s.y||1),z:Object(i.d)(s.z||1),size:Object(i.d)(s.size||1)})},f.onEnd=function(e){this.onItemUpdate(1,e)},f.onItemUpdate=function(e,t){var n=this.options,r=new Float32Array(n.position),i=new Float32Array(n.rotation),o=n.startSize,s=this.target;if(e<0)s&&(s.visible=!1);else if(e>=1)s&&(s.visible=4===this.endBehavior);else{var u=this.translateOverLifetime;u&&(r[0]+=u.x.getValue(e),r[1]+=u.y.getValue(e),r[2]+=u.z.getValue(e),u.path&&Object(a.k)(r,r,u.path.getValue(e)));var c=this.rotationOverLifetime;if(c)if(c.separateAxes)i[0]+=c.x.getValue(e),i[1]+=c.y.getValue(e),i[2]+=c.z.getValue(e);else{var l=c.rotation.getValue(e);i[0]+=l,i[1]+=l,i[2]+=l}if(2===this.type){s&&(s.visible=!0);var f=this.sizeOverLifetime;if(f)if(f.separateAxes)s.setScale(f.x.getValue(e)*o,f.y.getValue(e)*o,f.z.getValue(e)*o);else{var h=f.size.getValue(e)*o;s.setScale(h,h,h)}else s.setScale(o,o,o);s.setPosition(r[0],r[1],r[2]),s.setRotation(-i[0],-i[1],-i[2])}else if(1===this.type){var d=this.options.far.getValue(e),_=this.options.near.getValue(e),m=this.options.fov.getValue(e);return t.camera={near:_,far:d,fov:m,position:r,rotation:i}}}this.position=r},u=r,(c=[{key:"target",get:function(){return this._target},set:function(e){this._target=e}}])&&o(u.prototype,c),l&&o(u,l),r}(r),c=n(0);function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n);var i=r.prototype;return i._onCreate=function(e){var t=e.model.options;this.endBehavior=t.endBehavior||0,this.duration=t.duration,this.looping=t.looping},i._createContent=function(e){var t=this.model;if(t&&!this.delegate){var n=t.options.type;if(2===n){var r=this._modelNode||this._createNode(e);return this.delegate=new u(t,e.getParticleOptions()),r&&(r.name=this.name,e.addRenderNode(r),this.delegate.target=r),this.delegate.endBehavior=this.endBehavior,r}1===n&&(this.delegate=new u(t,e.getParticleOptions()))}},i.getCurrentPosition=function(){return this.delegate.position},i._createNode=function(e){var t,n=this.model;if(2===(null==n||null==(t=n.options)?void 0:t.type))return this._modelNode=e.createRenderNode(Object(c.k)({name:this.name},n.options))},i._precompile=function(){return this._createNode(this.renderer),{}},i._disposeContent=function(e,t){t&&e.destroyRenderNode(t)},i.onEnd=function(){var e;null==(e=this.delegate)||e.onEnd(this.renderer),this._callEnd=!1},i._onUpdate=function(e,t){this.delegate&&this.delegate.onItemUpdate(t,this.renderer)},r}(n(7).a),h=function(){function e(){}var t=e.prototype;return t.prepareResourceAsync=function(e,t,n){if(!n.loadGLTFFilesAsync)throw Error("RI not support 3d Model");return n.loadGLTFFilesAsync(e.gltf||[])},t.onCompositionInitialized=function(e,t){},t.onCompositionDestroyed=function(e){},t.destroy=function(e){},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var r=n(12),i=n(32),a=n.n(i),o=n(25),s=n.n(o),u=n(6),c=n(1),l=n(3),f=n(5);function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){var t,n;function i(t,n){var i,o=Object(l.c)(),c=Object(r.b)("maxVertexTextures")>0?"#define ENABLE_VERTEX_TEXTURE 1\n":"",h=0,d={};t.colorOverLifetime&&(c+="#define COLOR_OVER_LIFETIME\n",h|=1,d.uColorOverLifetime=Object(u.e)(t.colorOverLifetime).init(n)),t.colorOverTrail&&(c+="#define COLOR_OVER_TRAIL\n",h|=4,d.uColorOverTrail=Object(u.e)(t.colorOverTrail).init(n));var _=t.maxTrailCount>64;_?(c+="#define ATTR_TRAIL_START 1\n",h|=8):t.uTrailStart=new Float32Array(t.maxTrailCount);var m=t.opacityOverLifetime||Object(l.d)(1);t.uOpacityOverLifetimeValue=m.toUniform(o);var p=t.widthOverTrail.toUniform(o);c+="#define CURVE_VALUE_COUNT "+o.index+"\n",c+="#define MAX_KEY_FRAME_COUNT "+o.max+"\n",o.lineSegCount&&(c+="#define USE_LINE_SEG\n"),o.curveCount&&(c+="#define USE_CURVE_VALUE\n");var v=Math.max(t.pointCountPerTrail,2),g={vertexShader:c+a.a,fragmentShader:c+s.a,renderOrder:t.order,shaderCacheId:t._shaderCachePrefix+":t+"+h+"+"+o.index+"+"+o.max,states:{depthMask:t.occlusion,cullFace:!1},samplers:["uMaskTex","uColorOverLifetime","uColorOverTrail"],uniforms:{uModel:0,uViewProjection:"VIEWPROJECTION",uView:"VIEW",uParams:0,uColorParams:0,uTime:0,uWidthOverTrail:0,uOpacityOverLifetimeValue:0,uTrailStart:0,uTextureMap:0,uVCurveValues:[f.a.constants.FLOAT_VEC4],uFCurveValues:[f.a.constants.FLOAT_VEC4]},engine:n,attributes:["aPos","aDir","aInfo","aColor","aTrailStart","aTrailStartIndex","aSeed"]},y=v*t.maxTrailCount*2,E={attributes:{aPos:{size:4,data:4*y},aDir:{size:3,data:3*y},aInfo:{size:4,data:4*y},aColor:{size:4,data:4*y},aSeed:{size:1,data:y}},index:{size:1,data:6*y},drawCount:6*((v-1)*t.maxTrailCount),combineSubData:!0};if(_)E.attributes.aTrailStart={size:1,data:new Float32Array(y)};else{var T=new Float32Array(y);E.attributes.aTrailStartIndex={size:1,data:T};for(var x=0;x<t.maxTrailCount;x++)for(var A=2*v,O=x*A,b=0;b<A;b++)T[O+b]=x}var M=Object(u.h)(t.blending,g.states);return Object(u.i)(t.maskMode,t.mask,g.states),(i=e.call(this,{material:f.a.createMaterial(g),geometry:f.a.createGeometry(E,n),maxTrailCount:t.maxTrailCount,pointCountPerTrail:v,checkVertexDistance:t.minimumVertexDistance>0,minimumVertexDistance:Math.pow(t.minimumVertexDistance||.001,2),lifetime:t.lifetime,useAttributeTrailStart:_},n)||this).setUniformValues(d),i.setUniformValues({uTime:0,uModel:f.a.createMatrix4().elements,uWidthOverTrail:p,uView:"VIEWINVERSE",uVCurveValues:l.a.getAllData(o),uOpacityOverLifetimeValue:t.uOpacityOverLifetimeValue,uTrailStart:t.uTrailStart,uTextureMap:new Float32Array(t.textureMap||[0,0,1,1]),uParams:new Float32Array([0,v-1,t.width||.5,0]),uMaskTex:(Object(u.b)(t.texture)||Object(u.c)()).init(n),uColorParams:new Float32Array([t.texture?1:0,+M,3===t.blending,t.occlusion&&!t.transparentOcclusion])}),t._matrix&&(i._matrix=t._matrix),i._trailCursors=new Uint16Array(t.maxTrailCount),i.isTrailMesh=!0,i._pointStart=[],i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,d(t,n);var o,_,p,v=i.prototype;return v.addPoint=function(e,t,n){n=n||{};var r=this._trailCursors[e],i=this.pointCountPerTrail,a=this.geometry,o=i-1,s=r%i,u=(r-1)%i,l=(r-2)%i,f=this.getPoint(e,u);if(!(f&&this.checkVertexDistance&&Object(c.r)(f,t)<this.minimumVertexDistance)){var h=e*i+s,d=m(f,t),_=[n.time||this.time,n.lifetime||this.lifetime,r],p=8*h,v=n.size||1,g=new Float32Array(8);g.set(t,0),g[3]=.5*v,g.set(t,4),g[7]=-.5*v,a.setAttributeSubData("aPos",p,g);var y=6*h,E=new Float32Array(6);E.set(d,0),E.set(d,3),a.setAttributeSubData("aDir",y,E);var T=n.color||[1,1,1,1],x=new Float32Array(8);x.set(T,0),x.set(T,4),a.setAttributeSubData("aColor",p,x);var A=new Float32Array(8);A.set(_,0),A.set(_,4),A[3]=0,A[7]=1,a.setAttributeSubData("aInfo",p,A);var O=new Float32Array(2);if(O[0]=O[1]=Math.random(),a.setAttributeSubData("aSeed",2*h,O),u>=0){var b=this.getPoint(e,l),M=new Float32Array(m(b,f,t)),S=6*(e*i+u);a.setAttributeSubData("aDir",S,M),a.setAttributeSubData("aDir",S+3,M);var R=e*i*2,L=[2*u,2*u+1,2*s,2*s,2*u+1,2*s+1].map((function(e){return e+R})),C=6*(e*o+(r-1)%o);a.setIndexSubData(C,new Uint16Array(L))}r=++this._trailCursors[e];var I=this.getUniformValue("uParams"),w=_[2];if(this.useAttributeTrailStart){for(var P=2*i,N=new Float32Array(P),F=0;F<P;F++)N[F]=w;a.setAttributeSubData("aTrailStart",e*N.length,N)}else this.getUniformValue("uTrailStart")[e]=w;I[1]=Math.max(I[1],r-1)-Math.max(0,r-i)}},v.getPoint=function(e,t){var n=this.pointCountPerTrail;if(t>=0&&t<n){var r=8*(e*n+t),i=this.geometry.getAttributeData("aPos");return[i[r],i[1+r],i[2+r]]}},v.clearAllTrails=function(){var e=this.geometry;this._trailCursors=new Uint16Array(this._trailCursors.length),e.setIndexData(new Uint16Array(e.getIndexData().length))},v.reverseTime=function(e){for(var t=this.geometry.getAttributeData("aInfo"),n=0;n<t.length;n+=4)t[n]-=e;this.geometry.setAttributeData("aInfo",t),this.time-=e},v.clearTrail=function(e){if(0!==this._trailCursors[e]){var t=6*(this.pointCountPerTrail-1),n=this.geometry.getIndexData();n.set(new Uint8Array(t),e*t),this.geometry.setIndexData(n),this._indicesCleared=!0,this._trailCursors[e]=0}},v.getPointStartPos=function(e){return this._pointStart[e]},v.setPointStartPos=function(e,t){this._pointStart[e]=t},v.destroy=function(t,n){e.prototype.destroy.call(this,t,n),n&&Object(u.f)(this)},v._onUpdate=function(e){this._indicesCleared=!1},o=i,(_=[{key:"time",get:function(){return this.getUniformValue("uTime")},set:function(e){this.setUniformValue("uTime",e)}}])&&h(o.prototype,_),p&&h(o,p),i}(f.a.Mesh);function m(e,t,n){var r;if(!e&&!n)return[0,0,0];if(e)if(n){var i=Object(c.q)(Object(c.n)([],t,e)),a=Object(c.q)(Object(c.n)([],n,t));r=Object(c.k)(i,i,a)}else r=Object(c.n)([],t,e);else r=Object(c.n)([],n,t);return Object(c.q)(r)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return z}));var r=n(1),i=[0,0,0];function a(e,t,n,a,o){Object(r.n)(i,a,t);var s=Object(r.m)(n,i);if(s<0)return null;Object(r.p)(i,n,s),Object(r.k)(i,t,i);var u=Object(r.r)(a,i),c=o*o;return u>c?null:(Object(r.p)(e,n,s-Math.sqrt(c-u)),Object(r.k)(e,e,t))}var o=n(0),s=n(5),u=n(3),c=n(6),l=n(31),f=n.n(l),h=n(25),d=n.n(h),_=n(17),m=n(12),p=n(20),v=n(16);function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=s.a.constants,T=function(e){var t,n;function i(t,n){var r,a=["#define RENDER_MODE "+t.renderMode],l=[],h=[],v=0,g=Object(u.c)(),y=Object(u.c)(),T=Object(m.b)("maxVertexTextures")>0,x={uModel:s.a.createMatrix4().elements};T&&a.push("#define ENABLE_VERTEX_TEXTURE 1"),t.speedOverLifetime&&(a.push("#define SPEED_OVER_LIFETIME 1"),v|=2,x.uSpeedLifetimeValue=t.speedOverLifetime.toUniform(g));var A,O=t.sprite;O&&O.animate&&(a.push("#define USE_SPRITE"),v|=4,x.uFSprite=x.uSprite=new Float32Array([O.col,O.row,O.total,O.blend?1:0]),t._useSprite=!0),t.filter&&"none"!==t.filter.name&&(a.push("#define USE_FILTER 1"),v|=8,A=Object(_.a)(t.filter,y,g,n));var b=t.colorOverLifetime;b.color&&(a.push("#define COLOR_OVER_LIFETIME"),v|=16);var M=b.opacity;x.uOpacityOverLifetimeValue=M?M.toUniform(g):new Float32Array(4);var S,R=t.linearVelOverLifetime,L=t.orbitalVelOverLifetime;["x","y","z"].forEach((function(e,t){var n=0;R[e]&&(x["uLinear"+e.toUpperCase()+"ByLifetimeValue"]=R[e].toUniform(g),n=1,v|=1<<7+t,R.enabled=!0),a.push("#define LINEAR_VEL_"+e.toUpperCase()+" "+n);var r=0;L[e]&&(x["uOrb"+e.toUpperCase()+"ByLifetimeValue"]=L[e].toUniform(g),r=1,v|=1<<10+t,S=!0,L.enabled=!0),a.push("#define ORB_VEL_"+e.toUpperCase()+" "+r)})),R.asMovement&&(a.push("#define AS_LINEAR_MOVEMENT"),v|=32),S&&(L.asRotation&&(a.push("#define AS_ORBITAL_MOVEMENT"),v|=64),x.uOrbCenter=new Float32Array(L.center||3));var C=t.sizeOverLifetime;C&&(a.push("#define SIZE_BY_LIFE 1"),v|=8192,x.uSizeByLifetimeValue=C.x.toUniform(g),C.separateAxes&&(a.push("#define SIZE_Y_BY_LIFE 1"),v|=16384,x.uSizeYByLifetimeValue=C.y.toUniform(g)));var I=t.rotationOverLifetime;I.z&&(x.uRZByLifeTimeValue=I.z.toUniform(g),v|=32768,a.push("#define ROT_Z_LIFETIME 1")),I.x&&(x.uRXByLifeTimeValue=I.x.toUniform(g),v|=65536,a.push("#define ROT_X_LIFETIME 1")),I.y&&(x.uRYByLifeTimeValue=I.y.toUniform(g),v|=1<<17,a.push("#define ROT_Y_LIFETIME 1")),I.asRotation&&(a.push("#define ROT_LIFETIME_AS_MOVEMENT 1"),v|=1<<18);var w=t.gravity;x.uAcceleration=[w[0]||0,w[1]||0,w[2]||0,0],x.uGravityModifierValue=t.gravityModifier.toUniform(g);var P=t.forceTarget;P&&(a.push("#define FINAL_TARGET"),v|=1<<19,x.uFinalTarget=new Float32Array(P.target),x.uForceCurve=P.curve.toUniform(g));var N=Object(m.b)("floatTexture");N&&y.max?(v|=1<<20,x.uFCurveValueTexture=s.a.createTextureContainer({data:u.a.getAllData(y),type:E.FLOAT,width:y.index,height:1}).init(n),h.push("#define LOOKUP_TEXTURE_CURVE 1")):x.uFCurveValues=u.a.getAllData(y);var F=Object(m.b)("maxVertexUniforms");x.uVCurveValues=u.a.getAllData(g),g.max+g.curves.length-32>F&&g.max&&(N&&T&&(x.uVCurveValueTexture=s.a.createTextureContainer({data:t.uVCurveValues,type:E.FLOAT,width:g.max,height:1}).init(n),l.push("#define LOOKUP_TEXTURE_CURVE 1")),Object(p.b)(p.a,{name:t.name})),g.lineSegCount&&(l.push("#define USE_LINE_SEG"),v|=1<<21),y.lineSegCount&&(h.push("#define USE_LINE_SEG"),v|=1<<22),g.curveCount&&(l.push("#define USE_CURVE_VALUE"),v|=1<<23),y.curveCount&&(h.push("#define USE_CURVE_VALUE"),v|=1<<24),l.push("#define CURVE_VALUE_COUNT "+g.index),h.push("#define CURVE_VALUE_COUNT "+y.index),l.push("#define MAX_KEY_FRAME_COUNT "+g.max),h.push("#define MAX_KEY_FRAME_COUNT "+y.max),v=["p",t.renderMode,v,g.index,g.max,y.index,y.max].join("+");var D=a.join("\n"),U={vertexShader:l.join("\n")+"\n"+D+"\n"+f.a,fragmentShader:h.join("\n")+"\n"+D+"\n"+d.a,shaderCacheId:t._shaderCachePrefix+":"+v,renderOrder:t.order,states:{side:t.side,depthMask:t.occlusion},uniforms:{uViewProjection:"VIEWPROJECTION",uView:"VIEWINVERSE",uModel:0,uFinalTarget:0,uForceCurve:0,uVCurveValueTexture:0,uFCurveValueTexture:0,uVCurveValues:[s.a.constants.FLOAT_VEC4],uFCurveValues:[s.a.constants.FLOAT_VEC4],uRZByLifeTimeValue:0,uRYByLifeTimeValue:0,uRXByLifeTimeValue:0,uSpeedLifetimeValue:0,uLinearXByLifetimeValue:0,uLinearYByLifetimeValue:0,uLinearZByLifetimeValue:0,uOrbXByLifetimeValue:0,uOrbYByLifetimeValue:0,uOrbZByLifetimeValue:0,uGravityModifierValue:0,uSizeByLifetimeValue:0,uSizeYByLifetimeValue:0,uPreviewColor:0,uColorParams:0,uOpacityOverLifetime:0,uAcceleration:0,uOrbCenter:0,uSprite:0,uFSprite:0,uOpacityOverLifetimeValue:0,uParams:0,uTexOffset:0},engine:n,samplers:["uMaskTex","uColorOverLifetime"],attributes:["aSprite","aPos","aVel","aRot","aColor","aOffset","aSeed","aDirX","aDirY"]},V=t.diffuse;if(V?(V=t.diffuse.init(n)).onLoad=function(){return r.setUniformValue("uTexOffset",[1/V.width,1/V.height])}:V=Object(c.c)().init(n),t.diffuse=V,x.uTexOffset=new Float32Array(V?[1/V.width,1/V.height]:[0,0]),x.uParams=new Float32Array([0,t.duration,0,0]),x.uMaskTex=V,A){var B=U.uniforms;Object(o.d)(A.uniforms,(function(e,t){if(B[t])throw Error("conflict uniform name:"+t);B[t]=e}));var H=U.samplers;A.samplers.forEach((function(e){if(H.indexOf(e)>-1)throw Error("conflict sampler name:"+e);H.push(e)})),Object(o.d)(A.data,(function(e,t){x[t]=e})),U.fragmentShader=U.fragmentShader.replace("#pragma FILTER",A.fragment),U.vertexShader=U.vertexShader.replace("#pragma FILTER",A.vertex),U.shaderCacheId+=A.name}var z=t.blending,G=Object(c.h)(z,U.states);Object(c.i)(t.maskMode,t.mask,U.states),(r=e.call(this,{material:s.a.createMaterial(U),geometry:s.a.createGeometry(i.geometry(t._useSprite),n),duration:t.duration,particleOrigin:t.particleOrigin,_useSprite:t._useSprite,maxCount:t.maxCount,gravityModifier:t.gravityModifier,linearVelOverLifetime:R,orbitalVelOverLifetime:L,speedOverLifetime:t.speedOverLifetime},n)||this)._time=0,r.forceTarget=P,r.sizeOverLifetime=t.sizeOverLifetime,t._matrix&&(r._matrix=t._matrix),x.uColorParams=new Float32Array([V?1:0,+G,3===z,t.occlusion&&!t.transparentOcclusion]),x.uOpacityOverLifetime=b.opacity?1:0;var k=t.textureMap||[0,0,1,1];return r.textureOffsets=[[0,0],[0,1],[1,0],[1,1]].map((function(e){return[k[0]+e[0]*k[2],k[1]+e[1]*k[3]]})),b.color&&(x.uColorOverLifetime=Object(c.e)(b.color).init(n)),r.setUniformValues(x),r.isParticleMesh=!0,r.particleCount=0,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,y(t,n),i.geometry=function(e){var t={aPos:{size:3},aVel:{size:3},aRot:{size:3},aColor:{size:4},aOffset:{size:4},aSeed:{size:1},aDirY:{size:3},aDirX:{size:3}};return e&&(t.aSprite={size:3}),{attributes:t,index:{size:1}}};var a,l,h,T=i.prototype;return T.getPointColor=function(e){var t=this.geometry.getAttributeData("aColor"),n=16*e;return[t[n],t[n+1],t[n+2],t[n+3]]},T.getPointProjectedBounds=function(e,t,n){for(var i=this.geometry,a=i.getAttributeData("aOffset"),o=this.sizeOverLifetime,s=(this.time-a[16*e+2])/a[16*e+3],u=i.getAttributeData("aDirX"),c=i.getAttributeData("aDirY"),l=12*e,f=[],h=[],d=[],_=0;_<4;_++){var m=l+3*_,p=[u[m],u[m+1],u[m+2]],v=[c[m],c[m+1],c[m+2]];if(o){var g=o.x.getValue(s);Object(r.m)(p,p,g),o.separateAxes?Object(r.m)(v,v,o.y.getValue(s)):Object(r.m)(v,v,g)}Object(r.k)(f,t,p),Object(r.k)(f,f,v),Object(r.i)(f,f,n),h[_]=f[0],d[_]=f[1]}return[Math.min(h[0],h[1],h[2],h[3]),Math.min(d[0],d[1],d[2],d[3]),Math.max(h[0],h[1],h[2],h[3]),Math.max(d[0],d[1],d[2],d[3])]},T.getPointPosition=function(e){var t=this.geometry,n=12*e,r=t.getAttributeData("aPos"),i=t.getAttributeData("aVel"),a=t.getAttributeData("aOffset"),o=this.time-a[16*e+2],s=a[16*e+3],u=Object(v.b)(this,this.getUniformValue("uAcceleration"),o,s,r,i,n);if(this.forceTarget){var c=this.getUniformValue("uFinalTarget"),l=this.forceTarget.curve.getValue(o/s),f=1-l;u[0]=u[0]*f+c[0]*l,u[1]=u[1]*f+c[1]*l,u[2]=u[2]*f+c[2]*l}return u},T.clearPoints=function(){this.geometry.resetData(),this.particleCount=this.geometry.drawCount=this.maxParticleBufferCount=0},T.reverseTime=function(e){for(var t=this.geometry.getAttributeData("aOffset"),n=0;n<t.length;n+=4)t[n+2]-=e;this.geometry.setAttributeData("aOffset",t),this.time-=e},T.removePoint=function(e){e<this.particleCount&&this.geometry.setAttributeSubData("aOffset",16*e,new Float32Array(16))},T.setPoint=function(e,t){t=t||0;var n=this.maxCount;if(t<n){var i=1+t,a=4*i,s=this.geometry,u=i>this.maxParticleBufferCount,l=this.particleCount>0?2:1,f={aPos:new Float32Array(12),aVel:new Float32Array(12),aColor:new Float32Array(16),aRot:new Float32Array(12),aOffset:new Float32Array(16),aSeed:new Float32Array(4),aDirX:new Float32Array(12),aDirY:new Float32Array(12)};this._useSprite&&(f.aSprite=new Float32Array(12));var h,d=this.textureOffsets,_=[0,0,e.delay,e.lifetime],m=[0,1,0,1],p=e.pos,g=e.vel,y=e.color,E=Object(r.a)(e.rot);this._useSprite&&(h=e.sprite);for(var T=v.c[this.particleOrigin],x=Math.random(),A=0;A<4;A++){var O=d[A],b=3*A,M=4*A;f.aPos.set(p,b),f.aVel.set(g,b),f.aColor.set(y,M),f.aRot.set(E,b),f.aSeed[A]=x,this._useSprite&&f.aSprite.set(h,b);var S=e.uv||m;S?(_[0]=S[0]/S[1]+O[0]/S[1],_[1]=S[2]/S[3]+O[1]/S[3]):(_[0]=O[0],_[1]=O[1]),f.aOffset.set(_,M);for(var R=A+A,L=T[R]*e.size[0],C=T[R+1]*e.size[1],I=0;I<3;I++)f.aDirX[b+I]=e.dirX[I]*L,f.aDirY[b+I]=e.dirY[I]*C}var w=new Uint16Array([0,1,2,2,1,3].map((function(e){return e+4*t})));if(u){var P=s.getIndexData(),N=Object(c.g)(P,6*i,l,6*n);N.set(w,6*t),s.setIndexData(N),this.maxParticleBufferCount=N.length/6}else s.setIndexSubData(6*t,w);Object(o.d)(f,(function(e,r){var i=s.getAttributeSize(r);if(u){var o=s.getAttributeData(r),f=Object(c.g)(o,a*i,l,4*n*i);f.set(e,e.length*t),s.setAttributeData(r,f)}else s.setAttributeSubData(r,e.length*t,e)})),this.particleCount=Math.max(i,this.particleCount),s.drawCount=6*this.particleCount}return this},T.destroy=function(t,n){e.prototype.destroy.call(this,t,n),Object(c.f)(this,n)},a=i,(l=[{key:"time",get:function(){return this.getUniformValue("uParams")[0]},set:function(e){this.setUniformValue("uParams",new Float32Array([+e,this.duration,0,0]))}}])&&g(a.prototype,l),h&&g(a,h),i}(s.a.Mesh),x=function(){function e(e){Object(o.k)(this,e)}return e.prototype.generate=function(e){var t=.017453292519943295*A(this.arc,this.arcMode,e),n=[Math.cos(t)*this.radius,Math.sin(t)*this.radius,0],i=Math.tan(.017453292519943295*this.angle),a=Object(r.m)([],n,i);return a[2]+=1,{position:Object(r.m)(n,n,Object(o.l)(0,1)),direction:Object(r.q)(a)}},e}();function A(e,t,n){if(0===t)e=Object(o.l)(0,e);else if(1===t){var r=n.index%(n.total+1);e=e/n.total*r}else if(2===t){var i=n.index/(n.total+1),a=i-Math.floor(i);e*=Math.floor(i)%2?1-a:a}else 3===t&&(e=e*n.burstIndex/n.burstCount);return e}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(){function e(e){Object(o.k)(this,e)}var t=e.prototype;return t.getHorizontalAngle=function(){return Object(o.l)(-90,90)},t.generate=function(e){var t=.017453292519943295*A(this.arc,this.arcMode,e),n=.017453292519943295*this.getHorizontalAngle(),i=this.radius,a=[Math.cos(n),0,Math.sin(n)],o=Object(r.e)(t),s=Object(r.h)(a,a,o);return{position:s.map((function(e){return e*i})),direction:s}},e}(),M=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,O(t,n),r.prototype.getHorizontalAngle=function(){return Object(o.l)(0,90)},r}(b),S=function(){function e(e){Object(o.k)(this,e)}return e.prototype.generate=function(e){var t=.017453292519943295*A(this.arc,this.arcMode,e),n=[Math.cos(t),Math.sin(t),0],r=this.radius;return{direction:n,position:n.map((function(e){return e*r}))}},e}(),R=function(){function e(e){this._d=(e.width||1)/2,this._h=(e.height||1)/2}return e.prototype.generate=function(e){return{direction:[0,0,1],position:[Object(o.l)(-this._d,this._d),Object(o.l)(-this._h,this._h),0]}},e}(),L=function(){function e(e){this._d=(e.width||1)/2,this._h=(e.height||1)/2,this.arcMode=e.arcMode,this.arc=e.arc}return e.prototype.generate=function(e){var t=.017453292519943295*A(this.arc,this.arcMode,e),n=[Math.cos(t),Math.sin(t),0],r=this._d,i=this._h,a=Math.atan2(i,r),o=Math.tan(t);return{direction:n,position:t<a?[r,r*o,0]:t>=a&&t<Math.PI-a?[i/o,i,0]:t<Math.PI+a?[-r,-r*o,0]:t<w-a?[-i/o,-i,0]:[r,r*o,0]}},e}(),C=function(){function e(e){this._d=(e.width||1)/2,this.arcMode=e.arcMode}return e.prototype.generate=function(e){var t=3===this.arcMode?e.burstIndex%e.burstCount/(e.burstCount-1):Object(o.l)(0,1);return{direction:[0,1,0],position:[this._d*(t-.5),0,0]}},e}(),I={Cone:x,Sphere:b,Hemisphere:M,Circle:S,Donut:function(){function e(e){Object(o.k)(this,e)}return e.prototype.generate=function(e){var t=this.donutRadius,n=this.radius-t,i=Object(o.l)(0,w),a=.017453292519943295*A(this.arc,this.arcMode,e),s=Object(r.e)(a),u=[Math.cos(i),Math.sin(i),0],c=[n+Math.cos(i)*t,0,Math.sin(i)*t];return{direction:Object(r.h)(u,u,s),position:Object(r.h)(c,c,s)}},e}(),Rectangle:R,Edge:C,RectangleEdge:L},w=2*Math.PI,P=function(){function e(){}return e.prototype.generate=function(){return{position:[0,0,0],direction:[0,0,0]}},e}();function N(e){if(!e)return new P;var t=Object(o.k)({radius:1,arc:360,angle:0,arcMode:0},e||{}),n=I[e.shape];if(!n)throw Error("invalid shape:"+e.shape);var i=new n(t);return Object(o.k)(i,{alignSpeedDirection:e.alignSpeedDirection,reverseDirection:e.reverseDirection,upDirection:Object(r.q)(e.upDirection||[0,0,1])}),i}var F=function(){function e(e){this.time=+e.time||0,this.interval=+e.interval||1,this.count=e.count instanceof u.b?e.count:Object(u.d)(e.count),this.cycles=+e.cycles||1/0,this.probability=isNaN(e.probability)?1:+e.probability,this.reset()}var t=e.prototype;return t.getGeneratorOptions=function(e,t){var n=e-this.time-this._now,r=this.interval;if(n>r*this._i&&this._cycles>0)return this._cycles--,this._i++,Math.random()<=this.probability?{index:this._i,total:1/r,count:this.count.getValue(t),cycleIndex:this.cycles-this._cycles-1}:null},t.reset=function(){return this._cycles=this.cycles,this._i=0,this._now=0,this},t.clone=function(){return new e(this)},e}(),D=n(23),U=function(e){this.content=e},V=function(){function e(e){this.length=0,this._sort=e}var t=e.prototype;return t.findNodeByContent=function(e){var t=this.first;if(t)do{if(e(t.content))return t}while(t=t.next)},t._insertNode=function(e,t){var n=e.next;e.next=t,t.pre=e,t.next=n,n&&(n.pre=t)},t.shiftNode=function(e){var t=new U(e);if(this.length++,1===this.length)return this.first=this.last=t;for(var n=this.first;n;){if(!(this._sort(n.content,t.content)<=0))return n.pre?this._insertNode(n.pre,t):(this.first=t,t.next=n,n.pre=t),t;if(!n.next)return this._insertNode(n,t),this.last=t;n=n.next}},t.pushNode=function(e){var t=new U(e);if(this.length++,1===this.length)return this.last=this.first=t;for(var n=this.last;n;){if(!(this._sort(t.content,n.content)<=0))return this._insertNode(n,t),n===this.last&&(this.last=t),t;if(this.first===n)return n.pre=t,t.next=n,this.first=t;n=n.pre}},t.removeNode=function(e){var t=this.first;if(this.length--,t===e){var n=this.first=t.next;n&&(n.pre=null)}else if((t=this.last)===e){var r=this.last=t.pre;r&&(r.next=null)}else if(e){var i=e.pre,a=e.next;i.next=a,a&&(a.pre=i)}e.pre=null,e.next=null},t.forEach=function(e,t){var n=this.first,r=0;if(n)do{e.call(t||this,n.content,r++)}while(n=n.next)},t.forEachReverse=function(e,t){var n=this.last,r=this.length-1;if(n)do{e.call(t||this,n.content,r--)}while(n=n.pre)},e}();n(9);function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var z=function(e){var t,n;function i(t,n){var i,a=t.options||{};n=n||{};t.addition;var l=a.duration||1,f=a.gravityModifier,h=t.textureSheetAnimation,d=h?{animationDelay:Object(u.d)(h.animationDelay||0),animationDuration:Object(u.d)(h.animationDuration||1),cycles:Object(u.d)(h.cycles||1),animate:h.animate,col:h.col,row:h.row,total:h.total||h.col*h.row,blend:h.blend}:null,_=s.a.createMatrix4(),m={filter:t.filter,renderMatrix:_,independentEmitter:n.independentEmitter,options:{startLifetime:Object(u.d)(a.startLifetime),startDelay:Object(u.d)(a.startDelay||0),startSpeed:Object(u.d)(a.startSpeed||0),startColor:Object(u.d)(a.startColor||["static",[1,1,1,1]]),endBehavior:isNaN(a.endBehavior)?0:a.endBehavior,duration:l,looping:a.looping||!1,maxCount:a.maxCount||0,gravityModifier:Object(u.d)(f||0).scaleXCoord(l),start3DRotation:!!a.start3DRotation,start3DSize:!!a.start3DSize,startTurbulence:!!a.startTurbulence,turbulence:a.startTurbulence&&[Object(u.d)(a.turbulenceX),Object(u.d)(a.turbulenceY),Object(u.d)(a.turbulenceZ)]},shape:N(t.shape),emission:{rateOverTime:Object(u.d)(t.emission.rateOverTime),rateOverDistance:Object(u.d)(t.emission.rateOverDistance),burstOffsets:G(t.emission.burstOffsets),bursts:(t.emission.bursts||[]).map((function(e){return new F(e)}))},textureSheetAnimation:d,onEnd:t.onEnd||o.j,onIterate:t.onIterate||o.j,name:t.name};a.start3DRotation&&(m.options.startRotationX=Object(u.d)(a.startRotationX||0),m.options.startRotationY=Object(u.d)(a.startRotationY||0),m.options.startRotationZ=Object(u.d)(a.startRotationZ||0)),a.startRotation&&(m.options.startRotation=Object(u.d)(a.startRotation||0)),a.start3DSize?(m.options.startSizeX=Object(u.d)(a.startSizeX),m.options.startSizeY=Object(u.d)(a.startSizeY)):(m.options.startSize=Object(u.d)(a.startSize),m.options.sizeAspect=Object(u.d)(a.sizeAspect||1));var p=t.renderer||{},v={},g=t.rotationOverLifetime;g&&(g.separateAxes?(v.x=g.x&&Object(u.d)(g.x),v.y=g.y&&Object(u.d)(g.y),v.z=g.z&&Object(u.d)(g.z)):v.z=g.angularVelocity&&Object(u.d)(g.angularVelocity),v.asRotation=!!g.asRotation);var y,E=t.velocityOverLifetime||{};E.forceTarget&&(y={target:E.target||[0,0,0],curve:Object(u.d)(E.forceCurve||["lines",[[0,0],[1,1]]])});var x={x:E.linearX&&Object(u.d)(E.linearX),y:E.linearY&&Object(u.d)(E.linearY),z:E.linearZ&&Object(u.d)(E.linearZ),asMovement:E.asMovement},A={x:E.orbitalX&&Object(u.d)(E.orbitalX),y:E.orbitalY&&Object(u.d)(E.orbitalY),z:E.orbitalZ&&Object(u.d)(E.orbitalZ),center:E.orbCenter,asRotation:E.asRotation},O=t.sizeOverLifetime,b=t.colorOverLifetime||{},M=p.order||0,S=n.cachePrefix||"",R={filter:t.filter,name:t.name+"_$mesh",_matrix:_,_shaderCachePrefix:S,renderMode:p.renderMode||0,side:p.side||1032,textureMap:p.textureMap,sizeOverLifetime:O&&{separateAxes:O.separateAxes,x:Object(u.d)(O.separateAxes?O.x:O.size),y:Object(u.d)(O.separateAxes?O.y:O.size)},colorOverLifetime:{color:b.color&&Object(u.e)(b.color),opacity:b.opacity&&Object(u.d)(b.opacity)},gravityModifier:m.options.gravityModifier,gravity:Object(r.a)(a.gravity),duration:a.duration,blending:p.blending||0,rotationOverLifetime:v,linearVelOverLifetime:x,orbitalVelOverLifetime:A,speedOverLifetime:E.speedOverLifetime&&Object(u.d)(E.speedOverLifetime),order:M,particleOrigin:p.particleOrigin||0,sprite:d,occlusion:!!p.occlusion,transparentOcclusion:!!p.transparentOcclusion,maxCount:a.maxCount,mask:p.mask,maskMode:p.maskMode,forceTarget:y},L=p.texture;!L&&h&&(L=h.texture),R.diffuse=Object(c.b)(L,{clamp:!d})||Object(c.d)();var C=[];if(d&&!d.animate)for(var I=0;I<d.col;I++)for(var w=0;w<d.row;w++)C.push([I,d.col,w,d.row]);else C.push([0,1,0,1]);m._uvs=C,m.particleMesh=new T(R,n.engine);var P=t.trails;P&&(m.trails={lifetime:Object(u.d)(P.lifetime),dieWithParticles:!1!==P.dieWithParticles,sizeAffectsWidth:P.sizeAffectsWidth,sizeAffectsLifetime:P.sizeAffectsLifetime,inheritParticleColor:P.inheritParticleColor,parentAffectsPosition:P.parentAffectsPosition},m.trailMesh=new D.a({colorOverLifetime:Object(u.e)(P.colorOverLifetime),_matrix:_,minimumVertexDistance:P.minimumVertexDistance||.02,maxTrailCount:a.maxCount,pointCountPerTrail:P.maxPointPerTrail||32,blending:P.blending,texture:P.texture,opacityOverLifetime:Object(u.d)(P.opacityOverLifetime||1),widthOverTrail:Object(u.d)(P.widthOverTrail||1),colorOverTrail:Object(u.e)(P.colorOverTrail),order:M,_shaderCachePrefix:S,lifetime:P.lifetime,occlusion:!!P.occlusion,transparentOcclusion:!!P.transparentOcclusion,textureMap:P.textureMap,mask:p.mask,maskMode:p.maskMode},n.engine)),i=e.call(this,m,n.engine)||this;var U,V=t.transform||{};V.path?U=V.path:t.emitterTransform&&t.emitterTransform.path&&(U=t.emitterTransform.path);var B=Object(r.a)(V.position);i.setPosition(B[0],B[1],B[2]);var H=Object(r.a)(V.rotation);i.setRotation(H[0],H[1],H[2]);var z=V.scale||[1,1,1];i.setScale(z[0],z[1],z[2]),i._transform={position:B,rotation:H,path:U&&Object(u.d)(U)},i.updateMatrixWorld(!0),i._updateEmitterTransform(0);var k=[i.particleMesh];return i.trailMesh&&k.push(i.trailMesh),i.setMeshes(k),i.isParticleSystem=!0,i.reusable=n.reusable,i.independentEmitter=n.independentEmitter,i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,H(t,n);var l,f,h,d=i.prototype;return d._getTextures=function(){var e=[];return t(this.particleMesh),t(this.trailMesh),e;function t(t){t&&Object(o.d)(t.getUniformValues(),(function(n,r){n&&n.isTexture&&(e.push(n),t.setUniformValue(r,null))}))}},d.start=function(){return this._started&&!this._ended||(this.reset(),this._started=!0,this._ended=!1),this},d.stop=function(){this._ended=!0,this._started=!1},d.reset=function(){return this.particleMesh.clearPoints(),this.trailMesh&&this.trailMesh.clearAllTrails(),this._lastUpdate=this._loopStartTime=0,this._lastEmitTime=-1/this.emission.rateOverTime.getValue(0),this._info={generatedCount:0},this._paricleLink=new V((function(e,t){return e[0]-t[0]})),this.emission.bursts.forEach((function(e){return e.reset()})),this._freezed=!1,this},d.getParentMatrix=function(){if(this.parent)return this.parent.getWorldMatrix()},d._onUpdate=function(e){var t=this;if(this.independentEmitter){var n=this.getParentMatrix();n&&(this.particleMesh.setUniformValue("uModel",n),this.trailMesh&&this.trailMesh.setUniformValue("uModel",n))}if(this._started&&!this._freezed){var i=this._lastUpdate+e/1e3,a=this.particleMesh,o=this.trailMesh,s=this.options,u=this._loopStartTime;this._lastUpdate=i;var c=this.emission;a.time=i,o&&(o.time=i,o._onUpdate(e)),this._upDirectionWorld=null;var l=this._paricleLink,f=(i-u)/s.duration,h=this.timePassed,d=!1,_=function(){t.trails&&!d&&(d=!0,l.forEach((function(e){var n=e[0],r=e[1],i=e[2],a=e[3];n<h?t.clearPointTrail(r):h>i&&t.updatePointTrail(r,f,a,i)})))};if(this._ended){if(!s.looping)if(this.reusable);else if(0===s.endBehavior){var m=l.last;m&&m.content[0]-u<h&&(this._onUpdate=function(){return t._onDestroy(t)})}}else{var p=s.duration,v=this.lifetime;if(h<p){var g=1/c.rateOverTime.getValue(v),y=Math.floor((h-this._lastEmitTime)/g),E=y,T=g/y,x=i,A=s.maxCount;this._updateEmitterTransform(h);for(var O=function(){var e=l.first;return t.emissionStopped||l.length===A&&e&&e.content[0]-u>h},b=0;b<E&&b<A&&!O();b++){var M=this.createPoint(v);M.delay+=x+b*T,this._addParticle(M,A),this._lastEmitTime=h}for(var S=c.bursts,R=(null==S?void 0:S.length)-1,L=0;R>=0&&L<A&&!O();R--){var C=S[R],I=!C.disabled&&C.getGeneratorOptions(h,v);if(I){var w=c.burstOffsets[R],P=w&&w[I.cycleIndex]||[0,0,0];C.once&&this.removeBurst(R);for(var N=0;N<I.count&&L<A&&!O();N++){var F=this.initPoint(this.shape.generate({total:I.total,index:I.index,burstIndex:N,burstCount:I.count}));F.delay+=x,L++,Object(r.k)(F.pos,F.pos,P),this._addParticle(F,A)}}}}else if(s.looping)i-=p,this._loopStartTime=i,this._lastEmitTime-=p,this._lastUpdate-=p,_(),c.bursts.forEach((function(e){return e.reset()})),a.reverseTime(p),o&&o.reverseTime(p),this._paricleLink.forEach((function(e){e[0]-=p,e[2]-=p})),this.onIterate(this);else{this._ended=!0,this.onEnd(this),4===s.endBehavior&&(this._freezed=!0)}}_()}},d._updateEmitterTransform=function(e){var t,n=this._parentTransform,i=[0,0,0],a=this._transform;if(n){var o=n.rot;o&&(Object(r.k)(i,o,this._transform.rotation),this.setRotation(i[0],i[1],i[2])),n.pos?(i[0]=n.pos[0],i[1]=n.pos[1],i[2]=n.pos[2]):i[0]=i[1]=i[2]=0,t=!0}if(a.path){var s=this.options.duration;Object(r.k)(i,i,a.path.getValue(e/s)),t=!0}t&&(Object(r.k)(i,i,a.position),this.setPosition(i[0],i[1],i[2]),this.updateMatrixWorld())},d._onDestroy=function(e){},d.raycast=function(e){var t=this.timePassed,n=this._paricleLink,r=n.last,i=this.particleMesh,o=[],s=!1;if(r)do{var u=r.content,c=u[1];if(!(u[0]>t))break;var l=i.getPointPosition(c),f=e.ray,h=e.bound,d=!1;if(f)d=a([],f.center,f.direction,l,f.radius);else if(h){var _=i.getPointProjectedBounds(c,l,h.matrix);d=h.inRect(_)}d&&(e.removeParticle&&(i.removePoint(c),this.clearPointTrail(c),n.removeNode(r),u[0]=0,n.shiftNode(r.content)),o.push(l),e.multiple||(s=!0))}while((r=r.pre)&&!s);return o},d._addParticle=function(e,t){var n,r=this._paricleLink,i=new Float32Array([e.delay+e.lifetime,0,e.delay,e.size[0]]);if(r.length<t)n=i[1]=r.length;else{var a=r.first;r.removeNode(a),n=i[1]=a.content[1]}r.pushNode(i),this.particleMesh.setPoint(e,n),this.clearPointTrail(n),this._parentTransform&&this.trailMesh&&this.trailMesh.setPointStartPos(n,this._parentTransform.pos)},d.clearPointTrail=function(e){this.trails&&this.trails.dieWithParticles&&this.trailMesh.clearTrail(e)},d.updatePointTrail=function(e,t,n,i){var a=this.trails,o=this.particleMesh,s=o.getPointPosition(e),u=a.inheritParticleColor&&o.getPointColor(e),c=1,l=a.lifetime.getValue(t);if(a.sizeAffectsWidth&&(c*=n),a.sizeAffectsLifetime&&(l*=n),a.parentAffectsPosition&&this._parentTransform&&this._parentTransform.pos){Object(r.k)(s,s,this._parentTransform.pos);var f=this.trailMesh.getPointStartPos(e);f&&Object(r.n)(s,s,f)}this.trailMesh.addPoint(e,s,{color:u,lifetime:l,size:c,time:i})},d.onEnd=function(){},d.onIterate=function(){},d.initPoint=function(e){var t=this.options,n=this.lifetime,i=this.shape,a=t.startSpeed.getValue(n),s=this.independentEmitter?this.getModelMatrix():this.getWorldMatrix(),u=Object(r.i)(e.position,e.position,s),c=e.direction;if(i.reverseDirection&&(c=Object(r.m)(c,c,-1)),c=Object(r.q)(Object(r.j)(c,c,s)),t.startTurbulence){var l=Object(r.d)(t.turbulence.map((function(e){return.017453292519943295*e.getValue(n)})));c=Object(r.q)(Object(r.h)(c,c,l))}var f=[1,0,0],h=[0,1,0];i.alignSpeedDirection&&(h=[c[0],c[1],c[2]],this._upDirectionWorld||(this._upDirectionWorld=Object(r.j)([],i.upDirection,s)),f=Object(r.q)(Object(r.g)([],h,this._upDirectionWorld)));var d,_=!1,m=this.textureSheetAnimation;m&&m.animate&&(_=[m.animationDelay.getValue(n),m.animationDuration.getValue(n),m.cycles.getValue(n)]),t.start3DRotation?d=[t.startRotationX.getValue(n),t.startRotationY.getValue(n),t.startRotationZ.getValue(n)]:t.startRotation&&(d=[0,0,t.startRotation.getValue(n)]);var p,v=t.startColor.getValue(n);if(3===v.length&&(v[3]=1),t.start3DSize)p=[t.startSizeX.getValue(n),t.startSizeY.getValue(n)];else{var g=t.startSize.getValue(n);p=[g,g/t.sizeAspect.getValue(n)]}return{vel:Object(r.m)(c,c,a),color:v,pos:u,delay:t.startDelay.getValue(n),lifetime:t.startLifetime.getValue(n),size:p,uv:Object(o.m)(this._uvs,!0),sprite:_,rot:d,dirY:h,dirX:f}},d.addBurst=function(e,t){if(Object(o.a)(this.emission.bursts,e)&&t instanceof Array){var n=this.emission.bursts.indexOf(e);return this.emission.burstOffsets[n]=t,n}return-1},d.removeBurst=function(e){e<this.emission.bursts.length&&(this.emission.burstOffsets[e]=null,this.emission.bursts.splice(e,1))},d.createPoint=function(e){var t={total:this.emission.rateOverTime.getValue(e),index:this._info.generatedCount,burstIndex:0,burstCount:0};return this._info.generatedCount++,this.initPoint(this.shape.generate(t))},d.destroy=function(t,n){e.prototype.destroy.call(this,t,n),this.particleMesh.destroy(t,n);var r=this.trailMesh;r&&r.destroy(t,n)},l=i,(f=[{key:"timePassed",get:function(){return this._lastUpdate-this._loopStartTime}},{key:"lifetime",get:function(){return this.timePassed/this.options.duration}},{key:"parentTransform",set:function(e){this._parentTransform=e}}])&&B(l.prototype,f),h&&B(l,h),i}(s.a.Node);function G(e){var t={};return Array.isArray(e)&&e.forEach((function(e){var n=e instanceof Array,r=n?e[0]:e.index,i=t[r];i||(i=t[r]=[]),n?i.push(e.slice(1,4)):i.push([+e.x,+e.y,+e.z])})),t}},function(e,t){e.exports="precision mediump float;varying float vLife;varying vec2 vTexCoord;varying vec4 vColor;uniform sampler2D uMaskTex;uniform vec4 uColorParams;uniform vec2 uTexOffset;\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\n\n#ifdef USE_SPRITE\nvarying vec4 vTexCoordBlend;\n#ifdef USE_FILTER\nuniform vec4 uFSprite;\n#endif\n\n#endif\nvarying float vSeed;\n#ifdef PREVIEW_BORDER\nuniform vec4 uPreviewColor;\n#endif\n\n#ifdef USE_SPRITE\nvec4 getTextureColor(sampler2D a,vec2 texCoord){if(vTexCoordBlend.w>0.){return mix(texture2D(a,texCoord),texture2D(a,vTexCoordBlend.xy+texCoord),vTexCoordBlend.z);}return texture2D(a,texCoord);}\n#else\n\n#define getTextureColor texture2D\n\n#endif\n\n#ifdef USE_FILTER\n\n#pragma FILTER\n\n#endif\n\n#ifdef PREVIEW_BORDER\nvoid main(){gl_FragColor=uPreviewColor;}\n#else\nvoid main(){vec4 b=vec4(1.0);vec4 c=vColor;vec2 texOffset=uTexOffset;if(vLife<0.){discard;}\n#ifdef USE_FILTER\n#ifdef USE_SPRITE\ntexOffset=uTexOffset/uFSprite.xy;\n#endif\nb=main_filter(Particle(vTexCoord,texOffset,vLife,vSeed),uMaskTex);\n#else\nif(uColorParams.x>0.0){b=getTextureColor(uMaskTex,vTexCoord);}\n#endif\nif(uColorParams.z==1.){b=vec4(1.,1.,1.,b.r*b.a);}\n#ifdef COLOR_OVER_LIFETIME\n#ifndef ENABLE_VERTEX_TEXTURE\nc*=texture2D(uColorOverLifetime,vec2(vLife,0.));\n#endif\n#endif\nb=b*c;if(b.a<=0.01&&uColorParams.w>0.){float d=texture2D(uMaskTex,vTexCoord+texOffset).r+texture2D(uMaskTex,vTexCoord+texOffset*-1.).r;if(d<=0.02){discard;}}if(uColorParams.y>0.){b.rgb*=b.a;}gl_FragColor=b;}\n#endif\n"},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),i=n(1),a=function(){function e(){this._seed=1}var t=e.prototype;return t._getProjectedBounds=function(e,t){var n=e.width/2,r=e.height/2,a=e.position,o=a[0],s=a[1],u=a[2];if(e.parentId){var c=this.calculateGroup.getRenderData(e.parentId);if(c){var l=c.pos;l&&(o+=l[0],s+=l[1],u+=l[2]);var f=c.size;f&&(n*=f[0],r*=f[1])}}var h=[[o-n,s-r,u],[o+n,s-r,u],[o+n,s+r,u],[o-n,s+r,u]].map((function(e){return Object(i.i)(e,e,t)})),d=Math.min(h[0][0],h[1][0],h[2][0],h[3][0]),_=Math.max(h[0][0],h[1][0],h[2][0],h[3][0]),m=Math.min(h[0][1],h[1][1],h[2][1],h[3][1]),p=Math.max(h[0][1],h[1][1],h[2][1],h[3][1]);return e.hitPositions=[[o,s,u]],[d,m,_,p]},t.findRegions=function(e,t,n,i,a,o){for(var s,c=[],l=o&&o.maxCount||e.length,f=o&&o.skipRegion||r.j,h=0;h<e.length&&c.length<=l;h++){var d=e[h];if(!f(d)){var _=!1;if(d.delegate){s||(s=this._getHitTestParams(t,n,i,a));var m=d.delegate.hitTest(s);d.hitPositions=m,_=m.length>0}else d._bounds||(d._bounds=this._getProjectedBounds(d,a)),_=u(d._bounds,t,n);_&&c.push(d)}}return c},t._getHitTestParams=function(e,t,n,r){Object(i.b)(o,r);var a=Object(i.i)(s,[e,t,0],o);return Object(i.n)(a,a,n),{x:e,y:t,camera:{viewProjection:r,position:n,direction:Object(i.q)(a)},inRect:function(n){return u(n,e,t)}}},e}(),o=[],s=[];function u(e,t,n){return e[0]<t&&e[2]>t&&e[1]<n&&e[3]>n}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1);n(19);function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(e){var t,n;function a(t,n){var r;return(r=e.call(this,t,n)||this).id=n.id,r.refCount=n.refCount,r.renderData=r.getRenderData(0,!0),r.reusable=n.reusable,r}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,i(t,n);var o=a.prototype;return o.willTranslate=function(){return!0},o._onUpdate=function(e,t){this.updateTime(t.time);var n=this.getRenderData(this.time,!0),i=t.getRenderData(this.parentId);i&&(Object(r.l)(n.pos,n.pos,i.pos),Object(r.l)(n.rot,n.rot,i.rot),Object(r.o)(n.color,n.color,i.color),Object(r.o)(n.size,n.size,i.size)),this.renderData=n},a}(n(15).a)},function(e,t){e.exports={ArcModeRandom:0,ArcModeLoop:1,ArcModePingPong:2,ArcModeBurstSpread:3,RENDER_MODE_BILLBOARD:0,RENDER_MODE_VERTICAL_BILLBOARD:2,RENDER_MODE_HORIZONTAL_BILLBOARD:3,RENDER_MODE_MESH:1,BLEND_MODE_ADDITIVE:1,BLEND_MODE_ALPHA:0,BLEND_MODE_MULTIPLY:2,BLEND_MODE_LUMINANCE_ALPHA:3,BLEND_MODE_SUBTRACT:4,BLEND_MODE_ADD_LIGHT:5,BLEND_MODE_LIGHT:6,PARTICLE_ORIGIN_CENTER:0,PARTICLE_ORIGIN_LEFT_TOP:1,PARTICLE_ORIGIN_LEFT_CENTER:2,PARTICLE_ORIGIN_LEFT_BOTTOM:3,PARTICLE_ORIGIN_CENTER_TOP:4,PARTICLE_ORIGIN_CENTER_BOTTOM:5,PARTICLE_ORIGIN_RIGHT_TOP:6,PARTICLE_ORIGIN_RIGHT_CENTER:7,PARTICLE_ORIGIN_RIGHT_BOTTOM:8,END_BEHAVIOR_DESTROY:0,END_BEHAVIOR_PAUSE:1,END_BEHAVIOR_FORWARD:2,END_BEHAVIOR_PAUSE_AND_DESTROY:3,END_BEHAVIOR_FREEZE:4,END_BEHAVIOR_RESTART:5,FILTER_NAME_NONE:"none",INTERACT_BEHAVIOR_NOTIFY:0,INTERACT_BEHAVIOR_RESUME_PLAYER:1,DEG2RAD:.017453292519943295,MESSAGE_ITEM_PHRASE_BEGIN:2,MESSAGE_ITEM_PHRASE_END:1,CLICK_BEHAVIOR_NONE:0,CLICK_BEHAVIOR_DESTROY_PARTICLE:1,MASK_MODE_NONE:0,MASK_MODE_WRITE_MASK:1,MASK_MODE_READ_MASK:2,MASK_MODE_READ_INVERT_MASK:3,RENDER_LEVEL_B_PLUS:"B+",RENDER_LEVEL_B:"B",RENDER_LEVEL_A_PLUS:"A+",RENDER_LEVEL_A:"A",RENDER_LEVEL_S:"S",SIDE_BOTH:1032,SIDE_FRONT:1028,SIDE_BACK:1029,PARTICLE_HIT_TEST_MODE_RAY:0,PARTICLE_HIT_TEST_MODE_BOX:1,VFX_ITEM_TYPE_SPRITE:1,VFX_ITEM_TYPE_PARTICLE:2,VFX_ITEM_TYPE_NULL:3,VFX_ITEM_TYPE_INTERACT:4,VFX_ITEM_TYPE_PLUGIN:5,VFX_ITEM_TYPE_3D:6}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n(19);var r=n(5),i=n(15),a=n(10);function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=[],u=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,n)||this).time=0,r._meshes=[],r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,o(t,n);var u=r.prototype;return u.addItem=function(e){var t=e instanceof i.a?e:new i.a(e);return this._addToRenderMesh(t),t},u.removeItem=function(e){for(var t=this._meshes,n=0;n<t.length;n++){var r=t[n];if(r.items.indexOf(e)>-1)return r.removeItem(e),this.delegate.onSpriteRemoved(e,this),this.rearrangeMeshes()}},u._addToRenderMesh=function(e){for(var t,n=this,r=e.renderInfo,i=this._meshes,o=i.length,s=this.engine,u=e.listIndex,c=0;c<i.length;c++){var l=i[c];if(-1===l.listIndexStart){o=c;break}var f=l.listIndexEnd;if(u<f){o=c;break}if(u>f){var h=i[c+1];if(!h||h.listIndexStart>u&&l.availableItemCount>0){o=c;break}}}if(o===i.length)(t=new a.a(r,s)).calculateGroup=this.calculateGroup,t.addItem(e),i.push(t);else{t=i[o];var d=r.cacheId;if(!t.itemCount||t.renderCacheId===d&&t.availableItemCount>0)t.addItem(e);else{for(var _,m=t.items,p=m.length,v=0;v<m.length;v++)if(m[v].listIndex>u){p=v;break}if(0===p){var g=a.a.fromItems([e],s);g.calculateGroup=this.calculateGroup,i.splice(o,0,g)}else if(p===m.length){var y=a.a.fromItems([e],s);y.calculateGroup=this.calculateGroup,i.splice(o+1,0,y)}else{var E=m.slice(0,p),T=m.slice(p);E[0].renderInfo.cacheId===d?(E.push(e),_=[E,T]):T[0].renderInfo.cacheId===d?(T.unshift(e),_=[E,T]):_=[E,[e],T],(_=_.map((function(e,r){return(t=a.a.fromItems(e,s)).calculateGroup=n.calculateGroup,t}))).unshift(o,1),i.splice.apply(i,_)}this.rearrangeMeshes()}}return this.resetMeshes(),t},u.getSpriteMesh=function(e){for(var t=this._meshes,n=0;n<t.length;n++){var r=t[n];if(r.items.indexOf(e)>-1)return r}},u._onUpdate=function(e){for(var t,n=this.time+=e/1e3,r=this._meshes,i=0;i<r.length;i++){var a=r[i];a.time=n;for(var o=a.items,u=0;u<o.length;u++){var c=o[u];c.updateTime(n),c.ended&&4!==c.options.endBehavior?(s.push(c),t=!0):a.updateItem(c)}for(var l=0;l<s.length;l++){var f=s[l];a.removeItem(f),this.delegate.onSpriteRemoved(f,this)}s.length=0,a.applyChange()}t&&this.rearrangeMeshes()},u.resetMeshes=function(){return this.setMeshes(this._meshes),this._meshes},u.rearrangeMeshes=function(){for(var e=this._meshes,t=[],n=!1,r=0;r<e.length;){for(var i=e[r],o=i.renderCacheId,s=i.items.slice(),u=r+1,c=1,l=u;u<e.length;u++){var f=e[u];if(f.renderCacheId!==o)break;s.push.apply(s,f.items),c++,l++}var h=Math.ceil(s.length/a.c);if(c>h){n=!0;for(var d=r;d<u;d++)this.delegate.onSpriteMeshDestroy(e[d]);for(var _=0;_<h;_++){var m=_*a.c,p=a.a.fromItems(s.slice(m,a.c+m),this.engine);p.calculateGroup=this.calculateGroup,t.push(p)}}else for(var v=r;v<u;v++)t.push(e[v]);r=l}return e.length!==t.length&&(n=!0),e=t,this._meshes=e,1!==e.length||e[0].itemCount||(this.delegate.onSpriteMeshDestroy(e[0]),this._meshes=[]),n&&this.resetMeshes(),e},u.removeAll=function(){for(var e=this._meshes,t=0;t<e.length;t++)this.delegate.onSpriteMeshDestroy(e[t]);this._meshes=[],this.resetMeshes(),this.time=0},u.destroy=function(t){e.prototype.destroy.call(this,t),this.delegate=null},r}(r.a.Node)},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(11),i=n(8),a=n(14),o=n(12),s=n(0),u=n(21),c=function(){function e(e){this._targetFPS=e||60,this._interval=1e3/this._targetFPS,this._tickers=[],this._paused=!0,this._lastTime=0,this._tickCount=0,this._tickTime=0,this._measuredFPS=0}var t=e.prototype;return t.start=function(){var e=this;if(this._paused=!1,!this._intervalId){this._lastTime=+new Date;var t,n=this,r=this._interval,i=requestAnimationFrame;i&&r<17?(this._useRAF=!0,t=function(){n._intervalId=i(t),e._paused||n._tick()}):t=function(){n._intervalId=setTimeout(t,r),e._paused||n._tick()},t()}},t.stop=function(){this._useRAF?cancelAnimationFrame(this._intervalId):clearTimeout(this._intervalId),this._intervalId=null,this._lastTime=0,this._paused=!0,this._tickers=[]},t.pause=function(){this._paused=!0},t.resume=function(){this._paused=!1},t._tick=function(){if(!this._paused){var e=+new Date,t=e-this._lastTime,n=this._tickers;++this._tickCount>=this._targetFPS?(this._measuredFPS=1e3/(this._tickTime/this._tickCount)+.5>>0,this._tickCount=0,this._tickTime=0):this._tickTime+=e-this._lastTime,this._lastTime=e,this._resetTikers&&(n=this._tickers=n.filter((function(e){return e&&e.tick})),this._resetTikers=!1);for(var r=0,i=n.length;r<i;r++){var a=n[r];a&&a.tick(t)}}},t.addTicker=function(e){if(!e||"function"!=typeof e.tick)throw new Error("Ticker: The tick object must implement the tick method.");this._tickers.push(e)},t.removeTicker=function(e){var t=this._tickers,n=t.indexOf(e);n>=0&&(t[n]=0,this._resetTikers=!0)},t.nextTick=function(e){var t=this,n={tick:function(r){t.removeTicker(n),e(r)}};return t.addTick(n),n},e}(),l=n(18);function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(e){var t,n=this;if(this.pausePlayer=function(e){n.pause()&&n.onPausedByItem({name:e.name,player:n})},this._onTouchStart=function(e){1===e.touches.length&&n._onClick(e.touches[0])},this._onClick=function(e){if(n.interactive){var t=e.target.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*2-1,i=1-(e.clientY-t.top)/t.height*2;n.compositions.forEach((function(e){var t=e.hitTest(r,i);if(t.length)for(var a=0;a<t.length;a++){var o=t[a],s=o.behavior;0===s?n.onItemClicked({name:o.name,player:n,composition:e.name,id:o.id,hitPositions:o.hitPositions}):1===s&&n.resume()}}))}},this._onResume=function(){n.onPlayableUpdate({player:n,playing:!0})},e.canvas)t=e.canvas;else{var a=e.container;t=document.createElement("canvas"),a.appendChild(t)}var o=Object(s.e)(e.onWebGLContextLost)?e.onWebGLContextLost:s.j;this._onWebGLContextLost=function(){n.destroy(!0),o(n)},t.addEventListener("webglcontextlost",this._onWebGLContextLost),this.canvas=t;var u=this.renderer=r.rendererInterface.createPlayerRenderer(t);e.manualRender||(this.ticker=new c(60)).addTicker(this);this.interactive=e.interactive,this.resize(),this.onMessageItem=e.onMessageItem;var l=!1!==e.transparentBackground;u.init({preserveDrawingBuffer:!!e.willCaptureImage,alpha:l,pixelRatio:e.pixelRatio||window.devicePixelRatio}),Object(s.e)(e.onPlayableUpdate)&&(this.onPlayableUpdate=e.onPlayableUpdate),Object(s.e)(e.onPausedByItem)&&(this.onPausedByItem=e.onPausedByItem),Object(s.e)(e.onItemClicked)&&(this.onItemClicked=e.onItemClicked),Object(s.e)(e.onMessageItem)&&(this.onMessageItem=e.onMessageItem),Object(s.e)(e.onRenderError)&&(this.onRenderError=e.onRenderError),Object(i.c)()?t.addEventListener("touchstart",this._onTouchStart):t.addEventListener("click",this._onClick),this._pluginLoaderMap={},this.compositions=[]}var t,n,h,d=e.prototype;return d.resizeToAspect=function(e,t){t=t||1,e===this.displayAspect&&t===this.displayScale||(this.displayAspect=e,this.displayScale=t),this.resize()},d.resize=function(){var e,t,n=this.canvas.parentElement;if(n){var r=this.displayAspect;if(r)n.clientWidth/n.clientHeight>r?e=(t=n.clientHeight*this.displayScale)*r:t=(e=n.clientWidth*this.displayScale)/r;else e=n.clientWidth,t=n.clientHeight}e&&t&&this.renderer.resize(e,t)},d._tick=function(e,t){e=Math.min(e,33);for(var n=!1,r=this.compositions,i=0;i<r.length;i++){var a=r[i];a.shouldRestart&&a.restart();var o=a.renderer;o&&a.tick(e),a.shouldDestroy||!o?(a.destroy(),r[i]=null,n=!0):o.dispose()}n&&(this.compositions=r.filter((function(e){return e}))),this.paused&&!t||((this.compositions.length||t)&&this.renderer.render(),this._forwardingTime||this.onPlayableUpdate({player:!0,playing:!0}))},d.tick=function(e){try{this._tick(e,this._forceRenderNextFrame),this._forceRenderNextFrame=!1}catch(e){this.onRenderError(this,e)}},d.onRenderError=function(e,t){throw t},d.loadSceneAsync=function(e,t){var n=this;if(!this.renderer.supportWebGL)return Promise.reject("webgl not support");var r=this.renderer.gl;return Object(o.c)(r),Object(a.c)(e,Object(s.k)({},t)).then((function(e){return n.loadPluginsAsync(e,t)}))},d.loadPluginsAsync=function(e,t){var n=this,r=[];(e.plugins||[]).forEach((function(e){var t=n._pluginLoaderMap[e];t||(t=n._pluginLoaderMap[e]=Object(l.b)(e)),r.push(t)}));var i=new l.a(r);return i.loadResourcesAsync(e,t,this.renderer).then((function(){return e.pluginSystem=i,e}))},d.snapshot=function(e){var t,n=e.target||"dataURL",r=this.renderer;if("texture"===n&&(t=this.renderer.createFramebuffer(e.textureSize)).bind(),e.scene?this.play(e.scene,e.playable):r.render(),"dataURL"===n)return r.canvas.toDataURL(e.imageType||"image/png",e.imageQuality);if("data"===n){var i=this.canvas,a=new ImageData(width||i.width,height||i.height),o=r.gl;return o.readPixels(0,0,a.width,a.height,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),a}return t.unbind(),r.destroyFramebuffer(t,!0)},d.clearCanvas=function(e){if(e){var t=this.renderer.gl;t&&(t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT|t.DEPTH_BUFFER_BIT))}else this._forceRenderNextFrame=!0},d.config=function(e){var t=Object(s.h)(e.compositionName),n=t&&this.compositions.find((function(t){return t.name===e.compositionName}));if("speed"in e){var r=+e.speed||1;t?n&&(n.speed=r):this.compositions.forEach((function(e){return e.speed=r}))}},d.initializeComposition=function(e,t){if(this.renderer.supportWebGL){t=t||{},e.renderLevel=t.renderLevel;var n=e.reusable=!!t.willReverseTime,r=e.compositionId,i=t.compositionName;if(i){var o=Object(a.a)(e.compositions,i);if(!o)throw Error("composition for name "+i+" not found");r=o.id}e.fixRenderOrder=t.fixRenderOrder;var s=Object(a.b)(e.compositions,r,{transform:t.transform,mask:0,baseRenderOrder:t.baseRenderOrder||0},e);isNaN(s.endBehavior)&&(s.endBehavior=1);var c=this.renderer.createCompositionRenderer(t);c.baseRenderOrder=t.baseRenderOrder;var l=new u.a({speed:t.speed,precompile:t.precompile,content:s,imageUsage:!n&&e.imageUsage,keepResource:t.keepResource,textures:e.textures,renderer:c,pausePlayer:this.pausePlayer,onMessageItem:this.onMessageItem,onEnd:t.onEnd,pluginSystem:e.pluginSystem,scene:e});return e.imageUsage=e.textures=void 0,l._startContent(),l}},d.play=function(e,t){if(t=t||{},this.renderer.supportWebGL){var n,r=e instanceof u.a?e:this.initializeComposition(e,t);t.multipleCompositions?this.compositions.push(r):(this.compositions.forEach((function(e){return e.destroy()})),this.compositions=[r]);var i=r.camera;return i&&(r.camera=i),r.start(),null==(n=this.ticker)||n.start(),this.forwardCompositionTime(r,t.currentTime||r.startTime),this._renderFrame({pauseOnFirstFrame:t.pauseOnFirstFrame}),r}},d.forwardCompositionTime=function(e,t){t&&(this._forwardingTime=!0,e.forwardTime(t),this._forwardingTime=!1)},d._renderFrame=function(e){var t=this;this.compositions.forEach((function(n){return t.forwardCompositionTime(n,e.currentTime)})),this._tick(0,!0),e.pauseOnFirstFrame?this.pause():this.resume()},d.onItemClicked=function(e){},d.pause=function(){var e;if(!this.paused)return null==(e=this.ticker)||e.pause(),this.onPlayableUpdate({player:this,playing:!1}),!0},d.resume=function(){var e;this.paused&&(null==(e=this.ticker)||e.resume(),this._onResume())},d.onPlayableUpdate=function(){},d.onPausedByItem=function(){},d.destroy=function(){var e,t=this.renderer,n=t.canvas;null==(e=this.ticker)||e.stop(),this.compositions.forEach((function(e){return null==e?void 0:e.destroy()})),n.removeEventListener("webglcontextlost",this._onWebGLContextLost),n.removeEventListener("click",this._onClick),n.removeEventListener("touchstart",this._onTouchStart),Object(s.d)(this._pluginLoaderMap,(function(e){return e.destroy(t)})),t.destroy(!0)},d.destroyItem=function(e,t){t=t||{};var n=this.compositions[0],r=t.composition;r&&(n=this.compositions.find((function(e){return e===r}))),n&&n.destroyItem(e,t)},t=e,(n=[{key:"currentCompositionName",get:function(){var e=this.compositions[0];return e&&e.name}},{key:"hasPlayable",get:function(){return this.compositions.length>0}},{key:"paused",get:function(){var e;return null==(e=this.ticker)?void 0:e._paused}}])&&f(t.prototype,n),h&&f(t,h),e}()},function(e,t){e.exports="precision highp float;\n#define SHADER_VERTEX 1\n\n#ifdef SHADER_VERTEX\n\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n\n#define CURVE_VALUE_ARRAY uVCurveValues\n\n#else\n\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n\n#define CURVE_VALUE_ARRAY uFCurveValues\n\n#endif\n\n#if CURVE_VALUE_COUNT\n\n#ifdef LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n\n#endif\n\n#endif\n\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#define NONE_CONST_INDEX 1\n\n#else\n\n#ifdef LOOKUP_TEXTURE_CURVE\n\n#define NONE_CONST_INDEX 1\n\n#endif\n\n#endif\n\n#ifdef NONE_CONST_INDEX\n\n#define MAX_C  MAX_KEY_FRAME_COUNT\n\n#else\n\n#define MAX_C  CURVE_VALUE_COUNT\n\n#endif\n\n#ifdef USE_CURVE_VALUE\nfloat a(float b,vec4 c,vec4 d){float e=d.x-c.x;float f=c.w*e;float g=d.z*e;float h=(b-c.x)/e;float i=h*h;float j=i*h;return dot(vec4(dot(vec3(2.,-3.,1.),vec3(j,i,1.)),dot(vec3(1,-2.,1),vec3(j,i,h)),j-i,dot(vec2(-2,3),vec2(j,i))),vec4(c.y,f,g,d.y));}float k(float b,float l,float m){int n=int(l);int o=int(m-1.);int p=n+o;for(int q=0;q<MAX_C;q++){\n#ifdef NONE_CONST_INDEX\nif(q==o){return lookup_curve(o).y;}vec4 r=lookup_curve(q+n);vec4 s=lookup_curve(q+1+n);\n#else\nif(q<n){continue;}vec4 r=lookup_curve(q);vec4 s=lookup_curve(q+1);if(q==p){return r.y;}\n#endif\nif(b>=r.x&&b<=s.x){return a(b,r,s);}}return lookup_curve(0).y;}\n#endif\n\n#ifdef USE_LINE_SEG\nfloat t(float h,vec2 u,vec2 v){return u.y+(v.y-u.y)*(h-u.x)/(v.x-u.x);}float w(float b,float l,float m){int n=int(l);int o=int(m-1.);int p=n+o;for(int q=0;q<MAX_C;q++){\n#ifdef NONE_CONST_INDEX\nif(q>o){return lookup_curve(q).w;}\n#else\nif(q<n){continue;}if(q>p){return lookup_curve(q-2).w;}\n#endif\n#ifdef NONE_CONST_INDEX\nvec4 x=lookup_curve(q+n);\n#else\nvec4 x=lookup_curve(q);\n#endif\nvec2 u=x.xy;vec2 v=x.zw;if(b>=u.x&&b<=v.x){return t(b,u,v);}\n#ifdef NONE_CONST_INDEX\nvec2 y=lookup_curve(q+n+1).xy;\n#else\nvec2 y=lookup_curve(q+1).xy;\n#endif\nif(b>v.x&&b<=y.x){return t(b,v,y);}}return lookup_curve(0).y;}\n#endif\nfloat getValueFromTime(float b,vec4 z){float A=z.x;if(A==0.){return z.y;}else if(A==1.){return mix(z.y,z.z,b/z.w);}\n#ifdef USE_LINE_SEG\nif(A==3.){return w(b,z.y,z.z);}\n#endif\n#ifdef USE_CURVE_VALUE\nif(A==2.){return k(b,floor(z.y),floor(1./fract(z.y)+0.5))*z.w+z.z;}\n#endif\nif(A==4.){\n#ifdef SHADER_VERTEX\nfloat seed=aSeed;\n#else\nfloat seed=vSeed;\n#endif\nreturn mix(z.y,z.z,seed);}return 0.;}\n#ifdef USE_CURVE_VALUE\nfloat B(float C,vec4 r,vec4 s){float D=s.x-r.x;float f=r.w*D;float g=s.z*D;float E=r.x;float F=r.y;float G=s.y;float e=E-C;float H=e*e;float I=H*e;vec4 J=vec4(I*e,I,H,e)/vec4(4.*D*D*D,3.*D*D,2.*D,1.);vec4 K=vec4(f+g+2.*F-2.*G,2.*f+g+3.*F-3.*G,f,-F);return dot(J,K);}float L(float C,vec4 r,vec4 s){float D=s.x-r.x;float f=r.w*D;float g=s.z*D;float E=r.x;float F=r.y;float G=s.y;float e=E-C;float H=e*e;float I=H*e;float M=D*D;float N=M*D;vec4 J=vec4(-30.*N,10.*M,5.*D,3.)*vec4(e,H,I,I*e);vec4 K=vec4(F,f,2.*f+g+3.*F-3.*G,f+g+2.*F-2.*G)*vec4(E+C,E+2.*C,E+3.*C,E+4.*C);return dot(J,K)/60./N;}float O(float C,float l,float m){if(C==0.){return 0.;}int n=int(l);int o=int(m-1.);float P=0.;for(int q=0;q<MAX_KEY_FRAME_COUNT;q++){if(q==o){return P;}vec4 r=lookup_curve(q+n);vec4 s=lookup_curve(q+1+n);if(C>r.x&&C<=s.x){return P+L(C,r,s);}P+=L(s.x,r,s);}return P;}float Q(float b,float l,float m){if(b==0.){return 0.;}int n=int(l);int o=int(m-1.);float P=0.;for(int q=0;q<MAX_KEY_FRAME_COUNT;q++){if(q==o){return P;}vec4 r=lookup_curve(q+n);vec4 s=lookup_curve(q+1+n);if(b>r.x&&b<=s.x){return P+B(b,r,s);}P+=B(s.x,r,s);}return P;}\n#endif\nfloat R(float h,vec2 u,vec2 v){float E=u.x;float C=v.x;float S=u.y;float T=v.y;float U=dot(vec4(2.*h*h*h,3.*h*h,-E*E*E,3.*E*E),vec4(S-T,E*T-C*S,2.*S+T,C*S));return U/(E-C)/6.;}float V(float b,vec2 u,vec2 v){float W=b-u.x;float S=u.y;return (S+S+(v.y-S)*W/(v.x-u.x))*W/2.;}\n#ifdef USE_LINE_SEG\nfloat X(float b,float l,float m){if(b==0.){return 0.;}int n=int(l);int o=int(m-1.);float P=0.;for(int q=0;q<MAX_KEY_FRAME_COUNT;q++){if(q>o){return P;}vec4 Y=lookup_curve(q+n);vec2 r=Y.xy;vec2 s=Y.zw;if(b>r.x&&b<=s.x){return P+V(b,r,s);}P+=V(s.x,r,s);vec2 M=lookup_curve(q+n+1).xy;if(b>s.x&&b<=M.x){return P+V(b,s,M);}P+=V(M.x,s,M);}return P;}float Z(float b,float l,float m){if(b==0.){return 0.;}int n=int(l);int o=int(m-1.);float P=0.;for(int q=0;q<MAX_KEY_FRAME_COUNT;q++){if(q>o){return P;}vec4 Y=lookup_curve(q+n);vec2 r=Y.xy;vec2 s=Y.zw;if(b>r.x&&b<=s.x){return P+R(b,r,s);}P+=R(s.x,r,s);vec2 M=lookup_curve(q+n+1).xy;if(b>s.x&&b<=M.x){return P+R(b,s,M);}P+=R(M.x,s,M);}return P;}\n#endif\nfloat getIntegrateFromTime0(float C,vec4 z){float A=z.x;if(A==0.){return z.y*C;}else if(A==1.){vec2 u=vec2(0.,z.y);vec2 v=vec2(z.w,z.z);return V(C,u,v);}\n#ifdef USE_LINE_SEG\nif(A==3.){return X(C,z.y,z.z);}\n#endif\n#ifdef USE_CURVE_VALUE\nif(A==2.){float ba=floor(z.y);float bb=floor(1./fract(z.y)+0.5);float bc=Q(C,ba,bb);return bc*z.w+z.z;}\n#endif\nif(A==4.){return mix(z.y,z.z,aSeed)*C;}return 0.;}float bd(float E,float C,vec4 z){float A=z.x;if(A==0.){return z.y*(C*C-E*E)/2.;}else if(A==1.){vec2 u=vec2(0.,z.y);vec2 v=vec2(z.w,z.z);return R(C,u,v)-R(E,u,v);}\n#ifdef USE_LINE_SEG\nif(A==3.){return Z(C,z.y,z.z)-Z(E,z.y,z.z);}\n#endif\n#ifdef USE_CURVE_VALUE\nif(A==2.){float ba=floor(z.y);float bb=floor(1./fract(z.y)+0.5);float bc=O(C,ba,bb)-O(E,ba,bb);return bc*z.w+z.z;}\n#endif\nif(A==4.){return mix(z.y,z.z,aSeed)*(C*C-E*E)/2.;}return 0.;}const float be=3.141592653589793/180.;attribute vec3 aPos;attribute vec4 aOffset;attribute vec3 aVel;attribute vec3 aRot;attribute vec4 aColor;attribute vec3 aDirX;attribute vec3 aDirY;\n#ifdef USE_SPRITE\nattribute vec3 aSprite;uniform vec4 uSprite;vec2 bf(vec2 bg,float bh,out vec3 bi);varying vec4 vTexCoordBlend;\n#endif\n\n#ifdef FINAL_TARGET\nuniform vec3 uFinalTarget;uniform vec4 uForceCurve;\n#endif\nuniform mat4 uModel;uniform mat4 uView;uniform mat4 uViewProjection;uniform vec4 uParams;uniform vec4 uAcceleration;uniform float uOpacityOverLifetime;uniform vec4 uGravityModifierValue;uniform vec4 uOpacityOverLifetimeValue;\n#ifdef ROT_X_LIFETIME\nuniform vec4 uRXByLifeTimeValue;\n#endif\n\n#ifdef ROT_Y_LIFETIME\nuniform vec4 uRYByLifeTimeValue;\n#endif\n\n#ifdef ROT_Z_LIFETIME\nuniform vec4 uRZByLifeTimeValue;\n#endif\n\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\n\n#if LINEAR_VEL_X + LINEAR_VEL_Y + LINEAR_VEL_Z\n\n#if LINEAR_VEL_X\nuniform vec4 uLinearXByLifetimeValue;\n#endif\n\n#if LINEAR_VEL_Y\nuniform vec4 uLinearYByLifetimeValue;\n#endif\n\n#if LINEAR_VEL_Z\nuniform vec4 uLinearZByLifetimeValue;\n#endif\n\n#endif\n\n#ifdef SPEED_OVER_LIFETIME\nuniform vec4 uSpeedLifetimeValue;\n#endif\n\n#if ORB_VEL_X + ORB_VEL_Y + ORB_VEL_Z\n\n#if ORB_VEL_X\nuniform vec4 uOrbXByLifetimeValue;\n#endif\n\n#if ORB_VEL_Y\nuniform vec4 uOrbYByLifetimeValue;\n#endif\n\n#if ORB_VEL_Z\nuniform vec4 uOrbZByLifetimeValue;\n#endif\nuniform vec3 uOrbCenter;\n#endif\n\n#ifdef SIZE_BY_LIFE\nuniform vec4 uSizeByLifetimeValue;\n#endif\n\n#ifdef SIZE_Y_BY_LIFE\nuniform vec4 uSizeYByLifetimeValue;\n#endif\nvarying float vLife;varying vec4 vColor;varying vec2 vTexCoord;\n#ifdef USE_FILTER\n\n#pragma FILTER\n\n#endif\nvec3 bj(float _life,float _dur){vec3 bk=vec3(0.0);\n#ifdef AS_ORBITAL_MOVEMENT\n#define FUNC(a) getValueFromTime(_life,a)\n#else\n#define FUNC(a) getIntegrateFromTime0(_life,a) * _dur\n#endif\n#if ORB_VEL_X\nbk.x=FUNC(uOrbXByLifetimeValue);\n#endif\n#if ORB_VEL_Y\nbk.y=FUNC(uOrbYByLifetimeValue);\n#endif\n#if ORB_VEL_Z\nbk.z=FUNC(uOrbZByLifetimeValue);\n#endif\n#undef FUNC\nreturn bk;}vec3 bl(float _life,float _time,float _dur){vec3 bm=vec3(0.0);\n#ifdef AS_LINEAR_MOVEMENT\n#define FUNC(a) getValueFromTime(_life,a)\n#else\n#define FUNC(a) getIntegrateFromTime0(_time/_dur,a) * _dur\n#endif\n#if LINEAR_VEL_X\nbm.x=FUNC(uLinearXByLifetimeValue);\n#endif\n#if LINEAR_VEL_Y\nbm.y=FUNC(uLinearYByLifetimeValue);\n#endif\n#if LINEAR_VEL_Z\nbm.z=FUNC(uLinearZByLifetimeValue);\n#endif\n#undef FUNC\nreturn bm;}mat3 bn(vec3 bo){vec3 bp=sin(bo*be);vec3 bq=cos(bo*be);return mat3(1.,0.,0.,0,bq.x,-bp.x,0.,bp.x,bq.x)*mat3(bq.y,0.,bp.y,0.,1.,0.,-bp.y,0,bq.y)*mat3(bq.z,-bp.z,0.,bp.z,bq.z,0.,0.,0.,1.);}\n#ifdef USE_SPRITE\nvec2 bf(vec2 bg,float bh,out vec3 bi){float h=clamp((bh-aSprite.x)/aSprite.y,0.0,1.)*aSprite.z;float br=uSprite.z*h;float bs=max(ceil(br)-1.,0.);float bt=floor((bs+0.1)/uSprite.x);float bu=bs-bt*uSprite.x;vec2 bv=(vec2(bu,bt)+bg)/uSprite.xy;if(uSprite.w>0.){float bw=br-bs;float bx=min(ceil(br),uSprite.z-1.);float by=floor((bx+0.1)/uSprite.x);float bz=bx-by*uSprite.x;vec2 bA=(vec2(bz,by)+bg)/uSprite.xy-bv;bi=vec3(bA.x,1.-bA.y,bw);}return vec2(bv.x,1.-bv.y);}\n#endif\nvec3 bB(vec3 bC,float E,float C,float bD){float e=C-E;float bc=bd(0.,e,uGravityModifierValue);vec3 bE=uAcceleration.xyz*bc;\n#ifdef SPEED_OVER_LIFETIME\nreturn bC*getIntegrateFromTime0(e/bD,uSpeedLifetimeValue)*bD+bE;\n#endif\nreturn bC*e+bE;}mat3 bF(vec3 bG,float b){vec3 bo=bG;\n#ifdef ROT_LIFETIME_AS_MOVEMENT\n#define FUNC1 getValueFromTime\n#else\n#define FUNC1 getIntegrateFromTime0\n#endif\n#ifdef ROT_X_LIFETIME\nbo.x+=FUNC1(b,uRXByLifeTimeValue);\n#endif\n#ifdef ROT_Y_LIFETIME\nbo.y+=FUNC1(b,uRYByLifeTimeValue);\n#endif\n#ifdef ROT_Z_LIFETIME\nbo.z+=FUNC1(b,uRZByLifeTimeValue);\n#endif\nif(dot(bo,bo)==0.0){return mat3(1.0);}\n#undef FUNC1\nreturn bn(bo);}void main(){float b=uParams.x-aOffset.z;float bD=aOffset.w;if(b<0.||b>bD){gl_Position=vec4(-3.,-3.,-3.,1.);}else{float bH=clamp(b/bD,0.0,1.0);vLife=bH;\n#ifdef USE_SPRITE\nvec3 bI;vTexCoord=bf(aOffset.xy,b,bI);vTexCoordBlend=vec4(bI,uSprite.w);\n#else\nvTexCoord=vec2(aOffset.x,1.-aOffset.y);\n#endif\nvColor=aColor;\n#ifdef COLOR_OVER_LIFETIME\n#ifdef ENABLE_VERTEX_TEXTURE\nvColor*=texture2D(uColorOverLifetime,vec2(bH,0.));\n#endif\n#endif\nif(uOpacityOverLifetime>0.0){vColor.a*=clamp(getValueFromTime(bH,uOpacityOverLifetimeValue),0.,1.);}vec2 bJ=vec2(1.0);\n#ifdef SIZE_BY_LIFE\nbJ=vec2(getValueFromTime(bH,uSizeByLifetimeValue));\n#endif\n#ifdef SIZE_Y_BY_LIFE\nbJ.y=getValueFromTime(bH,uSizeYByLifetimeValue);\n#endif\nvec3 bK=bF(aRot,bH)*(aDirX*bJ.x+aDirY*bJ.y);vec3 bL=bB(aVel,aOffset.z,uParams.x,bD);vec3 bM=aPos+bL;\n#if ORB_VEL_X + ORB_VEL_Y + ORB_VEL_Z\nbM=(bM-uOrbCenter)*bn(bj(bH,bD));bM+=uOrbCenter;\n#endif\n#if LINEAR_VEL_X + LINEAR_VEL_Y + LINEAR_VEL_Z\nbM.xyz+=bl(bH,b,bD);\n#endif\n#ifdef FINAL_TARGET\nfloat bN=getValueFromTime(bH,uForceCurve);vec4 bO=vec4(mix(bM,uFinalTarget,bN),1.);\n#else\nvec4 bO=vec4(bM,1.0);\n#endif\n#if RENDER_MODE == 1\nbO.xyz+=bK;bO=uModel*bO;\n#elif RENDER_MODE == 3\nbO=uModel*bO;bO.xyz+=uView[0].xyz*bK.x+uView[2].xyz*bK.y;\n#elif RENDER_MODE == 2\nbO=uModel*bO;bO.xy+=bK.xy;\n#elif RENDER_MODE == 0\nbO=uModel*bO;bO.xyz+=uView[0].xyz*bK.x+uView[1].xyz*bK.y;\n#endif\ngl_Position=uViewProjection*bO;vSeed=aSeed;gl_PointSize=6.0;\n#ifdef USE_FILTER\nmain_filter(bH);\n#endif\n}}"},function(e,t){e.exports="precision mediump float;\n#define SHADER_VERTEX 1\n\n#ifdef SHADER_VERTEX\n\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n\n#define CURVE_VALUE_ARRAY uVCurveValues\n\n#else\n\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n\n#define CURVE_VALUE_ARRAY uFCurveValues\n\n#endif\n\n#if CURVE_VALUE_COUNT\n\n#ifdef LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n\n#endif\n\n#endif\n\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#define NONE_CONST_INDEX 1\n\n#else\n\n#ifdef LOOKUP_TEXTURE_CURVE\n\n#define NONE_CONST_INDEX 1\n\n#endif\n\n#endif\n\n#ifdef NONE_CONST_INDEX\n\n#define MAX_C  MAX_KEY_FRAME_COUNT\n\n#else\n\n#define MAX_C  CURVE_VALUE_COUNT\n\n#endif\n\n#ifdef USE_CURVE_VALUE\nfloat a(float b,vec4 c,vec4 d){float e=d.x-c.x;float f=c.w*e;float g=d.z*e;float h=(b-c.x)/e;float i=h*h;float j=i*h;return dot(vec4(dot(vec3(2.,-3.,1.),vec3(j,i,1.)),dot(vec3(1,-2.,1),vec3(j,i,h)),j-i,dot(vec2(-2,3),vec2(j,i))),vec4(c.y,f,g,d.y));}float k(float b,float l,float m){int n=int(l);int o=int(m-1.);int p=n+o;for(int q=0;q<MAX_C;q++){\n#ifdef NONE_CONST_INDEX\nif(q==o){return lookup_curve(o).y;}vec4 r=lookup_curve(q+n);vec4 s=lookup_curve(q+1+n);\n#else\nif(q<n){continue;}vec4 r=lookup_curve(q);vec4 s=lookup_curve(q+1);if(q==p){return r.y;}\n#endif\nif(b>=r.x&&b<=s.x){return a(b,r,s);}}return lookup_curve(0).y;}\n#endif\n\n#ifdef USE_LINE_SEG\nfloat t(float h,vec2 u,vec2 v){return u.y+(v.y-u.y)*(h-u.x)/(v.x-u.x);}float w(float b,float l,float m){int n=int(l);int o=int(m-1.);int p=n+o;for(int q=0;q<MAX_C;q++){\n#ifdef NONE_CONST_INDEX\nif(q>o){return lookup_curve(q).w;}\n#else\nif(q<n){continue;}if(q>p){return lookup_curve(q-2).w;}\n#endif\n#ifdef NONE_CONST_INDEX\nvec4 x=lookup_curve(q+n);\n#else\nvec4 x=lookup_curve(q);\n#endif\nvec2 u=x.xy;vec2 v=x.zw;if(b>=u.x&&b<=v.x){return t(b,u,v);}\n#ifdef NONE_CONST_INDEX\nvec2 y=lookup_curve(q+n+1).xy;\n#else\nvec2 y=lookup_curve(q+1).xy;\n#endif\nif(b>v.x&&b<=y.x){return t(b,v,y);}}return lookup_curve(0).y;}\n#endif\nfloat getValueFromTime(float b,vec4 z){float A=z.x;if(A==0.){return z.y;}else if(A==1.){return mix(z.y,z.z,b/z.w);}\n#ifdef USE_LINE_SEG\nif(A==3.){return w(b,z.y,z.z);}\n#endif\n#ifdef USE_CURVE_VALUE\nif(A==2.){return k(b,floor(z.y),floor(1./fract(z.y)+0.5))*z.w+z.z;}\n#endif\nif(A==4.){\n#ifdef SHADER_VERTEX\nfloat seed=aSeed;\n#else\nfloat seed=vSeed;\n#endif\nreturn mix(z.y,z.z,seed);}return 0.;}attribute vec4 aPos;attribute vec3 aDir;attribute vec4 aInfo;attribute vec4 aColor;\n#ifdef ATTR_TRAIL_START\nattribute float aTrailStart;\n#else\nuniform float uTrailStart[64];attribute float aTrailStartIndex;\n#endif\nuniform mat4 uView;uniform mat4 uModel;uniform mat4 uViewProjection;uniform vec4 uTextureMap;uniform float uTime;uniform vec4 uParams;uniform vec4 uColorParams;uniform vec4 uOpacityOverLifetimeValue;uniform vec4 uWidthOverTrail;\n#ifdef COLOR_OVER_TRAIL\nuniform sampler2D uColorOverTrail;\n#endif\n\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\nvarying float vLife;varying vec2 vTexCoord;varying vec4 vColor;void main(){vec4 B=uViewProjection*vec4(aPos.xyz,1.);vec4 C=uViewProjection*vec4(aPos.xyz+aDir,1.);vec2 D=normalize(C.xy/C.w-B.xy/B.w);vec2 E=vec2(-D.y,D.x);vec4 F=uModel*vec4(aPos.xyz,1.);\n#ifdef ATTR_TRAIL_START\nfloat G=aTrailStart;\n#else\nfloat G=uTrailStart[int(aTrailStartIndex)];\n#endif\nfloat H=(G-aInfo.z)/uParams.y;float I=aPos.w*getValueFromTime(H,uWidthOverTrail)/max(abs(E.x),abs(E.y));F.xyz+=(uView[0].xyz*E.x+uView[1].xyz*E.y)*I;float b=min((uTime-aInfo.x)/aInfo.y,1.0);gl_Position=uViewProjection*F;vColor=aColor;\n#ifdef COLOR_OVER_LIFETIME\n#ifdef ENABLE_VERTEX_TEXTURE\nvColor*=texture2D(uColorOverLifetime,vec2(b,0.));\n#endif\n#endif\n#ifdef COLOR_OVER_TRAIL\nvColor*=texture2D(uColorOverTrail,vec2(H,0.));\n#endif\nvColor.a*=clamp(getValueFromTime(b,uOpacityOverLifetimeValue),0.,1.);vLife=b;vTexCoord=uTextureMap.xy+vec2(H,aInfo.w)*uTextureMap.zw;vSeed=aSeed;}"},function(e,t){e.exports="precision highp float;\n#define SHADER_VERTEX 1\nattribute vec4 aPoint;attribute float aIndex;uniform vec4 uParams;uniform vec4 uPos[8];uniform vec4 uRot[8];uniform vec4 uColor[8];uniform vec4 uTexParams[8];uniform mat4 uModel;uniform mat4 uView;uniform mat4 uViewProjection;varying vec4 vColor;varying vec4 vTexCoord;varying vec2 vParams;const float a=3.141592653589793/180.;mat3 b(vec3 c){vec3 d=sin(c*a);vec3 e=cos(c*a);return mat3(1.,0.,0.,0,e.x,-d.x,0.,d.x,e.x)*mat3(e.y,0.,d.y,0.,1.,0.,-d.y,0,e.y)*mat3(e.z,-d.z,0.,d.z,e.z,0.,0.,0.,1.);}void main(){int f=int(aIndex);vec4 g=uTexParams[f];float h=g.w;if(h<0.||h>1.){gl_Position=vec4(3.,3.,3.,1.);}else{vec4 i=uRot[f];vec4 j=uPos[f];vec3 k=b(i.xyz)*vec3(aPoint.xy*vec2(j.w,i.w),0.);vec4 l=vec4(j.xyz,1.0);float m=g.z;if(m==0.){l=uModel*l;l.xyz+=uView[0].xyz*k.x+uView[1].xyz*k.y;}else if(m==1.){l.xyz+=k;l=uModel*l;}else if(m==2.){l=uModel*l;l.xy+=k.xy;}else if(m==3.){l=uModel*l;l.xyz+=uView[0].xyz*k.x+uView[2].xyz*k.y;}gl_Position=uViewProjection*l;gl_PointSize=6.0;vTexCoord=vec4(aPoint.zw,g.xy);vColor=uColor[f];vParams=vec2(aIndex,uParams.z);}}"},function(e,t){e.exports="precision mediump float;varying vec4 vColor;varying vec4 vTexCoord;varying vec2 vParams;uniform sampler2D uSampler0;uniform sampler2D uSampler1;uniform sampler2D uSampler2;uniform sampler2D uSampler3;uniform sampler2D uSampler4;uniform sampler2D uSampler5;uniform sampler2D uSampler6;uniform sampler2D uSampler7;vec4 a(float b,vec2 c);\n#ifdef PREVIEW_BORDER\nvoid main(){gl_FragColor=vColor;}\n#else\nvoid main(){vec4 d=vec4(1.0);float b=ceil(vParams.x);d=a(b,vTexCoord.xy);if(vTexCoord.w>0.){d=vec4(1.,1.,1.,d.r*d.a);}d*=vColor;if(vParams.y>0.){d.rgb*=d.a;}if(vTexCoord.z==0.&&d.a<0.01){discard;}else{gl_FragColor=d;}}\n#endif\nvec4 a(float b,vec2 c){if(b==0.){return texture2D(uSampler0,c);}if(b==1.){return texture2D(uSampler1,c);}if(b==2.){return texture2D(uSampler2,c);}if(b==3.){return texture2D(uSampler3,c);}if(b==4.){return texture2D(uSampler4,c);}if(b==5.){return texture2D(uSampler5,c);}if(b==6.){return texture2D(uSampler6,c);}return texture2D(uSampler7,c);}"},function(e,t){e.exports="uniform vec4 uStrengthValue;varying float vStrength;void main_filter(float lifetime){vStrength=getValueFromTime(lifetime,uStrengthValue);}"},function(e,t){e.exports="\n#ifdef USE_FILTER\nstruct Particle{vec2 texCoord;vec2 texOffset;float lifetime;float seed;};\n#endif\nuniform sampler2D uNoise;uniform sampler2D uBlend;uniform vec2 uClipPoint;varying float vStrength;vec4 main_filter(Particle a,sampler2D texture){float b=1.0-length(a.texCoord-uClipPoint)/sqrt(0.5);vec2 c=fract(a.texCoord+vec2(a.seed));float d=texture2D(uNoise,c).r;float e=(b+d)/2.+vStrength;if(e>1.){return getTextureColor(uBlend,a.texCoord);}return getTextureColor(texture,a.texCoord);}"},function(e,t){e.exports="uniform vec4 uDisplayMinXValue;uniform vec4 uDisplayMinYValue;uniform vec4 uDisplayMaxXValue;uniform vec4 uDisplayMaxYValue;varying vec4 vDisplayRange;void main_filter(float lifetime){vDisplayRange=vec4(getValueFromTime(lifetime,uDisplayMinXValue),getValueFromTime(lifetime,uDisplayMaxXValue),getValueFromTime(lifetime,uDisplayMinYValue),getValueFromTime(lifetime,uDisplayMaxYValue));}"},function(e,t){e.exports="\n#ifdef SHADER_VERTEX\n\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n\n#define CURVE_VALUE_ARRAY uVCurveValues\n\n#else\n\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n\n#define CURVE_VALUE_ARRAY uFCurveValues\n\n#endif\n\n#if CURVE_VALUE_COUNT\n\n#ifdef LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n\n#endif\n\n#endif\n\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#define NONE_CONST_INDEX 1\n\n#else\n\n#ifdef LOOKUP_TEXTURE_CURVE\n\n#define NONE_CONST_INDEX 1\n\n#endif\n\n#endif\n\n#ifdef NONE_CONST_INDEX\n\n#define MAX_C  MAX_KEY_FRAME_COUNT\n\n#else\n\n#define MAX_C  CURVE_VALUE_COUNT\n\n#endif\n\n#ifdef USE_CURVE_VALUE\nfloat a(float b,vec4 c,vec4 d){float e=d.x-c.x;float f=c.w*e;float g=d.z*e;float h=(b-c.x)/e;float i=h*h;float j=i*h;return dot(vec4(dot(vec3(2.,-3.,1.),vec3(j,i,1.)),dot(vec3(1,-2.,1),vec3(j,i,h)),j-i,dot(vec2(-2,3),vec2(j,i))),vec4(c.y,f,g,d.y));}float k(float b,float l,float m){int n=int(l);int o=int(m-1.);int p=n+o;for(int q=0;q<MAX_C;q++){\n#ifdef NONE_CONST_INDEX\nif(q==o){return lookup_curve(o).y;}vec4 r=lookup_curve(q+n);vec4 s=lookup_curve(q+1+n);\n#else\nif(q<n){continue;}vec4 r=lookup_curve(q);vec4 s=lookup_curve(q+1);if(q==p){return r.y;}\n#endif\nif(b>=r.x&&b<=s.x){return a(b,r,s);}}return lookup_curve(0).y;}\n#endif\n\n#ifdef USE_LINE_SEG\nfloat t(float h,vec2 u,vec2 v){return u.y+(v.y-u.y)*(h-u.x)/(v.x-u.x);}float w(float b,float l,float m){int n=int(l);int o=int(m-1.);int p=n+o;for(int q=0;q<MAX_C;q++){\n#ifdef NONE_CONST_INDEX\nif(q>o){return lookup_curve(q).w;}\n#else\nif(q<n){continue;}if(q>p){return lookup_curve(q-2).w;}\n#endif\n#ifdef NONE_CONST_INDEX\nvec4 x=lookup_curve(q+n);\n#else\nvec4 x=lookup_curve(q);\n#endif\nvec2 u=x.xy;vec2 v=x.zw;if(b>=u.x&&b<=v.x){return t(b,u,v);}\n#ifdef NONE_CONST_INDEX\nvec2 y=lookup_curve(q+n+1).xy;\n#else\nvec2 y=lookup_curve(q+1).xy;\n#endif\nif(b>v.x&&b<=y.x){return t(b,v,y);}}return lookup_curve(0).y;}\n#endif\nfloat getValueFromTime(float b,vec4 z){float A=z.x;if(A==0.){return z.y;}else if(A==1.){return mix(z.y,z.z,b/z.w);}\n#ifdef USE_LINE_SEG\nif(A==3.){return w(b,z.y,z.z);}\n#endif\n#ifdef USE_CURVE_VALUE\nif(A==2.){return k(b,floor(z.y),floor(1./fract(z.y)+0.5))*z.w+z.z;}\n#endif\nif(A==4.){\n#ifdef SHADER_VERTEX\nfloat seed=aSeed;\n#else\nfloat seed=vSeed;\n#endif\nreturn mix(z.y,z.z,seed);}return 0.;}\n#ifdef USE_FILTER\nstruct Particle{vec2 texCoord;vec2 texOffset;float lifetime;float seed;};\n#endif\nvarying vec4 vDisplayRange;uniform vec2 uFlipDir;uniform vec4 uOpacityOverXValue;uniform vec4 uOpacityOverYValue;vec4 main_filter(Particle B,sampler2D texture){vec2 texCoord=B.texCoord;float C=B.lifetime;if(texCoord.x<vDisplayRange.x||texCoord.x>vDisplayRange.y||texCoord.y<vDisplayRange.z||texCoord.y>vDisplayRange.w){return vec4(0.);}float D=getValueFromTime(texCoord.x,uOpacityOverXValue)*getValueFromTime(texCoord.y,uOpacityOverYValue);vec2 E=(texCoord-0.5)*uFlipDir+0.5;return getTextureColor(texture,E)*D;}"},function(e,t){e.exports="\n#ifdef USE_FILTER\nstruct Particle{vec2 texCoord;vec2 texOffset;float lifetime;float seed;};\n#endif\nuniform vec2 uCenter;uniform sampler2D uBlend;varying vec4 vFilterParams;vec4 main_filter(Particle a,sampler2D texture){vec2 texCoord=a.texCoord;float b=vFilterParams.x;float c=distance(texCoord,uCenter);const float d=3.14159/180.;if(b>c){float e=vFilterParams.y*d;float f=(b-c)/b;float g=f*f*e*vFilterParams.w;float h=sin(g);float i=cos(g);texCoord-=uCenter;texCoord=vec2(dot(texCoord,vec2(i,-h)),dot(texCoord,vec2(h,i)));texCoord+=uCenter;}vec4 j=getTextureColor(texture,texCoord);float k=vFilterParams.z;if(k>0.){return mix(j,getTextureColor(uBlend,texCoord),k);}return j;}"},function(e,t){e.exports="uniform vec4 uRadiusValue;uniform vec4 uAngleValue;uniform vec4 uBlendOpacityValue;uniform vec4 uStrengthValue;varying vec4 vFilterParams;void main_filter(float a){vFilterParams=vec4(getValueFromTime(a,uRadiusValue),getValueFromTime(a,uAngleValue),getValueFromTime(a,uBlendOpacityValue),getValueFromTime(a,uStrengthValue));}"},function(e,t){e.exports="\n#ifdef USE_FILTER\nstruct Particle{vec2 texCoord;vec2 texOffset;float lifetime;float seed;};\n#endif\nuniform vec4 uWaveParams;uniform sampler2D uBlend;varying vec4 vWaveParams;vec3 a(vec2 b,float c,float d,float e){float f=distance(b,uWaveParams.xy);float g=(c-f)*d;return vec3(b,cos(g*uWaveParams.z)*max(1.-g*g,0.)*e);}vec4 main_filter(Particle h,sampler2D texture){const vec3 i=vec3(0.,0.,-1.);float j=h.lifetime;vec2 k=h.texCoord;float l=uWaveParams.w;float m=vWaveParams.x;float d=vWaveParams.y;float n=vWaveParams.z;float e=vWaveParams.w;float g=(m-distance(k,uWaveParams.xy))*d;vec4 o;vec3 p=a(k,m,d,e);vec3 q=a(k+vec2(h.texOffset.x*uWaveParams.z,0.),m,d,e);vec3 r=a(k+vec2(0.,h.texOffset.y*uWaveParams.z),m,d,e);vec3 s=refract(i,normalize(cross(p-q,p-r)),0.8);float t=s.z==0.?0.:-p.z/s.z;o=getTextureColor(texture,k+t*s.xy);if(l==0.){return o;}vec4 u=getTextureColor(uBlend,k);if(l==2.){float f=distance(k,uWaveParams.xy);float g=clamp((m-f)*d+1.,0.,1.);n=g*n;}return mix(o,u,n);}"},function(e,t){e.exports="uniform vec4 uWaveMovementValue;uniform vec4 uWaveHeightValue;uniform vec4 uWaveDampingValue;uniform vec4 uBlendOpacityValue;varying vec4 vWaveParams;void main_filter(float a){vWaveParams=vec4(getValueFromTime(a,uWaveMovementValue),getValueFromTime(a,uWaveDampingValue),clamp(getValueFromTime(a,uBlendOpacityValue),0.,1.),getValueFromTime(a,uWaveHeightValue));}"},function(e,t){e.exports="\n#ifdef USE_FILTER\nstruct Particle{vec2 texCoord;vec2 texOffset;float lifetime;float seed;};\n#endif\nvarying vec4 uGlitchParams;varying vec4 uNoiseParams;varying float vColorClip;varying float vBlendOpacity;varying float vWaveFreq;uniform sampler2D uNoise;uniform sampler2D uBlend;uniform vec2 uResolution;float a(vec2 b){return fract(sin(dot(b.xy,vec2(12.9898,78.233)))*43758.5453);}float c(vec2 d){return texture2D(uNoise,fract(d)).r;}const vec4 e=vec4(1.,0.,0.,1.);const vec4 f=vec4(0,1.,0.,1.);const vec4 g=vec4(0.,0.,1.,1.);vec4 h(sampler2D i,sampler2D j,vec2 texCoord,float k){vec4 l=vec4(0.);vec4 m=vec4(0.);if(k<1.){l=getTextureColor(i,texCoord);}if(k>0.){m=getTextureColor(j,texCoord);}return mix(l,m,k);}vec4 n(float x,float y,float o,sampler2D texture){vec4 p=h(texture,uBlend,vec2(x+o,y),vBlendOpacity)*e;vec4 q=h(texture,uBlend,vec2(x,y),vBlendOpacity)*f;vec4 r=h(texture,uBlend,vec2(x-o,y),vBlendOpacity)*g;return p+q+r;}vec4 main_filter(Particle s,sampler2D texture){float t=s.lifetime;vec2 u=s.texCoord;vec2 v=1./s.texOffset;float w=uGlitchParams.x;vec2 x=vec2(w*8.0+0.5)*vec2(a(vec2(t))*2.0-1.0,a(vec2(t*2.0))*2.0-1.0)/v*uGlitchParams.y;float y=u.y*v.y;float z=(c(vec2(y*0.01,t*400.0))*(2.0+w*32.0)*c(vec2(y*0.02,t*200.0))*(1.0+w*4.0)+step(0.9995,sin(y*0.005+t*1.6))*12.0+step(0.9999,sin(y*0.005+t*2.0))*-18.0)/v.x*uGlitchParams.z;float A=(6.0+sin(t*500.0+u.y*40.0)*(20.0*w+1.0))/v.x*uGlitchParams.w;float B=u.x+z;vec4 C=n(B+x.x,u.y+x.y,A,texture);float D=(a(u+mod(t,10.0))*2.0-1.0)*(0.15+w*0.15)*uNoiseParams.x;float E=floor(t*20.0)*200.0;float F=step((c(vec2(u.x*3.0,E))+1.0)/2.0,0.12+w*0.3);float G=step((c(vec2(u.y*3.0,E))+1.0)/2.0,0.12+w*0.3);float H=F*G*uNoiseParams.y;float I=u.x+sin(E)*0.2+z;vec4 J=vec4(0.);if(H>0.){J=n(I,u.y,A,texture)*H;}float K=floor(t*25.0)*300.0;float L=step((c(vec2(u.x*2.0,K))+1.0)/2.0,0.12+w*0.5);float M=step((c(vec2(u.y*8.0,K))+1.0)/2.0,0.12+w*0.3);float N=L*M*uNoiseParams.z;vec4 O=vec4(0.);if(N>0.){O=n(I,u.y,A,texture)*N;}float P=(sin(u.y*vWaveFreq)+1.0)/2.0*(0.15+w*0.2)*uNoiseParams.w;vec4 Q=clamp(C*(1.0-H-N)+(D+J+O-P),0.,1.);if(dot(Q.xyz,vec3(Q.a))<vColorClip){discard;}return Q;}"},function(e,t){e.exports="varying vec4 uGlitchParams;varying vec4 uNoiseParams;varying float vColorClip;varying float vBlendOpacity;varying float vWaveFreq;uniform vec4 uToTalStrength;uniform vec4 uShakeStrength;uniform vec4 uColorWaveStrength;uniform vec4 uColorDifference;uniform vec4 uWhiteNoiseStrength;uniform vec4 uBKN1Strength;uniform vec4 uBKN2Strength;uniform vec4 uWaveNoiseStrength;uniform vec4 uColorClip;uniform vec4 uBlendOpacity;uniform vec4 uWaveFreq;void main_filter(float a){uGlitchParams=vec4(getValueFromTime(a,uToTalStrength),getValueFromTime(a,uShakeStrength),getValueFromTime(a,uColorWaveStrength),getValueFromTime(a,uColorDifference));uNoiseParams=vec4(getValueFromTime(a,uWhiteNoiseStrength),getValueFromTime(a,uBKN1Strength),getValueFromTime(a,uBKN2Strength),getValueFromTime(a,uWaveNoiseStrength));vColorClip=getValueFromTime(a,uColorClip);vBlendOpacity=getValueFromTime(a,uBlendOpacity);vWaveFreq=getValueFromTime(a,uWaveFreq);}"},function(e,t){e.exports="uniform vec4 uMovementValue;uniform vec4 uStrengthValue;uniform vec4 uPeriodValue;varying vec3 vWaveParams;void main_filter(float lifetime){const float a=3.14159265;vWaveParams=vec3(getValueFromTime(lifetime,uPeriodValue)*a,getValueFromTime(lifetime,uMovementValue)*a,getValueFromTime(lifetime,uStrengthValue));}"},function(e,t){e.exports="\n#ifdef USE_FILTER\nstruct Particle{vec2 texCoord;vec2 texOffset;float lifetime;float seed;};\n#endif\nuniform vec4 uWaveParams;varying vec3 vWaveParams;vec4 main_filter(Particle a,sampler2D texture){vec2 b=a.texCoord-uWaveParams.xy;float c=dot(b,uWaveParams.zw);float d=sin(vWaveParams.x*c+vWaveParams.y)*vWaveParams.z;vec2 e=vec2(-uWaveParams.w,uWaveParams.z)*d;return getTextureColor(texture,clamp(a.texCoord+e,0.,1.));}"},function(e,t){e.exports="\n#ifdef USE_FILTER\nstruct Particle{vec2 texCoord;vec2 texOffset;float lifetime;float seed;};\n#endif\nuniform vec4 uTexRange;vec4 main_filter(Particle a,sampler2D texture){vec2 texCoord=a.texCoord;float x=uTexRange.x+texCoord.x*uTexRange.y;vec4 b=getTextureColor(texture,vec2(x,texCoord.y));x=uTexRange.z+texCoord.x*uTexRange.w;vec4 c=getTextureColor(texture,vec2(x,texCoord.y));return vec4(c.rgb,b.r);}"},function(e,t){e.exports="\n#ifdef USE_FILTER\nstruct Particle{vec2 texCoord;vec2 texOffset;float lifetime;float seed;};\n#endif\nuniform float uStrength;uniform sampler2D uMask;float a(float b){if(b<=0.5) b=b*b*2.0;else b=1.0-((1.0-b)*(1.0-b)*2.0);return b;}vec4 c(Particle d,sampler2D texture){vec2 texCoord=d.texCoord;vec2 texOffset=d.texOffset*4.;\n#define texC(x,y) texture2D(texture,texCoord + vec2(x,y) * texOffset)\nvec4 b=texC(0.,0.)*36.;b+=texC(-2.,-2.)*1.;b+=texC(-2.,2.)*1.;b+=texC(2.,2.)*1.;b+=texC(2.,-2.)*1.;b+=texC(-1.,-2.)*4.;b+=texC(-1.,2.)*4.;b+=texC(1.,2.)*4.;b+=texC(1.,-2.)*4.;b+=texC(-2.,-1.)*4.;b+=texC(-2.,1.)*4.;b+=texC(2.,-1.)*4.;b+=texC(2.,1.)*4.;b+=texC(-2.,0.)*6.;b+=texC(2.,0.)*6.;b+=texC(0.,-2.)*6.;b+=texC(0.,2.)*6.;b+=texC(-1.,1)*16.;b+=texC(1.,1.)*16.;b+=texC(1.,-1.)*16.;b+=texC(-1.,-1.)*16.;b+=texC(-1.,0.)*24.;b+=texC(0.,-1.)*24.;b+=texC(1.,0.)*24.;b+=texC(0.,1.)*24.;return b/256.;}vec4 e(Particle d,sampler2D texture){vec2 texCoord=d.texCoord;vec2 texOffset=d.texOffset*3.;\n#define texC(x,y) texture2D(texture,texCoord + vec2(x,y) * texOffset)\nvec4 b=texC(0.,0.)*4.;b+=texC(-1.,-1.)*1.;b+=texC(1.,1.)*1.;b+=texC(-1.,1.)*1.;b+=texC(1.,-1.)*1.;b+=texC(-1.,0.)*2.;b+=texC(-0.,-1.)*2.;b+=texC(-0.,1.)*2.;b+=texC(1.,0.)*2.;return b/16.;}vec4 main_filter(Particle d,sampler2D texture){const vec3 f=vec3(0.299,0.587,0.114);vec2 texCoord=d.texCoord;vec2 texOffset=d.texOffset;float g=step(0.00001,texture2D(uMask,texCoord).r);if(g==0.){return vec4(0.);}\n#define texG(x,y) texture2D(texture,texCoord + vec2(x,y) * texOffset).g\nvec3 h=texture2D(texture,texCoord).rgb;float i=h.g*20.0;i+=texG(0.,-10.);i+=texG(0.,10.);i+=texG(10.,0.);i+=texG(-10.,0.);i+=texG(5.,-8.);i+=texG(5.,8.);i+=texG(-5.,8.);i+=texG(-5.,-8.);i+=texG(8.,5.);i+=texG(8.,-5.);i+=texG(-8.,5.);i+=texG(-8.,-5.);i+=texG(0.,-6.)*2.0;i+=texG(0.,6.)*2.0;i+=texG(6.,0.)*2.0;i+=texG(-6.,0.)*2.0;i+=texG(-4.,-4.)*2.0;i+=texG(-4.,4.)*2.0;i+=texG(4.,-4.)*2.0;i+=texG(4.,4.)*2.0;i=i/48.0;float j=h.g-i+0.5;for(int k=0;k<5;k++){j=a(j);}float l=dot(h,f);float m=pow(l,1./uStrength);vec3 n=h+(h-vec3(j))*m*0.1;vec4 o=vec4(mix(n.rgb,max(n,h),m),1.0);return o;}"},function(e,t,n){"use strict";var r=n(0),i=n(1),a={dissolve:{vertex:{variables:{uStrengthValue:["strength",1]}},uniforms:{uClipPoint:{name:"center",default:[.5,.5]}},textures:{uBlend:{src:"blend"},uNoise:{src:"noise"}}},reflect:{vertex:{variables:{uDisplayMinXValue:["displayMinX",0],uDisplayMinYValue:["displayMinY",0],uDisplayMaxXValue:["displayMaxX",1],uDisplayMaxYValue:["displayMaxY",1]}},fragment:{variables:{uOpacityOverYValue:["opacityOverY",1],uOpacityOverXValue:["opacityOverX",1]}},uniforms:{uFlipDir:{name:"direction",default:[1,1],enum:{1:[-1,1],2:[1,-1],3:[-1,-1]}}}},swirl:{vertex:{variables:{uRadiusValue:["radius",1],uAngleValue:["angle",180],uBlendOpacityValue:["blendOpacity",0],uStrengthValue:["strength",1]}},uniforms:{uCenter:{name:"center",default:[.5,.5]}},textures:{uBlend:{src:"blend"}}},distortion:{vertex:{variables:{uMovementValue:["waveMovement",0],uStrengthValue:["strength",1],uPeriodValue:["period",1]}},uniforms:{uWaveParams:function(e){var t=e.center||[.5,.5],n=Object(i.q)(e.direction||[1,0]);return[t[0],t[1],n[0],n[1]]}}},alphaPlayer:{uniforms:{uTexRange:function(e){var t=e.colorRange||[.5,1],n=e.alphaRange||[0,.5];return[n[0],n[1]-n[0],t[0],t[1]-t[0]]}}},wave:{vertex:{variables:{uWaveMovementValue:["waveMovement",0],uWaveHeightValue:["waveHeight",.1],uWaveDampingValue:["waveDamping",1],uBlendOpacityValue:["blendOpacity",0]}},uniforms:{uWaveParams:function(e){var t=e.center||[.5,.5];return[t[0],t[1],e.waveFrequency||4,e.blendMethod||0]}},textures:{uBlend:{src:"blend"}}},mask:{vertex:{variables:{uTextureOffsetX:["texOffsetX",0],uTextureOffsetY:["texOffsetY",0]}},textures:{uBlend:{src:"blend"}}},beauty:{uniforms:{uStrength:function(e){return e.strength||3}},textures:{uMask:{src:"mask"}}},glitch:{vertex:{variables:{uToTalStrength:["strength",1],uShakeStrength:["shakeStrength",1],uColorWaveStrength:["colorWaveStrength",1],uColorDifference:["colorDifference",1],uWhiteNoiseStrength:["whiteNoiseStrength",1],uBKN1Strength:["blockNoiseAStrength",1],uBKN2Strength:["blockNoiseBStrength",1],uWaveNoiseStrength:["waveNoiseStrength",1],uColorClip:["colorClip",0],uBlendOpacity:["blendOpacity",0],uWaveFreq:["waveNoiseFreq",1200]}},textures:{uNoise:{src:"noise"},uBlend:{src:"blend"}}}},o=n(35),s=n.n(o),u=n(36),c=n.n(u),l=n(37),f=n.n(l),h=n(38),d=n.n(h),_=n(39),m=n.n(_),p=n(40),v=n.n(p),g=n(41),y=n.n(g),E=n(42),T=n.n(E),x=n(43),A=n.n(x),O=n(44),b=n.n(O),M=n(45),S=n.n(M),R=n(46),L=n.n(R),C=n(47),I=n.n(C),w=n(48),P=n.n(w);Object(r.d)({dissolve:{vs:s.a,fs:c.a},reflect:{vs:f.a,fs:d.a},swirl:{vs:v.a,fs:m.a},wave:{vs:T.a,fs:y.a},distortion:{vs:S.a,fs:L.a},glitch:{fs:A.a,vs:b.a},alphaPlayer:{fs:I.a},beauty:{fs:P.a}},(function(e,t){var n=a[t];n.vertex||(n.vertex={}),n.fragment||(n.fragment={}),n.vertex.program=e.vs||"void main_filter(float l){}",n.fragment.program=e.fs,Object(r.d)(e.textures,(function(e,t){Object(r.k)(n.textures[t],e)}))}));t.a=a},function(e,t,n){"use strict";n.r(t),n.d(t,"MarsBlurFunc",(function(){return s}));n(51);var r=n(11),i=n(49);for(var a in r)["default","MarsBlurFunc"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);function o(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}var s=function(){this.detectSwitch=!0,this.blur_canvas=null,this.blur_player=null,this.blur_div=null};s.prototype.backgroundBlur=function(e,t){var n=this;return new Promise((function(a,s){n.blur_div=document.createElement("div"),n.blur_div.style.width=t.local_video_width+"px",n.blur_div.style.height=t.local_video_height+"px",document.body.appendChild(n.blur_div),n.blur_canvas=document.createElement("canvas"),n.blur_canvas.hidden=!0,n.blur_canvas.width=t.local_video_width,n.blur_canvas.height=t.local_video_height,n.blur_div.appendChild(n.blur_canvas),Object(r.registerFilters)(i.a),n.blur_player=new r.MarsPlayer({canvas:n.blur_canvas,transparentBackground:!0}),n.blur_player.loadSceneAsync(function(e,t,n,r){var i={compositionId:18,requires:[],compositions:[{name:"composition_18",id:18,duration:9999,camera:{fov:60,far:20,near:.1,position:[0,0,8]},items:[{name:"background",delay:0,id:1,ro:.1,sprite:{options:{startLifetime:2,startSize:6,sizeAspect:r.aspect,startColor:["color",[255,255,255]],duration:2,looping:!0},renderer:{renderMode:1,texture:2}}},{name:"item_683",delay:0,id:683,ro:.1,particle:{options:{startLifetime:5,startSize:8,sizeAspect:t,startSpeed:0,startColor:["color",[255,255,255]],duration:2,maxCount:10,gravityModifier:1,looping:!0},emission:{rateOverTime:5},renderer:{texture:0},filter:{name:"beauty",strength:n,mask:1}}}]}],gltf:[],images:[{type:"video",url:e},{type:"data",options:{format:WebGLRenderingContext.prototype.LUMINANCE,wrapS:WebGLRenderingContext.prototype.CLAMP_TO_EDGE,wrapT:WebGLRenderingContext.prototype.CLAMP_TO_EDGE},data:{width:1,height:1,data:new Uint8Array([255])}},r.url],version:"0.4.0-beta.43",shapes:[],plugins:[],_imgs:{18:[0,1,2]}},a=i.compositions[0].camera,o=t*(a.position[2]-0)*Math.tan(a.fov/2*Math.PI/180);return i.compositions[0].items[0].sprite.options.startSize=i.compositions[0].items[1].particle.options.startSize=2*o,i}(e,t.local_video_width/t.local_video_height,1,{url:t.url,aspect:t.local_video_width/t.local_video_height}),{wrapTexture:!0}).then(function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=function(){var e=this;s.segmentPerson(i,{segmentationThreshold:t.segmentationThreshold,scoreThreshold:t.scoreThreshold}).then((function(t){e.detectSwitch&&(o.updateData(t),u.call(e))}))},i=r.images[0].options.image,n.blur_player.resize(),n.blur_player.play(r,{keepResource:!0}),o=r.images[1],i.setAttribute("width",i.videoWidth),i.setAttribute("height",i.videoHeight),e.next=9,bodyPix.load({architecture:t.architecture,outputStride:t.outputStride,multiplier:t.multiplier,quantBytes:t.quantBytes}).catch((function(e){}));case 9:s=e.sent,u.call(n),n.blur_div.style.display="none",a({result:!0,info:n.blur_canvas.captureStream()});case 13:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,u,"next",e)}function u(e){o(a,r,i,s,u,"throw",e)}s(void 0)}))});return function(e){return r.apply(this,arguments)}}()).catch((function(e){a({result:!1,info:e})}))}))}},function(e,t,n){if(n(52),/ri=hilo/.test(location.search))n(4),n(55);else if(/ri=pixi/.test(location.search))n(53);else{n(2).Logger.enable(),n(54)}},function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=m;var l={},f={};f[a]=function(){return this};var h=Object.getPrototypeOf,d=h&&h(h(M([])));d&&d!==n&&r.call(d,a)&&(f=d);var _=y.prototype=v.prototype=Object.create(f);g.prototype=_.constructor=y,y.constructor=g,y[s]=g.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e._proto_=y,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(_),e},c.awrap=function(e){return{_await:e}},E(T.prototype),T.prototype[o]=function(){return this},c.AsyncIterator=T,c.async=function(e,t,n,r){var i=new T(m(e,t,n,r));return c.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(_),_[s]="Generator",_[a]=function(){return this},_.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=M,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function m(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),o=new b(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return S()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=x(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function v(){}function g(){}function y(){}function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function T(e){var t;this._invoke=function(n,i){function a(){return new Promise((function(t,a){!function t(n,i,a,o){var s=p(e[n],e,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"_await")?Promise.resolve(c._await).then((function(e){t("next",e,a,o)}),(function(e){t("throw",e,a,o)})):Promise.resolve(c).then((function(e){u.value=e,a(u)}),o)}o(s.arg)}(n,i,t,a)}))}return t=t?t.then(a,a):a()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=p(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function M(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var r,i=n(0),a={},o=function(e){for(var t in e)/^[A-Z_]/.test(t)&&(a[t]=e[t])};function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}o(WebGLRenderingContext),o(WebGLRenderingContext.prototype);var u=((r={})[a.FLOAT]=Float32Array,r[a.UNSIGNED_INT]=Uint32Array,r[a.INT]=Int32Array,r[a.UNSIGNED_SHORT]=Uint16Array,r),c=1,l=function(){function e(t){this.attributes={},this.id=e.name+"_"+c++,this.drawCount=t.drawCount,this.initialize(t.attributes,t.index),this.name=t.name,this.mode=t.mode||a.TRIANGLES}var t,n,r,o=e.prototype;return o.setAttributeData=function(e,t){var n=this.attributes[e];n.data=t,this._dirty=n._dirty=!0},o.setIndexSubData=function(e,t){this._setAttributeSubData(this.attributes.index,e,t)},o.setAttributeSubData=function(e,t,n){this._setAttributeSubData(this.attributes[e],t,n)},o._setAttributeSubData=function(e,t,n){var r=t+n.length;if(this.combineSubData&&(e._dirty=!0),e.data.length<r){var i=new i.constructor(r);i.set(e.data),e.data=i,e._dirty=!0}else if(!e._dirty){var a=e.subRange;a?(a[0]=Math.min(a[0],t),a[1]=Math.max(a[1],r)):e.subRange=[t,t+n.length]}e.data.set(n,t),this._dirty=!0},o.setIndexData=function(e){this.attributes.index.data=e,this.attributes.index._dirty=!0,this._dirty=!0},o.getIndexData=function(){return this.attributes.index.data},o.getAttributeData=function(e){return this.attributes[e].data},o.getAttributeSize=function(e){return this.attributes[e].size},o.getAttributeNames=function(){return this._attributeNames},o.resetData=function(){var e=this.attributes;this._attributeNames.forEach((function(t){var n=e[t];n.data=new n.data.constructor(0),n._dirty=!0})),e.index.data=new e.index.data.constructor(0),e.index._dirty=!0},o.initialize=function(e,t){var n=this.attributes;Object(i.d)(e,(function(e,t){var r=e.type||a.FLOAT,i=u[r];n[t]={type:r,size:e.size,data:e.data instanceof i?e.data:new i(e.data||0),_dirty:!0}})),this._attributeNames=Object.getOwnPropertyNames(n);var r=t.type||a.UNSIGNED_SHORT,o=u[r];n.index={type:r,size:t.size,data:t.data instanceof o?t.data:new o(t.data||0),_dirty:!0},this._dirty=!0},o.destroy=function(){this.attributes={},this._vao&&(this._vao.destroy(),this._vao=null)},t=e,(n=[{key:"drawStart",get:function(){return 0},set:function(e){}},{key:"drawCount",get:function(){return this.vertexCount},set:function(e){this.vertexCount=e}},{key:"indices",get:function(){return this.attributes.index}}])&&s(t.prototype,n),r&&s(t,r),e}(),f=Math.PI/180,h=Math.cos,d=Math.sin;function _(){return new Float32Array(16)}function m(e,t,n,r){var i=h(t*f/2),a=h(n*f/2),o=h(r*f/2),s=d(t*f/2),u=d(n*f/2),c=d(r*f/2);return e[0]=s*a*o-i*u*c,e[1]=i*u*o+s*a*c,e[2]=i*a*c-s*u*o,e[3]=i*a*o+s*u*c,e}function p(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,c=a+a,l=o+o,f=i*u,h=i*c,d=i*l,_=a*c,m=a*l,p=o*l,v=s*u,g=s*c,y=s*l,E=r[0],T=r[1],x=r[2];return e[0]=(1-(_+p))*E,e[1]=(h+y)*E,e[2]=(d-g)*E,e[3]=0,e[4]=(h-y)*T,e[5]=(1-(f+p))*T,e[6]=(m+v)*T,e[7]=0,e[8]=(d+g)*x,e[9]=(m-v)*x,e[10]=(1-(f+_))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function v(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],_=t[11],m=t[12],p=t[13],v=t[14],g=t[15],y=n[0],E=n[1],T=n[2],x=n[3];return e[0]=y*r+E*s+T*f+x*m,e[1]=y*i+E*u+T*h+x*p,e[2]=y*a+E*c+T*d+x*v,e[3]=y*o+E*l+T*_+x*g,y=n[4],E=n[5],T=n[6],x=n[7],e[4]=y*r+E*s+T*f+x*m,e[5]=y*i+E*u+T*h+x*p,e[6]=y*a+E*c+T*d+x*v,e[7]=y*o+E*l+T*_+x*g,y=n[8],E=n[9],T=n[10],x=n[11],e[8]=y*r+E*s+T*f+x*m,e[9]=y*i+E*u+T*h+x*p,e[10]=y*a+E*c+T*d+x*v,e[11]=y*o+E*l+T*_+x*g,y=n[12],E=n[13],T=n[14],x=n[15],e[12]=y*r+E*s+T*f+x*m,e[13]=y*i+E*u+T*h+x*p,e[14]=y*a+E*c+T*d+x*v,e[15]=y*o+E*l+T*_+x*g,e}function g(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],_=t[12],m=t[13],p=t[14],v=t[15],g=n*s-r*o,y=n*u-i*o,E=n*c-a*o,T=r*u-i*s,x=r*c-a*s,A=i*c-a*u,O=l*m-f*_,b=l*p-h*_,M=l*v-d*_,S=f*p-h*m,R=f*v-d*m,L=h*v-d*p,C=g*L-y*R+E*S+T*M-x*b+A*O;return C?(C=1/C,e[0]=(s*L-u*R+c*S)*C,e[1]=(i*R-r*L-a*S)*C,e[2]=(m*A-p*x+v*T)*C,e[3]=(h*x-f*A-d*T)*C,e[4]=(u*M-o*L-c*b)*C,e[5]=(n*L-i*M+a*b)*C,e[6]=(p*E-_*A-v*y)*C,e[7]=(l*A-h*E+d*y)*C,e[8]=(o*R-s*M+c*O)*C,e[9]=(r*M-n*R-a*O)*C,e[10]=(_*x-m*E+v*g)*C,e[11]=(f*E-l*x-d*g)*C,e[12]=(s*b-o*S-u*O)*C,e[13]=(n*S-r*b+i*O)*C,e[14]=(m*y-_*T-p*g)*C,e[15]=(l*T-f*y+h*g)*C,e):null}function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=1,x=function(){function e(t){Object.assign(this,t),this.states=y({},t.states),this.id=e.name+"_"+T++,this.shaderCacheId||(this.shaderCacheId="Shader_"+Object(i.o)(this.vertexShader+this.fragmentShader)),this.transparent=!0}var t,n,r;return e.prototype.destroy=function(){},t=e,(n=[{key:"transparent",get:function(){return this.states.blending},set:function(e){this.states.blending=!!e}}])&&E(t.prototype,n),r&&E(t,r),e}();function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(e){Object.assign(this,e),this._uniformValues={}}var t,n,r,a=e.prototype;return a.setUniformValue=function(e,t){this._uniformValues[e]=t},a.getUniformValue=function(e){return this._uniformValues[e]},a.getUniformValues=function(){return A({},this._uniformValues)},a.setUniformValues=function(e){var t=this;Object(i.d)(e,(function(e,n){return t.setUniformValue(n,e)}))},a.destroyByRenderer=function(e){e.destroyMesh(this)},a.destroy=function(){this.geometry.destroy(),this.material.destroy()},t=e,(n=[{key:"vaoId",get:function(){return this.geometry.id}}])&&O(t.prototype,n),r&&O(t,r),e}(),M=1,S=function(){function e(e){this._meshes=[],this._ntransform={pos:[0,0,0],rot:[0,0,0],scale:[1,1,1],_dirty:!0,_quat:[0,0,0,1],_matrix:new Float32Array(16),_matrixWorld:new Float32Array(16)},this.children=[],this.id=M++,e&&Object.assign(this,e)}var t=e.prototype;return t.addChild=function(e){e&&Object(i.a)(this.children,e)&&(e.parent=this,e.updateMatrixWorld(!0))},t.removeChild=function(e){Object(i.c)(this.children,e)&&(e.parent=null)},t.addToRenderList=function(e,t){this.updateMatrixWorld();for(var n=this._meshes,r=0;r<n.length;r++){var i=n[r];i._node=this,i._renderer=t,e.addMesh(i)}this.children.forEach((function(n){return n.addToRenderList(e,t)}))},t.destroyByRenderer=function(e){for(var t=this._meshes,n=0;n<t.length;n++)e.destroyMesh(t[n])},t.setMeshes=function(e){this._meshes=e},t.removeMesh=function(e){Object(i.c)(this._meshes,e)},t.updateMatrixWorld=function(e){var t=this._ntransform;if(t._dirty||e){var n=t.rot;m(t._quat,n[0],n[1],n[2]),p(t._matrix,t._quat,t.pos,t.scale),this._updateModelMatrix(t._matrix);var r=this._getParentWorldMatrix();r?v(t._matrixWorld,r,t._matrix):t._matrixWorld.set(t._matrix),t._dirty=!1}},t.setPosition=function(e,t,n){var r=this._ntransform.pos;r[0]=e,r[1]=t,r[2]=n,this._ntransform._dirty=!0,this._invalidChildren()},t.getPosition=function(e){var t=this._ntransform.pos;return e||(e=[]),e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t._invalidChildren=function(){this.children.forEach((function(e){e._ntransform&&(e._ntransform._dirty=!0)}))},t.setRotation=function(e,t,n){var r=this._ntransform.rot;r[0]=e,r[1]=t,r[2]=n,this._ntransform._dirty=!0,this._invalidChildren()},t.setScale=function(e,t,n){1===arguments.length&&(t=e,n=e);var r=this._ntransform.scale;r[0]=e,r[1]=t,r[2]=n,this._ntransform._dirty=!0,this._invalidChildren()},t.getModelMatrix=function(){return this._ntransform._matrix},t.getWorldMatrix=function(){return this._ntransform._matrixWorld},t._updateModelMatrix=function(e){},t._getParentWorldMatrix=function(){var e=this.parent;if(e)return e.updateMatrixWorld(),e.getWorldMatrix()},t.destroy=function(){this.children.forEach((function(e){return e.destroy()})),this.children=[]},e}(),R=new Float32Array(16),L={MODEL:function(e,t){return t.getWorldMatrix()},VIEW:function(e){return e.view},PROJECTION:function(e){return e.projection},LOCAL:function(e,t){return t.getModelMatrix()},VIEWPROJECTION:function(e){return e.viewProjection},MODELVIEW:function(e,t){return e.getModelView(R,t.getWorldMatrix())},MODELVIEWPROJECTION:function(e,t){return e.getModelViewProjection(R,t.getWorldMatrix())},MODELINVERSE:function(e,t){return g(R,t.getWorldMatrix())},VIEWINVERSE:function(e){return e.inverseView},PROJECTIONINVERSE:function(e){return e.inverseProjection},MODELVIEWINVERSE:function(e,t){return g(R,L.MODELVIEW(e,t))},MODELVIEWPROJECTIONINVERSE:function(e,t){return g(R,L.MODELVIEWPROJECTION(e,t))}},C=L,I={};[{name:"FLOAT",byteSize:4,uniformFuncName:"uniform1f",type:"Scalar",size:1},{name:"FLOAT_VEC2",byteSize:8,uniformFuncName:"uniform2f",type:"Vector",size:2},{name:"FLOAT_VEC3",byteSize:12,uniformFuncName:"uniform3f",type:"Vector",size:3},{name:"FLOAT_VEC4",byteSize:16,uniformFuncName:"uniform4f",type:"Vector",size:4},{name:"FLOAT_MAT2",byteSize:16,uniformFuncName:"uniformMatrix2fv",type:"Matrix",size:4},{name:"FLOAT_MAT3",byteSize:36,uniformFuncName:"uniformMatrix3fv",type:"Matrix",size:9},{name:"FLOAT_MAT4",byteSize:64,uniformFuncName:"uniformMatrix4fv",type:"Matrix",size:16},{name:"INT",byteSize:4,uniformFuncName:"uniform1i",type:"Scalar",size:1},{name:"INT_VEC2",byteSize:8,uniformFuncName:"uniform2i",type:"Vector",size:2},{name:"INT_VEC3",byteSize:12,uniformFuncName:"uniform3i",type:"Vector",size:3},{name:"INT_VEC4",byteSize:16,uniformFuncName:"uniform4i",type:"Vector",size:4},{name:"BOOL",byteSize:4,uniformFuncName:"uniform1i",type:"Scalar",size:1},{name:"BOOL_VEC2",byteSize:8,uniformFuncName:"uniform2i",type:"Vector",size:2},{name:"BOOL_VEC3",byteSize:12,uniformFuncName:"uniform3i",type:"Vector",size:3},{name:"BOOL_VEC4",byteSize:16,uniformFuncName:"uniform4i",type:"Vector",size:4},{name:"SAMPLER_2D",byteSize:4,uniformFuncName:"uniform1i",type:"Scalar",size:1},{name:"SAMPLER_CUBE",byteSize:4,uniformFuncName:"uniform1i",type:"Scalar",size:1}].forEach((function(e){var t,n,r=e.name,i=e.uniformFuncName,o=i+"v",s=a[r];"Matrix"===e.type?t=n=function(e,t,n){void 0!==n&&e[i](t,!1,n)}:s===a.SAMPLER_2D?(t=function(e,t,n,r){void 0!==n&&(n&&n.isTexture&&n.activeTexture(r),e[i](t,r))},n=function(e,t,n,r){if(n instanceof Array){var i=n.map((function(e,t){return e.isTexture?e.activeTexture(r+t):r}));e[o](t,i)}}):(t=function(e,t,n){void 0!==n&&e[i](t,n)},n=function(e,t,n){e[o](t,n)}),I[s]=Object.assign(e,{glValue:s,uniform:t,uniformArray:n})}));var w={dict:I,get:function(e){return I[e]}};var P=function(){function e(e,t,n,r){this.id=e,this.attributes={},this.uniforms={},this.gl=t,this.program=this.createProgram(n,r),this.program&&(this.initAttributes(),this.initUniforms()),this.isValid=!!this.program}var t=e.prototype;return t.createProgram=function(e,t){var n=this.gl,r=n.createProgram(),i=this.createShader(n.VERTEX_SHADER,e),a=this.createShader(n.FRAGMENT_SHADER,t);if(i&&a){if(n.attachShader(r,i),n.attachShader(r,a),n.linkProgram(r),n.deleteShader(i),n.deleteShader(a),!n.getProgramParameter(r,n.LINK_STATUS)){var o=n.getProgramInfoLog(r);return console.error("compileProgramError: "+o,this),n.deleteProgram(r),null}return r}return null},t.useProgram=function(e){e.useProgram(this.program)},t.createShader=function(e,t){var n=this.gl,r=n.createShader(e);if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS)){var i=n.getShaderInfoLog(r);return console.error("compileShaderError: "+i,t.split("\n").map((function(e,t){return t+1+" "+e})).join("\n")),null}return r},t.initAttributes=function(){for(var e=this,t=this.gl,n=this.program,r=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES),i=function(r){var i=t.getActiveAttrib(n,r),o=i.name,s=i.type,u=i.size,c=t.getAttribLocation(n,o),l=w.get(s),f=function(e){e=e||{},t.vertexAttribPointer(c,e.size||l.size,e.type||a.FLOAT,e.normalized||!1,e.stride||0,e.offset||0)},h=function(){t.enableVertexAttribArray(c)},d=function(e,t){e[c]=t};if("Matrix"===l.type){var _=l.byteSize,m=l.size,p=Math.sqrt(m),v=4*p,g=function(e){for(var t=0;t<p;t++)e(c+t,t)};f=function(e){var n,r=e.type,i=void 0===r?t.FLOAT:r,a=e.normalized,o=void 0!==a&&a,s=e.stride,u=void 0===s?0:s,c=e.offset,l=void 0===c?0:c;n=0===u?_:u,g((function(e,r){t.vertexAttribPointer(e,p,i,o,n,l+v*r)}))},h=function(){g((function(e){t.enableVertexAttribArray(e)}))},d=function(e,t){g((function(n){e[n]=t}))}}e.attributes[o]={name:o,location:c,type:s,size:u,glTypeInfo:l,pointer:f,enable:h,divisor:function(){},addTo:d}},o=0;o<r;o++)i(o)},t.initUniforms=function(){for(var e=this.gl,t=this.program,n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0,i=0;i<n;i++){var a=e.getActiveUniform(t,i),o=a.name,s=a.size,u=a.type,c=null;/\[0\]$/.test(o)&&(c=e.getUniformLocation(t,o)),o=o.replace(/\[0\]$/,""),c||(c=e.getUniformLocation(t,o)),c||console.warn("get uniform "+o+" loc fail");var l=w.get(u);this.uniforms[o]={name:o,location:c,type:u,size:s,glTypeInfo:l},u!==e.SAMPLER_2D&&u!==e.SAMPLER_CUBE||(this.uniforms[o].textureIndex=r,r+=s)}},t.setGLUniformValue=function(e,t){var n=this.uniforms[e],r=n.glTypeInfo,i=n.location,a=this.gl;n&&(n.size>1||n.glTypeInfo.size>1?t&&r.uniformArray(a,i,t,n.textureIndex):r.uniform(a,i,t,n.textureIndex))},t.destroy=function(){return this._isDestroyed||(this.gl.deleteProgram(this.program),this.uniforms=null,this.attributes=null,this.program=null,this.gl=null,this._isDestroyed=!0),this},e}(),N=a.ARRAY_BUFFER,F=a.ELEMENT_ARRAY_BUFFER,D=a.STATIC_DRAW,U=a.DYNAMIC_DRAW,V=1;var B,H=function(){function e(t,n,r){void 0===n&&(n=N),void 0===r&&(r=D),this.id=e.name+"_"+V++,this.gl=t,this.target=n,this.usage=r,this.buffer=t.createBuffer(),this._dirty=!0}var t=e.prototype;return t.bind=function(){return this.gl.bindBuffer(this.target,this.buffer),this},t.bufferData=function(e){var t=this.gl,n=this.target;return t.bufferData(n,e,this.usage),this},t.bufferSubData=function(e,t,n){var r=this.gl,i=this.target,a=e*n.BYTES_PER_ELEMENT,o=new n.constructor(n.buffer,a,t-e);r.bufferSubData(i,a,o)},t.upload=function(e){if(e._dirty)this.bufferData(e.data);else if(e.subRange){var t=e.subRange;this.bufferSubData(t[0],t[1],e.data)}e._dirty=e.subRange=!1},t.destroy=function(){return this._isDestroyed||(this.gl.deleteBuffer(this.buffer),this._isDestroyed=!0),this},e}();var z=function(){function e(e,t,n){this.gl=t,this.id=e,this.vaoExtension=n,this.vaoExtension&&(this.vao=this.vaoExtension.createVertexArrayOES(),this.useVao=!0),this.attributes=[],this.activeStates=[],this.indexBuffer=null}var t=e.prototype;return t.recordVao=function(e){this.useVao&&this.vaoExtension.bindVertexArrayOES(e?this.vao:null)},t.bind=function(){B!==this&&(this.useVao?this.vaoExtension.bindVertexArrayOES(this.vao):this.bindSystemVao(),B=this)},t.bindSystemVao=function(){var e;B&&B.useVao&&B.unbind(),this.attributes.forEach((function(t){var n=t.buffer,r=t.attribute,i=t.geometryData;e!==n&&(e=n,n.bind()),r.enable(),r.pointer(i)})),this.indexBuffer&&this.indexBuffer.bind()},t.unbind=function(){this.useVao&&this.vaoExtension.bindVertexArrayOES(null),B=null},t.draw=function(e){this.bind();var t=this.gl;if(this.indexBuffer)t.drawElements(e,this.vertexCount,this.indexType,0);else{var n=this.getVertexCount();t.drawArrays(e,0,n)}},t.getVertexCount=function(){if(null===this.vertexCount){var e=this.attributes[0];this.vertexCount=e?e.geometryData.count:0}return this.vertexCount},t.addIndexBuffer=function(e,t){var n=this.gl,r=this.indexBuffer;return this.indexType=e.type,r||(r=function(e,t){return new H(e,F,t||U)}(n,t),this.indexBuffer=r),r.bind(),r.upload(e),r},t.addAttribute=function(e,t,n){var r=this.gl,i=t.name,a=this[i];if(!a){var o=function(e,t){return new H(e,N,t||U)}(r,n);o.bind(),a={attribute:t,buffer:o},this.attributes.push(a),this[i]=a,t.addTo(this.activeStates,a)}var s=a.buffer;return s.bind(),s.upload(e),t.enable(),t.pointer(),a},t.destroy=function(){var e=this;return this._isDestroyed||(this.useVao&&(this.vaoExtension.deleteVertexArrayOES(this.vao),this.vao=null,this.vaoExtension=null),this.gl=null,this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=null,this.attributes.forEach((function(t){var n=t.attribute||{};e[n.name]=null,t.buffer.destroy()})),this.attributes=null,this.activeStates=null,this._isDestroyed=!0),this},e}(),G=function(){function e(e){this.gl=e,this.reset()}var t=e.prototype;return t.reset=function(){this._dict={},this.activeTextureIndex=null,this.textureUnitDict={},this.currentFramebuffer=null,this.preFramebuffer=null,this._pixelStorei={}},t.enable=function(e){!0!==this._dict[e]&&(this._dict[e]=!0,this.gl.enable(e))},t.disable=function(e){!1!==this._dict[e]&&(this._dict[e]=!1,this.gl.disable(e))},t.bindFramebuffer=function(e,t){this.currentFramebuffer!==t&&(this.preFramebuffer=this.currentFramebuffer,this.currentFramebuffer=t,this.gl.bindFramebuffer(e,t))},t.bindSystemFramebuffer=function(){this.bindFramebuffer(this.gl.FRAMEBUFFER,this.systemFramebuffer)},t.useProgram=function(e){this.set1("useProgram",e)},t.depthFunc=function(e){this.set1("depthFunc",e)},t.depthMask=function(e){this.set1("depthMask",e)},t.clear=function(e){this.gl.clear(e)},t.depthRange=function(e,t){this.set2("depthRange",e,t)},t.stencilFunc=function(e,t,n){this.set3("stencilFunc",e,t,n)},t.stencilMask=function(e){this.set1("stencilMask",e)},t.stencilOp=function(e,t,n){this.set3("stencilOp",e,t,n)},t.colorMask=function(e,t,n,r){this.set4("colorMask",e,t,n,r)},t.cullFace=function(e){this.set1("cullFace",e)},t.frontFace=function(e){this.set1("frontFace",e)},t.blendFuncSeparate=function(e,t,n,r){this.set4("blendFuncSeparate",e,t,n,r)},t.blendEquationSeparate=function(e,t){this.set2("blendEquationSeparate",e,t)},t.pixelStorei=function(e,t){this._pixelStorei[e]!==t&&(this._pixelStorei[e]=t,this.gl.pixelStorei(e,t))},t.viewport=function(e,t,n,r){this.set4("viewport",e,t,n,r)},t.activeTexture=function(e){this.activeTextureIndex!==e&&(this.activeTextureIndex=e,this.gl.activeTexture(e))},t.bindTexture=function(e,t){var n=this.getActiveTextureUnit();n[e]!==t&&(n[e]=t,this.gl.bindTexture(e,t))},t.getActiveTextureUnit=function(){var e=this.textureUnitDict[this.activeTextureIndex];return e||(e=this.textureUnitDict[this.activeTextureIndex]={}),e},t.set1=function(e,t){this._dict[e]!==t&&(this._dict[e]=t,this.gl[e](t))},t.set2=function(e,t,n){var r=this._dict[e];r||(r=this._dict[e]=[]),r[0]===t&&r[1]===n||(r[0]=t,r[1]=n,this.gl[e](t,n))},t.set3=function(e,t,n,r){var i=this._dict[e];i||(i=this._dict[e]=[]),i[0]===t&&i[1]===n&&i[2]===r||(i[0]=t,i[1]=n,i[2]=r,this.gl[e](t,n,r))},t.set4=function(e,t,n,r,i){var a=this._dict[e];a||(a=this._dict[e]=[]),a[0]===t&&a[1]===n&&a[2]===r&&a[3]===i||(a[0]=t,a[1]=n,a[2]=r,a[3]=i,this.gl[e](t,n,r,i))},t.get=function(e){return this._dict[e]},e}(),k=a.DEPTH_TEST,j=a.STENCIL_TEST,X=a.SAMPLE_ALPHA_TO_COVERAGE,W=a.CULL_FACE,q=a.BLEND,Y=function(){function e(e,t){this.gl=e,this.extensions={vao:e.getExtension("OES_vertex_array_object")},this.state=(null==t?void 0:t.glState)||new G(e),t&&(this.camera=t.camera),null!=t&&t.keepResource?(this._keepResource=!0,this._texCache=t.textureCache,this._programCache=t.programCache):(this._texCache=[],this._programCache={}),this._vaoCache={},this._rootNodes=[],this._programUsage={}}var t=e.prototype;return t.setupDepthTest=function(e){var t=this.state;e.depthTest?(t.enable(k),e.depthFunc&&t.depthFunc(e.depthFunc),t.depthMask(e.depthMask),e.depthRange&&t.depthRange(e.depthRange[0],e.depthRange[1])):t.disable(k)},t.setupSampleAlphaToCoverage=function(e){var t=this.state;e.sampleAlphaToCoverage?t.enable(X):t.disable(X)},t.setupCullFace=function(e){var t=this.state;e.cullFace?(t.enable(W),t.cullFace(e.cullFace),e.frontFace&&t.frontFace(e.frontFace)):t.disable(W)},t.setupBlend=function(e){var t=this.state;e.blending?(t.enable(q),t.blendFuncSeparate(e.blendSrc,e.blendDst,e.blendSrcAlpha,e.blendDstAlpha),e.blendEquation&&t.blendEquationSeparate(e.blendEquation,e.blendEquationAlpha)):t.disable(q)},t.setupStencil=function(e){var t=this.state;e.stencilTest?(t.enable(j),t.stencilMask(e.stencilMask),t.stencilFunc(e.stencilFunc,e.stencilFuncRef,e.stencilFuncMask),t.stencilOp(e.stencilOpFail,e.stencilOpZFail,e.stencilOpZPass)):t.disable(j)},t.getUniformSemanticValue=function(e,t){var n=this.camera,r=this.node,i=C[e];return i||console.error("semantic "+e+" not implement"),i(n,r)},t.setupUniforms=function(e,t){var n=this;Object(i.d)(e.uniforms,(function(r,a){var o,s=t.material.uniforms[a];o=Object(i.h)(s)?n.getUniformSemanticValue(s,t):t.getUniformValue(a),e.setGLUniformValue(a,o)}))},t.setupVao=function(e,t,n){var r=n.geometry;if(r._dirty){var a=r.usage,o=t.attributes;e.unbind(),e.recordVao(!0),Object(i.d)(o,(function(t,n){var i=o[n];i&&e.addAttribute(r.attributes[n],i,a)})),r.indices&&e.addIndexBuffer(r.indices,a),e.recordVao(!1),r.vertexCount?e.vertexCount=r.vertexCount:e.vertexCount=r.indices.data.length,r._dirty=!1}return e},t.setupMaterial=function(e,t){var n=t.material.states;this.setupDepthTest(n),this.setupSampleAlphaToCoverage(n),this.setupCullFace(n),this.setupBlend(n),this.setupStencil(n),this.setupUniforms(e,t)},t.renderMesh=function(e){var t=this.setupMesh(e);t&&(t.draw(e.geometry.mode),this.addRenderInfo(t.getVertexCount()/3))},t.getProgram=function(e){return t=e.shaderCacheId,n=this,r=e.vertexShader,i=e.fragmentShader,(a=n._programCache)[t]||(a[t]=new P(t,n.gl,r,i)),a[t];var t,n,r,i,a},t.addProgramUsage=function(e){for(var t=this._programUsage,n=0;n<e.length;n++){var r=e[n];t[r]||(t[r]=0),t[r]++}},t.removeProgramUsage=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=--this._programUsage[n];if(0===r){var i=this._programCache[n];i&&(i.destroy(),this._programCache[n]=null)}else(r<0||isNaN(r))&&(this._programUsage[n]=0)}},t.setupMesh=function(e){var t,n,r,i,a=this.state,o=this.getProgram(e.material);if(o.isValid){o.useProgram(a),this.setupMaterial(o,e);var s=(t=e.vaoId,n=this,r=this.extensions.vao,(i=n._vaoCache)[t]||(i[t]=new z(t,n.gl,r)),i[t]);return this.setupVao(s,o,e)}},t.clear=function(e){var t=this.gl,n=this.state;e=e||this.clearColor,t.clearColor(e[0],e[0],e[0],e[0]),n.depthMask(!0);var r=t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT;this.stencil&&(n.stencilMask(!0),r|=t.STENCIL_BUFFER_BIT),t.clear(r)},t.renderToScreen=function(e){this.state.bindSystemFramebuffer(),e.render(0,0,1,1,this.clearColor)},t.addRenderInfo=function(e){},t.destroyMesh=function(e){if(e){e.geometry.destroy(this);var t=e.geometry.id,n=this._vaoCache;n[t]&&(n[t].destroy(),delete n[t])}},t.destroy=function(){var e=this.gl;e&&(Object(i.d)(this._vaoCache,(function(e){return e&&e.destroy()})),this._keepResource||(this._texCache.forEach((function(t){return e.deleteTexture(t)})),Object(i.d)(this._programCache,(function(e){return null==e?void 0:e.destroy()}))),this._vaoCache={},this._programCache={},this._texCache=[],this.gl=null,this._destroyed=!0)},t.destroyTexture=function(e){e&&e.destroy&&e.destroy()},t.destroyNode=function(e){},t.unbind=function(){B&&B.unbind(),this.state.useProgram(null),this.setupStencil({stencilTest:!1}),this.state.reset()},e}();function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Q=[1,1,1],Z=[0,0,0],J=[],$=function(){function e(){this.projection=_(),this.view=_(),this.viewProjection=_(),this._invView=_(),this.params={near:.1,far:20,fov:60,aspect:1,position:[0,0,0],rotation:[0,0,0]},this._dirty=!0}var t,n,r,a=e.prototype;return a.setParams=function(e,t){Object(i.k)(this.params,e),t&&Object(i.k)(this.params,t),this._dirty=!0},a.updateMatrix=function(){if(this._dirty){var e=this.params;n=this.projection,r=e.fov,i=e.aspect,a=e.near,o=e.far,u=1/Math.tan(r*f/2),n[0]=u/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=o&&o!==1/0?(s=1/(a-o),n[10]=(o+a)*s,n[14]=2*o*a*s):(n[10]=-1,n[14]=-2*a);var t=e.rotation?m(J,e.rotation[0],e.rotation[1],e.rotation[2]):[0,0,0,1];p(this._invView,t,e.position||Z,Q),g(this.view,this._invView),v(this.viewProjection,this.projection,this.view),this._invVP=null,this._dirty=!1}var n,r,i,a,o,s,u},a.getModelView=function(e,t){return v(e,this.view,t)},a.getModelViewProjection=function(e,t){return v(e,this.viewProjection,t)},t=e,(n=[{key:"inverseProjection",get:function(){return this._invProjection||(this._invProjection=g(_(),this.projection)),this._invProjection}},{key:"inverseViewProjection",get:function(){return this._invVP||(this._invVP=g(_(),this.viewProjection)),this._invVP}},{key:"inverseView",get:function(){return this._invView}}])&&K(t.prototype,n),r&&K(t,r),e}();function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var te=function(){function e(){this._tMeshes=[],this._oMeshes=[]}var t,n,r,i=e.prototype;return i.reset=function(){return this._tMeshes.length=0,this._oMeshes.length=0,this},i.addMesh=function(e){for(var t=e.material.transparent?this._tMeshes:this._oMeshes,n=0;n<t.length;n++){if(t[n].material.renderOrder>e.material.renderOrder)return void t.splice(n,0,e)}t.push(e)},i.render=function(){for(var e=this.transparentMeshes,t=0;t<e.length;t++){var n=e[t],r=n._renderer;r.node=n._node,r.renderMesh(n),r.node=null}},t=e,(n=[{key:"transparentMeshes",get:function(){return this._tMeshes}},{key:"opaqueMeshes",get:function(){return this._oMeshes}}])&&ee(t.prototype,n),r&&ee(t,r),e}();function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var re=function(){function e(e){this._camera=new $,this.glRenderer=e.glRenderer,this.gl=this.glRenderer.gl,this.independentEmitter=e.independentEmitter,this.unusedNodes=[],this._rootNode=new S({name:"root"}),this._renderList=new te}var t,n,r,a=e.prototype;return a.getViewProjection=function(){return this._camera.updateMatrix(),this._camera.viewProjection},a.getParticleOptions=function(){return{gl:this.gl,engine:this.glRenderer,cachePrefix:0,independentEmitter:this.independentEmitter}},a.invalid=function(){this.isValid=!1},a.destroy=function(){this.setRootNode(null),this.dispose(),this._destroyed=!0,this.glRenderer.destroy()},a._traverseRenderList=function(e){var t=this._rootNode.children,n=this._camera;n.updateMatrix();var r=this.glRenderer;r.camera=n;for(var i=0;i<t.length;i++){t[i].addToRenderList(e,r)}},a.render=function(){this.dispose();var e=this._renderList.reset();this._traverseRenderList(e),e.render()},a.destroyNode=function(e){e&&(e.parent&&e.parent.removeChild(e),Object(i.a)(this.unusedNodes,e))},a.setRootNode=function(e){this._programUsage&&(this.glRenderer.addProgramUsage(this._programUsage),this._programUsage=null),this._rootNode&&this.destroyNode(this._rootNode),this._rootNode=e},a.destroyTexture=function(e){e&&e.destroy&&e.destroy()},a.destroyPrecompiled=function(e){this.glRenderer.removeProgramUsage(e)},a.precompile=function(e){var t=function e(t,n,r,a){void 0===r&&(r=[]);void 0===a&&(a=[]);var o=t.precompile(),s=[];if(o){o.particleMesh&&s.push(o.particleMesh),o.trailMesh&&s.push(o.trailMesh);var u=o.spriteItem;if(u){var c=u.cacheId;-1===r.indexOf(c)&&(s.push(o.createMesh(n)),r.push(c))}}for(var l=0;l<s.length;l++){var f=s[l].material,h=f.shaderCacheId;n.getProgram(f),Object(i.a)(a,h)}return t._items.forEach((function(t){return e(t,n,r,a)})),a}(e,this.glRenderer),n=this.gl;return n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),this._programUsage=t,t},a.dispose=function(){var e=this.glRenderer;this.unusedNodes.forEach((function(t){t.destroyByRenderer(e)})),this.unusedNodes.length=0},t=e,(n=[{key:"camera",get:function(){return this._camera.params},set:function(e){if(e){var t=this.gl;this._camera.setParams(e,{aspect:t.drawingBufferWidth/t.drawingBufferHeight})}}},{key:"canvas",get:function(){return this.gl.canvas}},{key:"supportWebGL",get:function(){return!!this.gl}},{key:"cameraPosition",get:function(){return this._camera.params.position}},{key:"destroyed",get:function(){return this._destroyed||this.glRenderer._destroyed}}])&&ne(t.prototype,n),r&&ne(t,r),e}();function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ae=function(){function e(e){this.canvas=e,this._compRenderers=[],this._renderList=new te,this._textureCache=[],this._programCache={}}var t,n,r,a=e.prototype;return a.init=function(e){this.gl=this.canvas.getContext("webgl",{preserveDrawingBuffer:e.preserveDrawingBuffer,alpha:e.alpha,stencil:!0,antialias:!0}),this.gl&&(this._supportWebGL=!0,this._glState=new G(this.gl)),this.pixelRatio=e.pixelRatio||1,this.resize(this.canvas.width,this.canvas.height)},a.resize=function(e,t){var n,r=this.pixelRatio||1,i=this.canvas,a=e*r,o=t*r;i.width===a&&i.height===o||(i.style.width=e+"px",i.style.height=t+"px",i.width=a,i.height=o,null==(n=this.gl)||n.viewport(0,0,a,o))},a.render=function(){var e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);for(var t=this._compRenderers,n=!1,r=this._renderList.reset(),i=0;i<t.length;i++){var a=t[i];a.destroyed?(n=!0,t[i]=null):(a.dispose(),a._traverseRenderList(r))}r.render(),n&&(this._compRenderers=this._compRenderers.filter((function(e){return e})))},a.invalid=function(){},a.destroy=function(e){this._compRenderers.forEach((function(e){return e.destroy()})),this._compRenderers=[];var t=this.gl;this._textureCache.forEach((function(e){return t.deleteTexture(e)})),this._textureCache=[],Object(i.d)(this._programCache,(function(e){return null==e?void 0:e.destroy()}))},a.createCompositionRenderer=function(e){var t=new Y(this.gl,{glState:this._glState,textureCache:this._textureCache,programCache:this._programCache,keepResource:e&&e.keepResource}),n=new re({glRenderer:t});return this._compRenderers.push(n),n},t=e,(n=[{key:"supportWebGL",get:function(){return this._supportWebGL}}])&&ie(t.prototype,n),r&&ie(t,r),e}();function oe(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ue=a.TEXTURE_2D,ce=function(){function e(e){var t=e.gl;t&&(this.gl=t,this._glTexture=t.createTexture(),this.renderer=e,Object(i.a)(e._texCache,this._glTexture))}var t,n,r,a=e.prototype;return a.activeTexture=function(e){var t=this.gl;return t?(t.activeTexture(t.TEXTURE0+e),t.bindTexture(ue,this._glTexture),e):console.error("texture has been destroyed")},a._createTexture=function(e){var t,n,r=e.format,i=e.type,a=e.data,o=this.gl,s=o.getParameter(o.TEXTURE_BINDING_2D);o.bindTexture(ue,this._glTexture);var u=o.getParameter(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL);if(u&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.compressed)if(t=e.width,n=e.height,e.mipmaps){for(var c=0;c<e.mipmaps.length;c++){var l=e.mipmaps[c];o.compressedTexImage2D(ue,c,e.internalFormat,l.width,l.height,0,l.data)}o.generateMipmap(ue)}else o.compressedTexImage2D(ue,0,e.internalFormat,e.width,e.height,0,e.image),e.minFilter=o.LINEAR;else if(a)this.isDataTexture=!0,t=a.width,n=a.height,o.texImage2D(ue,0,r,t,n,0,r,i,a.data);else{var f=this.resizeImage(e.image);t=f.width,n=f.height,o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,+e.flipY),o.texImage2D(ue,0,r,r,i,f),o.generateMipmap(ue)}return this._width=t,this._height=n,u&&o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),o.texParameteri(ue,o.TEXTURE_MIN_FILTER,e.minFilter),o.texParameteri(ue,o.TEXTURE_MAG_FILTER,e.magFilter),o.texParameteri(ue,o.TEXTURE_WRAP_S,e.wrapS),o.texParameteri(ue,o.TEXTURE_WRAP_T,e.wrapT),o.bindTexture(o.TEXTURE_2D,s),this},a.bufferVideo=function(e){var t=this.gl,n=this._glTexture;e&&(t.bindTexture(ue,n),t.texImage2D(ue,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,e))},a.destroy=function(){var e=this.gl;e&&(e.deleteTexture(this._glTexture),this._glTexture=this.gl=null,Object(i.c)(this.renderer._texCache,this._glTexture))},a.resizeImage=function(e){if(e){var t=e.width,n=e.height,r=oe(t),i=oe(n);if(i!==n||r!==t){var a=document.createElement("canvas");return a.width=r,a.height=i,a.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r,i),console.warn("image resize from "+t+"x"+n+" to "+r+"x"+i),a}return e}},t=e,(n=[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}])&&se(t.prototype,n),r&&se(t,r),e}(),le=1,fe=function(){function e(e){this.options=e,this.isTextureContainer=!0,this.id=le++}var t=e.prototype;return t.updateVideo=function(){var e=this.options;e.isVideo&&this._texture&&this._texture.bufferVideo(e.image)},t.init=function(e){var t=this;if(!this._texture){var n=this.options;if(n.src){var r=this._texture=new ce(e);Object(i.i)(n.src).then((function(e){var n=t.options;r._createTexture(Object(i.k)({},n,{data:null,image:e}))}))}else this._texture=n.compressed?function(e,t){var n=new he(e.data,1);e.compressed=0===n.glType,e.type=n.glType,e.width=n.pixelWidth,e.height=n.pixelHeight,e.internalFormat=n.glInternalFormat,e.format=n.glFormat,e.isCubemap=6===n.numberOfFaces,n.numberOfMipmapLevels>=Math.floor(Math.log2(Math.max(e.width,e.height))+1)?(e.mipmaps=n.mipmaps(!0),e.image=e.mipmaps[0].data):(e.mipmaps=null,e.image=n.mipmaps(!1)[0].data);return new ce(t)._createTexture(e)}(n,e):new ce(e)._createTexture(n),n.isVideo?n.image.addEventListener("ended",(function(e){n.isVideo=!1,n.image=null,e.target.src=""})):n.image instanceof Image&&(n.src=n.image.src,n.image=null);this._texture.id=this.id}return this._texture},t.destroy=function(){this._texture&&(this._texture.destroy(),this._texture=null)},e}();Object.defineProperty(ce.prototype,"isTexture",{value:!0,writable:!1,enumerable:!1});var he=function(){function e(e,t,n){void 0===n&&(n=0),this.arrayBuffer=e,this.baseOffset=n;var r=new Uint8Array(this.arrayBuffer,this.baseOffset,12);if(171===r[0]&&75===r[1]&&84===r[2]&&88===r[3]&&32===r[4]&&49===r[5]&&49===r[6]&&187===r[7]&&13===r[8]&&10===r[9]&&26===r[10]&&10===r[11]){var i=Uint32Array.BYTES_PER_ELEMENT,a=new DataView(this.arrayBuffer,this.baseOffset+12,13*i),o=67305985===a.getUint32(0,!0);this.glType=a.getUint32(1*i,o),this.glTypeSize=a.getUint32(2*i,o),this.glFormat=a.getUint32(3*i,o),this.glInternalFormat=a.getUint32(4*i,o),this.glBaseInternalFormat=a.getUint32(5*i,o),this.pixelWidth=a.getUint32(6*i,o),this.pixelHeight=a.getUint32(7*i,o),this.pixelDepth=a.getUint32(8*i,o),this.numberOfArrayElements=a.getUint32(9*i,o),this.numberOfFaces=a.getUint32(10*i,o),this.numberOfMipmapLevels=a.getUint32(11*i,o),this.bytesOfKeyValueData=a.getUint32(12*i,o),this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===t?0===this.glType?this.loadType=0:this.loadType=2:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")}else console.error("texture missing KTX identifier")}return e.prototype.mipmaps=function(e){for(var t=[],n=64+this.bytesOfKeyValueData,r=this.pixelWidth,i=this.pixelHeight,a=e?this.numberOfMipmapLevels:1,o=0;o<a;o++){for(var s=new Int32Array(this.arrayBuffer,this.baseOffset+n,1)[0],u=0;u<this.numberOfFaces;u++){var c=new Uint8Array(this.arrayBuffer,this.baseOffset+n+4,s);t.push({data:c,width:r,height:i}),n+=s+4,n+=3-(s+3)%4}r=Math.max(1,.5*r),i=Math.max(1,.5*i)}return t},e}(),de={constants:a,createTextureContainer:function(e){return new fe(e)},createMatrix4:function(){return{elements:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},createMaterial:function(e){return new x(e)},createGeometry:function(e){return new l(e)},createMesh:function(e){return new b(e)},createNode:function(e){return new S(e)},createPlayerRenderer:function(e){return new ae(e)},Node:S,Mesh:b,Geometry:l,CompositionRenderer:re,WebGLRenderer:Y,Camera:$,WebGLState:G};t.default=de;"object"==typeof window&&(window.__MarsRI__=de)},function(e,t,n){"use strict";n.r(t),n.d(t,"ri",(function(){return ee}));var r,i,a,o=n(8),s=n(0),u=n(2),c={};function l(e){for(var t in e)/^[A-Z_]/.test(t)&&(c[t]=e[t])}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}l(WebGLRenderingContext),l(WebGLRenderingContext.prototype);var _=((r={})[c.FLOAT]=Float32Array,r[c.UNSIGNED_INT]=Uint32Array,r[c.INT]=Int32Array,r[c.UNSIGNED_SHORT]=Uint16Array,r),m=((i={})[c.UNSIGNED_BYTE]=u.IndexFormat.UInt8,i[c.UNSIGNED_SHORT]=u.IndexFormat.UInt16,i[c.UNSIGNED_INT]=u.IndexFormat.UInt32,i),p=function(){this.vertexBufferMap={},this.dataMaps={},this.updateFlags={}},v=function(){this.updateFlag={start:Number.MAX_SAFE_INTEGER,end:Number.MIN_SAFE_INTEGER}},g=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.prototype.render=function(){this.geometry&&this.geometry._update(),u.GeometryRenderer.prototype.render.apply(this,arguments)},t}(u.GeometryRenderer),y=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).updateBufferWithDiscard=!1,t._vertexData=new p,t._indexData=new v,t}h(t,e);var n,r,i,a=t.prototype;return a.getAttributeNames=function(){return this._attrNames},a.getAttributeSize=function(e){return this._primitive._vertexElementMap[e].elementInfo.size},a.getAttributeData=function(e){return this._vertexData.dataMaps[e]},a.setAttributeData=function(e,t){var n=this._vertexData,r=n.dataMaps,i=n.updateFlags[e];r[e]=t,this.updateBufferWithDiscard||(i.start=0,i.end=t.length)},a.setAttributeSubData=function(e,t,n){var r=this._vertexData,i=r.dataMaps,a=r.updateFlags;i[e].set(n,t),this.updateBufferWithDiscard||this._compareUpdateFlag(a[e],t,t+n.length)},a.setIndexSubData=function(e,t){this._indexData.indexBufferData.set(t,e),this.updateBufferWithDiscard||this._compareUpdateFlag(this._indexData.updateFlag,e,e+t.length)},a.setIndexData=function(e){if(this._indexData.indexBufferData=e,!this.updateBufferWithDiscard){var t=this._indexData.updateFlag;t.start=0,t.end=e.length}},a.getIndexData=function(){return this._indexData.indexBufferData},a.resetData=function(){var e=this,t=this._vertexData.dataMaps;Object(s.d)(t,(function(t,n){e.setAttributeData(n,new t.constructor(0))}));var n=this.getIndexData();this.setIndexData(new n.constructor(0))},a.initialize=function(e,n,r){var i=this,a=this._vertexData,o=a.dataMaps,l=a.vertexBufferMap,f=a.updateFlags,h=0,d=[];if(Object(s.d)(e,(function(e,n){var a=t._vertexSizeMap[e.size],s=new u.VertexElement(n,0,a,h),c=s.elementInfo,m=c.type,p=c.size,v=new _[m](e.data||0);f[n]={start:Number.MAX_SAFE_INTEGER,end:Number.MIN_SAFE_INTEGER},o[n]=v;var g=new u.Buffer(r,u.BufferBindFlag.VertexBuffer,0,u.BufferUsage.Dynamic);l[n]=g,i.setVertexBufferBinding(new u.VertexBufferBinding(g,4*p),h++),d.push(s),i.setAttributeData(n,v)})),this.setVertexElements(d),this._attrNames=Object.keys(o),n){var p=new u.Buffer(r,u.BufferBindFlag.IndexBuffer,0,u.BufferUsage.Dynamic),v=n.type||c.UNSIGNED_SHORT,g=this._indexData,y=new _[v](n.data||0);g.indexBufferData=y,g.indexBuffer=p,this.setIndexBufferBinding(p,m[v]),this.setIndexData(y)}return this._initData={attributes:e,index:n,engine:r},this},a._update=function(){var e=this._vertexData,t=e.dataMaps,n=e.vertexBufferMap,r=e.updateFlags;for(var i in n){var a=n[i],o=t[i],s=o.byteLength;if(s>a.byteLength&&a.resize(s),this.updateBufferWithDiscard)a.setData(o,0,0,o.length,u.SetDataOptions.Discard);else{var c=r[i],l=c.start,f=c.end;l!=Number.MAX_SAFE_INTEGER&&(a.setData(o,4*l,l,f-l),c.start=Number.MAX_SAFE_INTEGER,c.end=Number.MIN_SAFE_INTEGER)}}var h=this._indexData,d=h.indexBuffer;if(d){var _=h.indexBufferData,m=_.byteLength;if(m>d.byteLength&&d.resize(m),this.updateBufferWithDiscard)d.setData(_,0,0,_.length,u.SetDataOptions.Discard);else{var p=h.updateFlag,v=p.start,g=p.end;v!=Number.MAX_SAFE_INTEGER&&(d.setData(_,v*_.BYTES_PER_ELEMENT,v,g-v),p.start=Number.MAX_SAFE_INTEGER,p.end=Number.MIN_SAFE_INTEGER)}}},a._compareUpdateFlag=function(e,t,n){e.start=Math.min(e.start,t),e.end=Math.max(e.end,n)},a.destroy=function(){this._primitive&&(this._primitive.destroy(!0),this._primitive=null),this._vertexData&&Object(s.d)(this._vertexData.vertexBufferMap,(function(e){e.destroy(!0)})),this._indexData&&this._indexData.indexBuffer.destroy(!0),this._indexData=this._vertexData=null},a.clone=function(){var e=this,n=this._initData,r=new t(n.engine,this.name);r.initialize(n.attributes,n.index,n.engine);var i=this.getIndexData();return i&&r.setIndexData(i),Object(s.d)(n.attributes,(function(t,n){r.setAttributeData(n,e.getAttributeData(n))})),r},n=t,(r=[{key:"drawCount",get:function(){return this.subGeometry.count},set:function(e){this.subGeometry.count=e}},{key:"drawStart",get:function(){return this.subGeometry.offset},set:function(e){this.subGeometry.offset=0}}])&&f(n.prototype,r),i&&f(n,i),t}(u.BufferGeometry);y._vertexSizeMap={1:u.VertexElementFormat.Float,2:u.VertexElementFormat.Vector2,3:u.VertexElementFormat.Vector3,4:u.VertexElementFormat.Vector4};var E,T,x=((a={})[c.LINES]=u.PrimitiveTopology.Lines,a[c.TRIANGLE_FAN]=u.PrimitiveTopology.TriangleFan,a[c.TRIANGLE_STRIP]=u.PrimitiveTopology.TriangleStrip,a[c.LINE_STRIP]=u.PrimitiveTopology.LineStrip,a[c.LINE_LOOP]=u.PrimitiveTopology.LineLoop,a[c.POINTS]=u.PrimitiveTopology.Points,a);function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O={float:u.DataType.FLOAT,vec2:u.DataType.FLOAT_VEC2,vec3:u.DataType.FLOAT_VEC3,vec4:u.DataType.FLOAT_VEC4,bool:u.DataType.BOOL,mat2:u.DataType.FLOAT_MAT2,mat3:u.DataType.FLOAT_MAT3,mat4:u.DataType.FLOAT_MAT4,int:u.DataType.INT,sampler2D:u.DataType.SAMPLER_2D,samplerCube:u.DataType.SAMPLER_CUBE},b=((E={})[c.FLOAT]=u.DataType.FLOAT_ARRAY,E[c.FLOAT_VEC2]=u.DataType.FLOAT_VEC2_ARRAY,E[c.FLOAT_VEC3]=u.DataType.FLOAT_VEC3_ARRAY,E[c.FLOAT_VEC4]=u.DataType.FLOAT_VEC4_ARRAY,E[c.SAMPLER_2D]=u.DataType.SAMPLER_2D_ARRAY,E);var M=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,n.engine,n.name)||this)._technique=t,r.renderType=u.MaterialType.TRANSPARENT,r.renderOrder=n.renderOrder,r.shaderCacheId=n.shaderCacheId,r._initData=n,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,A(t,n);var i=r.prototype;return i.setValue=function(t,n){var r=this._technique;if(r){var i=r.uniforms[t];if(i){var a=i._tempVal;Object(s.g)(a)&&(n=a.setValueByArray(n))}}e.prototype.setValue.call(this,t,n)},i.clone=function(){var e=R(this._initData);return Object(s.d)(this._values,(function(t,n){if(Object(s.g)(t)&&t.toArray){var r=[];t.toArray(r),e.setValue(n,r)}else e.setValue(n,t)})),e},r}(u.Material),S=((T={})[u.DataType.FLOAT_VEC2]=u.Vector2,T[u.DataType.FLOAT_MAT3]=u.Matrix3x3,T[u.DataType.FLOAT_MAT4]=u.Matrix,T[u.DataType.FLOAT_VEC3]=u.Vector3,T[u.DataType.FLOAT_VEC4]=u.Vector4,T);function R(e){var t=function(e,t){for(var n,r=/\buniform[\s\t]+((float|mat|vec|bool|int|sampler2D|samplerCube)[234]?)[\s\t]+([\w_\d]+)\b/gm,i={};n=r.exec(e);){i[n[3]]=O[n[1]]}for(;n=r.exec(t);){i[n[3]]=O[n[1]]}return i}(e.fragmentShader,e.vertexShader),n={};Object(s.d)(e.uniforms,(function(e,r){Object(s.f)(e)?n[r]={name:r,type:e||t[r]}:Object(s.h)(e)?n[r]={name:r,type:t[r],semantic:u.UniformSemantic[e]}:e instanceof Array&&(n[r]={name:r,type:b[e[0]]});var i=n[r].type,a=S[i];a&&(n[r]._tempVal=new a)})),e.samplers.forEach((function(e){if(Object(s.h)(e))n[e]={name:e,type:t[e]};else{var r=e;e=r.name;var i=r.type;n[e]={name:e,type:Array.isArray(i)?b[i[0]]:i}}}));var r=function(e){for(var t,n=/\battribute[\s\t]+((float|mat|vec|bool|int)[234]?)[\s\t]+([\w_\d]+)\b/gm,r={};t=n.exec(e);){r[t[3]]=O[t[1]]}return r}(e.vertexShader),i={};e.attributes.forEach((function(e){if(e.indexOf("#")>-1){var t=e.split("#");e=t[0],i[t[0]]={name:e,type:r[e],semantic:t[1]}}else i[e]={name:e,type:r[e],semantic:e}}));var a=new u.RenderTechnique(e.name);a.isValid=!0,a.attributes=i,a._uniforms=n,a.vertexShader=e.vertexShader,a.fragmentShader=e.fragmentShader,a.autoConvert=!1;var o=e.states,l=o.side||1032,f=o.stencilTest;return a.states={disable:[],enable:[u.RenderState.BLEND],functions:{depthMask:[o.depthMask],frontFace:[c.CCW]}},1032===l?a.states.disable.push(u.RenderState.CULL_FACE):1028===l?a.states.functions.cullFace=[c.BACK]:1029===l&&(a.states.functions.cullFace=[c.FRONT]),o.blendEquation&&(a.states.functions.blendEquationSeparate=[o.blendEquation,o.blendEquationAlpha]),"blendDstAlpha"in o||(o.blendDstAlpha=c.ONE_MINUS_SRC_ALPHA,o.blendSrcAlpha=c.ONE),a.states.functions.blendFuncSeparate=[o.blendSrc,o.blendDst,o.blendSrcAlpha,o.blendDstAlpha],f?(a.states.enable.push(c.STENCIL_TEST),a.states.functions.stencilFunc=[o.stencilFunc,o.stencilFuncRef,o.stencilFuncMask],a.states.functions.stencilOp=[o.stencilOpFail,o.stencilOpZFail,o.stencilOpZPass],a.states.functions.stencilMask=[o.stencilMask]):a.states.disable.push(c.STENCIL_TEST),Object.defineProperty(a,"_needCompile",L),new M(a,e)}var L={get:function(){return!1},set:function(){}};function C(e,t,n){var r={};return function e(t,n,r,i){var a=t.precompile(),o=[];if(a){a.particleMesh&&o.push(a.particleMesh),a.trailMesh&&o.push(a.trailMesh);var s=a.spriteItem;if(s){var u=s.shaderCacheId;if(-1===n.indexOf(u)){var c=a.createMesh(r);o.push(c),n.push(u),c.geometry.destroy()}}}for(var l=0;l<o.length;l++){var f=o[l],h=f.material.shaderCacheId;if(!i[h]){var d=f.material._technique;I(d,r)?i[h]=d:f.disabled=!0}}t._items.forEach((function(t){return e(t,n,r,i)}))}(e,[],t,r),r}function I(e,t){return u.GLShaderProgram.requireProgram(e,t._hardwareRenderer.gl)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var P=function(){function e(e){var t=this.engine=e.engine;this.gl=t._hardwareRenderer.gl,this._container=e.container,this.unsedNode=[],this._tempVPMat4=new u.Matrix,this.parent=e.parent,this.independentEmitter=e.independentEmitter,this.cameraLayer=e.cameraLayer,e.cameraComp?this.cameraComp=e.cameraComp:this.cameraLayer&&this.createCamera()}var t,n,r,i=e.prototype;return i.createRenderNode=function(e){var t=this.parent.createRenderNode(e);return t&&N(t,this.cameraLayer),t},i.createCamera=function(){var e=this._cameraNode=this._container.createChild("camera:"+this.cameraLayer),t=this.cameraComp=e.addComponent(u.Camera);this.cameraLayer&&(t.cullingMask=e.layer=this.cameraLayer),t.setClearMode(0),e.transform.lookAt(new u.Vector3)},i.setRootNode=function(e){this._rootNode&&(this._container.removeChild(this._rootNode),this.destroyNode(this._rootNode),this._rootNode.addChild=s.j),this._rootNode=e,e&&(N(e,this.cameraLayer),this._container.addChild(e))},i.dispose=function(){this.unsedNodes&&(this.unsedNodes.forEach((function(e){null==e||e.destroy()})),this.unsedNodes.length=0)},i.destroyTexture=function(e){e&&e.destroy&&e.destroy()},i.getParticleOptions=function(){return{engine:this.engine,independentEmitter:this.independentEmitter}},i.getViewProjection=function(){var e=this.cameraComp;if(e){var t=this._tempVPMat4;return u.Matrix.multiply(e.projectionMatrix,e.viewMatrix,t),t.elements}return new Float32Array(16)},i.precompile=function(e){return C(e,this.engine)},i.destroyPrecompiled=function(e){var t,n;t=e,n=this.engine,Object(s.d)(t,(function(e,t){n.renderhardware.assetsCache.requireObject(e,u.GLTechnique).finalize(!0)}))},i.destroyNode=function(e){this.unsedNodes||(this.unsedNodes=[]),this._rootNode&&this._rootNode.removeChild(e),Object(s.e)(e.destroy)&&Object(s.a)(this.unsedNodes,e)},i.destroy=function(){this.parent&&(this.setRootNode(null),this._cameraNode&&this._cameraNode.destroy(),this._container=this.parent=null),this.dispose()},t=e,(n=[{key:"baseRenderOrder",set:function(e){e&&(this.cameraComp.priority=e)}},{key:"camera",get:function(){return this._camera},set:function(e){var t=this._camera={near:e.near||.1,far:e.far||20,fov:e.fov||60},n=this.cameraComp;if(n){var r=n.entity.transform,i=e.position||[0,0,0];i&&(t.position=[i[0],i[1],i[2]],r.setPosition(i[0],i[1],i[2]));var a=e.rotation||[0,0,0];a&&(t.rotation=[a[0],a[1],a[2]],r.setRotation(a[0],a[1],a[2])),n.aspectRatio=this.canvas.width/this.canvas.height,n.farClipPlane=t.far,n.nearClipPlane=t.near,n.fieldOfView=t.fov}}},{key:"canvas",get:function(){return this.gl.canvas}}])&&w(t.prototype,n),r&&w(t,r),e}();function N(e,t){t&&(e.layer=t,e.children.forEach((function(e){return N(e,t)})))}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var U=Math.pow(2,-31),V=u.MathUtil.degreeToRadFactor,B=Math.cos,H=Math.sin,z=new u.Quaternion,G=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,n,t.name)||this).setMeshes([]),Object(s.k)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r),t),r._isViewMatrixDirty=r.transform.registerWorldChangeFlag(),r.addComponent(u.Script).onUpdate=function(){r._dirty&&(r._setMeshes(r._omeshes),r._empMeshes=null,r._dirty=!1)},r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,D(t,n);var i,a,o,c=r.prototype;return c.getChildByName=function(e){return this.findByName(e)},c.getModelMatrix=function(){return this.transform.localMatrix.elements},c.setMeshes=function(e){this._dirty=!0,this._omeshes=e},c._setMeshes=function(){var e=this,t={},n=[];this._omeshes.map((function(r){if(!r.disabled){var i=e.addComponent(g);i.geometry=r.geometry,i.material=r.material;var a=r.material.renderOrder||0,o=t[a];isNaN(o)?t[a]=1:(t[a]++,a+=o*U),i.renderPriority=a,r._component=i,n.push(i)}})),this._meshRenderers&&this._meshRenderers.forEach((function(e){return e.destroy()})),this._meshRenderers=n},c.removeMesh=function(e){var t=this.getMeshes(),n=t.indexOf(e);n>-1&&(t.splice(n,1),this.setMeshes(t))},c.getMeshes=function(){return this._omeshes},c.addChild=function(t){e.prototype.addChild.call(this,t),N(t,this.layer)},c.addMesh=function(e,t){var n=this.getMeshes();isNaN(t)?n.push(e):n.splice(t,0,e),this.setMeshes(n)},c.setPosition=function(e,t,n){this.transform.setPosition(e,t,n)},c.getPosition=function(){var e=this.transform.position;return[e.x,e.y,e.z]},c.setRotation=function(e,t,n){this._rotationEuler(e*V,t*V,n*V),this.transform.setRotationQuaternion(z.x,z.y,z.z,z.w)},c.setScale=function(e,t,n){this.transform.setScale(e,t,n)},c.updateMatrixWorld=function(){this._isViewMatrixDirty.flag&&(this._isViewMatrixDirty.flag=!1,this.transform.worldMatrix)},c.getWorldMatrix=function(){return this.transform.worldMatrix.elements},c.destroy=function(){var t;e.prototype.destroy.call(this),null==(t=this._meshRenderers)||t.forEach((function(e){return e.destroy()}))},c._rotationEuler=function(e,t,n){var r=B(e/2),i=B(t/2),a=B(n/2),o=H(e/2),s=H(t/2),u=H(n/2);z.x=o*i*a-r*s*u,z.y=r*s*a+o*i*u,z.z=r*i*u-o*s*a,z.w=r*i*a+o*s*u},i=r,(a=[{key:"visible",get:function(){return this.isActive},set:function(e){this.isActive=!!e}}])&&F(i.prototype,a),o&&F(i,o),r}(u.Entity);G.prototype.isNode=!0;var k=u.Entity.prototype.createChild;function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}u.Entity.prototype.createChild=function(){var e=k.apply(this,arguments);return e.layer=this.layer,e};var X=function(){function e(e){this.canvas=e,this._cl=0}var t,n,r,i=e.prototype;return i.invalid=function(){this._invalid=!0},i.getChildByName=function(e){return this.engine.sceneManager.activeScene.rootEntities.find((function(t){return t.name===e}))},i.createFramebuffer=function(e){throw Error("not implement")},i.destroyFramebuffer=function(e,t){throw Error("not implement")},i.init=function(e){this.pixelRatio=e.pixelRatio;var t,n=this.canvas;if(n){try{this.resize(n.width,n.height),t=this.engine=new u.Engine(new u.WebCanvas(n),new u.WebGLRenderer({alpha:e.alpha,preserveDrawingBuffer:!!e.preserveDrawingBuffer,stencil:!0,antialias:!0,webGLMode:u.WebGLMode.WebGL1}))}catch(e){}if(t){var r=t.sceneManager.activeScene,i=t.createEntity();r.addRootEntity(i),this._rootNode=i,i.addComponent(u.AmbientLight),t.update(),this.init=s.j}}},i.loadGLTFFilesAsync=function(e){var t=this,n=this.engine;if(!n)return Promise.reject("lost webgl");var r=n.resourceManager,i={};return this._gltfMap&&(this._gltfMap={}),Promise.all(e.map((function(e,t){return r.load({url:e,type:u.AssetType.Perfab}).then((function(e){return i[t]=e}))}))).then((function(){return t._resetGLTFMap(i,n)}))},i._resetGLTFMap=function(e,t){var n=this;function r(e){var t=e.getComponent(u.Camera);e.children.forEach(r),t&&t.destroy()}return this._gltfMap=e,Object(s.d)(this._gltfMap,(function(e){r(e.defaultSceneRoot);var i=n._rootNode.addComponent(u.Camera);!function(e,t,n){e.nodes.forEach((function(e){e._components.forEach((function(e){if(e instanceof u.MeshRenderer){var r=e.mesh.primitives,i=e._sharedMaterials;if(r)for(var a=0,o=i.length;a<o;a++){var s=i[a];if(s){var c=u.RenderContext._getRenderContext(n);s.prepareDrawing(c,e,r[a]),I(s.technique,t)}}}}))}))}(e,t,i),i.destroy()})),e},i.createRenderNode=function(e){var t=this._gltfMap[e.gltf];if(t){var n=t.defaultSceneRoot;if(e.root){var r=n.findByName(e.root);r&&(n=r)}var i,a=n.clone();Number.isInteger(+e.animation)?i=t.animations[e.animation]:e.animation&&(i=t.animations.find((function(t){return t.name===e.animation}))),i&&a.getComponent(u.Animation).playAnimationClip(i.name,{wrapMode:e.looping?u.WrapMode.LOOP:u.WrapMode.ONCE});var o=new G({name:e.name},this.engine);return o.addChild(a),o}},i.createCompositionRenderer=function(){var e=this._cl++;return new P({engine:this.engine,parent:this,container:this._rootNode,cameraLayer:1<<e%16+1})},i.resize=function(e,t){var n=this.pixelRatio||1,r=e*n,i=t*n,a=this.canvas;if(a.width!==r||a.height!==i){if(this.engine){var o=this.engine.canvas;o.width=e*n,o.height=t*n}a.width=e*n,a.height=t*n,a.style.width=e+"px",a.style.height=t+"px"}},i.render=function(){if(this._invalid){var e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this.engine.update(),this._invalid=!1}},i.destroy=function(){this.engine&&(this.engine.renderhardware.destroy(),Object.values(this.engine._resourceManager._refObjectPool).forEach((function(e){e.destroy&&e.destroy(!0)})),this.engine.destroy(),this.engine=null,this.render=s.j)},t=e,(n=[{key:"gl",get:function(){return this.engine._hardwareRenderer.gl}},{key:"isInvalid",get:function(){return this._invalid}},{key:"supportWebGL",get:function(){return!!this.engine}}])&&j(t.prototype,n),r&&j(t,r),e}(),W=n(13);function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Y=1,K=[],Q=function(e){var t,n;function r(t){var n;n=e.call(this,t)||this;var r=t._hardwareRenderer,i=r.gl;return n._rhi=r,n._target=i.TEXTURE_2D,n._glTexture=i.createTexture(),K.push(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,q(t,n);var i=r.prototype;return i._createTexture=function(e){var t=e.image=this.resizeImage(e.image),n=e.format,r=e.type,i=e.data,a=this._rhi.gl,o=(t||i).width,u=(t||i).height;return a.bindTexture(a.TEXTURE_2D,this._glTexture),i?(this.isDataTexture=!0,a.texImage2D(a.TEXTURE_2D,0,n,o,u,0,n,r,i.data)):(a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,+e.flipY),a.texImage2D(a.TEXTURE_2D,0,n,n,r,t),Object(s.g)(t)&&t.videoWidth&&(o=t.videoWidth,u=t.videoHeight),Object(W.a)(o)&&Object(W.a)(u)&&a.generateMipmap(a.TEXTURE_2D)),this._width=o,this._height=u,a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e.minFilter),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e.magFilter),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e.wrapS),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,e.wrapT),a.bindTexture(a.TEXTURE_2D,null),this},i.bufferVideo=function(e){var t=this._rhi,n=this._glTexture;if(t&&n){var r=t.gl;e&&(r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGB,r.RGB,r.UNSIGNED_BYTE,e))}},i.destroy=function(){e.prototype.destroy.call(this),this._glTexture=null,Object(s.c)(K,this)},i.resizeImage=function(e){if(e){var t=e.width,n=e.height,r=Object(W.b)(t),i=Object(W.b)(n);if(i!==n||r!==t){var a=document.createElement("canvas");return a.width=r,a.height=i,a.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r,i),console.warn("image resize from "+t+"x"+n+" to "+r+"x"+i),a}return e}},r}(u.Texture),Z=function(){function e(e){this.options=e,this.isTextureContainer=!0,this.id=Y++}var t=e.prototype;return t.updateData=function(e){this._texture&&(this.options.data=e,this._texture._createTexture(this.options),delete this.options.data)},t.updateVideo=function(){var e=this.options;e.isVideo&&this._texture&&this._texture.bufferVideo(e.image)},t.init=function(e){var t=this;if(!this._texture){var n=this.options;if(n.src){var r=this._texture=new Q(e);Object(s.i)(n.src).then((function(e){var n=t.options;r._createTexture(Object(s.k)({},n,{data:null,image:e}))}))}else this._texture=n.compressed?function(e,t){var n=Object(u.parseSingleKTX)(e.data),r=n.width,i=n.height,a=n.mipmaps,o=n.engineFormat,s=new u.Texture2D(t,r,i,o,!1);if(s._glTexture)for(var c=0;c<a.length;c++){var l=a[c],f=l.width,h=l.height,d=l.data;s.setPixelBuffer(d,c,0,0,f,h)}return s}(n,e):new Q(e)._createTexture(n),n.isVideo&&n.image.addEventListener("ended",(function(e){n.isVideo=!1,n.image=null,e.target.src=""}));this._texture.isGCIgnored=!0,this._texture.id=this.id}return this._texture},t.destroy=function(){this._texture&&(this._texture.destroy(),this._texture=null)},e}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(u.Texture.prototype,"isTexture",{value:!0,writable:!1,enumerable:!1});var $=function(){function e(e,t){Object(s.k)(this,e),this.engine=t}var t,n,r,i=e.prototype;return i.setUniformValue=function(e,t){this.material.setValue(e,t)},i.getUniformValue=function(e){return this.material.getValue(e)},i.getUniformValues=function(){return this.material._values},i.setUniformValues=function(e){var t=this.material;Object(s.d)(e,(function(e,n){t.setValue(n,e)}))},i.destroy=function(){this.geometry.destroy(),this.material.destroy(!0),this._component&&this._component.destroy()},i.clone=function(){return new e({material:this.material.clone(),geometry:this.geometry.clone()},this.engine)},t=e,(n=[{key:"disabled",get:function(){return this._disabled},set:function(e){this._component&&e&&this._component.destroy(),this._disabled=e}},{key:"isMesh",get:function(){return!0}}])&&J(t.prototype,n),r&&J(t,r),e}();["x","y","z","w"].forEach((function(e,t){var n={set:function(t){this[e]=t},get:function(){return this[e]}};Object.defineProperty(u.Vector4.prototype,t+"",n),Object.defineProperty(u.Vector3.prototype,t+"",n),Object.defineProperty(u.Vector2.prototype,t+"",n)}));var ee={Mesh:$,Node:G,Geometry:y,createMatrix4:function(){return new u.Matrix},constants:c,createTextureContainer:function(e){return new Z(e)},createMaterial:R,createGeometry:function(e,t){var n=new y(t,e.name);return n.initialize(e.attributes,e.index,t),n.addSubGeometry(0,e.drawCount,x[e.mode]),e.combineSubData&&(n.updateBufferWithDiscard=!0),n},createNode:function(e,t){return new G(e,t)},createMesh:function(e){return new $(e,e.engine)},createPlayerRenderer:function(e){return new X(e)},OasisCompositionRenderer:P,texCaches:K};"object"==typeof window&&(window.__MarsRI__=ee);t.default=ee;if(Object(o.c)()){var te=WebGLRenderingContext.prototype.getExtension;WebGLRenderingContext.prototype.getExtension=function(e){return"WEBGL_compressed_texture_astc"===e?null:te.apply(this,arguments)}}Object(s.e)(Object.values)||(Object.values=function(e){return Object.keys(e).map((function(t){return e[t]}))})},function(e,t,n){"use strict";n.r(t);var r=n(4);function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,i(t,n);var a=r.prototype;return a.getMeshes=function(){return this.children},a.addMesh=function(e,t){1===arguments.length?this.addChild(e):-1===this.children.indexOf(e)&&(e.parent=this,this.children.splice(t,0,e))},a.removeMesh=function(e){this.removeChild(e)},a.setMeshes=function(e){var t=this;this.children=e.map((function(e){return e.parent=t,e}))},a.getWorldMatrix=function(){return this.worldMatrix.elements},a.getModelMatrix=function(){return this.matrix.elements},r}(r.Node),o=n(0);function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u,c=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this)._uniformValues={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n);var i=r.prototype;return i.setUniformValue=function(e,t){this._uniformValues[e]=t},i.getUniformValue=function(e){return this._uniformValues[e]},i.getUniformValues=function(){return Object(o.k)({},this._uniformValues)},i.setUniformValues=function(e){var t=this;Object(o.d)(e,(function(e,n){return t.setUniformValue(n,e)}))},r}(r.Mesh),l={get:function(e,t,n){return e.geometry.attributes[n.name]}},f={isDependMesh:!0,get:function(e,t,n){return e.getUniformValue(n.name)}},h={isDependMesh:!0,get:function(e,t,n){var i=e.getUniformValue(n.name);if(n.size>1){for(var a=new Int32Array(n.size),o=0;o<i.length;o++)a[o]=r.semantic.handlerTexture(i[o],n.textureIndex+o);return a}return r.semantic.handlerTexture(i,n.textureIndex)}};function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=((u={})[r.constants.FLOAT]=Float32Array,u[r.constants.UNSIGNED_INT]=Uint32Array,u[r.constants.INT]=Int32Array,u[r.constants.UNSIGNED_SHORT]=Uint16Array,u),p=r.constants.FLOAT,v=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).attributes={},Object.assign(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),t),n.combineSubData=t.combineSubData,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,_(t,n);var a,s,u,c=i.prototype;return c.setAttributeData=function(e,t){this.isDirty=!0,this.attributes[e].clearSubData(),this.attributes[e].data=t},c.getAttributeData=function(e){return this.attributes[e].data},c.setAttributeSubData=function(e,t,n){if(this.isDirty=!0,this.combineSubData)this.attributes[e].data.set(n,t),this.attributes[e].isDirty=!0;else{var r=this.attributes[e];this._setAttributeSubData(r,t,n),r.subDataList.length>10&&(r.isDirty=!0,r.clearSubData())}},c._setAttributeSubData=function(e,t,n){e.setSubData(t,n)},c.getIndexData=function(){return this.attributes.index.data},c.setIndexData=function(e){this.isDirty=!0,this.attributes.index.data=e},c.setIndexSubData=function(e,t){this.isDirty=!0,this.combineSubData?(this.attributes.index.data.set(t,e),this.attributes.index.isDirty=!0):this._setAttributeSubData(this.attributes.index,e,t)},c.getAttributeSize=function(e){return this.attributes[e].size},c.getAttributeNames=function(){return this._attributeNames},c.resetData=function(){var e=this.attributes;this._attributeNames.forEach((function(t){var n=e[t];n.data=new n.data.constructor(0)})),e.index.data=new e.index.data.constructor(0),this.isDirty=!0},c.initialize=function(e,t){var n=this.attributes;return Object(o.d)(e,(function(e,t){n[t]=new r.GeometryData(new m[e.type||p](e.data||0),e.size)})),this._attributeNames=Object.getOwnPropertyNames(n),n.index=new r.GeometryData(new m[t.type||r.constants.UNSIGNED_SHORT](t.data||0),t.size),this},a=i,(s=[{key:"indices",get:function(){return this.attributes.index}},{key:"drawStart",get:function(){return 0},set:function(e){}},{key:"drawCount",get:function(){return this.vertexCount},set:function(e){this.vertexCount=e}}])&&d(a.prototype,s),u&&d(a,u),i}(r.Geometry);n(8);function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){var t,n,r,i,a;function o(){return e.apply(this,arguments)||this}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,y(t,n),r=o,(i=[{key:"width",get:function(){var e=this.image;return e&&e.complete?e.width:0},set:function(e){}},{key:"height",get:function(){var e=this.image;return e&&e.complete?e.height:0},set:function(e){}},{key:"onLoad",set:function(e){this.on("load",e)}}])&&g(r.prototype,i),a&&g(r,a),o}(r.LazyTexture),T=1,x=function(){function e(e){this.options=e,this.isTextureContainer=!0,this.id=T++}var t=e.prototype;return t.init=function(e){if(!this._texture){var t=this.options;this._texture=t.compressed?(n=t.data,(new r.KTXLoader).createTexture({},n)):function(e){var t=Object(o.k)({},e);if(t.isImageCanRelease=!!e.dataReleasable,e.data){var n=e.data;t.image=e.data.data,t.isDataTexture=!0,t.width=n.width,t.height=n.height}else{if(t.src)return new E(t);var i=t.image;i&&(e.isVideo?(t.width=i.videoWidth,t.height=i.videoHeight,t.isImageCanRelease=!1,i.addEventListener("ended",(function(){i.src=""}))):(t.width=i.width,t.height=i.height))}return new r.Texture(t)}(t),this._texture.id=this.id,e&&this._texture.getGLTexture(e.state),delete t.data,delete t.image}var n;return this._texture},t.updateVideo=function(){var e=this._texture;this.options.isVideo&&e&&(e.needUpdate=!0),e.onLoad&&(e.width=e.image.videoWidth,e.height=e.image.videoHeight,e.onLoad(),e.onLoad=null)},t.destroy=function(){this._texture&&(this._texture.destroy(),this._texture=null)},e}();r.GeometryData.prototype.setSubData||(r.GeometryData.prototype.setSubData=function(e,t){this.isDirty=!0,this.data.set(t,e)});var A=r.Texture.prototype._glUploadTexture;r.Texture.prototype._glUploadTexture=function(e,t,n){if(this.compressed&&!(n instanceof Uint8Array))return console.error("invalid compressed texture");A.apply(this,arguments)};var O=n(13);function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(e){this.disposedNodes=[],this.stage=e.stage,this.gl=e.stage.renderer.gl,this._shaderCachePrefix=e._shaderCachePrefix,this._camera=e.camera,this.parent=e.parent}var t,n,i,a=e.prototype;return a.createRenderNode=function(e){return this.parent.createRenderNode(e)},a.setRootNode=function(e){this._rootNode&&(this._rootNode.removeFromParent(),this.destroyNode(this._rootNode)),this._rootNode=e,e&&this.stage.addChild(e)},a.destroyNode=function(e){e&&Object(o.e)(e.destroy)&&(Object(o.a)(this.disposedNodes,e),this.parent&&this.parent.invalid())},a.destroy=function(){if(this.stage){var e=this.stage.renderer;this.dispose(),e.resourceManager.destroyUnsuedResource(this.stage),this.parent&&this.parent.invalid(),this.parent=this.stage=null}},a.dispose=function(){var e=this.stage.renderer;e&&(this.disposedNodes.forEach((function(t){t.destroy(e,!0)})),this.disposedNodes.length=0)},a.precompile=function(e){return function(e,t,n){var i={};return function(e){e.renderer.gl&&r.glType.init(e.renderer.gl)}(t),function e(t,n,i,a,o){var s=t.precompile(),u=[];if(s){s.particleMesh&&u.push(s.particleMesh),s.trailMesh&&u.push(s.trailMesh);var c=s.spriteItem;if(c){var l=c.cacheId;-1===i.indexOf(l)&&(u.push(s.createMesh(a.renderer)),i.push(l))}}for(var f=0;f<u.length;f++){var h=u[f],d=h.material,_=d.shaderCacheId,m=void 0,p=void 0;if(o){var v=a.renderer.setupMesh(h);v.vao.draw(),p=v.program,m=r.Shader.cache.get(_)}else m=r.Shader.getCustomShader(d.vs,d.fs,"",_),(p=r.Program.getProgram(m,a.renderer.state)).useProgram();m.alwaysUse=!0,p.alwaysUse=!0,_ in n?n[_]++:n[_]=1}t._items.forEach((function(t){return e(t,n,i,a,o)}))}(e,i,[],t,n),i}(e,this.stage)},a.destroyPrecompiled=function(e){var t;t=e,Object(o.d)(t,(function(e,t){var n=r.Shader.cache.get(t);if(n){var i=r.Program.cache.get(n.id);n.destroy(),i.destroy(),i.program=null}}))},a.getParticleOptions=function(){return{cachePrefix:this._shaderCachePrefix,engine:this.stage.renderer}},a.getViewProjection=function(){return this._camera.viewProjectionMatrix.elements},a.destroyTexture=function(e){e&&e.destroy&&e.destroy()},t=e,(n=[{key:"cameraPosition",get:function(){return this._camera.position.elements}},{key:"camera",get:function(){return this._cameraParams},set:function(e){var t;if(e instanceof r.Camera)t=this._camera=e;else{(t=this._camera).near=e.near||2,t.far=e.far||20,t.fov=e.fov||60;var n=e.position,i=e.rotation;n&&t.setPosition(n[0],n[1],n[2]),i&&t.setRotation(i[0],i[1],i[2])}var a=this.canvas;t.aspect=a.width/a.height,t.right&&(t.top=t.right/t.aspect,t.bottom=-t.top),this._cameraParams={near:t.near,far:t.far,fov:t.fov,position:t.position.elements,rotation:t.rotation.elements,aspect:t.aspect}}},{key:"canvas",get:function(){return this.gl.canvas}}])&&b(t.prototype,n),i&&b(t,i),e}();function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=1,L=function(){function e(e){this.canvas=e,this._shaderCachePrefix=R++,this.disposedNodes=[],this._camera=new r.PerspectiveCamera({aspect:1,fov:60,far:20,near:2,z:8}),this._gltfMap={}}var t,n,i,a=e.prototype;return a.invalid=function(){this._invalid=!0},a.render=function(){var e=this.stage;this.stage.renderer.render(e,e.camera,!0),this._invalid=!1},a._addRenderNode=function(e){this.stage.addChild(e)},a._removeRenderNode=function(e){e.removeFromParent(),e.destroy()},a.createRenderNode=function(e){var t=this._gltfMap[e.gltf];if(t){var n=t.node;if(e.replaceCamera){var r=t.cameras[0],i={near:r.near,far:r.far,fov:r.fov};if(r&&e.root){for(n=r.parent;n&&e.root!==n.name;)n=n.parent;return n&&(i.position=[n.x,n.y,n.z],i.rotation=[n.rotationX,n.rotationY,n.rotationZ]),this.camera=i,null}}else{if(!e.root)return null;n=n.getChildByName(e.root).clone()}if(e.animation)t.anim.play(e.animation);return n}},a.loadGLTFFilesAsync=function(e){var t=this,n={};return Promise.all(e.map((function(e){return(new r.GLTFLoader).load({src:e,isProgressive:!1}).then((function(t){n[e]=t}))}))).then((function(e){return t._gltfMap=n}))},a.createCompositionRenderer=function(){return new M({_shaderCachePrefix:this._shaderCachePrefix,stage:this.stage,camera:this._camera,parent:this})},a.init=function(e){var t=this.canvas,n=this.stage=new r.Stage({canvas:t,camera:this._camera,pixelRatio:this.pixelRatio=e.pixelRatio||1,clearColor:new r.Color(0,0,0,0),width:t.width,height:t.height,alpha:e.alpha,antialias:!0,stencil:!0,preserveDrawingBuffer:!!e.preserveDrawingBuffer});new r.AmbientLight({color:new r.Color(1,1,1,1)}).addTo(this.stage);var i=n.renderer.clear,a=this;n.renderer.clear=function(){a._invalid&&(i.apply(this,arguments),a._invalid=!1)},n.tick(0),this.init=o.j},a.resize=function(e,t){this._camera.aspect=e/t,this.stage&&this.stage.resize(e,t,this.pixelRatio,!0)},a.getChildByName=function(e){return this.stage.getChildByName(e)},a.destroy=function(e){var t=this.stage;t&&(e&&t.renderer.resourceManager.reset(),t.destroy(),this.stage=null)},a.createFramebuffer=function(e){var t=this.stage.renderer;e=e||[t.width,t.height];var n=Object(O.a)(e[0])&&Object(O.a)(e[1]);return new r.Framebuffer(t,{width:e[0],height:e[1],minFilter:n?r.constants.LINEAR:r.constants.NEAREST,magFilter:n?r.constants.LINEAR:r.constants.NEAREST})},a.destroyFramebuffer=function(e,t){var n=e.texture;return t&&(e.texture=null),e.destroy(),n},t=e,(n=[{key:"gl",get:function(){return this.stage.renderer.gl}},{key:"supportWebGL",get:function(){return!!this.stage.renderer.gl}}])&&S(t.prototype,n),i&&S(t,i),e}();var C={createMatrix4:function(){return new r.Matrix4},constants:r.constants,createMaterial:function(e){var t=Object(o.k)({fs:e.fragmentShader,vs:e.vertexShader,castShadows:!1},e);return t.attributes={},t.uniforms={},delete t.states,e.attributes.forEach((function(e){return t.attributes[e]=l})),e.samplers.forEach((function(e){Object(o.g)(e)&&Object(o.h)(e.name)&&(e=e.name),t.uniforms[e]=h})),Object(o.k)(t,{depthTest:!0,transparent:!0,stencilTest:!1},e.states),Object(o.d)(e.uniforms,(function(e,n){var r;r=Object(o.f)(e)||e instanceof Array?f:e,t.uniforms[n]=r})),new r.ShaderMaterial(t)},createGeometry:function(e,t){return new v({name:e.name,drawCount:e.drawCount||0,mode:isNaN(e.mode)?r.constants.TRIANGLES:e.mode,combineSubData:e.combineSubData}).initialize(e.attributes,e.index,t)},createTextureContainer:function(e){return new x(e)},createMesh:function(e){return new c(e)},createNode:function(e){return new a(e)},Mesh:c,Node:a,createPlayerRenderer:function(e){return new L(e)}};t.default=C;"object"==typeof window&&(window.__MarsRI__=C)}])}));